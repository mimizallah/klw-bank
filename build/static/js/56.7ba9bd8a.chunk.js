(this["webpackJsonpklw-bank"]=this["webpackJsonpklw-bank"]||[]).push([[56],{1032:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(638);function a(e){e&&e.writtenProperties&&e.writtenProperties.forEach((function(e){var t=e.target,r=e.propName,a=e.newOrigin;Object(n.a)(t)&&a&&t.originOf(r)!==a&&t.updateOrigin(r,a)}))}},2215:function(e,t,r){"use strict";r.r(t),r.d(t,"save",(function(){return W})),r.d(t,"saveAll",(function(){return Z})),r.d(t,"saveAs",(function(){return ee}));var n=r(112),a=r(92),u=r(4),c=r(12),i=r(98),o=r(101),s=r(102),l=r(110),p=r(1032),f=r(412),d=r(324),b=r(817),y=r(395),v=r(197),O=r(496),m=r(818),j=r(674),h=s.a.getLogger("esri.layers.FeatureLayer"),w="Feature Service";function x(e,t){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(t)}function k(e,t){if(t.type!==w)throw new o.a("feature-layer:portal-item-wrong-type",x(e,'should have portal item of type "'.concat(w,'"')))}function g(e){return I.apply(this,arguments)}function I(){return(I=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.load();case 2:if(!Object(y.d)(t)){e.next=4;break}throw new o.a("feature-layer:save",x(t,"using an in-memory source cannot be saved to a portal item"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){var r,n=(null!==(r=e.messages)&&void 0!==r?r:[]).filter((function(e){return"error"===e.type})).map((function(e){var t=e.name,r=e.message,n=e.details;return new o.a(t,r,n)}));if(null!==t&&void 0!==t&&t.ignoreUnsupported&&(n=n.filter((function(e){var t=e.name;return"layer:unsupported"!==t&&"symbol:unsupported"!==t&&"symbol-layer:unsupported"!==t&&"property:unsupported"!==t&&"url:unsupported"!==t}))),n.length>0)throw new o.a("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}function J(e,t,r){return P.apply(this,arguments)}function P(){return(P=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="beforeSave"in t&&"function"==typeof t.beforeSave,!e.t0){e.next=4;break}return e.next=4,t.beforeSave();case 4:return a=t.write({},r),e.abrupt("return",(S(r,n),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){var t=e.layer,r=e.layerJSON;return t.isTable?{layers:[],tables:[r]}:{layers:[r],tables:[]}}function A(e){Object(j.b)(e,j.a.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((function(e,t,r){return r.indexOf(e)===t})))}function T(e){var t=e.portalItem;if(!t)throw h.error("save: requires the portalItem property to be set"),new o.a("feature-layer:portal-item-not-set",x(e,"requires the portalItem property to be set"));if(!t.loaded)throw new o.a("feature-layer:portal-item-not-loaded",x(e,"cannot be saved to a portal item that does not exist or is inaccessible"));k(e,t)}function E(e,t){return L.apply(this,arguments)}function L(){return(L=Object(c.a)(Object(u.a)().mark((function e(t,r){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",/\/\d+\/?$/.test(null!==(n=t.url)&&void 0!==n?n:"")?N(r[0]):K(t,r));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e,t){return D.apply(this,arguments)}function D(){return(D=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,c,i,o,s,l,p,f;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r[0].layer,c=n.url,i=n.customParameters,o=n.apiKey,e.next=3,t.fetchData("json");case 3:if(s=e.sent,e.t0=s&&null!=s.layers&&null!=s.tables,e.t0){e.next=9;break}return e.next=8,F(s,{url:null!==c&&void 0!==c?c:"",customParameters:i,apiKey:o},r.map((function(e){return e.layer.layerId})));case 8:s=e.sent;case 9:l=Object(a.a)(r);try{for(l.s();!(p=l.n()).done;)M((f=p.value).layer,f.layerJSON,s)}catch(u){l.e(u)}finally{l.f()}return e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,r){return R.apply(this,arguments)}function R(){return(R=Object(c.a)(Object(u.a)().mark((function e(t,r,a){var c,i,o,s,l,p,f,d,y,v,O,m;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||(t={}),(c=t).layers||(c.layers=[]),(i=t).tables||(i.tables=[]),o=r.url,s=r.customParameters,l=r.apiKey,e.next=6,Object(b.a)(o,{customParameters:s,apiKey:l});case 6:return p=e.sent,f=p.serviceJSON,d=p.layersJSON,y=U(t.layers,f.layers,a),v=U(t.tables,f.tables,a),t.layers=y.itemResources,t.tables=v.itemResources,O=[].concat(Object(n.a)(y.added),Object(n.a)(v.added)),m=d?[].concat(Object(n.a)(d.layers),Object(n.a)(d.tables)):[],e.next=15,q(t,O,o,m);case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t,r){var n=Object(i.e)(e,t,(function(e,t){return e.id===t.id}));e=e.filter((function(e){return!n.removed.some((function(t){return t.id===e.id}))}));var a=n.added.map((function(e){return{id:e.id}}));return a.forEach((function(t){var r=t.id;e.push({id:r})})),{itemResources:e,added:a.filter((function(e){var t=e.id;return!r.includes(t)}))}}function q(e,t,r,n){return z.apply(this,arguments)}function z(){return(z=Object(c.a)(Object(u.a)().mark((function e(t,r,n,a){var c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=r.map((function(e){var t=e.id;return new f.default({url:n,layerId:t,sourceJSON:a.find((function(e){return e.id===t}))})})),e.next=3,Object(l.e)(c.map((function(e){return e.load()})));case 3:c.forEach((function(e){var r=e.layerId,n=e.loaded,a=e.defaultPopupTemplate;n&&null!=a&&M(e,{id:r,popupInfo:a.toJSON()},t)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t,r){e.isTable?Q(r.tables,t):Q(r.layers,t)}function Q(e,t){if(e){var r=e.findIndex((function(e){return e.id===t.id}));-1===r?e.push(t):e[r]=t}}function Y(e){var t=e.portalItem;return Object(y.f)(e)&&!e.dynamicDataSource&&!(null===t||void 0===t||!t.loaded)&&t.type===w}function _(e){return B.apply(this,arguments)}function B(){return(B=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,c,i,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t&&t.length){e.next=2;break}throw new o.a("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");case 2:return e.next=4,Promise.all(t.map((function(e){return e.load()})));case 4:r=Object(a.a)(t),e.prev=5,r.s();case 7:if((n=r.n()).done){e.next=13;break}if(Y(c=n.value)){e.next=11;break}throw new o.a("feature-layer-utils-saveall:invalid-parameters","'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ".concat(x(c,"does not conform")),{layer:c});case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:if(i=t.map((function(e){return e.portalItem.id})),!(new Set(i).size>1)){e.next=24;break}throw new o.a("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");case 24:if(s=t.map((function(e){return e.layerId})),new Set(s).size===s.length){e.next=27;break}throw new o.a("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service");case 27:case"end":return e.stop()}}),e,null,[[5,15,18,21]])})))).apply(this,arguments)}function C(e,t){var r,n,a,u,c=O.default.from(t);return c.id&&((c=c.clone()).id=null),null!==(n=(r=c).type)&&void 0!==n||(r.type=w),null!==(u=(a=c).portal)&&void 0!==u||(a.portal=v.a.getDefault()),k(e,c),c}function G(e,t){return V.apply(this,arguments)}function V(){return(V=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,c,i,o,s,l;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url,a=t.layerId,c=t.title,i=t.fullExtent,o=t.isTable,s=Object(d.e)(n),l=null!=s&&"FeatureServer"===s.serverType,r.url=l?n:"".concat(n,"/").concat(a),r.title||(r.title=c),r.extent=null,e.t0=o||null==i,e.t0){e.next=9;break}return e.next=8,Object(j.d)(i);case 8:r.extent=e.sent;case 9:Object(j.g)(r,j.a.METADATA),Object(j.g)(r,j.a.MULTI_LAYER),Object(j.b)(r,j.a.SINGLE_LAYER),o&&Object(j.b)(r,j.a.TABLE),A(r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t,r){return H.apply(this,arguments)}function H(){return(H=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.portal,e.next=3,null===c||void 0===c?void 0:c.signIn();case 3:return e.next=5,null===c||void 0===c||null===(a=c.user)||void 0===a?void 0:a.addItem({item:t,data:r,folder:null===n||void 0===n?void 0:n.folder});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var W=Object(l.d)((function(e,t){return X.apply(this,arguments)}));function X(){return(X=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,c,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:return T(t),n=t.portalItem,a=Object(m.b)(n),e.next=7,J(t,a,r);case 7:return c=e.sent,e.next=10,E(n,[{layer:t,layerJSON:c}]);case 10:return i=e.sent,A(n),e.next=14,n.update({data:i});case 14:return Object(p.a)(a),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=Object(l.d)(function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,c,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t);case 2:return n=t[0].portalItem,a=Object(m.b)(n),e.next=6,Promise.all(t.map((function(e){return J(e,a,r)})));case 6:return c=e.sent,e.next=9,E(n,t.map((function(e,t){return{layer:e,layerJSON:c[t]}})));case 9:return i=e.sent,A(n),e.next=13,n.update({data:i});case 13:return e.next=15,Promise.all(t.slice(1).map((function(e){return e.portalItem.reload()})));case 15:return Object(p.a)(a),e.abrupt("return",n.clone());case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),ee=Object(l.d)((function(e,t,r){return te.apply(this,arguments)}));function te(){return(te=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a,c,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:return a=C(t,r),c=Object(m.b)(a),e.t0=N,e.t1=t,e.next=8,J(t,c,n);case 8:return e.t2=e.sent,e.t3={layer:e.t1,layerJSON:e.t2},i=(0,e.t0)(e.t3),e.next=13,G(t,a);case 13:return e.next=15,$(a,i,n);case 15:return t.portalItem=a,Object(p.a)(c),e.abrupt("return",a);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},601:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(4),a=r(1),u=r(12),c=r(129);function i(e,t){return o.apply(this,arguments)}function o(){return o=Object(u.a)(Object(n.a)().mark((function e(t,r){var u,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.default)(t,{responseType:"json",query:Object(a.a)(Object(a.a)({f:"json"},null===r||void 0===r?void 0:r.customParameters),{},{token:null===r||void 0===r?void 0:r.apiKey})});case 2:return u=e.sent,i=u.data,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}},638:function(e,t,r){"use strict";function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}r.d(t,"a",(function(){return n}))},817:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(4),a=r(12),u=r(601);function c(e,t){return i.apply(this,arguments)}function i(){return i=Object(a.a)(Object(n.a)().mark((function e(t,r){var a,c,i,s;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.a)(t,r);case 2:if((c=e.sent).layers=c.layers.filter(o),i={serviceJSON:c},!((null!==(a=c.currentVersion)&&void 0!==a?a:0)<10.5)){e.next=7;break}return e.abrupt("return",i);case 7:return e.next=9,Object(u.a)(t+"/layers",r);case 9:return s=e.sent,e.abrupt("return",(i.layersJSON={layers:s.layers.filter(o),tables:s.tables},i));case 11:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}function o(e){return!e.type||"Feature Layer"===e.type}},818:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var n=r(128),a=r(197);function u(e){return{origin:"portal-item",url:Object(n.Q)(e.itemUrl),portal:e.portal||a.a.getDefault(),portalItem:e,readResourcePaths:[]}}function c(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?Object(n.Q)(e.itemUrl):null,portal:e.portal||a.a.getDefault(),portalItem:e}}}}]);
//# sourceMappingURL=56.7ba9bd8a.chunk.js.map