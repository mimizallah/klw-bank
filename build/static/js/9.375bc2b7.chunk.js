(this["webpackJsonpklw-bank"]=this["webpackJsonpklw-bank"]||[]).push([[9,67],{1019:function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return N})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return F})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return x})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return v})),r.d(t,"k",(function(){return b})),r.d(t,"l",(function(){return S})),r.d(t,"m",(function(){return M}));var n=r(92),a=r(112),i=r(809),s=r(810),u="<Null>",c="equal-interval",o=1,l=5,f=10,d=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,p=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),h=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function b(e){return null==e||"string"==typeof e&&!e?u:e}function v(e){var t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,n=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!n}function m(e){var t=e.returnDistinct?Object(a.a)(new Set(e.values)):e.values,r=t.filter((function(e){return null!=e})).sort(),n=r.length,i={count:n,min:r[0],max:r[n-1]};return e.supportsNullCount&&(i.nullcount=t.length-n),e.percentileParams&&(i.median=g(t,e.percentileParams)),i}function y(e){var t,r=e.values,a=e.useSampleStdDev,i=e.supportsNullCount,s=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=null,o=null,l=null,f=null,d=0,p=null==e.minValue?-1/0:e.minValue,h=null==e.maxValue?1/0:e.maxValue,b=Object(n.a)(r);try{for(b.s();!(t=b.n()).done;){var v=t.value;Number.isFinite(v)?v>=p&&v<=h&&(c=null===c?v:c+v,s=Math.min(s,v),u=Math.max(u,v),d++):"string"==typeof v&&d++}}catch(k){b.e(k)}finally{b.f()}if(d&&null!=c){o=c/d;var m,y=0,x=Object(n.a)(r);try{for(x.s();!(m=x.n()).done;){var O=m.value;Number.isFinite(O)&&O>=p&&O<=h&&(y+=Math.pow(O-o,2))}}catch(k){x.e(k)}finally{x.f()}f=a?d>1?y/(d-1):0:d>0?y/d:0,l=Math.sqrt(f)}else s=null,u=null;var j={avg:o,count:d,max:u,min:s,stddev:l,sum:c,variance:f};return i&&(j.nullcount=r.length-d),e.percentileParams&&(j.median=g(r,e.percentileParams)),j}function g(e,t){var r=t.fieldType,n=t.value,i=t.orderBy,s=t.isDiscrete,u=x(r,"desc"===i);if(0===(e=Object(a.a)(e).filter((function(e){return null!=e})).sort((function(e,t){return u(e,t)}))).length)return null;if(n<=0)return e[0];if(n>=1)return e[e.length-1];var c=(e.length-1)*n,o=Math.floor(c),l=o+1,f=c%1,d=e[o],p=e[l];return l>=e.length||s||"string"==typeof d||"string"==typeof p?d:d*(1-f)+p*f}function x(e,t){var r=t?1:-1,n=function(e){return e?function(e,t){var r=O(e,t,!0);return null!=r?r:t-e}:function(e,t){var r=O(e,t,!1);return null!=r?r:e-t}}(t),i=j(t);if(!e||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID"].concat(Object(a.a)(p)).includes(e))return function(e,t){return"number"==typeof e&&"number"==typeof t?n(e,t):"string"==typeof e&&"string"==typeof t?i(e,t):r};if("esriFieldTypeDate"===e)return function(e,t){var a=new Date(e).getTime(),i=new Date(t).getTime();return isNaN(a)||isNaN(i)?r:n(a,i)};if(p.has(e))return function(e,t){return n(e,t)};if("esriFieldTypeString"===e)return function(e,t){return i(e,t)};if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e){var s=j(t);return function(e,t){return s(k(e),k(t))}}return t?function(e,t){return 1}:function(e,t){return-1}}function O(e,t,r){if(r){if(null==e)return null==t?0:1;if(null==t)return-1}else{if(null==e)return null==t?0:-1;if(null==t)return 1}return null}function j(e){return e?function(e,t){var r=O(e,t,!0);return null!=r?r:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:function(e,t){var r=O(e,t,!1);return null!=r?r:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}function k(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function S(e,t){var r;for(r in e)h.includes(r)&&(Number.isFinite(e[r])||(e[r]=null));return t?(["avg","stddev","variance"].forEach((function(t){var r;null!=e[t]&&(e[t]=Math.ceil(null!==(r=e[t])&&void 0!==r?r:0))})),e):e}function F(e){var t,r={},a=Object(n.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;(null==i||"string"==typeof i&&""===i.trim())&&(i=null),null==r[i]?r[i]={count:1,data:i}:r[i].count++}}catch(s){a.e(s)}finally{a.f()}return{count:r}}function I(e){return"coded-value"!==(null===e||void 0===e?void 0:e.type)?[]:e.codedValues.map((function(e){return e.code}))}function w(e,t,r,a){var i=e.count,s=[];if(r&&t){var u,c=[],o=I(t[0]),l=Object(n.a)(o);try{for(l.s();!(u=l.n()).done;){var f=u.value;if(t[1]){var d,p=I(t[1]),h=Object(n.a)(p);try{for(h.s();!(d=h.n()).done;){var v=d.value;if(t[2]){var m,y=I(t[2]),g=Object(n.a)(y);try{for(g.s();!(m=g.n()).done;){var x=m.value;c.push("".concat(b(f)).concat(a).concat(b(v)).concat(a).concat(b(x)))}}catch(w){g.e(w)}finally{g.f()}}else c.push("".concat(b(f)).concat(a).concat(b(v)))}}catch(w){h.e(w)}finally{h.f()}}else c.push(f)}}catch(w){l.e(w)}finally{l.f()}for(var O=0,j=c;O<j.length;O++){var k=j[O];i.hasOwnProperty(k)||(i[k]={data:k,count:0})}}for(var S in i){var F=i[S];s.push({value:F.data,count:F.count,label:F.label})}return{uniqueValueInfos:s}}function _(e,t,r,n){var a=null;switch(t){case"log":0!==e&&(a=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&0!==n&&(a=e/n*100);break;case"field":Number.isFinite(r)&&0!==r&&(a=e/r);break;case"natural-log":e>0&&(a=Math.log(e));break;case"square-root":e>0&&(a=Math.pow(e,.5))}return a}function R(e,t){var r=T({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||l});return e=function(e,t,r){var n=null!==t&&void 0!==t?t:-1/0,a=null!==r&&void 0!==r?r:1/0;return e.filter((function(e){return Number.isFinite(e)&&e>=n&&e<=a}))}(e,t.minValue,t.maxValue),Object(s.a)({definition:r,values:e,normalizationTotal:t.normalizationTotal})}function T(e){var t=e.breakCount,r=e.field,n=e.normalizationField,a=e.normalizationType,s=e.classificationMethod||c,u="standard-deviation"===s?e.standardDeviationInterval||o:void 0;return new i.a({breakCount:t,classificationField:r,classificationMethod:s,normalizationField:"field"===a?n:void 0,normalizationType:a,standardDeviationInterval:u})}function M(e,t){var r,n,a=e.classBreaks,i=a.length,s=null===(r=a[0])||void 0===r?void 0:r.minValue,u=null===(n=a[i-1])||void 0===n?void 0:n.maxValue,c="standard-deviation"===t,o=d;return a=a.map((function(e){var t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(c&&t){var n,a=t.match(o),i=null!==(n=null===a||void 0===a?void 0:a.map((function(e){return+e.trim()})))&&void 0!==n?n:[];2===i.length?(r.minStdDev=i[0],r.maxStdDev=i[1],i[0]<0&&i[1]>0&&(r.hasAvg=!0)):1===i.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=i[0]):t.includes(">")&&(r.minStdDev=i[0],r.maxStdDev=null))}return r})),{minValue:s,maxValue:u,classBreakInfos:a,normalizationTotal:e.normalizationTotal}}function N(e,t){var r,a,i=V(e,t);if(null==i.min&&null==i.max)return{bins:[],minValue:i.min,maxValue:i.max,normalizationTotal:t.normalizationTotal};var s,u=i.intervals,c=null!==(r=i.min)&&void 0!==r?r:0,o=null!==(a=i.max)&&void 0!==a?a:0,l=u.map((function(e,t){return{minValue:u[t][0],maxValue:u[t][1],count:0}})),f=Object(n.a)(e);try{for(f.s();!(s=f.n()).done;){var d=s.value;if(null!=d&&d>=c&&d<=o){var p=A(u,d);p>-1&&l[p].count++}}}catch(h){f.e(h)}finally{f.f()}return{bins:l,minValue:c,maxValue:o,normalizationTotal:t.normalizationTotal}}function V(e,t){var r=t.field,n=t.classificationMethod,a=t.standardDeviationInterval,i=t.normalizationType,s=t.normalizationField,u=t.normalizationTotal,c=t.minValue,o=t.maxValue,l=t.numBins||f,d=null,p=null,h=null;if(n&&"equal-interval"!==n||i){var b=R(e,{field:r,normalizationType:i,normalizationField:s,normalizationTotal:u,classificationMethod:n,standardDeviationInterval:a,minValue:c,maxValue:o,numClasses:l}).classBreaks;d=b[0].minValue,p=b[b.length-1].maxValue,h=b.map((function(e){return[e.minValue,e.maxValue]}))}else{var m,g;if(null!=c&&null!=o)d=c,p=o;else{var x,O,j=y({values:e,minValue:c,maxValue:o,useSampleStdDev:!i,supportsNullCount:v({normalizationType:i,normalizationField:s,minValue:c,maxValue:o})});d=null!==(x=j.min)&&void 0!==x?x:null,p=null!==(O=j.max)&&void 0!==O?O:null}h=function(e,t,r){for(var n,a=(t-e)/r,i=[],s=e,u=1;u<=r;u++)n=s+a,n=Number(n.toFixed(16)),i.push([s,u===r?t:n]),s=n;return i}(null!==(m=d)&&void 0!==m?m:0,null!==(g=p)&&void 0!==g?g:0,l)}return{min:d,max:p,intervals:h}}function A(e,t){for(var r=-1,n=e.length-1;n>=0;n--)if(t>=e[n][0]){r=n;break}return r}},1319:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return u}));var n=r(4),a=r(12);function i(e,t){return s.apply(this,arguments)}function s(){return s=Object(a.a)(Object(n.a)().mark((function e(t,r){var a,i,s,u,c,o;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(a=r.featureAdapter,i=t.startTimeField,s=t.endTimeField,u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,!i||!s){e.next=9;break}return e.next=7,r.forEach((function(e){var t=a.getAttribute(e,i),r=a.getAttribute(e,s);null==t||isNaN(t)||(u=Math.min(u,t)),null==r||isNaN(r)||(c=Math.max(c,r))}));case 7:e.next=12;break;case 9:return o=i||s,e.next=12,r.forEach((function(e){var t=a.getAttribute(e,o);null==t||isNaN(t)||(u=Math.min(u,t),c=Math.max(c,t))}));case 12:return e.abrupt("return",{start:u,end:c});case 13:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function u(e,t,r){if(!t||!e)return null;var n=e.startTimeField,a=e.endTimeField;if(!n&&!a)return null;var i=t.start,s=t.end;return null===i&&null===s?null:void 0===i&&void 0===s?function(){return!1}:n&&a?function(e,t,r,n,a){return null!=n&&null!=a?function(i){var s=e.getAttribute(i,t),u=e.getAttribute(i,r);return(null==s||s<=a)&&(null==u||u>=n)}:null!=n?function(t){var a=e.getAttribute(t,r);return null==a||a>=n}:null!=a?function(r){var n=e.getAttribute(r,t);return null==n||n<=a}:void 0}(r,n,a,i,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(a){var i=e.getAttribute(a,t);return i>=r&&i<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||a,i,s)}},1591:function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return S})),r.d(t,"c",(function(){return k}));var n=r(4),a=r(92),i=r(12),s=r(101),u=r(519),c=r(248);var o=r(122),l=r(132);function f(e,t){return e?t?4:3:t?3:2}function d(e,t,r,n,i){if(!e)return!1;var s,u=f(t,r),c=e.coords,o=e.lengths,l=!1,d=0,h=Object(a.a)(o);try{for(h.s();!(s=h.n()).done;){var b=s.value;l=p(l,c,u,d,b,n,i),d+=b*u}}catch(v){h.e(v)}finally{h.f()}return l}function p(e,t,r,n,a,i,s){for(var u=e,c=n,o=n,l=n+a*r;o<l;o+=r){(c=o+r)===l&&(c=n);var f=t[o],d=t[o+1],p=t[c],h=t[c+1];(d<s&&h>=s||h<s&&d>=s)&&f+(s-d)/(h-d)*(p-f)<i&&(u=!u)}return u}var h=r(168),b=r(169),v=r(309),m=r(598),y="feature-store:unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},x={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function O(e){return null!=e&&!0===x.queryGeometry[Object(o.c)(e)]}function j(e){return null!=e&&!0===x.layerGeometry[e]}function k(e,t,n,a,i){if(Object(o.g)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var s=Object(h.h)(new b.a,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return d(e,t,r,n.coords[0],n.coords[1])}(s,!1,!1,e)}))}if(Object(o.g)(t)&&"esriGeometryMultipoint"===n){var l=Object(h.h)(new b.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return function(e,t,r,n,a,i){var s=f(a,i),u=n.coords,c=n.lengths;if(!c)return!1;for(var o=0,l=0;o<c.length;o++,l+=s)if(!d(e,t,r,u[l],u[l+1]))return!1;return!0}(l,!1,!1,e,a,i)}))}if(Object(o.d)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return Object(u.e)(t,Object(m.c)(n,a,i,e))}));if(Object(o.d)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return Object(u.d)(t,Object(m.c)(n,a,i,e))}));if(Object(o.d)(t)&&"esriSpatialRelIntersects"===e){var p="mesh"===(v=n)?c.a:Object(c.c)(v);return Promise.resolve((function(e){return p(t,Object(m.c)(n,a,i,e))}))}var v;return Promise.all([r.e(7),r.e(28)]).then(r.bind(null,434)).then((function(r){var s=r[g[e]].bind(null,t.spatialReference,t);return function(e){return s(Object(m.c)(n,a,i,e))}}))}function S(e,t,r){return F.apply(this,arguments)}function F(){return(F=Object(i.a)(Object(n.a)().mark((function e(t,r,a){var i,u;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.spatialRel,!(u=t.geometry)){e.next=11;break}if(null!=(n=i)&&!0===x.spatialRelationship[n]){e.next=4;break}throw new s.a(y,"Unsupported query spatial relationship",{query:t});case 4:if(!Object(l.l)(u.spatialReference)||!Object(l.l)(a)){e.next=11;break}if(O(u)){e.next=7;break}throw new s.a(y,"Unsupported query geometry type",{query:t});case 7:if(j(r)){e.next=9;break}throw new s.a(y,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",Object(v.a)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}var n}),e)})))).apply(this,arguments)}function I(e){if(Object(o.d)(e))return!0;if(Object(o.g)(e)){var t,r=Object(a.a)(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(i){r.e(i)}finally{r.f()}return!0}return!1}},252:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return x})),r.d(t,"d",(function(){return i})),r.d(t,"e",(function(){return S})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return O})),r.d(t,"h",(function(){return j}));var n,a,i,s=r(120),u=r(88),c=r(89),o=r(90),l=r(91),f=r(297),d=r(34);!function(e){e.AsyncNotEnabled="AsyncNotEnabled",e.ModulesNotSupported="ModulesNotSupported",e.CircularModules="CircularModules",e.NeverReach="NeverReach",e.UnsupportedHashType="UnsupportedHashType",e.InvalidParameter="InvalidParameter",e.UnexpectedToken="UnexpectedToken",e.Unrecognised="Unrecognised",e.UnrecognisedType="UnrecognisedType",e.MaximumCallDepth="MaximumCallDepth",e.BooleanConditionRequired="BooleanConditionRequired",e.TypeNotAllowedInFeature="TypeNotAllowedInFeature",e.KeyMustBeString="KeyMustBeString",e.WrongNumberOfParameters="WrongNumberOfParameters",e.CallNonFunction="CallNonFunction",e.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",e.NoFunctionInDictionary="NoFunctionInDictionary",e.NoFunctionInArray="NoFunctionInArray",e.AssignModuleFunction="AssignModuleFunction",e.LogicExpressionOrAnd="LogicExpressionOrAnd",e.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",e.FunctionNotFound="FunctionNotFound",e.InvalidMemberAccessKey="InvalidMemberAccessKey",e.UnsupportedUnaryOperator="UnsupportUnaryOperator",e.InvalidIdentifier="InvalidIdentifier",e.MemberOfNull="MemberOfNull",e.UnsupportedOperator="UnsupportedOperator",e.Cancelled="Cancelled",e.ModuleAccessorMustBeString="ModuleAccessorMustBeString",e.ModuleExportNotFound="ModuleExportNotFound",e.Immutable="Immutable",e.OutOfBounds="OutOfBounds",e.IllegalResult="IllegalResult",e.FieldNotFound="FieldNotFound",e.PortalRequired="PortalRequired",e.LogicError="LogicError",e.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",e.KeyAccessorMustBeString="KeyAccessorMustBeString",e.WrongSpatialReference="WrongSpatialReference"}(i||(i={}));var p=(n={},Object(d.a)(n,i.TypeNotAllowedInFeature,"Feature attributes only support dates, numbers, strings, guids."),Object(d.a)(n,i.LogicError,"Logic error - {reason}"),Object(d.a)(n,i.NeverReach,"Encountered unreachable logic"),Object(d.a)(n,i.AsyncNotEnabled,"Async Arcade must be enabled for this script"),Object(d.a)(n,i.ModuleAccessorMustBeString,"Module accessor must be a string"),Object(d.a)(n,i.ModuleExportNotFound,"Module has no export with provided identifier"),Object(d.a)(n,i.ModulesNotSupported,"Current profile does not support modules"),Object(d.a)(n,i.ArrayAccessorMustBeNumber,"Array accessor must be a number"),Object(d.a)(n,i.FunctionNotFound,"Function not found"),Object(d.a)(n,i.FieldNotFound,"Key not found - {key}"),Object(d.a)(n,i.CircularModules,"Circular module dependencies are not allowed"),Object(d.a)(n,i.Cancelled,"Execution cancelled"),Object(d.a)(n,i.UnsupportedHashType,"Type not supported in hash function"),Object(d.a)(n,i.IllegalResult,"Value is not a supported return type"),Object(d.a)(n,i.PortalRequired,"Portal is required"),Object(d.a)(n,i.InvalidParameter,"Invalid parameter"),Object(d.a)(n,i.WrongNumberOfParameters,"Call with wrong number of parameters"),Object(d.a)(n,i.Unrecognised,"Unrecognised code structure"),Object(d.a)(n,i.UnrecognisedType,"Unrecognised type"),Object(d.a)(n,i.WrongSpatialReference,"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference"),Object(d.a)(n,i.BooleanConditionRequired,"Conditions must use booleans"),Object(d.a)(n,i.NoFunctionInDictionary,"Dictionaries cannot contain functions."),Object(d.a)(n,i.NoFunctionInArray,"Arrays cannot contain functions."),Object(d.a)(n,i.NoFunctionInTemplateLiteral,"Template Literals do not expect functions by value."),Object(d.a)(n,i.KeyAccessorMustBeString,"Accessor must be a string"),Object(d.a)(n,i.KeyMustBeString,"Object keys must be a string"),Object(d.a)(n,i.Immutable,"Object is immutable"),Object(d.a)(n,i.UnexpectedToken,"Unexpected token"),Object(d.a)(n,i.MemberOfNull,"Cannot access property of null object"),Object(d.a)(n,i.MaximumCallDepth,"Exceeded maximum function depth"),Object(d.a)(n,i.OutOfBounds,"Out of bounds"),Object(d.a)(n,i.InvalidIdentifier,"Identifier not recognised"),Object(d.a)(n,i.CallNonFunction,"Expression is not a function"),Object(d.a)(n,i.InvalidMemberAccessKey,"Cannot access value using a key of this type"),Object(d.a)(n,i.AssignModuleFunction,"Cannot assign function to module variable"),Object(d.a)(n,i.UnsupportedUnaryOperator,"Unsupported unary operator"),Object(d.a)(n,i.UnsupportedOperator,"Unsupported operator"),Object(d.a)(n,i.LogicalExpressionOnlyBoolean,"Logical expressions must be boolean"),Object(d.a)(n,i.LogicExpressionOrAnd,"Logical expression can only be combined with || or &&"),n),h=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(){Object(c.a)(this,r);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.call.apply(t,[this].concat(n))}return Object(u.a)(r)}(Object(f.a)(Error)),b=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(e,n){var a;return Object(c.a)(this,r),(a=t.call(this,m(n)+e.message,{cause:e})).loc=null,Error.captureStackTrace&&Error.captureStackTrace(Object(s.a)(a),r),n&&n.loc&&(a.loc=n.loc),a}return Object(u.a)(r)}(h),v=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(e,n,a,i){var u;return Object(c.a)(this,r),(u=t.call(this,"Execution error - "+m(a)+O(p[n],i))).loc=null,u.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(Object(s.a)(u),r),a&&a.loc&&(u.loc=a.loc),u}return Object(u.a)(r)}(Object(f.a)(Error));function m(e){var t,r;return e&&e.loc?"Line : ".concat(null===(t=e.loc.start)||void 0===t?void 0:t.line,", ").concat(null===(r=e.loc.start)||void 0===r?void 0:r.column,": "):""}var y,g=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(e,n,a,i){var u;return Object(c.a)(this,r),(u=t.call(this,"Compilation error - "+m(a)+O(p[n],i))).loc=null,u.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(Object(s.a)(u),r),a&&a.loc&&(u.loc=a.loc),u}return Object(u.a)(r)}(Object(f.a)(Error)),x=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(c.a)(this,r),(e=t.call(this,"Uncompilable code structures")).declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(Object(s.a)(e),r),e}return Object(u.a)(r)}(Object(f.a)(Error));function O(e,t){try{if(!t)return e;for(var r in t){var n=t[r];n||(n=""),e=e.replace("{"+r+"}",t[r])}}catch(h){}return e}function j(e,t,r){return"esri.arcade.arcadeexecutionerror"===r.declaredRootClass||"esri.arcade.arcadecompilationerror"===r.declaredRootClass?null===r.loc&&t&&t.loc?new b(r,{cause:r}):r:("esri.arcade.featureset.support.featureseterror"===r.declaredRootClass||"esri.arcade.featureset.support.sqlerror"===r.declaredRootClass||r.declaredRootClass,t&&t.loc?new b(r,{cause:r}):r)}!function(e){e.UnrecognisedUri="UnrecognisedUri",e.UnsupportedUriProtocol="UnsupportedUriProtocol"}(y||(y={}));var k=(a={},Object(d.a)(a,y.UnrecognisedUri,"Unrecognised uri - {uri}"),Object(d.a)(a,y.UnsupportedUriProtocol,"Unrecognised uri protocol"),a),S=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(e,n){var a;return Object(c.a)(this,r),(a=t.call(this,O(k[e],n))).declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(Object(s.a)(a),r),a}return Object(u.a)(r)}(Object(f.a)(Error))},309:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return F}));var n=r(4),a=r(89),i=r(88),s=r(12),u=r(92),c=r(99),o=r(98),l=r(206),f=r(341),d=r(132),p=r(233),h=[0,0];function b(e,t){if(!t)return null;if("x"in t){var r,n,a={x:0,y:0};return r=e(t.x,t.y,h),n=Object(c.a)(r,2),a.x=n[0],a.y=n[1],null!=t.z&&(a.z=t.z),null!=t.m&&(a.m=t.m),a}if("xmin"in t){var i,s,u,o,l={xmin:0,ymin:0,xmax:0,ymax:0};return i=e(t.xmin,t.ymin,h),s=Object(c.a)(i,2),l.xmin=s[0],l.ymin=s[1],u=e(t.xmax,t.ymax,h),o=Object(c.a)(u,2),l.xmax=o[0],l.ymax=o[1],t.hasZ&&(l.zmin=t.zmin,l.zmax=t.zmax,l.hasZ=!0),t.hasM&&(l.mmin=t.mmin,l.mmax=t.mmax,l.hasM=!0),l}return"rings"in t?{rings:v(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:v(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:m(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function v(e,t){var r,n=[],a=Object(u.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;n.push(m(i,t))}}catch(s){a.e(s)}finally{a.f()}return n}function m(e,t){var r,n=[],a=Object(u.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value,s=t(i[0],i[1],[0,0]);n.push(s),i.length>2&&s.push(i[2]),i.length>3&&s.push(i[3])}}catch(c){a.e(c)}finally{a.f()}return n}function y(e,t){return g.apply(this,arguments)}function g(){return(g=Object(s.a)(Object(n.a)().mark((function e(t,r){var a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&r){e.next=2;break}return e.abrupt("return");case 2:return a=Array.isArray(t)?t.map((function(e){return null!=e.geometry?e.geometry.spatialReference:null})).filter(o.i):[t],e.next=5,Object(l.initializeProjection)(a.map((function(e){return{source:e,dest:r}})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=b.bind(null,p.c),O=b.bind(null,p.f);function j(e,t,r,n){if(!e)return e;if(r||(r=t,t=e.spatialReference),!Object(d.l)(t)||!Object(d.l)(r)||Object(d.d)(t,r))return e;if(Object(p.a)(t,r)){var a=Object(d.p)(r)?x(e):O(e);return a.spatialReference=r,a}return Object(l.projectMany)(f.a,[e],t,r,null,n)[0]}var k=function(){function e(){Object(a.a)(this,e),this._jobs=[],this._timer=null,this._process=this._process.bind(this)}return Object(i.a)(e,[{key:"push",value:function(){var e=Object(s.a)(Object(n.a)().mark((function e(t,r,a){var i,s=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.length&&r&&a&&!Object(d.d)(r,a)){e.next=2;break}return e.abrupt("return",t);case 2:return i={geometries:t,inSpatialReference:r,outSpatialReference:a,resolve:null},e.abrupt("return",(this._jobs.push(i),new Promise((function(e){i.resolve=e,null===s._timer&&(s._timer=setTimeout(s._process,10))}))));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_process",value:function(){this._timer=null;var e=this._jobs.shift();if(e){var t=e.geometries,r=e.inSpatialReference,n=e.outSpatialReference,a=e.resolve;Object(p.a)(r,n)?Object(d.p)(n)?a(t.map(x)):a(t.map(O)):a(Object(l.projectMany)(f.a,t,r,n,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}}]),e}(),S=new k;function F(e,t,r){return S.push(e,t,r)}},341:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(88),a=r(89),i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){var n=new s(e.getPointX(t),e.getPointY(t),r),a=e.hasZ(t),i=e.hasM(t);return a&&(n.z=e.getPointZ(t)),i&&(n.m=e.getPointM(t)),n},exportPolygon:function(e,t,r){return new u(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new c(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var n=e.hasZ(t),a=e.hasM(t),i=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(n){var s=e.getZExtent(t);i.zmin=s.vmin,i.zmax=s.vmax}if(a){var u=e.getMExtent(t);i.mmin=u.vmin,i.mmax=u.vmax}return i}};var s=Object(n.a)((function e(t,r,n){Object(a.a)(this,e),this.x=t,this.y=r,this.spatialReference=n,this.z=void 0,this.m=void 0}));var u=Object(n.a)((function e(t,r,n,i){Object(a.a)(this,e),this.rings=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)}));var c=Object(n.a)((function e(t,r,n,i){Object(a.a)(this,e),this.paths=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)}));var o=Object(n.a)((function e(t,r,n,i){Object(a.a)(this,e),this.points=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)}));var l=Object(n.a)((function e(t,r,n,i,s){Object(a.a)(this,e),this.xmin=t,this.ymin=r,this.xmax=n,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}))},375:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(92);function a(e,t){return e?t?4:3:t?3:2}function i(e,t,r,i,c){if(null==t||!t.lengths.length)return null;var o="upperLeft"===(null===c||void 0===c?void 0:c.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var l,f=e.coords,d=[],p=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],h=t.lengths,b=t.coords,v=a(r,i),m=0,y=Object(n.a)(h);try{for(y.s();!(l=y.n()).done;){var g=l.value,x=s(p,b,m,g,r,i,o);x&&d.push(x),m+=g*v}}catch(k){y.e(k)}finally{y.f()}if(d.sort((function(e,t){var n=o*e[2]-o*t[2];return 0===n&&r&&(n=e[4]-t[4]),n})),d.length){var O=6*d[0][2];f[0]=d[0][0]/O,f[1]=d[0][1]/O,r&&(O=6*d[0][4],f[2]=0!==O?d[0][3]/O:0),(f[0]<p[0]||f[0]>p[1]||f[1]<p[2]||f[1]>p[3]||r&&(f[2]<p[4]||f[2]>p[5]))&&(f.length=0)}if(!f.length){var j=t.lengths[0]?u(b,0,h[0],r,i):null;if(!j)return null;f[0]=j[0],f[1]=j[1],r&&j.length>2&&(f[2]=j[2])}return e}function s(e,t,r,n,i,s){for(var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=a(i,s),o=r,l=r+c,f=0,d=0,p=0,h=0,b=0,v=0,m=n-1;v<m;v++,o+=c,l+=c){var y=t[o],g=t[o+1],x=t[o+2],O=t[l],j=t[l+1],k=t[l+2],S=y*j-O*g;h+=S,f+=(y+O)*S,d+=(g+j)*S,i&&(p+=(x+k)*(S=y*k-O*x),b+=S),y<e[0]&&(e[0]=y),y>e[1]&&(e[1]=y),g<e[2]&&(e[2]=g),g>e[3]&&(e[3]=g),i&&(x<e[4]&&(e[4]=x),x>e[5]&&(e[5]=x))}if(h*u>0&&(h*=-1),b*u>0&&(b*=-1),!h)return null;var F=[f,d,.5*h];return i&&(F[3]=p,F[4]=.5*b),F}function u(e,t,r,n,i){for(var s=a(n,i),u=t,d=t+s,p=0,h=0,b=0,v=0,m=0,y=r-1;m<y;m++,u+=s,d+=s){var g=e[u],x=e[u+1],O=e[u+2],j=e[d],k=e[d+1],S=e[d+2],F=n?o(g,x,O,j,k,S):c(g,x,j,k);if(F)if(p+=F,n){var I=f(g,x,O,j,k,S);h+=F*I[0],b+=F*I[1],v+=F*I[2]}else{var w=l(g,x,j,k);h+=F*w[0],b+=F*w[1]}}return p>0?n?[h/p,b/p,v/p]:[h/p,b/p]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function c(e,t,r,n){var a=r-e,i=n-t;return Math.sqrt(a*a+i*i)}function o(e,t,r,n,a,i){var s=n-e,u=a-t,c=i-r;return Math.sqrt(s*s+u*u+c*c)}function l(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function f(e,t,r,n,a,i){return[e+.5*(n-e),t+.5*(a-t),r+.5*(i-r)]}},488:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},598:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return V})),r.d(t,"c",(function(){return j})),r.d(t,"d",(function(){return k})),r.d(t,"e",(function(){return F})),r.d(t,"f",(function(){return O}));var n=r(4),a=r(12),i=r(146),s=r(194),u=r(206),c=r(716),o=r(122),l=r(217),f=r(132),d=r(168),p=r(169),h=r(309),b=new i.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),v=Object.freeze({}),m=new p.a,y=new p.a,g=new p.a,x={esriGeometryPoint:d.n,esriGeometryPolyline:d.p,esriGeometryPolygon:d.o,esriGeometryMultipoint:d.m};function O(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.hasZ,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.hasM;if(null==t)return null;var i=e.hasZ&&n,s=e.hasM&&a;if(r){var u=Object(d.u)(g,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,a);return Object(d.n)(u,i,s)}return Object(d.n)(t,i,s)}function j(e,t,r,n,a,i){var s,u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r,l=t&&c,f=r&&o,p=null!=n?"coords"in n?n:n.geometry:null;if(null==p)return null;if(a){var h,b,v=Object(d.q)(y,p,t,r,e,a,c,o);return i&&(v=Object(d.u)(g,v,l,f,e,i)),null!==(h=null===(b=x[e])||void 0===b?void 0:b.call(x,v,l,f))&&void 0!==h?h:null}if(i){var O,j,k=Object(d.u)(g,p,t,r,e,i,c,o);return null!==(O=null===(j=x[e])||void 0===j?void 0:j.call(x,k,l,f))&&void 0!==O?O:null}return Object(d.x)(m,p,t,r,c,o),null!==(s=null===(u=x[e])||void 0===u?void 0:u.call(x,m,l,f))&&void 0!==s?s:null}function k(e,t,r){return S.apply(this,arguments)}function S(){return(S=Object(a.a)(Object(n.a)().mark((function e(t,r,a){var i,s,u,c,o,l,f,d;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.outFields,s=t.orderByFields,u=t.groupByFieldsForStatistics,c=t.outStatistics,i)for(o=0;o<i.length;o++)i[o]=i[o].trim();if(s)for(l=0;l<s.length;l++)s[l]=s[l].trim();if(u)for(f=0;f<u.length;f++)u[f]=u[f].trim();if(c)for(d=0;d<c.length;d++)c[d].onStatisticField&&(c[d].onStatisticField=c[d].onStatisticField.trim());return e.abrupt("return",(t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),F(t,r,a)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,r){return I.apply(this,arguments)}function I(){return(I=Object(a.a)(Object(n.a)().mark((function e(t,r,a){var i,s,u,f,d,p,b,m,y;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(i=t.where,t.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||r&&r===i)&&(t.where=null),t.geometry){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,R(t);case 7:if(s=e.sent,t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&(u=t.geometry.spatialReference,(s=Object(c.a)(s)).spatialReference=u),!s){e.next=27;break}return e.next=12,Object(h.a)(s.spatialReference,a);case 12:return s=_(s,a),e.next=15,Object(l.a)(Object(o.a)(s));case 15:if(null!=(d=e.sent[0])){e.next=18;break}throw v;case 18:return p="quantizationParameters"in t&&(null===(f=t.quantizationParameters)||void 0===f?void 0:f.tolerance)||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,b=p&&w(s,a)?{densificationStep:8*p}:void 0,m=d.toJSON(),e.next=23,Object(h.b)(m,m.spatialReference,a,b);case 23:if(y=e.sent){e.next=26;break}throw v;case 26:y.spatialReference=a,t.geometry=y;case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){if(!e)return!1;var r=e.spatialReference;return(Object(o.d)(e)||Object(o.g)(e)||Object(o.h)(e))&&!Object(f.d)(r,t)&&!Object(u.canProjectWithoutEngine)(r,t)}function _(e,t){var r=e.spatialReference;return w(e,t)&&Object(o.d)(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}function R(e){return T.apply(this,arguments)}function T(){return(T=Object(a.a)(Object(n.a)().mark((function e(t){var r,a,i,u,c,o;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.distance,a=t.units,i=t.geometry,null!=r&&!("vertexAttributes"in i)){e.next=3;break}return e.abrupt("return",i);case 3:if(u=i.spatialReference,c=a?b.fromJSON(a):Object(s.g)(u),!u||!Object(f.h)(u)&&!Object(f.p)(u)){e.next=9;break}e.t0=i,e.next=12;break;case 9:return e.next=11,Object(h.a)(u,f.b).then((function(){return Object(h.b)(i,f.b)}));case 11:e.t0=e.sent;case 12:return o=e.t0,e.next=15,M();case 15:return e.t1=e.sent,e.abrupt("return",(0,e.t1)(o.spatialReference,o,r,c));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return N.apply(this,arguments)}function N(){return(N=Object(a.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e(7),r.e(28)]).then(r.bind(null,434));case 2:return e.abrupt("return",e.sent.geodesicBuffer);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return e&&A in e?JSON.parse(JSON.stringify(e,E)):e}var A="_geVersion",E=function(e,t){return e!==A?t:void 0}},809:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var n=r(89),a=r(88),i=r(90),s=r(91),u=r(94),c=r(146),o=r(105),l=r(97),f=(r(96),r(98),r(93),r(138)),d=r(95),p=new c.a({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),h=new c.a({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),b=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).type="class-breaks-definition",a.breakCount=null,a.classificationField=null,a.classificationMethod=null,a.normalizationField=null,a.normalizationType=null,a}return Object(a.a)(r,[{key:"standardDeviationInterval",set:function(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}},{key:"definedInterval",set:function(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}}]),r}(o.a);Object(u.a)([Object(f.a)({classBreaksDef:"class-breaks-definition"})],b.prototype,"type",void 0),Object(u.a)([Object(l.b)({json:{write:!0}})],b.prototype,"breakCount",void 0),Object(u.a)([Object(l.b)({json:{write:!0}})],b.prototype,"classificationField",void 0),Object(u.a)([Object(l.b)({type:String,json:{read:p.read,write:p.write}})],b.prototype,"classificationMethod",void 0),Object(u.a)([Object(l.b)({json:{write:!0}})],b.prototype,"normalizationField",void 0),Object(u.a)([Object(l.b)({json:{read:h.read,write:h.write}})],b.prototype,"normalizationType",void 0),Object(u.a)([Object(l.b)({value:null,json:{write:!0}})],b.prototype,"standardDeviationInterval",null),Object(u.a)([Object(l.b)({value:null,json:{write:!0}})],b.prototype,"definedInterval",null);var v=b=Object(u.a)([Object(d.a)("esri.rest.support.ClassBreaksDefinition")],b)},810:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(102).a.getLogger("esri.rest.support.generateRendererUtils");function a(e,t){return Number(e.toFixed(t))}function i(e){var t=e.normalizationTotal;return{classBreaks:s(e),normalizationTotal:t}}function s(e){var t,r=e.definition,n=r.classificationMethod,i=r.normalizationType,s=r.definedInterval,l=null!==(t=r.breakCount)&&void 0!==t?t:1,f=[],d=e.values;if(0===d.length)return[];d=d.sort((function(e,t){return e-t}));var p=d[0],h=d[d.length-1];if("equal-interval"===n)if(d.length>=l){for(var b=(h-p)/l,v=p,m=1;m<l;m++){var y=a(p+m*b,6);f.push({minValue:v,maxValue:y,label:u(v,y,i)}),v=y}f.push({minValue:v,maxValue:h,label:u(v,h,i)})}else d.forEach((function(e){f.push({minValue:e,maxValue:e,label:u(e,e,i)})}));else if("natural-breaks"===n){for(var g=c(d),x=e.valueFrequency||g.valueFrequency,O=o(g.uniqueValues,x,l),j=p,k=1;k<l;k++)if(g.uniqueValues.length>k){var S=a(g.uniqueValues[O[k]],6);f.push({minValue:j,maxValue:S,label:u(j,S,i)}),j=S}f.push({minValue:j,maxValue:h,label:u(j,h,i)})}else if("quantile"===n)if(d.length>=l&&p!==h){for(var F=p,I=Math.ceil(d.length/l),w=0,_=1;_<l;_++){var R=I+w-1;R>d.length&&(R=d.length-1),R<0&&(R=0),f.push({minValue:F,maxValue:d[R],label:u(F,d[R],i)}),F=d[R],w+=I,I=Math.ceil((d.length-w)/(l-_))}f.push({minValue:F,maxValue:h,label:u(F,h,i)})}else for(var T=-1,M=0;M<d.length;M++){var N=d[M];N!==T&&(T=N,f.push({minValue:T,maxValue:N,label:u(T,N,i)}),T=N)}else if("standard-deviation"===n){var V=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(d),A=function(e,t){for(var r=0,n=0;n<e.length;n++){var a=e[n];r+=(a-t)*(a-t)}return r/=e.length,Math.sqrt(r)}(d,V);if(0===A)f.push({minValue:d[0],maxValue:d[0],label:u(d[0],d[0],i)});else{for(var E=function(e,t,r,n,a){var i=Math.max(n-e,t-n)/a/r;return i=i>=1?1:i>=.5?.5:.25,i}(p,h,l,V,A)*A,C=0,z=p,P=l;P>=1;P--){var q=a(V-(P-.5)*E,6);f.push({minValue:z,maxValue:q,label:u(z,q,i)}),z=q,C++}var D=a(V+.5*E,6);f.push({minValue:z,maxValue:D,label:u(z,D,i)}),z=D,C++;for(var Q=1;Q<=l;Q++)D=C===2*l?h:a(V+(Q+.5)*E,6),f.push({minValue:z,maxValue:D,label:u(z,D,i)}),z=D,C++}}else if("defined-interval"===n){if(!s)return f;for(var G=d[0],B=d[d.length-1],U=Math.ceil((B-G)/s),Z=G,L=1;L<U;L++){var Y=a(G+L*s,6);f.push({minValue:Z,maxValue:Y,label:u(Z,Y,i)}),Z=Y}f.push({minValue:Z,maxValue:B,label:u(Z,B,i)})}return f}function u(e,t,r){return e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t}function c(e){for(var t=[],r=[],n=Number.MIN_VALUE,a=1,i=-1,s=0;s<e.length;s++){var u=e[s];u===n?(a++,r[i]=a):null!==u&&(t.push(u),n=u,a=1,r.push(a),i++)}return{uniqueValues:t,valueFrequency:r}}function o(e,t,r){var n=e.length,a=[];r>n&&(r=n);for(var i=0;i<r;i++)a.push(Math.round(i*n/r-1));a.push(n-1);var s=l(a,e,t,r);return function(e,t,r,n,a,i){for(var s=0,u=0,c=0,o=0,l=!0,d=0;d<2&&l;d++){0===d&&(l=!1);for(var p=0;p<i-1;p++)for(;r[p+1]+1!==r[p+2];){r[p+1]=r[p+1]+1;var h=f(p,r,n,a);c=h.sbMean,s=h.sbSdcm;var b=f(p+1,r,n,a);if(o=b.sbMean,!(s+(u=b.sbSdcm)<t[p]+t[p+1])){r[p+1]=r[p+1]-1;break}t[p]=s,t[p+1]=u,e[p]=c,e[p+1]=o,l=!0}for(var v=i-1;v>0;v--)for(;r[v]!==r[v-1]+1;){r[v]=r[v]-1;var m=f(v-1,r,n,a);c=m.sbMean,s=m.sbSdcm;var y=f(v,r,n,a);if(o=y.sbMean,!(s+(u=y.sbSdcm)<t[v-1]+t[v])){r[v]=r[v]+1;break}t[v-1]=s,t[v]=u,e[v-1]=c,e[v]=o,l=!0}}return l}(s.mean,s.sdcm,a,e,t,r)&&(s=l(a,e,t,r)),a}function l(e,t,r,n){for(var a=[],i=[],s=[],u=0,c=[],o=[],l=0;l<n;l++){var d=f(l,e,t,r);c.push(d.sbMean),o.push(d.sbSdcm),u+=o[l]}for(var p,h=u,b=!0;b||u<h;){b=!1,a=[];for(var v=0;v<n;v++)a.push(e[v]);for(var m=0;m<n;m++)for(var y=e[m]+1;y<=e[m+1];y++)if(p=t[y],m>0&&y!==e[m+1]&&Math.abs(p-c[m])>Math.abs(p-c[m-1]))e[m]=y;else if(m<n-1&&e[m]!==y-1&&Math.abs(p-c[m])>Math.abs(p-c[m+1])){e[m+1]=y-1;break}h=u,u=0,i=[],s=[];for(var g=0;g<n;g++){i.push(c[g]),s.push(o[g]);var x=f(g,e,t,r);c[g]=x.sbMean,o[g]=x.sbSdcm,u+=o[g]}}if(u>h){for(var O=0;O<n;O++)e[O]=a[O],c[O]=i[O],o[O]=s[O];u=h}return{mean:c,sdcm:o}}function f(e,t,r,a){for(var i=0,s=0,u=t[e]+1;u<=t[e+1];u++){var c=a[u];i+=r[u]*c,s+=c}s<=0&&n.warn("Exception in Natural Breaks calculation");for(var o=i/s,l=0,f=t[e]+1;f<=t[e+1];f++)l+=a[f]*Math.pow(r[f]-o,2);return{sbMean:o,sbSdcm:l}}},858:function(e,t,r){"use strict";r.d(t,"a",(function(){return pe}));var n=r(112),a=r(99),i=r(1),s=r(92),u=r(4),c=r(12),o=r(88),l=r(89),f=r(98),d=r(101),p=r(116),h=r(111),b=r(1144),v=r(110),m=r(194),y=r(392),g=r(139),x=r(153),O=r(122),j=r(217),k=r(132),S=r(168),F=r(146),I=r(381),w=r(436),_=new(function(){function e(t,r){Object(l.a)(this,e),this._cache=new I.a(t),this._invalidCache=new I.a(r)}return Object(o.a)(e,[{key:"get",value:function(e,t){var r="".concat(t.uid,":").concat(e),n=this._cache.get(r);if(n)return n;if(void 0!==this._invalidCache.get(r))return null;try{var a=w.WhereClause.create(e,t);return this._cache.put(r,a),a}catch(i){return this._invalidCache.put(r,null),null}}}]),e}())(50,500),R="feature-store:unsupported-query",T=" as ",M=new F.a({esriFieldTypeString:"string"}),N=new F.a({esriFieldTypeOID:"oid",esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long"}),V=new F.a({esriFieldTypeDate:"date"}),A=new F.a({esriFieldTypeGUID:"guid",esriFieldTypeGlobalId:"global-id"}),E=new Set([].concat(Object(n.a)(N.jsonValues),Object(n.a)(V.jsonValues),Object(n.a)(M.jsonValues),Object(n.a)(A.jsonValues))),C=new Intl.ListFormat("en-US",{type:"conjunction"}).format([].concat(Object(n.a)(N.apiValues),Object(n.a)(V.apiValues),Object(n.a)(M.apiValues),Object(n.a)(A.apiValues)));function z(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=P(e,t);if(!n)throw new d.a(R,"invalid SQL expression",{expression:e});var a=r.expressionName||"expression";if(r.validateStandardized&&!n.isStandardized)throw new d.a(R,"".concat(a," is not standard"),{expression:e});if(r.validateAggregate&&!n.isAggregate)throw new d.a(R,"".concat(a," does not contain a valid aggregate function"),{expression:e});return n.fieldNames}function P(e,t){return e?_.get(e,t):null}function q(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.errorMessage||(r.errorMessage=r.expressionName?"".concat(r.expressionName," contains invalid fields"):"Fields are invalid"),Q(e,t,(function(e,t){return t.has(e)}),r)}function D(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.errorMessage||(r.errorMessage=r.expressionName?"".concat(r.expressionName," only supports ").concat(C," field types"):"Only ".concat(C," field types are supported")),Q(e,t,(function(e,t){return!B(e,t)}),r)}function Q(e,t,r){var a,i,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=null===(a=u.verifyExpression)||void 0===a||a,o=[],l=Object(s.a)(t);try{for(l.s();!(i=l.n()).done;){var f=i.value,p=r(f,e);if("*"!==f&&!p)if(c){var h=G(f);try{Q(e,z(h,e,{validateStandardized:!0}),r,u)}catch(v){var b=null===v||void 0===v?void 0:v.details;if(null!==b&&void 0!==b&&b.expression)throw v;null!==b&&void 0!==b&&b.invalidFields?o.push.apply(o,Object(n.a)(b.invalidFields)):o.push(f)}}else o.push(f)}}catch(m){l.e(m)}finally{l.f()}if(o.length)throw new d.a(R,u.errorMessage,{invalidFields:o,query:u.query})}function G(e){return e.split(T)[0]}function B(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E,n=t.get(e);return!!n&&!r.has(n.type)}var U=r(309),Z=r(488),L=r(218),Y=r(716),H=r(327),W=r(598),J=r(1019),K=r(207),X=function(){function e(t,r,n){var a;Object(l.a)(this,e),this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=null!==(a=t.returnDistinctValues)&&void 0!==a&&a,this.fieldsIndex=n,this.featureAdapter=r;var i=t.outFields;if(i&&!i.includes("*")){this.outFields=i;var u,c=0,o=Object(s.a)(i);try{for(o.s();!(u=o.n()).done;){var f=u.value,d=G(f),p=this.fieldsIndex.get(d),h=p?null:P(d,n),b=p?p.name:f.split(T)[1]||"FIELD_EXP_"+c++;this._fieldDataCache.set(f,{alias:b,clause:h})}}catch(v){o.e(v)}finally{o.f()}}}return Object(o.a)(e,[{key:"countDistinctValues",value:function(e){var t=this;return this.returnDistinctValues?(e.forEach((function(e){return t.getAttributes(e)})),this._returnDistinctMap.size):e.length}},{key:"getAttributes",value:function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}},{key:"getFieldValue",value:function(e,t,r){var n,a,i=r?r.name:t,s=null;return this._fieldDataCache.has(i)?s=null===(n=this._fieldDataCache.get(i))||void 0===n?void 0:n.clause:r||(s=P(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:s})),r?this.featureAdapter.getAttribute(e,i):null===(a=s)||void 0===a?void 0:a.calculateValue(e,this.featureAdapter)}},{key:"getDataValues",value:function(e,t){var r=this,n=t.normalizationType,a=t.normalizationTotal;return e.map((function(e){var i=t.field&&r.getFieldValue(e,t.field,r.fieldsIndex.get(t.field));if(t.field2&&(i="".concat(Object(J.k)(i)).concat(t.fieldDelimiter).concat(Object(J.k)(r.getFieldValue(e,t.field2,r.fieldsIndex.get(t.field2)))),t.field3&&(i="".concat(i).concat(t.fieldDelimiter).concat(Object(J.k)(r.getFieldValue(e,t.field3,r.fieldsIndex.get(t.field3)))))),n&&Number.isFinite(i)){var s="field"===n&&t.normalizationField?r.getFieldValue(e,t.normalizationField,r.fieldsIndex.get(t.normalizationField)):null;i=Object(J.i)(i,n,s,a)}return i}))}},{key:"getExpressionValues",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r,n,a){var s,c,o,l,f,d,p=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(K.e)();case 2:if(s=e.sent,c=s.arcadeUtils,o=c.hasGeometryOperations(r),e.t0=o,!e.t0){e.next=9;break}return e.next=9,c.enableGeometryOperations();case 9:return l=c.createFunction(r),f=n&&c.getViewInfo(n),d={fields:this.fieldsIndex.fields},e.abrupt("return",t.map((function(e){var t={attributes:p.featureAdapter.getAttributes(e),layer:d,geometry:o?Object(i.a)(Object(i.a)({},Object(W.c)(a.geometryType,a.hasZ,a.hasM,p.featureAdapter.getGeometry(e))),{},{spatialReference:null===n||void 0===n?void 0:n.spatialReference}):null},r=c.createExecContext(t,f);return c.executeFunction(l,r)})));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"validateItem",value:function(e,t){var r,n;return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:P(t,this.fieldsIndex)}),null!==(r=null===(n=this._fieldDataCache.get(t))||void 0===n||null===(n=n.clause)||void 0===n?void 0:n.testFeature(e,this.featureAdapter))&&void 0!==r&&r}},{key:"validateItems",value:function(e,t){var r,n;return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:P(t,this.fieldsIndex)}),null!==(r=null===(n=this._fieldDataCache.get(t))||void 0===n||null===(n=n.clause)||void 0===n?void 0:n.testSet(e,this.featureAdapter))&&void 0!==r&&r}},{key:"_processAttributesForOutFields",value:function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);var r,n={},a=Object(s.a)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value,u=this._fieldDataCache.get(i),c=u.alias,o=u.clause;n[c]=o?o.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,c)}}catch(l){a.e(l)}finally{a.f()}return n}},{key:"_processAttributesForDistinctValues",value:function(e){if(null==e||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t){var n,a=Object(s.a)(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,u=this._fieldDataCache.get(i).alias;r.push(e[u])}}catch(f){a.e(f)}finally{a.f()}}else for(var c in e)r.push(e[c]);var o="".concat((t||["*"]).join(","),"=").concat(r.join(",")),l=this._returnDistinctMap.get(o)||0;return this._returnDistinctMap.set(o,++l),l>1?null:e}}]),e}();function $(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function ee(e,t,r,n,a){return{objectId:e,target:t,distance:r,type:"edge",start:n,end:a,draped:arguments.length>5&&void 0!==arguments[5]&&arguments[5]}}var te=r(195),re=function(){function e(t,r,n){Object(l.a)(this,e),this.items=t,this.query=r,this.geometryType=n.geometryType,this.hasM=n.hasM,this.hasZ=n.hasZ,this.fieldsIndex=n.fieldsIndex,this.objectIdField=n.objectIdField,this.spatialReference=n.spatialReference,this.featureAdapter=n.featureAdapter}return Object(o.a)(e,[{key:"size",get:function(){return this.items.length}},{key:"createQueryResponseForCount",value:function(){var e=new X(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);var t=this.query,r=t.groupByFieldsForStatistics,n=t.having,a=t.outStatistics;if(!(null===r||void 0===r?void 0:r.length))return 1;var i,u=new Map,c=new Map,o=new Set,l=Object(s.a)(a);try{for(l.s();!(i=l.n()).done;){var f=i.value,d="exceedslimit"!==f.statisticType?f.onStatisticField:void 0;if(!c.has(d)){var p,h=[],b=Object(s.a)(r);try{for(b.s();!(p=b.n()).done;){var v=p.value,m=this._getAttributeValues(e,v,u);h.push(m)}}catch(S){b.e(S)}finally{b.f()}c.set(d,this._calculateUniqueValues(h,e.returnDistinctValues))}var y=c.get(d);for(var g in y){var x=y[g],O=x.data,j=x.items,k=O.join(",");n&&!e.validateItems(j,n)||o.add(k)}}}catch(S){l.e(S)}finally{l.f()}return o.size}},{key:"createQueryResponse",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.query.outStatistics){e.next=11;break}if(!this.query.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))){e.next=5;break}e.t0=this._createExceedsLimitQueryResponse(this.query),e.next=8;break;case 5:return e.next=7,this._createStatisticsQueryResponse(this.query);case 7:e.t0=e.sent;case 8:t=e.t0,e.next=12;break;case 11:t=this._createFeatureQueryResponse(this.query);case 12:return this.query.returnQueryGeometry&&(r=this.query.geometry,Object(k.l)(this.query.outSR)&&!Object(k.d)(r.spatialReference,this.query.outSR)?t.queryGeometry=Object(W.b)(Object(i.a)({spatialReference:this.query.outSR},Object(U.b)(r,r.spatialReference,this.query.outSR))):t.queryGeometry=Object(W.b)(Object(i.a)({spatialReference:this.query.outSR},r))),e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createSnappingResponse",value:function(e,t){var r,n=this.featureAdapter,a=ae(this.hasZ,this.hasM),i=e.point,u=e.mode,c="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,l={candidates:[]},f="esriGeometryPolygon"===this.geometryType,d=this._getPointCreator(u,this.spatialReference,t),p=new ie(null,0),h=new ie(null,0),b={x:0,y:0,z:0},v=Object(s.a)(this.items);try{for(v.s();!(r=v.n()).done;){var m=r.value,y=n.getGeometry(m);if(null!=y){var g=y.coords,x=y.lengths;if(p.coords=g,h.coords=g,e.returnEdge)for(var O=0,j=0;j<x.length;j++)for(var k=x[j],S=0;S<k;S++,O+=a){var F=p;if(F.coordsIndex=O,S!==k-1){var I=h;I.coordsIndex=O+a;var w=b;ne(b,i,F,I);var _=(i.x-w.x)/c,R=(i.y-w.y)/o,T=_*_+R*R;T<=1&&l.candidates.push(ee(n.getObjectId(m),d(w),Math.sqrt(T),d(F),d(I)))}}if(e.returnVertex)for(var M=f?g.length-a:g.length,N=0;N<M;N+=a){var V=p;V.coordsIndex=N;var A=(i.x-V.x)/c,E=(i.y-V.y)/o,C=A*A+E*E;C<=1&&l.candidates.push($(n.getObjectId(m),d(V),Math.sqrt(C)))}}}}catch(z){v.e(z)}finally{v.f()}return l.candidates.sort((function(e,t){return e.distance-t.distance})),l}},{key:"_getPointCreator",value:function(e,t,r){var n=null==r||Object(k.d)(t,r)?function(e){return e}:function(e){return Object(U.b)(e,t,r)},a=this.hasZ;return"3d"===e?a?function(e){var t=e.x,r=e.y,a=e.z;return n({x:t,y:r,z:a})}:function(e){var t=e.x,r=e.y;return n({x:t,y:r,z:0})}:function(e){var t=e.x,r=e.y;return n({x:t,y:r})}}},{key:"createSummaryStatisticsResponse",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,a,i,s,c,o,l,f,d,p,h,b,v;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,a=t.normalizationField,i=t.normalizationType,s=t.normalizationTotal,c=t.minValue,o=t.maxValue,l=t.scale,f=this.fieldsIndex.isDateField(r),e.next=11,this._getDataValues({field:r,valueExpression:n,normalizationField:a,normalizationType:i,normalizationTotal:s,scale:l});case 11:return d=e.sent,p=Object(J.j)({normalizationType:i,normalizationField:a,minValue:c,maxValue:o}),h=this.fieldsIndex.get(r),b={value:.5,fieldType:null===h||void 0===h?void 0:h.type},v=Object(te.x)(h)?Object(J.e)({values:d,supportsNullCount:p,percentileParams:b}):Object(J.d)({values:d,minValue:c,maxValue:o,useSampleStdDev:!i,supportsNullCount:p,percentileParams:b}),e.abrupt("return",Object(J.l)(v,f));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createUniqueValuesResponse",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,a,i,s,c,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,a=t.domains,i=t.returnAllCodedValues,s=t.scale,e.next=7,this._getDataValues({field:r,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:n,scale:s});case 7:return c=e.sent,o=Object(J.f)(c),e.abrupt("return",Object(J.g)(o,a,i,t.fieldDelimiter));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createClassBreaksResponse",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,a,i,s,c,o,l,f,d,p,h,b;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,a=t.normalizationField,i=t.normalizationType,s=t.normalizationTotal,c=t.classificationMethod,o=t.standardDeviationInterval,l=t.minValue,f=t.maxValue,d=t.numClasses,p=t.scale,e.next=13,this._getDataValues({field:r,valueExpression:n,normalizationField:a,normalizationType:i,normalizationTotal:s,scale:p});case 13:return h=e.sent,b=Object(J.a)(h,{field:r,normalizationField:a,normalizationType:i,normalizationTotal:s,classificationMethod:c,standardDeviationInterval:o,minValue:l,maxValue:f,numClasses:d}),e.abrupt("return",Object(J.m)(b,c));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createHistogramResponse",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,a,i,s,c,o,l,f,d,p,h;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,a=t.normalizationField,i=t.normalizationType,s=t.normalizationTotal,c=t.classificationMethod,o=t.standardDeviationInterval,l=t.minValue,f=t.maxValue,d=t.numBins,p=t.scale,e.next=13,this._getDataValues({field:r,valueExpression:n,normalizationField:a,normalizationType:i,normalizationTotal:s,scale:p});case 13:return h=e.sent,e.abrupt("return",Object(J.b)(h,{field:r,normalizationField:a,normalizationType:i,normalizationTotal:s,classificationMethod:c,standardDeviationInterval:o,minValue:l,maxValue:f,numBins:d}));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sortFeatures",value:function(e,t,r){var n=this;if(e.length>1&&t&&t.length){var a,i=Object(s.a)(t.reverse());try{var u=function(){var t=a.value.split(" "),i=t[0],s=n.fieldsIndex.get(i),u=!!t[1]&&"desc"===t[1].toLowerCase(),c=Object(J.h)(null===s||void 0===s?void 0:s.type,u);e.sort((function(e,t){var n=r(e,i,s),a=r(t,i,s);return c(n,a)}))};for(i.s();!(a=i.n()).done;)u()}catch(c){i.e(c)}finally{i.f()}}}},{key:"_createFeatureQueryResponse",value:function(e){var t=this,r=this.items,a=this.geometryType,i=this.hasM,s=this.hasZ,u=this.objectIdField,c=this.spatialReference,o=e.outFields,l=e.outSR,f=e.quantizationParameters,d=e.resultRecordCount,p=e.resultOffset,h=e.returnZ,b=e.returnM,v=null!=d&&r.length>(p||0)+d,m=o&&(o.includes("*")?Object(n.a)(this.fieldsIndex.fields):o.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:v,features:this._createFeatures(e,r),fields:m,geometryType:a,hasM:i&&b,hasZ:s&&h,objectIdFieldName:u,spatialReference:Object(W.b)(l||c),transform:f&&Object(H.c)(f)||null}}},{key:"_createFeatures",value:function(e,t){var r=new X(e,this.featureAdapter,this.fieldsIndex),a=this.hasM,i=this.hasZ,u=e.orderByFields,c=e.quantizationParameters,o=e.returnGeometry,l=e.returnCentroid,f=e.maxAllowableOffset,d=e.resultOffset,p=e.resultRecordCount,h=e.returnZ,b=void 0!==h&&h,v=e.returnM,m=i&&b,y=a&&(void 0!==v&&v),g=[],x=0,O=Object(n.a)(t);if(this._sortFeatures(O,u,(function(e,t,n){return r.getFieldValue(e,t,n)})),o||l){var j,k=null!==(j=Object(H.c)(c))&&void 0!==j?j:void 0;if(o&&!l){var S,F=Object(s.a)(O);try{for(F.s();!(S=F.n()).done;){var I=S.value;g[x++]={attributes:r.getAttributes(I),geometry:Object(W.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(I),f,k,m,y)}}}catch(q){F.e(q)}finally{F.f()}}else if(!o&&l){var w,_=Object(s.a)(O);try{for(_.s();!(w=_.n()).done;){var R=w.value;g[x++]={attributes:r.getAttributes(R),centroid:Object(W.f)(this,this.featureAdapter.getCentroid(R,this),k)}}}catch(q){_.e(q)}finally{_.f()}}else{var T,M=Object(s.a)(O);try{for(M.s();!(T=M.n()).done;){var N=T.value;g[x++]={attributes:r.getAttributes(N),centroid:Object(W.f)(this,this.featureAdapter.getCentroid(N,this),k),geometry:Object(W.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(N),f,k,m,y)}}}catch(q){M.e(q)}finally{M.f()}}}else{var V,A=Object(s.a)(O);try{for(A.s();!(V=A.n()).done;){var E=V.value,C=r.getAttributes(E);C&&(g[x++]={attributes:C})}}catch(q){A.e(q)}finally{A.f()}}var z=d||0;if(null!=p){var P=z+p;g=g.slice(z,Math.min(g.length,P))}return g}},{key:"_createExceedsLimitQueryResponse",value:function(e){var t,r,n=!1,a=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,c=Object(s.a)(null!==(t=e.outStatistics)&&void 0!==t?t:[]);try{for(c.s();!(r=c.n()).done;){var o=r.value;if("exceedslimit"===o.statisticType){a=null!=o.maxPointCount?o.maxPointCount:Number.POSITIVE_INFINITY,i=null!=o.maxRecordCount?o.maxRecordCount:Number.POSITIVE_INFINITY,u=null!=o.maxVertexCount?o.maxVertexCount:Number.POSITIVE_INFINITY;break}}}catch(d){c.e(d)}finally{c.f()}if("esriGeometryPoint"===this.geometryType)n=this.items.length>a;else if(this.items.length>i)n=!0;else{var l=ae(this.hasZ,this.hasM),f=this.featureAdapter;n=this.items.reduce((function(e,t){var r=f.getGeometry(t);return e+(null!=r&&r.coords.length||0)}),0)/l>u}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(n)}}]}}},{key:"_createStatisticsQueryResponse",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,a,i,c,o,l,f,d,p,h,b,v,m,y,g,x,O,j,k,S,F,I,w,_,R,T,M,N,V,A,E,C,z,P,q,D,Q,G=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={attributes:{}},n=[],a=new Map,i=new Map,c=new Map,o=new Map,l=new X(t,this.featureAdapter,this.fieldsIndex),f=t.outStatistics,d=t.groupByFieldsForStatistics,p=t.having,h=t.orderByFields,b=d&&d.length,m=(v=!!b)?d[0]:null,y=v&&!this.fieldsIndex.get(m),g=Object(s.a)(null!==f&&void 0!==f?f:[]),e.prev=2,g.s();case 4:if((x=g.n()).done){e.next=34;break}if(O=x.value,j=O.outStatisticFieldName,k=O.statisticType,S=O,F="exceedslimit"!==k?O.onStatisticField:void 0,I="percentile_disc"===k||"percentile_cont"===k,w="EnvelopeAggregate"===k||"CentroidAggregate"===k||"ConvexHullAggregate"===k,_=v&&1===b&&(F===m||y)&&"count"===k,!v){e.next=19;break}if(!c.has(F)){R=[],T=Object(s.a)(d);try{for(T.s();!(M=T.n()).done;)N=M.value,V=this._getAttributeValues(l,N,a),R.push(V)}catch(B){T.e(B)}finally{T.f()}c.set(F,this._calculateUniqueValues(R,!w&&l.returnDistinctValues))}A=c.get(F),E=Object(u.a)().mark((function e(){var t,r,n,i,s,c,f,h,b,v,m,y,g,x;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=A[C],r=t.count,n=t.data,i=t.items,s=t.itemPositions,c=n.join(","),p&&!l.validateItems(i,p)){e.next=18;break}if(f=o.get(c)||{attributes:{}},!w){e.next=13;break}return f.aggregateGeometries||(f.aggregateGeometries={}),e.next=7,G._getAggregateGeometry(S,i);case 7:h=e.sent,b=h.aggregateGeometries,v=h.outStatisticFieldName,f.aggregateGeometries[v]=b,e.next=16;break;case 13:m=null,_?m=r:(y=G._getAttributeValues(l,F,a),g=s.map((function(e){return y[e]})),m=I&&"statisticParameters"in S?G._getPercentileValue(S,g):G._getStatisticValue(S,g,null,l.returnDistinctValues)),f.attributes[j]=m;case 16:x=0,d.forEach((function(e,t){return f.attributes[G.fieldsIndex.get(e)?e:"EXPR_"+ ++x]=n[t]})),o.set(c,f);case 18:case"end":return e.stop()}}),e)})),e.t0=Object(u.a)().keys(A);case 12:if((e.t1=e.t0()).done){e.next=17;break}return C=e.t1.value,e.delegateYield(E(),"t2",15);case 15:e.next=12;break;case 17:e.next=31;break;case 19:if(!w){e.next=29;break}return r.aggregateGeometries||(r.aggregateGeometries={}),e.next=23,this._getAggregateGeometry(S,this.items);case 23:z=e.sent,P=z.aggregateGeometries,q=z.outStatisticFieldName,r.aggregateGeometries[q]=P,e.next=31;break;case 29:D=this._getAttributeValues(l,F,a),r.attributes[j]=I&&"statisticParameters"in S?this._getPercentileValue(S,D):this._getStatisticValue(S,D,i,l.returnDistinctValues);case 31:n.push({name:j,alias:j,type:"esriFieldTypeDouble"});case 32:e.next=4;break;case 34:e.next=39;break;case 36:e.prev=36,e.t3=e.catch(2),g.e(e.t3);case 39:return e.prev=39,g.f(),e.finish(39);case 42:return Q=v?Array.from(o.values()):[r],e.abrupt("return",(this._sortFeatures(Q,h,(function(e,t){return e.attributes[t]})),{fields:n,features:Q}));case 44:case"end":return e.stop()}}),e,this,[[2,36,39,42]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_getAggregateGeometry",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){var a,s,c,o,l,f,d,p,h,b,v,m,y,g,x;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e(7),r.e(28)]).then(r.bind(null,434));case 2:return a=e.sent,s=a.convexHull,c=a.union,o=t.statisticType,l=t.outStatisticFieldName,f=this.featureAdapter,d=this.spatialReference,p=this.geometryType,h=this.hasZ,b=this.hasM,v=n.map((function(e){return Object(W.c)(p,h,b,f.getGeometry(e))})),m=s(d,v,!0)[0],y={aggregateGeometries:null,outStatisticFieldName:null},"EnvelopeAggregate"===o?(g=m?Object(Y.b)(m):Object(Y.a)(c(d,v)),y.aggregateGeometries=Object(i.a)(Object(i.a)({},g),{},{spatialReference:d}),y.outStatisticFieldName=l||"extent"):"CentroidAggregate"===o?(x=m?Object(L.b)(m):Object(L.a)(Object(Y.a)(c(d,v))),y.aggregateGeometries={x:x[0],y:x[1],spatialReference:d},y.outStatisticFieldName=l||"centroid"):"ConvexHullAggregate"===o&&(y.aggregateGeometries=m,y.outStatisticFieldName=l||"convexHull"),e.abrupt("return",y);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getStatisticValue",value:function(e,t,r,a){var i,s=e.onStatisticField,u=e.statisticType;return i=null!==r&&void 0!==r&&r.has(s)?r.get(s):Object(te.x)(this.fieldsIndex.get(s))?Object(J.e)({values:t,returnDistinct:a}):Object(J.d)({values:a?Object(n.a)(new Set(t)):t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(s,i),i["var"===u?"variance":u]}},{key:"_getPercentileValue",value:function(e,t){var r=e.onStatisticField,n=e.statisticParameters,a=e.statisticType,i=n.value,s=n.orderBy,u=this.fieldsIndex.get(r);return Object(J.c)(t,{value:i,orderBy:s,fieldType:null===u||void 0===u?void 0:u.type,isDiscrete:"percentile_disc"===a})}},{key:"_getAttributeValues",value:function(e,t,r){if(r.has(t))return r.get(t);var n=this.fieldsIndex.get(t),a=this.items.map((function(r){return e.getFieldValue(r,t,n)}));return r.set(t,a),a}},{key:"_calculateUniqueValues",value:function(e,t){for(var r={},n=this.items,a=n.length,i=0;i<a;i++){var u,c=n[i],o=[],l=Object(s.a)(e);try{for(l.s();!(u=l.n()).done;){var f=u.value;o.push(f[i])}}catch(p){l.e(p)}finally{l.f()}var d=o.join(",");null==r[d]?r[d]={count:1,data:o,items:[c],itemPositions:[i]}:(t||r[d].count++,r[d].items.push(c),r[d].itemPositions.push(i))}return r}},{key:"_getDataValues",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,a,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new X(this.query,this.featureAdapter,this.fieldsIndex),n=t.valueExpression,a=t.scale,i=n?{viewingMode:"map",scale:a,spatialReference:this.query.outSR||this.spatialReference}:null,e.abrupt("return",n?r.getExpressionValues(this.items,n,i,{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM}):r.getDataValues(this.items,{field:t.field,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,normalizationField:t.normalizationField,normalizationType:t.normalizationType,normalizationTotal:t.normalizationTotal}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ne(e,t,r,n){var a=n.x-r.x,i=n.y-r.y,s=a*a+i*i,u=(t.x-r.x)*a+(t.y-r.y)*i,c=Math.min(1,Math.max(0,u/s));e.x=r.x+a*c,e.y=r.y+i*c}function ae(e,t){return e?t?4:3:t?3:2}var ie=function(){function e(t,r){Object(l.a)(this,e),this.coords=t,this.coordsIndex=r}return Object(o.a)(e,[{key:"x",get:function(){return this.coords[this.coordsIndex]}},{key:"y",get:function(){return this.coords[this.coordsIndex+1]}},{key:"z",get:function(){return this.coords[this.coordsIndex+2]}}]),e}(),se=r(1591),ue=r(1319),ce=r(227),oe=r(752);var le="feature-store:unsupported-query",fe=new b.b(2e6),de=0,pe=function(){function e(t){var r=this;Object(l.a)(this,e),this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:Z.a},this.geometryType=t.geometryType,this.hasM=!!t.hasM,this.hasZ=!!t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new b.a(de+++"$$",fe)),this.fieldsIndex=new ce.a(t.fields),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}return Object(o.a)(e,[{key:"destroy",value:function(){this._frameTask=Object(h.l)(this._frameTask),this.clearCache(),Object(h.e)(this._geometryQueryCache),this._changeHandle=Object(h.l)(this._changeHandle),Object(h.e)(this.fieldsIndex)}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"clearCache",value:function(){var e;null!==(e=this._geometryQueryCache)&&void 0!==e&&e.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null}},{key:"executeQuery",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{},r);case 3:return e.abrupt("return",e.sent.createQueryResponse());case 6:if(e.prev=6,e.t0=e.catch(0),e.t0===W.a){e.next=10;break}throw e.t0;case 10:return e.abrupt("return",new re([],t,this).createQueryResponse());case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,r,n=arguments;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.prev=2,e.next=5,this._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},r);case 5:return e.abrupt("return",e.sent.createQueryResponseForCount());case 8:if(e.prev=8,e.t0=e.catch(2),e.t0===W.a){e.next=12;break}throw e.t0;case 12:return e.abrupt("return",0);case 13:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.outSR,e.prev=1,e.next=4,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 4:if(a=e.sent,i=a.size){e.next=8;break}return e.abrupt("return",{count:0,extent:null});case 8:return e.t0=i,e.next=11,this._getBounds(a.items,a.spatialReference,n||this.spatialReference);case 11:return e.t1=e.sent,e.abrupt("return",{count:e.t0,extent:e.t1});case 15:if(e.prev=15,e.t2=e.catch(1),e.t2!==W.a){e.next=19;break}return e.abrupt("return",{count:0,extent:null});case 19:throw e.t2;case 20:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIdSet",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 3:return n=e.sent,a=n.items,i=new Set,e.next=8,this._reschedule((function(){var e,t=Object(s.a)(a);try{for(t.s();!(e=t.n()).done;){var r=e.value;i.add(n.featureAdapter.getObjectId(r))}}catch(u){t.e(u)}finally{t.f()}}),r);case 8:return e.abrupt("return",i);case 11:if(e.prev=11,e.t0=e.catch(0),e.t0!==W.a){e.next=15;break}return e.abrupt("return",new Set);case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSnapping",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,s,c,o,l,f,d,p,h,b,v,m,y,g,x,S=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.point,a=t.distance,s=t.returnEdge,c=t.returnVertex,s||c){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return S._checkQuerySupport(t.query)}),r);case 5:if(o=e.sent,l=!Object(k.d)(n.spatialReference,this.spatialReference),e.t0=l,!e.t0){e.next=11;break}return e.next=11,Object(U.a)(n.spatialReference,this.spatialReference);case 11:if(f="number"==typeof a?a:a.x,d="number"==typeof a?a:a.y,p={xmin:n.x-f,xmax:n.x+f,ymin:n.y-d,ymax:n.y+d,spatialReference:n.spatialReference},h=l?Object(U.b)(p,this.spatialReference):p){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,Object(j.a)(Object(O.a)(n),null,{signal:r});case 16:return b=e.sent[0],e.next=19,Object(j.a)(Object(O.a)(h),null,{signal:r});case 19:if(v=e.sent[0],null!=b&&null!=v){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return e.t1=re,e.next=25,this._reschedule((function(){return S._searchFeatures(S._getQueryBBoxes(v.toJSON()))}),r);case 25:return e.t2=e.sent,e.t3=o,e.t4=this,m=new e.t1(e.t2,e.t3,e.t4),e.next=31,this._reschedule((function(){return S._executeObjectIdsQuery(m)}),r);case 31:return e.next=33,this._reschedule((function(){return S._executeTimeQuery(m)}),r);case 33:return e.next=35,this._reschedule((function(){return S._executeAttributesQuery(m)}),r);case 35:return y=b.toJSON(),g=l?Object(U.b)(y,this.spatialReference):y,x=l?Math.max(h.xmax-h.xmin,h.ymax-h.ymin)/2:a,e.abrupt("return",m.createSnappingResponse(Object(i.a)(Object(i.a)({},t),{},{point:g,distance:x}),n.spatialReference));case 37:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.timeInfo&&this.timeInfo.trackIdField){e.next=2;break}throw new d.a(le,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 2:return e.prev=2,e.next=5,this._executeQuery(t,{},r);case 5:return n=e.sent,e.next=8,this._reschedule((function(){return a._filterLatest(n)}),r);case 8:return e.abrupt("return",n.createQueryResponse());case 11:if(e.prev=11,e.t0=e.catch(2),e.t0===W.a){e.next=15;break}throw e.t0;case 15:return e.abrupt("return",new re([],t,this).createQueryResponse());case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,r,n,a,i,s,c=arguments;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},n=c.length>2?c[2]:void 0,a=(r=c.length>1?c[1]:void 0).field,i=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:a,normalizationField:i,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createSummaryStatisticsResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForUniqueValues",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,r,n,a,i,s,c,o=arguments;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=o.length>2?o[2]:void 0,a=(r=o.length>1?o[1]:void 0).field,i=r.field2,s=r.field3,c=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:a,field2:i,field3:s,valueExpression:c},n);case 6:return e.abrupt("return",e.sent.createUniqueValuesResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForClassBreaks",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,r,n,a,i,s,c=arguments;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},n=c.length>2?c[2]:void 0,a=(r=c.length>1?c[1]:void 0).field,i=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:a,normalizationField:i,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createClassBreaksResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForHistogram",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,r,n,a,i,s,c=arguments;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},n=c.length>2?c[2]:void 0,a=(r=c.length>1?c[1]:void 0).field,i=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:a,normalizationField:i,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createHistogramResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchRecomputedExtents",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,i,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Promise,!("getFullExtent"in this.featureStore)||!this.featureStore.getFullExtent){e.next=5;break}e.t1=Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)),e.next=12;break;case 5:return e.t2=this,e.next=8,this._getAllFeatures();case 8:e.t3=e.sent,e.t4=this.spatialReference,e.t5=this.spatialReference,e.t1=e.t2._getBounds.call(e.t2,e.t3,e.t4,e.t5);case 12:return e.t6=e.t1,e.t7=null!=this._timeExtentPromise?this._timeExtentPromise:this._timeExtentPromise=Object(ue.a)(this.timeInfo,this.featureStore),e.t8=[e.t6,e.t7],e.next=17,e.t0.all.call(e.t0,e.t8);case 17:return r=e.sent,n=Object(a.a)(r,2),i=n[0],s=n[1],e.abrupt("return",(Object(v.n)(t),{fullExtent:i,timeExtent:s}));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getBounds",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a,i,s,c,o,l;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(y.l)(Object(y.b)(),y.a),e.next=3,this.featureStore.forEachBounds(t,(function(e){return Object(y.e)(a,e)}));case 3:return i={xmin:a[0],ymin:a[1],xmax:a[3],ymax:a[4],spatialReference:Object(W.b)(this.spatialReference)},this.hasZ&&isFinite(a[2])&&isFinite(a[5])&&(i.zmin=a[2],i.zmax=a[5]),(s=Object(U.b)(i,r,n)).spatialReference=Object(W.b)(n),s.xmax-s.xmin==0&&(c=Object(m.e)(s.spatialReference),s.xmin-=c,s.xmax+=c),s.ymax-s.ymin==0&&(o=Object(m.e)(s.spatialReference),s.ymin-=o,s.ymax+=o),this.hasZ&&null!=s.zmin&&null!=s.zmax&&s.zmax-s.zmin==0&&(l=Object(m.e)(s.spatialReference),s.zmin-=l,s.zmax+=l),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_schedule",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!=this._frameTask?this._frameTask.schedule(t,r):t(oe.c));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_reschedule",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!=this._frameTask?this._frameTask.reschedule(t,r):t(oe.c));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getAllFeaturesQueryEngineResult",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=re,e.next=3,this._getAllFeatures();case 3:return e.t1=e.sent,e.t2=t,e.t3=this,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getAllFeatures",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,r,n,a=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this._allFeaturesPromise&&(t=[],this._allFeaturesPromise=Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.featureStore.forEach((function(e){return t.push(e)}));case 2:case"end":return e.stop()}}),e)})))().then((function(){return t}))),r=this._allFeaturesPromise,e.next=4,r;case 4:return n=e.sent,e.abrupt("return",r===this._allFeaturesPromise?n.slice():this._getAllFeatures());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_executeQuery",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a,s,c=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(p.a)(t),e.next=3,this._schedule((function(){return Object(W.d)(t,c.definitionExpression,c.spatialReference)}),n);case 3:return t=e.sent,e.next=6,this._reschedule((function(){return c._checkQuerySupport(t)}),n);case 6:return t=e.sent,t=Object(i.a)(Object(i.a)({},t),r),e.next=10,this._reschedule((function(){return c._executeSceneFilterQuery(t,n)}),n);case 10:return a=e.sent,e.next=13,this._reschedule((function(){return c._executeGeometryQuery(t,a,n)}),n);case 13:return s=e.sent,e.next=16,this._reschedule((function(){return c._executeAggregateIdsQuery(s)}),n);case 16:return e.next=18,this._reschedule((function(){return c._executeObjectIdsQuery(s)}),n);case 18:return e.next=20,this._reschedule((function(){return c._executeTimeQuery(s)}),n);case 20:return e.next=22,this._reschedule((function(){return c._executeAttributesQuery(s)}),n);case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeSceneFilterQuery",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,i,o,l,f,d,p,h,b,v,m,y,g,x,O,j,S,F=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.sceneFilter){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.outSR,a=t.returnGeometry,i=t.returnCentroid,o=this.featureStore.featureSpatialReference,l=t.sceneFilter.geometry,f=null==o||Object(k.d)(o,l.spatialReference)?l:Object(U.b)(l,o)){e.next=5;break}return e.abrupt("return",null);case 5:return d=a||i,p=Object(k.l)(n)&&!Object(k.d)(this.spatialReference,n)&&d?function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F._project(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():function(e){return e},h=this.featureAdapter,e.next=10,this._reschedule((function(){return F._searchFeatures(F._getQueryBBoxes(f))}),r);case 10:if(b=e.sent,"disjoint"!==t.sceneFilter.spatialRelationship){e.next=24;break}if(b.length){e.next=14;break}return e.abrupt("return",null);case 14:v=new Set,m=Object(s.a)(b);try{for(m.s();!(y=m.n()).done;)g=y.value,v.add(h.getObjectId(g))}catch(I){m.e(I)}finally{m.f()}return e.next=19,this._reschedule((function(){return F._getAllFeatures()}),r);case 19:return x=e.sent,e.next=22,this._reschedule(Object(c.a)(Object(u.a)().mark((function e(){var n,a,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(se.c)("esriSpatialRelDisjoint",f,F.geometryType,F.hasZ,F.hasM);case 2:return n=e.sent,a=function(e){return!v.has(h.getObjectId(e))||n(h.getGeometry(e))},e.next=6,F._runSpatialFilter(x,a,r);case 6:return i=e.sent,e.abrupt("return",new re(i,t,F));case 8:case"end":return e.stop()}}),e)}))),r);case 22:return O=e.sent,e.abrupt("return",p(O));case 24:if(b.length){e.next=26;break}return e.abrupt("return",new re([],t,this));case 26:if(!this._canExecuteSinglePass(f,t)){e.next=28;break}return e.abrupt("return",p(new re(b,t,this)));case 28:return e.next=30,Object(se.c)("esriSpatialRelContains",f,this.geometryType,this.hasZ,this.hasM);case 30:return j=e.sent,e.next=33,this._runSpatialFilter(b,(function(e){return j(h.getGeometry(e))}),r);case 33:return S=e.sent,e.abrupt("return",p(new re(S,t,this)));case 35:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_executeGeometryQuery",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a,i,o,l,d,p,h,b,v,m,y,g,x,O,j,S,F,I,w,_,R,T,M,N,V,A=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r||0!==r.items.length){e.next=2;break}return e.abrupt("return",r);case 2:if(t=null!=r?r.query:t,i=(a=t).geometry,o=a.outSR,l=a.spatialRel,d=a.returnGeometry,p=a.returnCentroid,h=this.featureStore.featureSpatialReference,b=!i||null==h||Object(k.d)(h,i.spatialReference)?i:Object(U.b)(i,h),v=d||p,m=Object(k.l)(o)&&!Object(k.d)(this.spatialReference,o),y=this._geometryQueryCache&&null==r?m&&v?JSON.stringify({originalFilterGeometry:i,spatialRelationship:l,outSpatialReference:o}):JSON.stringify({originalFilterGeometry:i,spatialRelationship:l}):null,null==(g=y?this._geometryQueryCache.get(y):null)){e.next=6;break}return e.abrupt("return",new re(g,t,this));case 6:if(x=function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=m&&v,!e.t0){e.next=4;break}return e.next=4,A._project(t,o);case 4:return y&&A._geometryQueryCache.put(y,t.items,t.items.length+1),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b){e.next=18;break}if(e.t0=x,null==r){e.next=13;break}e.t1=r,e.next=16;break;case 13:return e.next=15,this._getAllFeaturesQueryEngineResult(t);case 15:e.t1=e.sent;case 16:return e.t2=e.t1,e.abrupt("return",(0,e.t0)(e.t2));case 18:return O=this.featureAdapter,e.next=21,this._reschedule((function(){return A._searchFeatures(A._getQueryBBoxes(i))}),n);case 21:if(j=e.sent,"esriSpatialRelDisjoint"!==l){e.next=49;break}if(j.length){e.next=34;break}if(e.t3=x,null==r){e.next=29;break}e.t4=r,e.next=32;break;case 29:return e.next=31,this._getAllFeaturesQueryEngineResult(t);case 31:e.t4=e.sent;case 32:return e.t5=e.t4,e.abrupt("return",(0,e.t3)(e.t5));case 34:S=new Set,F=Object(s.a)(j);try{for(F.s();!(I=F.n()).done;)w=I.value,S.add(O.getObjectId(w))}catch(E){F.e(E)}finally{F.f()}if(null==r){e.next=41;break}e.t6=r.items,e.next=44;break;case 41:return e.next=43,this._reschedule((function(){return A._getAllFeatures()}),n);case 43:e.t6=e.sent;case 44:return _=e.t6,e.next=47,this._reschedule(Object(c.a)(Object(u.a)().mark((function e(){var r,a,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(se.c)(l,b,A.geometryType,A.hasZ,A.hasM);case 2:return r=e.sent,a=function(e){return!S.has(O.getObjectId(e))||r(O.getGeometry(e))},e.next=6,A._runSpatialFilter(_,a,n);case 6:return i=e.sent,e.abrupt("return",new re(i,t,A));case 8:case"end":return e.stop()}}),e)}))),n);case 47:return R=e.sent,e.abrupt("return",x(R));case 49:if(null!=r&&(T=new f.a,j=j.filter((function(e){return Object(f.g)(r.items,e,r.items.length,T)>=0}))),j.length){e.next=53;break}return M=new re([],t,this),e.abrupt("return",(y&&this._geometryQueryCache.put(y,M.items,1),M));case 53:if(!this._canExecuteSinglePass(b,t)){e.next=55;break}return e.abrupt("return",x(new re(j,t,this)));case 55:return e.next=57,Object(se.c)(l,b,this.geometryType,this.hasZ,this.hasM);case 57:return N=e.sent,e.next=60,this._runSpatialFilter(j,(function(e){return N(O.getGeometry(e))}),n);case 60:return V=e.sent,e.abrupt("return",x(new re(V,t,this)));case 62:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeAggregateIdsQuery",value:function(e){if(0!==e.items.length&&e.query.aggregateIds&&e.query.aggregateIds.length&&null!=this.aggregateAdapter){var t,r=new Set,n=Object(s.a)(e.query.aggregateIds);try{for(n.s();!(t=n.n()).done;){var a=t.value;this.aggregateAdapter.getFeatureObjectIds(a).forEach((function(e){return r.add(e)}))}}catch(u){n.e(u)}finally{n.f()}var i=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return r.has(i(e))}))}}},{key:"_executeObjectIdsQuery",value:function(e){if(0!==e.items.length&&e.query.objectIds&&e.query.objectIds.length){var t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return t.has(r(e))}))}}},{key:"_executeTimeQuery",value:function(e){if(0!==e.items.length){var t=Object(ue.b)(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}}},{key:"_executeAttributesQuery",value:function(e){var t=this;if(0!==e.items.length){var r=P(e.query.where,this.fieldsIndex);if(r){if(!r.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((function(e){return r.testFeature(e,t.featureAdapter)}))}}}},{key:"_runSpatialFilter",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a,i,s,o=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(null!=this._frameTask){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return a=0,i=new Array,s=function(){var e=Object(c.a)(Object(u.a)().mark((function e(c){var l;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a<t.length)){e.next=9;break}if(l=t[a++],r(l)&&(i.push(l),c.madeProgress()),e.t0=c.done,!e.t0){e.next=7;break}return e.next=7,o._reschedule((function(e){return s(e)}),n);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(e){return s(e)}),n).then((function(){return i})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_filterLatest",value:function(e){var t,r=this.timeInfo,n=r.trackIdField,a=r.startTimeField,i=r.endTimeField||a,u=new Map,c=this.featureAdapter.getAttribute,o=Object(s.a)(e.items);try{for(o.s();!(t=o.n()).done;){var l=t.value,f=c(l,n),d=c(l,i),p=u.get(f);(!p||d>c(p,i))&&u.set(f,l)}}catch(h){o.e(h)}finally{o.f()}e.items=Array.from(u.values())}},{key:"_canExecuteSinglePass",value:function(e,t){var r=t.spatialRel;return Object(se.a)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r||"esriSpatialRelWithin"===r))}},{key:"_project",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,i=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!Object(k.d)(this.spatialReference,r)){e.next=2;break}return e.abrupt("return",t);case 2:return n=this.featureAdapter,e.next=5,Object(U.c)(t.items.map((function(e){return Object(W.c)(i.geometryType,i.hasZ,i.hasM,n.getGeometry(e))})),this.spatialReference,r);case 5:return a=e.sent,e.abrupt("return",(t.items=a.map((function(e,r){return n.cloneWithGeometry(t.items[r],Object(S.d)(e,i.hasZ,i.hasM))})),t));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getQueryBBoxes",value:function(e){if(Object(se.a)(e)){if(Object(O.d)(e))return[Object(g.o)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(O.g)(e))return e.rings.map((function(e){return Object(g.o)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[Object(x.b)(Object(g.h)(),e)]}},{key:"_searchFeatures",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,n,a=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Set,e.next=3,Promise.all(t.map((function(e){return a.featureStore.forEachInBounds(e,(function(e){return r.add(e)}))})));case 3:return n=Array.from(r.values()),e.abrupt("return",(r.clear(),n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkStatisticsSupport",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null!==(n=t.distance)&&void 0!==n?n:0)<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=2;break}throw new d.a(le,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),Promise.all([this._checkStatisticsParamsSupport(r,t),Object(se.b)(t,this.geometryType,this.spatialReference),Object(U.a)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkStatisticsParamsSupport",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r){var n,a,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!t.valueExpression){e.next=7;break}return e.next=4,Object(K.e)();case 4:a=e.sent,i=a.arcadeUtils,n=i.extractFieldNames(t.valueExpression);case 7:if(t.field&&n.push(t.field),t.field2&&n.push(t.field2),t.field3&&n.push(t.field3),t.normalizationField&&n.push(t.normalizationField),n.length||t.valueExpression){e.next=9;break}throw new d.a(le,"field or valueExpression is required",{params:t});case 9:q(this.fieldsIndex,n,{errorMessage:"Cannot calculate statistics for missing fields",query:r}),D(this.fieldsIndex,n,{expressionName:"statistics",query:r});case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkQuerySupport",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null!==(r=t.distance)&&void 0!==r?r:0)<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new d.a(le,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),Promise.all([Object(se.b)(t,this.geometryType,this.spatialReference),Object(U.a)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,a=e.outStatistics,i=a?a.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})).filter(Boolean):[];if(r&&r.length>0){var s=" asc",u=" desc",c=r.map((function(e){var t=e.toLowerCase();return t.includes(s)?t.split(s)[0]:t.includes(u)?t.split(u)[0]:e})).filter((function(e){return!i.includes(e)}));q(this.fieldsIndex,c,{expressionName:"orderByFields",query:e})}if(t&&t.length>0)q(this.fieldsIndex,t,{expressionName:"outFields",query:e});else if(n)throw new d.a(le,"outFields should be specified for returnDistinctValues",{query:e});!function(e,t,r){if(!t)return!0;var n="where clause",a=z(t,e,{validateStandardized:!0,expressionName:n});q(e,a,{expressionName:n,query:r}),D(e,a,{expressionName:n,query:r})}(this.fieldsIndex,e.where,e)}},{key:"_checkStatisticsQuerySupport",value:function(e){var t=e.outStatistics,r=e.groupByFieldsForStatistics,a=e.having,i=r&&r.length,u=t&&t.length;if(a){if(!i||!u)throw new d.a(le,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});!function(e,t,r,n){if(!t)return!0;var a="having",i=z(t,e,{validateAggregate:!0,expressionName:a});q(e,i,{expressionName:a,query:n}),D(e,i,{expressionName:a,query:n});var s=_.get(t,e),u=null===s||void 0===s?void 0:s.getExpressions().every((function(t){var n,a=t.aggregateType,i=t.field,s=null===(n=e.get(i))||void 0===n?void 0:n.name;return r.some((function(t){var r,n=t.onStatisticField,i=t.statisticType;return(null===(r=e.get(n))||void 0===r?void 0:r.name)===s&&i.toLowerCase().trim()===a}))}));if(!u)throw new d.a(R,"expressions in having should also exist in outStatistics",{having:t})}(this.fieldsIndex,a,t,e)}if(u){if(!function(e){return null!=e&&e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return;var c=t.map((function(e){return e.onStatisticField})).filter(Boolean);q(this.fieldsIndex,c,{expressionName:"onStatisticFields",query:e}),i&&q(this.fieldsIndex,r,{expressionName:"groupByFieldsForStatistics",query:e});var o,l=new Set([].concat(Object(n.a)(N.jsonValues),Object(n.a)(V.jsonValues))),f=new Intl.ListFormat("en-US",{type:"conjunction"}).format([].concat(Object(n.a)(N.apiValues),Object(n.a)(V.apiValues))),p=Object(s.a)(t);try{for(p.s();!(o=p.n()).done;){var h=o.value,b=h.onStatisticField,v=h.statisticType;if("percentile_disc"!==v&&"percentile_cont"!==v||!("statisticParameters"in h)){if("count"!==v&&"min"!==v&&"max"!==v&&b&&B(b,this.fieldsIndex,l))throw new d.a(le,"outStatistics with '".concat(v,"' statistic type, only supports ").concat(f," field types"),{definition:h,query:e})}else if(!h.statisticParameters)throw new d.a(le,"statisticParameters should be set for percentile type",{definition:h,query:e})}}catch(m){p.e(m)}finally{p.f()}}}},{key:"_getQueryEngineResultForStats",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,r,n){var a,i,s=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(p.a)(t),e.prev=1,e.next=4,this._schedule((function(){return Object(W.d)(t,s.definitionExpression,s.spatialReference)}),n);case 4:return t=e.sent,e.next=7,this._reschedule((function(){return s._checkStatisticsSupport(t,r)}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return s._executeSceneFilterQuery(t,n)}),n);case 10:return a=e.sent,e.next=13,this._reschedule((function(){return s._executeGeometryQuery(t,a,n)}),n);case 13:return i=e.sent,e.next=16,this._reschedule((function(){return s._executeAggregateIdsQuery(i)}),n);case 16:return e.next=18,this._reschedule((function(){return s._executeObjectIdsQuery(i)}),n);case 18:return e.next=20,this._reschedule((function(){return s._executeTimeQuery(i)}),n);case 20:return e.next=22,this._reschedule((function(){return s._executeAttributesQuery(i)}),n);case 22:return e.abrupt("return",i);case 25:if(e.prev=25,e.t0=e.catch(1),e.t0===W.a){e.next=29;break}throw e.t0;case 29:return e.abrupt("return",new re([],t,this));case 30:case"end":return e.stop()}}),e,this,[[1,25]])})));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}()}}]);
//# sourceMappingURL=9.375bc2b7.chunk.js.map