(this["webpackJsonpklw-bank"]=this["webpackJsonpklw-bank"]||[]).push([[189],{1761:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Qn}));var r=n(92),a=n(4),i=n(12),o=n(89),s=n(88),u=n(367),c=n(90),l=n(91),d=n(94),p=(n(119),n(145)),h=n(101),f=n(102),y=n(110),b=n(97),v=(n(96),n(98),n(93)),m=n(95),g=n(910),j=n(259),O=n(168),w=n(169),_=n(99),x=n(126),k=n(352),T=n(164),E=n(206),I=n(132),M=n(335),C=function(){function e(){Object(o.a)(this,e),this._featureLookup=new Map}return Object(s.a)(e,[{key:"deleteFromStore",value:function(e){var t=this;e.forEach((function(e){t._featureLookup.delete(e)}))}},{key:"readFromStoreByList",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.readFromStoreById(e);r&&n.push(r)})),n}},{key:"readFromStoreById",value:function(e){var t;return null!==(t=this._featureLookup.get(e))&&void 0!==t?t:null}},{key:"writeToStore",value:function(e,t,n){var r=this,a=[];return e.forEach((function(e){if(e&&e.id){e.properties||(e.properties=[]);var i,o=null;if(n&&(o=e.properties[n]?Object(O.d)(e.properties[n]):null),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&r._featureLookup.has(e.id)&&r._featureLookup.get(e.id).attributes){var s=r._featureLookup.get(e.id);i=new M.a(o?JSON.parse(JSON.stringify(o)):null!==s&&void 0!==s&&s.geometry?JSON.parse(JSON.stringify(s.geometry)):null,JSON.parse(JSON.stringify(Object.assign(s.attributes,e.properties))),null,e.properties[t])}else i=new M.a(o?JSON.parse(JSON.stringify(o)):null,e.properties,null,e.properties[t]);r._featureLookup.set(e.id,i),a.push(i)}})),a}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"resetInstance",value:function(){e.instance&&(e.instance=null)}}]),e}(),L=n(1),D=n(277),S=n(129),G=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).resultRows=[],r}return Object(s.a)(n)}(x.a);Object(d.a)([Object(b.b)()],G.prototype,"resultRows",void 0);var R=G=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphQueryResult")],G),N=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).resultRowsStream=new ReadableStream,r}return Object(s.a)(n)}(x.a);Object(d.a)([Object(b.b)()],N.prototype,"resultRowsStream",void 0);var F=N=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphQueryResult")],N),P=n(105),A=n(125),B=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).name=null,r.unique=null,r.ascending=null,r.description=null,r.fieldNames=null,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],B.prototype,"name",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],B.prototype,"unique",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],B.prototype,"ascending",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],B.prototype,"description",void 0),Object(d.a)([Object(b.b)({type:[String],json:{write:!0}})],B.prototype,"fieldNames",void 0);var Y=B=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.FieldIndex")],B),z=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).name=null,r.alias=null,r.fieldType=null,r.geometryType=null,r.hasM=null,r.hasZ=null,r.nullable=null,r.editable=null,r.required=null,r.defaultVisibility=null,r.systemMaintained=null,r.role=null,r.defaultValue=null,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],z.prototype,"name",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],z.prototype,"alias",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],z.prototype,"fieldType",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],z.prototype,"geometryType",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],z.prototype,"hasM",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],z.prototype,"hasZ",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],z.prototype,"nullable",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],z.prototype,"editable",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],z.prototype,"required",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],z.prototype,"defaultVisibility",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],z.prototype,"systemMaintained",void 0),Object(d.a)([Object(b.b)()],z.prototype,"role",void 0),Object(d.a)([Object(b.b)({type:Object,json:{type:String,write:{writer:function(e,t){t.defaultValue=null!=e?e.toString():null}}}})],z.prototype,"defaultValue",void 0);var Q=z=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphProperty")],z),U=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).name=null,r.alias=null,r.role=null,r.strict=null,r.properties=null,r.fieldIndexes=null,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],U.prototype,"name",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],U.prototype,"alias",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],U.prototype,"role",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],U.prototype,"strict",void 0),Object(d.a)([Object(b.b)({type:[Q],json:{write:!0}})],U.prototype,"properties",void 0),Object(d.a)([Object(b.b)({type:[Y],json:{write:!0}})],U.prototype,"fieldIndexes",void 0);var q=U=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphObjectType")],U),X=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n)}(q),H=X=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.EntityType")],X),J=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).endPoints=[],r}return Object(s.a)(n)}(q);Object(d.a)([Object(b.b)()],J.prototype,"endPoints",void 0);var W=J=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.RelationshipType")],J),V=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).timestamp=null,r.spatialReference=null,r.strict=null,r.objectIdField=null,r.globalIdField=null,r.arcgisManaged=null,r.identifierInfo=null,r.searchIndexes=null,r.entityTypes=null,r.relationshipTypes=null,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({type:Date,json:{type:Number,write:{writer:function(e,t){t.timestamp=null===e||void 0===e?void 0:e.getTime()}}}})],V.prototype,"timestamp",void 0),Object(d.a)([Object(b.b)({type:A.a,json:{write:!0}})],V.prototype,"spatialReference",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],V.prototype,"strict",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],V.prototype,"objectIdField",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],V.prototype,"globalIdField",void 0),Object(d.a)([Object(b.b)()],V.prototype,"arcgisManaged",void 0),Object(d.a)([Object(b.b)()],V.prototype,"identifierInfo",void 0),Object(d.a)([Object(b.b)()],V.prototype,"searchIndexes",void 0),Object(d.a)([Object(b.b)({type:[H],json:{write:!0}})],V.prototype,"entityTypes",void 0),Object(d.a)([Object(b.b)({type:[W],json:{write:!0}})],V.prototype,"relationshipTypes",void 0);var Z=V=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.DataModel")],V),K=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).capabilities=[],r.supportsSearch=!1,r.supportedQueryFormats=[],r.allowGeometryUpdates=!1,r.searchMaxRecordCount=null,r.serviceCapabilities=null,r.maxRecordCount=null,r.description="",r.copyrightText="",r.units="",r.spatialReference=null,r.currentVersion=null,r.dateFieldsTimeReference=null,r.serviceItemId="",r.supportsDocuments=!1,r.dataEditingNotSupported=!1,r.schemaEditingNotSupported=!1,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({type:[String],json:{write:!0}})],K.prototype,"capabilities",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],K.prototype,"supportsSearch",void 0),Object(d.a)([Object(b.b)({type:[String],json:{write:!0}})],K.prototype,"supportedQueryFormats",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],K.prototype,"allowGeometryUpdates",void 0),Object(d.a)([Object(b.b)({type:Number,json:{write:!0}})],K.prototype,"searchMaxRecordCount",void 0),Object(d.a)([Object(b.b)({type:Object,json:{write:!0}})],K.prototype,"serviceCapabilities",void 0),Object(d.a)([Object(b.b)({type:Number,json:{write:!0}})],K.prototype,"maxRecordCount",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],K.prototype,"description",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],K.prototype,"copyrightText",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],K.prototype,"units",void 0),Object(d.a)([Object(b.b)({type:Object,json:{write:!0}})],K.prototype,"spatialReference",void 0),Object(d.a)([Object(b.b)({type:Number,json:{write:!0}})],K.prototype,"currentVersion",void 0),Object(d.a)([Object(b.b)({type:Object,json:{write:!0}})],K.prototype,"dateFieldsTimeReference",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],K.prototype,"serviceItemId",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],K.prototype,"supportsDocuments",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],K.prototype,"dataEditingNotSupported",void 0),Object(d.a)([Object(b.b)({type:Boolean,json:{write:!0}})],K.prototype,"schemaEditingNotSupported",void 0);var $=K=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.ServiceDefinition")],K),ee=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).dataModel=null,r.serviceDefinition=null,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],ee.prototype,"url",void 0),Object(d.a)([Object(b.b)({type:Z,json:{write:!0}})],ee.prototype,"dataModel",void 0),Object(d.a)([Object(b.b)({type:$,json:{write:!0}})],ee.prototype,"serviceDefinition",void 0);var te,ne=ee=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.KnowledgeGraph")],ee),re=n(288),ae="esri/rest/knowledgeGraph/wasmInterface/",ie=null;function oe(){return se.apply(this,arguments)}function se(){return(se=Object(i.a)(Object(a.a)().mark((function e(){var t,n,r;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=null!==(t=ie)&&void 0!==t?t:te)){e.next=3;break}return e.abrupt("return",n);case 3:return r=Object(v.a)("wasm-simd"),e.abrupt("return",te=ue(r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){return ce.apply(this,arguments)}function ce(){return(ce=Object(i.a)(Object(a.a)().mark((function e(t){var r,i,o,s;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,n.e(268).then(n.bind(null,2240)).then((function(e){return e.a}));case 3:return r=e.sent,i=r.default,e.abrupt("return",i({locateFile:function(e){return Object(re.a)(ae+e)}}));case 6:return e.next=8,n.e(269).then(n.bind(null,2241)).then((function(e){return e.a}));case 8:return o=e.sent,s=o.default,e.abrupt("return",s({locateFile:function(e){return Object(re.a)(ae+e)}}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=n(363),de=n(135),pe=n(192),he=n(214);function fe(e,t){var n=new t.ArrayValue;return n.deleteLater(),e.forEach((function(e){n.add_value(ge(e,t))})),n}function ye(e,t){var n=new t.ObjectValue;n.deleteLater();for(var r=0,a=Object.entries(e);r<a.length;r++){var i=Object(_.a)(a[r],2),o=i[0],s=i[1];n.set_key_value(o,ge(s,t))}return n}function be(e,t){if(e instanceof le.a)return function(e,t){var n=new t.GeometryValue;n.deleteLater(),n.geometry_type=n.geometry_type=t.esriGeometryType.esriGeometryMultipoint,n.has_z=e.hasZ,n.has_m=e.hasM;var r=[],a=[];a[0]=e.points.length;var i=0;return e.points.forEach((function(e){e.forEach((function(e){r[i]=e,i++}))})),n.coords=new Float64Array(r),n.lengths=new Uint32Array(a),n}(e,t);if(e instanceof de.a)return function(e,t){var n=new t.GeometryValue;n.deleteLater(),n.geometry_type=t.esriGeometryType.esriGeometryPoint,n.has_z=e.hasZ,n.has_m=e.hasM;var r=[],a=[];a[0]=1,r[0]=e.x,r[1]=e.y;var i=2;return e.hasZ&&(r[i]=e.z,i++),e.hasM&&(r[i]=e.m,i++),n.coords=new Float64Array(r),n.lengths=new Uint32Array(a),n}(e,t);if(e instanceof pe.a||e instanceof T.a)return function(e,t){var n=new t.GeometryValue;n.deleteLater(),n.has_z=e.hasZ,n.has_m=e.hasM;var r=[],a=[],i=[];e instanceof pe.a?(n.geometry_type=t.esriGeometryType.esriGeometryPolyline,i=e.paths):e instanceof T.a&&(n.geometry_type=t.esriGeometryType.esriGeometryPolygon,i=e.rings);var o=0,s=0;return i.forEach((function(e){var t=0;e.forEach((function(e){t++,e.forEach((function(e){r[s]=e,s++}))})),a[o]=t,o++})),n.coords=new Float64Array(r),n.lengths=new Uint32Array(a),n}(e,t);throw new h.a("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function ve(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function me(e,t,n){if(!e.extent)throw new h.a("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new h.a("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new h.a("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:n.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function ge(e,t){if(null==e)return"";if("object"!=typeof e)return e;if(e instanceof Date)return e;if(e instanceof he.a)return be(e,t);if(Array.isArray(e)){var n=new t.ArrayValue;return n.deleteLater(),e.forEach((function(e){n.add_value(ge(e,t))})),n}return ye(e,t)}var je=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).properties=null,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({json:{write:!0}})],je.prototype,"properties",void 0);var Oe=je=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphObject")],je),we=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).typeName=null,r.id=null,r}return Object(s.a)(n)}(Oe);Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],we.prototype,"typeName",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],we.prototype,"id",void 0);var _e=we=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphNamedObject")],we),xe=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).layoutGeometry=null,r}return Object(s.a)(n)}(_e);Object(d.a)([Object(b.b)({type:de.a,json:{write:!0}})],xe.prototype,"layoutGeometry",void 0);var ke=xe=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.Entity")],xe),Te=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).originId=null,r.destinationId=null,r.layoutGeometry=null,r}return Object(s.a)(n)}(_e);Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],Te.prototype,"originId",void 0),Object(d.a)([Object(b.b)({type:String,json:{write:!0}})],Te.prototype,"destinationId",void 0),Object(d.a)([Object(b.b)({type:pe.a,json:{write:!0}})],Te.prototype,"layoutGeometry",void 0);var Ee=Te=Object(d.a)([Object(m.a)("esri.rest.Relationship.Relationship")],Te);function Ie(e,t){if(!e.typeName)throw new h.a("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof ke){var n=new t.EntityValue;n.deleteLater(),n.type_name=e.typeName;for(var r=0,a=Object.entries(e.properties);r<a.length;r++){var i=Object(_.a)(a[r],2),o=i[0],s=i[1];n.set_key_value(o,Ce(s,t))}return e.id&&n.set_id(e.id),n}if(e instanceof Ee){var u=new t.RelationshipValue;u.deleteLater(),u.type_name=e.typeName;for(var c=0,l=Object.entries(e.properties);c<l.length;c++){var d=Object(_.a)(l[c],2),p=d[0],f=d[1];u.set_key_value(p,Ce(f,t))}return e.id&&u.set_id(e.id),e.originId&&e.destinationId&&u.set_related_entity_ids(e.originId,e.destinationId),u}throw new h.a("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function Me(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Ce(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof he.a?be(e,t):""}var Le=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).name=null,r.supportedCategory=null,r.analyzers=[],r.searchProperties=new Map,r}return Object(s.a)(n)}(x.a);Object(d.a)([Object(b.b)()],Le.prototype,"name",void 0),Object(d.a)([Object(b.b)()],Le.prototype,"supportedCategory",void 0),Object(d.a)([Object(b.b)()],Le.prototype,"analyzers",void 0),Object(d.a)([Object(b.b)()],Le.prototype,"searchProperties",void 0);var De,Se,Ge,Re,Ne,Fe,Pe,Ae,Be=Le=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.SearchIndex")],Le);function Ye(e){var t,n,r,a;return e.deleteLater(),new Z({timestamp:e.timestamp,spatialReference:new A.a(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:Pe[null===(t=e.identifier_info)||void 0===t||null===(t=t.identifier_mapping_info)||void 0===t||null===(t=t.identifier_info_type)||void 0===t?void 0:t.value],databaseNativeIdentifier:null===(n=e.identifier_info)||void 0===n||null===(n=n.identifier_mapping_info)||void 0===n?void 0:n.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:null===(r=e.identifier_info)||void 0===r||null===(r=r.identifier_mapping_info)||void 0===r||null===(r=r.uniform_property_identifier)||void 0===r?void 0:r.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Re[null===(a=e.identifier_info)||void 0===a||null===(a=a.identifier_generation_info)||void 0===a||null===(a=a.uuid_method_hint)||void 0===a?void 0:a.value]}},searchIndexes:Ke(e.search_indexes),entityTypes:He(e.entity_types),relationshipTypes:Ze(e.relationship_types)})}function ze(e){return e.deleteLater(),new H(Ue(e))}function Qe(e){return e.deleteLater(),new Y({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Je(e.fields)})}function Ue(e){return{name:e.name,alias:e.alias,role:De[e.role.value]?De[e.role.value]:null,strict:e.strict,properties:We(e.properties),fieldIndexes:Ve(e.field_indexes)}}function qe(e){return e.deleteLater(),new Q({alias:e.alias,name:e.name,fieldType:Se[e.field_type.value]?Se[e.field_type.value]:null,geometryType:Ge[e.geometry_type.value]?Ge[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:Fe[e.role.value],defaultValue:e.default_value})}function Xe(e){e.deleteLater();for(var t=Ue(e),n=[],r=0;r<e.end_points.size();r++){var a=e.end_points.get(r);n.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return new W(Object.assign({endPoints:n},t))}function He(e){for(var t=[],n=0;n<e.size();n++)t.push(ze(e.get(n)));return t}function Je(e){for(var t=[],n=0;n<e.size();n++)t.push(e.get(n));return t}function We(e){for(var t=[],n=0;n<e.size();n++)t.push(qe(e.get(n)));return t}function Ve(e){for(var t=[],n=0;n<e.size();n++)t.push(Qe(e.get(n)));return t}function Ze(e){for(var t=[],n=0;n<e.size();n++)t.push(Xe(e.get(n)));return t}function Ke(e){for(var t=[],n=0;n<e.size();n++){var r=new Be,a=e.get(0);r.name=a.name,r.supportedCategory=Ne[a.supported_category.value];for(var i=a.analyzers.size(),o=0;o<i;o++)r.analyzers.push({name:a.analyzers.get(o).name});for(var s=0;s<a.search_properties.keys().size();s++){for(var u=a.search_properties.keys().get(s),c=a.search_properties.get(u),l=[],d=0;d<c.property_names.size();d++)l.push(c.property_names.get(d));r.searchProperties.set(u,{propertyNames:l})}t.push(r)}return t}(Ae=De||(De={}))[Ae.Regular=0]="Regular",Ae[Ae.Provenance=1]="Provenance",Ae[Ae.Document=2]="Document",function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger"}(Se||(Se={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Ge||(Ge={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Re||(Re={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(Ne||(Ne={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(Fe||(Fe={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(Pe||(Pe={}));var $e=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(s.a)(n)}(Oe),et=$e=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.ObjectValue")],$e),tt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).path=null,r}return Object(s.a)(n)}(P.a);Object(d.a)([Object(b.b)({type:[Oe],json:{write:!0}})],tt.prototype,"path",void 0);var nt,rt,at,it,ot,st=tt=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.Path")],tt);function ut(e){var t={},n=ct(e,t),r=e.lengths,a=e.coords,i="";if(e.geometry_type.value===nt.ESRI_GEOMETRY_POLYGON)i="rings";else{if(e.geometry_type.value!==nt.ESRI_GEOMETRY_POLYLINE)throw new h.a("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");i="paths"}t[i]=[];var o=0;return r.forEach((function(e){for(var r=[],s=0;s<e;s++){for(var u=[],c=0;c<n;c++)u[c]=a[o],o++;r.push(u)}t[i].push(r)})),t}function ct(e,t){var n=2;return e.has_z?(t.hasZ=e.has_z,n++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,n++):t.hasM=!1,n}(rt=nt||(nt={}))[rt.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",rt[rt.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",rt[rt.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",rt[rt.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",rt[rt.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",rt[rt.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",rt[rt.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",rt[rt.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH",(ot=at||(at={}))[ot.OBJECT=0]="OBJECT",ot[ot.ENTITY=1]="ENTITY",ot[ot.RELATIONSHIP=2]="RELATIONSHIP",ot[ot.PATH=3]="PATH",ot[ot.ARRAY=4]="ARRAY",function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(it||(it={}));var lt=f.a.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),dt={decodedWasmObjToQueryResponseObj:function(e,t){if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case nt.ESRI_GEOMETRY_POINT:return function(e){var t={},n=2;ct(e,t);var r=e.coords;return t.x=r[0],t.y=r[1],e.has_z&&(t.z=r[n],n++),e.has_m&&(t.m=r[n]),new de.a(t)}(e);case nt.ESRI_GEOMETRY_MULTIPOINT:return function(e){var t={},n=ct(e,t),r=e.lengths,a=e.coords,i=r[0];t.points=[];for(var o=0,s=0;s<i;s++){for(var u=[],c=0;c<n;c++)u[c]=a[o],o++;t.points.push(u)}return new le.a(t)}(e);case nt.ESRI_GEOMETRY_POLYLINE:return n=e,new pe.a(ut(n));case nt.ESRI_GEOMETRY_POLYGON:return function(e){return new T.a(ut(e))}(e);case nt.ESRI_GEOMETRY_ENVELOPE:case nt.ESRI_GEOMETRY_MULTI_PATCH:return lt.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case nt.ESRI_GEOMETRY_NULL:case nt.ESRI_GEOMETRY_ANY:default:return lt.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return lt.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case at.OBJECT:return function(e,t){return new et(ft(e,t))}(e,t);case at.ENTITY:return ht(e,t);case at.RELATIONSHIP:return yt(e,t);case at.PATH:return function(e,t){for(var n=e.entity_count(),r=e.relationship_count(),a=[],i=0;i<n;i++)a.push(ht(e.get_entity_at(i),t)),i<r&&a.push(yt(e.get_relationship_at(i),t));return new st({path:a})}(e,t);case at.ARRAY:return function(e,t){for(var n=[],r=e.count(),a=0;a<r;a++){var i=e.get_value_at(a);n.push(pt(i,t))}return n}(e,t);default:return lt.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}var n}};function pt(e,t){return dt.decodedWasmObjToQueryResponseObj(e,t)}function ht(e,t){var n=e.type_name,r=ft(e,t),a=e.get_id();return new ke(Object.assign({typeName:n,id:a},r))}function ft(e,t){for(var n={},r=e.key_count(),a=0;a<r;a++)n[e.get_key_at(a)]=pt(e.get_value_at(a),t);return{properties:n}}function yt(e,t){var n=e.type_name,r=ft(e,t);return new Ee(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},r))}var bt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).hasError=null,r.error=null,r.editResults=[],r}return Object(s.a)(n)}(x.a);Object(d.a)([Object(b.b)()],bt.prototype,"hasError",void 0),Object(d.a)([Object(b.b)()],bt.prototype,"error",void 0),Object(d.a)([Object(b.b)()],bt.prototype,"editResults",void 0);var vt=bt=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphApplyEdits")],bt);function mt(e){var t=new vt;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});for(var n=e.get_edit_results_count(),r=0;r<n;r++){for(var a=e.get_edit_results_at(r),i=e.get_edit_results_type_name_at(r),o=[],s=[],u=[],c=a.get_add_results_count(),l=a.get_update_results_count(),d=a.get_delete_results_count(),p=0;p<c;p++){var h=a.get_add_result_at(p);o.push({id:h.id,error:{errorCode:h.error.error_code,errorMessage:h.error.error_message}})}for(var f=0;f<l;f++){var y=a.get_update_result_at(f);s.push({id:y.id,error:{errorCode:y.error.error_code,errorMessage:y.error.error_message}})}for(var b=0;b<d;b++){var v=a.get_delete_result_at(b);u.push({id:v.id,error:{errorCode:v.error.error_code,errorMessage:v.error.error_message}})}t.editResults.push({typeName:i,adds:o,updates:s,deletes:u})}return t}var gt={fetchKnowledgeGraph:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,r;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ne({url:t}),(r=[]).push(_t(n)),r.push(kt(n)),e.next=5,Promise.all(r);case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refreshDataModel:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xt(t);case 2:t.dataModel=e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refreshServiceDefinition:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,r,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.default)(t.url,{query:{f:"json"}});case 2:return i=e.sent.data,e.abrupt("return",(i.capabilities=null===i||void 0===i||null===(n=i.capabilities)||void 0===n?void 0:n.split(","),i.supportedQueryFormats=null===i||void 0===i||null===(r=i.supportedQueryFormats)||void 0===r?void 0:r.split(","),t.serviceDefinition=new $(i),t.serviceDefinition));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),executeQueryStreaming:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,r){var i,o,s;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(t.url,"/graph/query"),e.next=3,Mt(t);case 3:return e.next=5,At(i,r);case 5:return o=e.sent,e.next=8,Rt(n,t);case 8:return o.data.body=e.sent,e.next=11,Et(o.data.url,o.data);case 11:if(s=e.sent,!t.dataModel){e.next=19;break}return e.t0=F,e.next=16,Ut(s,t.dataModel);case 16:return e.t1=e.sent,e.t2={resultRowsStream:e.t1},e.abrupt("return",new e.t0(e.t2));case 19:throw new h.a("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeApplyEdits:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,r){var i,o,s;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(i=t.serviceDefinition)||void 0===i||!i.dataEditingNotSupported){e.next=2;break}throw new h.a("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");case 2:return o="".concat(t.url,"/graph/applyEdits"),e.next=5,Mt(t);case 5:return e.next=7,At(o,r);case 7:return s=e.sent,e.next=10,St(n,t);case 10:return s.data.body=e.sent,e.t0=Yt,e.next=14,Et(s.data.url,s.data);case 14:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeQuery:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,r){var i,o,s,u,c,l;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(t.url,"/graph/query"),e.next=3,Object(S.default)(o,{responseType:"array-buffer",query:Object(L.a)({f:"pbf",openCypherQuery:n.openCypherQuery},null===r||void 0===r?void 0:r.query),signal:null===r||void 0===r?void 0:r.signal,timeout:null===r||void 0===r?void 0:r.timeout});case 3:if(s=e.sent,u=null===(i=s.getHeader)||void 0===i?void 0:i.call(s,"content-type"),c=s.data,null===u||void 0===u||!u.includes("application/x-protobuf")){e.next=14;break}return e.next=9,oe();case 9:if(e.t0=e.sent.GraphQueryDecoder,(l=new e.t0).deleteLater(),!t.dataModel){e.next=13;break}return e.abrupt("return",new R({resultRows:Qt(l,c,t.dataModel)}));case 13:throw new h.a("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 14:throw new h.a("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:u,data:s.data});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeSearch:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,r){var i,o,s,u,c,l,d;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.typeCategoryFilter,s="".concat(t.url,"/graph/search"),e.next=4,Object(S.default)(s,{responseType:"array-buffer",query:Object(L.a)({f:"pbf",searchQuery:'"'.concat(n.searchQuery,'"'),typeCategoryFilter:o},null===r||void 0===r?void 0:r.query),signal:null===r||void 0===r?void 0:r.signal,timeout:null===r||void 0===r?void 0:r.timeout});case 4:if(u=e.sent,c=null===(i=u.getHeader)||void 0===i?void 0:i.call(u,"content-type"),l=u.data,null===c||void 0===c||!c.includes("application/x-protobuf")){e.next=15;break}return e.next=10,oe();case 10:if(e.t0=e.sent.GraphQueryDecoder,(d=new e.t0).deleteLater(),!t.dataModel){e.next=14;break}return e.abrupt("return",new R({resultRows:Qt(d,l,t.dataModel)}));case 14:throw new h.a("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 15:throw new h.a("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:c,data:u.data});case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeSearchStreaming:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,r){var i,o,s;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(t.url,"/graph/search"),e.next=3,Mt(t);case 3:return e.next=5,At(i,r);case 5:return o=e.sent,e.next=8,Ft(n);case 8:return o.data.body=e.sent,e.next=11,Et(o.data.url,o.data);case 11:if(s=e.sent,!t.dataModel){e.next=19;break}return e.t0=F,e.next=16,Ut(s,t.dataModel);case 16:return e.t1=e.sent,e.t2={resultRowsStream:e.t1},e.abrupt("return",new e.t0(e.t2));case 19:throw new h.a("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),_fetchWrapper:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()};function jt(e,t,n){return Ot.apply(this,arguments)}function Ot(){return Ot=Object(i.a)(Object(a.a)().mark((function e(t,n,r){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.executeQueryStreaming(t,n,r));case 1:case"end":return e.stop()}}),e)}))),Ot.apply(this,arguments)}function wt(){return wt=Object(i.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.fetchKnowledgeGraph(t));case 1:case"end":return e.stop()}}),e)}))),wt.apply(this,arguments)}function _t(e){return xt.apply(this,arguments)}function xt(){return xt=Object(i.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.refreshDataModel(t));case 1:case"end":return e.stop()}}),e)}))),xt.apply(this,arguments)}function kt(e){return Tt.apply(this,arguments)}function Tt(){return Tt=Object(i.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.refreshServiceDefinition(t));case 1:case"end":return e.stop()}}),e)}))),Tt.apply(this,arguments)}function Et(e,t){return It.apply(this,arguments)}function It(){return It=Object(i.a)(Object(a.a)().mark((function e(t,n){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt._fetchWrapper(t,n));case 1:case"end":return e.stop()}}),e)}))),It.apply(this,arguments)}function Mt(e){return Ct.apply(this,arguments)}function Ct(){return(Ct=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===D.c||void 0===D.c?void 0:D.c.findCredential(t.url),e.t0=n,e.t0){e.next=10;break}if(!t.dataModel){e.next=8;break}return e.next=6,Xt(t);case 6:e.next=10;break;case 8:return e.next=10,_t(t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lt(e,t,n){if(0!==e.error_code)throw new h.a(t,n,{errorCode:e.error_code,errorMessage:e.error_message})}function Dt(e,t,n,r){null==t?n.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?n.set_param_key_value(e,t):t instanceof he.a?n.set_param_key_value(e,be(t,r)):t instanceof Array?n.set_param_key_value(e,fe(t,r)):n.set_param_key_value(e,ye(t,r))}function St(e,t){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,i,o,s,u,c,l,d,p,f,y,b,v;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.dataModel,e.t0){e.next=4;break}return e.next=4,_t(n);case 4:if(n.dataModel){e.next=6;break}throw new h.a("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");case 6:return e.next=8,oe();case 8:s=e.sent,u=!(null===(r=t.options)||void 0===r||!r.cascadeDelete),(c=new s.GraphApplyEditsEncoder(s.SpatialReferenceUtil.WGS84(),null!==(i=t.options)&&void 0!==i&&i.inputQuantizationParameters?Me(null===(o=t.options)||void 0===o?void 0:o.inputQuantizationParameters):s.InputQuantizationUtil.WGS84_lossless())).deleteLater(),c.cascade_delete=u,e.prev=12,null!==(l=t.entityAdds)&&void 0!==l&&l.forEach((function(e){Lt(c.add_entity(Ie(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(d=t.relationshipAdds)&&void 0!==d&&d.forEach((function(e){if(!e.originId||!e.destinationId)throw new h.a("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");Lt(c.add_relationship(Ie(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(p=t.entityUpdates)&&void 0!==p&&p.forEach((function(e){if(!e.id)throw new h.a("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");Lt(c.update_entity(Ie(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(f=t.relationshipUpdates)&&void 0!==f&&f.forEach((function(e){if(!e.id)throw new h.a("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");Lt(c.update_relationship(Ie(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(y=t.entityDeletes)&&void 0!==y&&y.forEach((function(e){var t;if(!e.typeName)throw new h.a("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");var n=c.make_delete_helper(e.typeName,!0);n.deleteLater(),null===(t=e.ids)||void 0===t||t.forEach((function(e){n.delete_by_id(e)}))})),null!==(b=t.relationshipDeletes)&&void 0!==b&&b.forEach((function(e){var t;if(!e.typeName)throw new h.a("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");var n=c.make_delete_helper(e.typeName,!1);null===(t=e.ids)||void 0===t||t.forEach((function(e){n.delete_by_id(e)}))})),c.encode(),e.next=19;break;case 16:throw e.prev=16,e.t1=e.catch(12),new h.a("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:e.t1});case 19:return v=c.get_encoding_result(),e.abrupt("return",(Lt(v.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),v.get_byte_buffer()));case 21:case"end":return e.stop()}}),e,null,[[12,16]])}))),Gt.apply(this,arguments)}function Rt(e,t){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,i,o,s,u,c,l,d,p;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:if(r=e.sent,(i=new r.GraphQueryRequestEncoder).deleteLater(),i.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),i.open_cypher_query=t.openCypherQuery,t.bindParameters)for(o=0,s=Object.entries(t.bindParameters);o<s.length;o++)u=Object(_.a)(s[o],2),c=u[0],l=u[1],Dt(c,l,i,r);if(!t.bindGeometryQuantizationParameters){e.next=9;break}ve(t.bindGeometryQuantizationParameters,i),e.next=16;break;case 9:if(e.t0=n.dataModel,e.t0){e.next=13;break}return e.next=13,_t(n);case 13:if(4326===(null===(d=n.dataModel)||void 0===d||null===(d=d.spatialReference)||void 0===d?void 0:d.wkid)){e.next=15;break}throw new h.a("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");case 15:i.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless();case 16:t.outputQuantizationParameters&&me(t.outputQuantizationParameters,i,r),e.prev=17,i.encode(),e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(17),new h.a("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:e.t1});case 24:if(0===(p=i.get_encoding_result()).error.error_code){e.next=27;break}throw new h.a("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:p.error.error_code,errorMessage:p.error.error_message});case 27:return e.abrupt("return",p.get_byte_buffer());case 28:case"end":return e.stop()}}),e,null,[[17,21]])}))),Nt.apply(this,arguments)}function Ft(e){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(i.a)(Object(a.a)().mark((function e(t){var n,r,i,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:if(r=e.sent,(i=new r.GraphSearchRequestEncoder).deleteLater(),i.search_query=t.searchQuery,i.type_category_filter=r.esriNamedTypeCategory[t.typeCategoryFilter],!0===t.returnSearchContext&&(i.return_search_context=t.returnSearchContext),null!=t.start&&t.start>0&&(i.start_index=t.start),null!=t.num&&(i.max_num_results=t.num),!(null!=t.idsFilter&&Array.isArray(t.idsFilter)&&t.idsFilter.length>0)){e.next=12;break}e.prev=5,i.set_ids_filter(fe(t.idsFilter,r)),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(5),new h.a("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:e.t0});case 12:null===(n=t.namedTypesFilter)||void 0===n||n.forEach((function(e){i.add_named_type_filter(e)})),e.prev=13,i.encode(),e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(13),new h.a("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:e.t1});case 20:if(0===(o=i.get_encoding_result()).error.error_code){e.next=23;break}throw new h.a("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});case 23:return e.abrupt("return",o.get_byte_buffer());case 24:case"end":return e.stop()}}),e,null,[[5,9],[13,17]])}))),Pt.apply(this,arguments)}function At(e,t){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(i.a)(Object(a.a)().mark((function e(t,n){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(S.default)(t,{responseType:"native-request-init",method:"post",query:Object(L.a)({f:"pbf"},null===n||void 0===n?void 0:n.query),body:"x",headers:{"Content-Type":"application/octet-stream"},signal:null===n||void 0===n?void 0:n.signal,timeout:null===n||void 0===n?void 0:n.timeout}));case 1:case"end":return e.stop()}}),e)}))),Bt.apply(this,arguments)}function Yt(e){return zt.apply(this,arguments)}function zt(){return zt=Object(i.a)(Object(a.a)().mark((function e(t){var n,r,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t.headers.get("content-type"))||void 0===n||!n.includes("application/x-protobuf")){e.next=10;break}return e.next=4,t.arrayBuffer();case 4:return r=e.sent,e.next=7,oe();case 7:return e.t0=e.sent.GraphApplyEditsDecoder,i=new e.t0,e.abrupt("return",(i.deleteLater(),i.decode(new Uint8Array(r)),mt(i)));case 10:throw new h.a("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:t.text()});case 11:case"end":return e.stop()}}),e)}))),zt.apply(this,arguments)}function Qt(e,t,n){e.push_buffer(new Uint8Array(t));for(var r=[],a=0;e.next_row();){a||(a=e.get_header_keys().size());for(var i=new Array(a),o=0;o<a;o++){var s=e.get_value(o);i[o]=pt(s,n)}r.push(i)}if(e.has_error())throw new h.a("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return r}function Ut(e,t){return qt.apply(this,arguments)}function qt(){return qt=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,o,s,u;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.headers.get("content-type"),t.headers.get("content-length")&&f.a.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),null===r||void 0===r||!r.includes("application/x-protobuf")){e.next=8;break}return s=null===(o=t.body)||void 0===o?void 0:o.getReader(),e.next=5,oe();case 5:return e.t0=e.sent.GraphQueryDecoder,u=new e.t0,e.abrupt("return",(u.deleteLater(),new ReadableStream({start:function(e){return Object(i.a)(Object(a.a)().mark((function t(){var r;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=function(){return null===s||void 0===s?void 0:s.read().then((function(t){var a,i=t.done,o=t.value;if(!i){var c=Qt(u,o,n);return c.length>0&&e.enqueue(c),r()}if(u.has_error()&&(a=new h.a("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:u.error.error_code,errorMessage:u.error.error_message})),s.releaseLock(),a)throw e.error(a),a;e.close()}))},t.prev=1,t.abrupt("return",r());case 5:t.prev=5,t.t0=t.catch(1),null!==s&&void 0!==s&&s.releaseLock(),e.error(new h.a("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:t.t0})),e.close();case 8:case"end":return t.stop()}}),t,null,[[1,5]])})))()}})));case 8:throw new h.a("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:t.text()});case 9:case"end":return e.stop()}}),e)}))),qt.apply(this,arguments)}function Xt(e){return Ht.apply(this,arguments)}function Ht(){return Ht=Object(i.a)(Object(a.a)().mark((function e(t){var n,r,i,o,s,u;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(t.url,"/dataModel/queryDataModel"),e.next=3,Object(S.default)(r,{responseType:"array-buffer",query:{f:"pbf"}});case 3:if(i=e.sent,o=null===(n=i.getHeader)||void 0===n?void 0:n.call(i,"content-type"),s=i.data,null===o||void 0===o||!o.includes("application/x-protobuf")){e.next=13;break}return e.next=9,oe();case 9:if(u=e.sent.decode_data_model_from_protocol_buffer(new Uint8Array(s))){e.next=12;break}throw new h.a("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");case 12:return e.abrupt("return",Ye(u));case 13:throw new h.a("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:i.data});case 14:case"end":return e.stop()}}),e)}))),Ht.apply(this,arguments)}var Jt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).openCypherQuery="",r}return Object(s.a)(n)}(x.a);Object(d.a)([Object(b.b)()],Jt.prototype,"openCypherQuery",void 0);var Wt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).bindParameters=null,r.bindGeometryQuantizationParameters=null,r.outputQuantizationParameters=null,r}return Object(s.a)(n)}(Jt=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphQuery")],Jt));Object(d.a)([Object(b.b)()],Wt.prototype,"bindParameters",void 0),Object(d.a)([Object(b.b)()],Wt.prototype,"bindGeometryQuantizationParameters",void 0),Object(d.a)([Object(b.b)()],Wt.prototype,"outputQuantizationParameters",void 0);var Vt=Wt=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.GraphQueryStreaming")],Wt),Zt=n(210),Kt="ESRI__ID",$t="ESRI__ORIGIN_ID",en="ESRI__DESTINATION_ID",tn="ESRI__LAYOUT_GEOMETRY",nn=12,rn=f.a.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager"),an=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r,a,i,s;Object(o.a)(this,n),(s=t.call(this,e)).inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},s.entityTypeNames=new Set,s.relationshipTypeNames=new Set,s.geographicLookup=new Map,s.sublayerCaches=new Map,s._processingCacheUpdatesLookup=new Map,s._memberIdTypeLookup=new Map;var u=new Map;return null!==(r=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==r&&r.forEach((function(t){var n,r;t.name&&(u.set(t.name,"entity"),s._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers)||s.entityTypeNames.add(t.name),null===(r=t.properties)||void 0===r||r.forEach((function(e){var n;e.geometryType&&"esriGeometryNull"!==e.geometryType&&s.geographicLookup.set(t.name,{name:null!==(n=e.name)&&void 0!==n?n:"",geometryType:e.geometryType})})))})),null!==(a=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==a&&a.forEach((function(t){var n,r;t.name&&(u.set(t.name,"relationship"),s._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers)||s.relationshipTypeNames.add(t.name),null===(r=t.properties)||void 0===r||r.forEach((function(e){var n;e.geometryType&&"esriGeometryNull"!==e.geometryType&&s.geographicLookup.set(t.name,{name:null!==(n=e.name)&&void 0!==n?n:"",geometryType:e.geometryType})})))})),null===(i=e.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.forEach((function(t,n){var r;if("entity"===u.get(n))s.entityTypeNames.add(n);else{var a;if("relationship"!==u.get(n))return rn.warn("A named type, ".concat(n,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(a=e.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.delete(n));s.relationshipTypeNames.add(n)}var i=new Map;null!==(r=t.members)&&void 0!==r&&r.forEach((function(e){s._memberIdTypeLookup.set(e.id,n);var t=s.getById(e.id);t&&i.set(e.id,t)})),s.sublayerCaches.set(n,i)})),s}return Object(s.a)(n,[{key:"addToLayerInclusionSet",value:function(e){var t=this;e.forEach((function(e){var n=e.typeName,r=e.id;if(!t.inclusionModeDefinition)throw new h.a("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(t.inclusionModeDefinition.namedTypeDefinitions.has(n)){if(t.inclusionModeDefinition.namedTypeDefinitions.has(n)){var a=t.inclusionModeDefinition.namedTypeDefinitions.get(n);if(a.useAllData)throw new h.a("knowledge-graph:layer-data-manager","You cannot add members to an exclusion list for a sublayer where the sublayer is set to always retrieve its entire data set");a.members||(a.members=new Map),a.members.set(r,{id:r}),t._memberIdTypeLookup.set(r,n)}}else{var i=new Map;i.set(r,{id:r}),t.inclusionModeDefinition.namedTypeDefinitions.set(n,{useAllData:!1,members:i}),t._memberIdTypeLookup.set(r,n)}}))}},{key:"getById",value:function(e){return C.getInstance().readFromStoreById(e)}},{key:"getData",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,r){var i,o,s,u,c,l,d,p,h,f,y,b,v;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.objectType.name&&null!==(i=this.inclusionModeDefinition)&&void 0!==i&&i.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0)||this.inclusionModeDefinition.namedTypeDefinitions.has(n.objectType.name)){e.next=2;break}return e.abrupt("return",[]);case 2:if(o=t||new Zt.a({where:"1=1",outFields:["*"]}),"link-chart"!==n.parentCompositeLayer.type){e.next=12;break}if(l=n.parentCompositeLayer,d=this._processingCacheUpdatesLookup.get(null!==(s=n.objectType.name)&&void 0!==s?s:""),p=o.outFields,h=o.geometry,f="",y="",h&&h.extent&&(f=Object(g.b)(h.extent.ymin,h.extent.xmin,nn),y=Object(g.b)(h.extent.ymax,h.extent.xmax,nn)),e.t0=p&&1===p.length&&p[0]===Kt&&"1=1"===o.where,e.t0){e.next=10;break}return e.next=10,Promise.all(null!==d&&void 0!==d?d:[]);case 10:return b=this.sublayerCaches.has(null!==(u=n.objectType.name)&&void 0!==u?u:"")?Array.from(null===(c=this.sublayerCaches.get(n.objectType.name))||void 0===c?void 0:c.values()):[],v=[],e.abrupt("return",(b.forEach((function(e){if(e.geometry=l.linkChartDiagramLookup.get(e.attributes[n.objectIdField]),e.attributes[tn]=e.geometry,f&&y){var t=l.linkChartGeohashLookup.get(e.attributes[n.objectIdField]);t?t>=f&&t<=y&&v.push(e):v.push(e)}else v.push(e)})),v));case 12:return e.abrupt("return",this.retrieveDataFromService(o,n,r));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getConnectedRecordIds",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,r,o,s=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=[],o=new Map,t.forEach((function(e){if(s._memberIdTypeLookup.has(e)){var t,n=s._memberIdTypeLookup.get(e);if(!s.entityTypeNames.has(n))return;o.has(n)?null===(t=o.get(n))||void 0===t||t.push(e):o.set(n,[e])}})),o.forEach((function(e,t){var o="MATCH (n:".concat(t,")-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]"),u=new Promise((function(t){Object(i.a)(Object(a.a)().mark((function t(){var r,i,u,c,l,d;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,jt(s.knowledgeGraph,new Vt({openCypherQuery:o,bindParameters:{ids:e}}));case 2:r=t.sent.resultRowsStream.getReader(),t.prev=3;case 4:return t.next=6,r.read();case 6:if(i=t.sent,u=i.done,c=i.value,!u){t.next=11;break}return t.abrupt("break",14);case 11:for(l=0;l<c.length;l++)d=c[l],n.push({id:d[0],typeName:d[1]}),n.push({id:d[2],typeName:d[3]});case 12:t.next=4;break;case 14:t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(3),"AbortError"===t.t0.name){t.next=20;break}throw t.t0;case 20:rn.info("Request aborted as expected");case 21:case"end":return t.stop()}}),t,null,[[3,16]])})))().then((function(){t()}))}));r.push(u)})),e.next=5,Promise.all(r);case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshCacheContent",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,o){var s,u,c,l,d,p,f,y,b,v,m,g,j,O=this,w=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p=!(w.length>3&&void 0!==w[3])||w[3],f=C.getInstance(),y=[],b=new Map,v=new Map,null!==(s=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==s&&s.forEach((function(e){e.name&&v.set(e.name,e)})),null!==(u=this.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==u&&u.forEach((function(e){e.name&&v.set(e.name,e)})),t||this.inclusionModeDefinition?t?t.forEach((function(e){if(O._memberIdTypeLookup.has(e)){var t,n=O._memberIdTypeLookup.get(e);b.has(n)?null===(t=b.get(n))||void 0===t||t.push(e):b.set(n,[e])}})):null===(c=this.inclusionModeDefinition)||void 0===c||null===(c=c.namedTypeDefinitions)||void 0===c||c.forEach((function(e,t){e.useAllData?b.set(t,null):e.members&&e.members.forEach((function(e){var n;b.has(t)&&null!==b.get(t)?null===(n=b.get(t))||void 0===n||n.push(e.id):b.set(t,[e.id])}))})):(null!==(l=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==l&&l.forEach((function(e){e.name&&b.set(e.name,null)})),null===(d=this.knowledgeGraph.dataModel.entityTypes)||void 0===d||d.forEach((function(e){e.name&&b.set(e.name,null)}))),m=Object(r.a)(b),e.prev=4,j=Object(a.a)().mark((function e(){var t,r,s,u,c;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(_.a)(g.value,2),s=r[0],u=r[1],c=new Promise((function(e){var t=function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,r,i,c,l,d,y,b,m,g;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Set,i=[],l="",d=!1,n||null!==(t=v.get(s))&&void 0!==t&&null!==(t=t.properties)&&void 0!==t&&t.forEach((function(e){e.name&&r.add(e.name)})),o&&O.geographicLookup.has(s)&&(b=null===(y=O.geographicLookup.get(s))||void 0===y?void 0:y.name)&&r.add(b),!O.entityTypeNames.has(s)){e.next=7;break}l="MATCH (n:".concat(s,") ").concat(u?"WHERE id(n) IN $ids ":"","return ID(n)"),r.forEach((function(e){l+=", n.".concat(e),i.push(e)})),e.next=10;break;case 7:if(O.relationshipTypeNames.has(s)){e.next=9;break}throw new h.a("knowledge-graph:layer-data-manager","The graph type of ".concat(s," could not be determined. Was this type set in the KG data model and inclusion definition?"));case 9:d=!0,l="MATCH ()-[n:".concat(s,"]->() ").concat(u?"WHERE id(n) IN $ids ":"","return ID(n), id(startNode(n)), id(endNode(n))"),r.forEach((function(e){l+=", n.".concat(e),i.push(e)}));case 10:return c=new Vt(u?{openCypherQuery:l,bindParameters:{ids:u}}:{openCypherQuery:l}),e.next=13,jt(O.knowledgeGraph,c);case 13:m=e.sent.resultRowsStream.getReader(),g=Object(a.a)().mark((function e(){var t,n,r,o,u,c,l,h,y,b,v,g,j,w,_;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.read();case 2:if(u=e.sent,c=u.done,l=u.value,!c){e.next=7;break}return e.abrupt("return",1);case 7:for(h=[],y=0;y<l.length;y++){for(b=l[y],g=0,(j={properties:{}}).id=b[v=0],v++,g++,d&&(j.originId=b[v],v++,g++,j.destinationId=b[v],v++,g++);v<b.length;v++)j.properties[i[v-g]]=b[v];h.push(j)}w=f.writeToStore(h,Kt,null===(t=O.geographicLookup.get(s))||void 0===t?void 0:t.name),O.sublayerCaches.has(s)||O.sublayerCaches.set(s,new Map),p&&!(null!==(n=O.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.has(s))&&null!==(r=O.inclusionModeDefinition)&&void 0!==r&&r.namedTypeDefinitions.set(s,{useAllData:!1,members:new Map}),p&&(null===(o=O.inclusionModeDefinition)||void 0===o||!o.namedTypeDefinitions.get(s).members)&&(O.inclusionModeDefinition.namedTypeDefinitions.get(s).members=new Map),_=O.sublayerCaches.get(s),w.forEach((function(e){var t,n;null!==_&&void 0!==_&&_.set(e.attributes[Kt],e),p&&(null===(t=O.inclusionModeDefinition)||void 0===t||!t.namedTypeDefinitions.get(s).members.has(e.attributes[Kt]))&&(null!==(n=O.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.get(s).members.set(e.attributes[Kt],{id:e.attributes[Kt]}),O._memberIdTypeLookup.set(e.attributes[Kt],s))}));case 13:case"end":return e.stop()}}),e)}));case 15:return e.delegateYield(g(),"t0",16);case 16:if(!e.t0){e.next=18;break}return e.abrupt("break",20);case 18:e.next=15;break;case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t().then((function(){e(null)}))})),y.push(c),null===(t=O._processingCacheUpdatesLookup.get(s))||void 0===t||t.push(c);case 3:case"end":return e.stop()}}),e)})),m.s();case 7:if((g=m.n()).done){e.next=11;break}return e.delegateYield(j(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),m.e(e.t1);case 16:return e.prev=16,m.f(),e.finish(16);case 19:return e.next=21,Promise.all(y);case 21:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"removeFromLayer",value:function(e){var t=this,n=new Set;e.forEach((function(e){var r;t._memberIdTypeLookup.get(e)&&n.add(t._memberIdTypeLookup.get(e)),t._memberIdTypeLookup.delete(e),null===(r=t.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.forEach((function(t){var n;(null===(n=t.members)||void 0===n?void 0:n.has(e))&&t.members.delete(e)}))})),n.forEach((function(n){var r;null===(r=t.sublayerCaches.get(n))||void 0===r||r.forEach((function(r,a){var i;e.includes(a)&&(null===(i=t.sublayerCaches.get(n))||void 0===i||i.delete(a))}))}))}},{key:"retrieveDataFromService",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,r){var i,o,s,u,c,l,d,p,h,f,y,b,v,m,g,j,O,w,_,x,M,L,D,S,G,R,N,F,P,A,B,Y,z,Q,U,q,X,H,J,W,V,Z;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=C.getInstance(),c=new Set,l=[],p="",h=[],f="relationship"===n.graphType,y=null===(i=this.inclusionModeDefinition)||void 0===i||null===(i=i.namedTypeDefinitions)||void 0===i||null===(i=i.get(n.objectType.name))||void 0===i?void 0:i.useAllData,b=n.parentCompositeLayer.sublayerIdsCache.get(n.objectType.name),v=!y&&b?Array.from(b).sort():null,null===(o=this.inclusionModeDefinition)||void 0===o||null===(o=o.namedTypeDefinitions)||void 0===o||null===(o=o.get(n.objectType.name))||void 0===o||!o.useAllData){e.next=8;break}(null===(s=this.inclusionModeDefinition)||void 0===s||null===(s=s.namedTypeDefinitions)||void 0===s||null===(s=s.get(n.objectType.name))||void 0===s?void 0:s.useAllData)&&null!=t.objectIds&&(v=t.objectIds),e.next=20;break;case 8:if(!(null!=t.objectIds&&v&&v.length>0)){e.next=13;break}m=t.objectIds,t.objectIds=v.filter((function(e){return m.includes(e)})),e.next=20;break;case 13:if(null==t.objectIds){e.next=17;break}v=t.objectIds,e.next=20;break;case 17:if(null===(g=this.inclusionModeDefinition)||void 0===g||!g.namedTypeDefinitions.has(n.objectType.name)||null!==(j=this.inclusionModeDefinition.namedTypeDefinitions.get(n.objectType.name))&&void 0!==j&&j.members&&!((null===(O=this.inclusionModeDefinition.namedTypeDefinitions.get(n.objectType.name))||void 0===O||null===(O=O.members)||void 0===O?void 0:O.size)<1)){e.next=19;break}return e.abrupt("return",(t.objectIds=[],[]));case 19:t.objectIds=v;case 20:if(null!=t.outFields&&((w=t.outFields).includes("*")?n.fields.forEach((function(e){c.add(e.name)})):w.forEach((function(e){e!==Kt&&e!==n.geometryFieldName&&c.add(e)}))),null==t.geometry){e.next=38;break}if(null===(M=t.geometry)||void 0===M||null===(_=M.extent)||void 0===_||!_.spatialReference||null!==(x=M.spatialReference)&&void 0!==x&&x.isWGS84){e.next=29;break}return e.next=26,Object(E.initializeProjection)(M.extent.spatialReference,I.b);case 26:L=Object(E.project)(M.extent,I.b),e.next=30;break;case 29:L=M.extent;case 30:if(null==t.where||"1=1"===t.where){e.next=35;break}return e.next=33,Object(k.a)(t.where.toUpperCase(),n.fieldsIndex);case 33:D=e.sent,n.fields.forEach((function(e){D.fieldNames.includes(e.name)&&c.add(e.name)}));case 35:p=f?"Match ()-[n:".concat(n.objectType.name,"]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(n.geometryFieldName,") return ID(n), id(startNode(r)), id(endNode(r))"):"Match (n:".concat(n.objectType.name,") WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(n.geometryFieldName,") return ID(n)"),n.geometryFieldName&&c.add(n.geometryFieldName),c.forEach((function(e){p+=", n.".concat(e),l.push(e)})),d=new Vt({openCypherQuery:p,bindParameters:{param_filter_geom:new T.a({rings:[[[L.xmin,L.ymin],[L.xmin,L.ymax],[L.xmax,L.ymax],[L.xmax,L.ymin],[L.xmin,L.ymin]]]})}}),e.next=52;break;case 38:if(S="",null==t.where||"1=1"===t.where){e.next=48;break}return e.next=42,Object(k.a)(t.where,n.fieldsIndex);case 42:G=e.sent,n.fields.forEach((function(e){G.fieldNames.includes(e.name)&&c.add(e.name)})),R=["column-reference","string","number","binary-expression"],N=["=","<","<=","<>",">",">=","AND","OR","LIKE"],F=!1,P=function e(t){if("column-reference"===t.type)return"n.".concat(t.column);if("string"===t.type)return"'".concat(t.value,"'");if("number"===t.type)return"".concat(t.value);if("binary-expression"===t.type&&R.includes(t.left.type)&&R.includes(t.right.type)&&N.includes(t.operator))return"".concat(e(t.left)," ").concat(t.operator," ").concat(e(t.right));if("binary-expression"===t.type&&"LIKE"===t.operator){var n="";if("function"===t.left.type&&"column-reference"===t.left.args.value[0].type)n+="lower(n.".concat(t.left.args.value[0].column,")");else{if("column-reference"!==t.left.type)return F=!0,"";n+="lower(n.".concat(t.left.column,")")}if(n+=" CONTAINS (","string"!==t.right.type)return F=!0,"";var r=t.right.value;return"%"===r.charAt(0)&&(r=r.slice(1)),"%"===r.charAt(r.length-1)&&(r=r.slice(0,-1)),n+="'".concat(r.toLowerCase(),"')")}return F=!0,""},S=P(G.parseTree),F&&(S="");case 48:A="",A=f?"Match ()-[n:".concat(n.objectType.name,"]->()"):"Match (n:".concat(n.objectType.name,")"),B=!1,v&&(B=!0,A+=" WHERE ID(n) IN $ids"),S&&(A+=B?" AND":" WHERE",A+=" ".concat(S)),A+=" return ID(n)",f&&(A+=", id(startNode(n)), id(endNode(n))"),t.returnGeometry&&n.geometryFieldName&&c.add(n.geometryFieldName),c.forEach((function(e){A+=", n.".concat(e),l.push(e)})),d=new Vt(v?{openCypherQuery:A,bindParameters:{ids:v}}:{openCypherQuery:A});case 52:return e.next=54,jt(n.parentCompositeLayer.dataManager.knowledgeGraph,d,r);case 54:Y=e.sent.resultRowsStream.getReader();case 55:return e.next=57,Y.read();case 57:if(Q=e.sent,U=Q.done,q=Q.value,!U){e.next=62;break}return e.abrupt("break",67);case 62:for(X=[],H=0;H<q.length;H++){for(J=q[H],V=0,(Z={properties:{}}).id=J[W=0],W++,V++,f&&(Z.originId=J[W],W++,V++,Z.destinationId=J[W],W++,V++);W<J.length;W++)Z.properties[l[W-V]]=J[W];X.push(Z)}h=h.concat(u.writeToStore(X,Kt,null===(z=n.parentCompositeLayer.dataManager.geographicLookup.get(n.objectType.name))||void 0===z?void 0:z.name));case 65:e.next=55;break;case 67:return e.abrupt("return",h);case 68:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(x.a);Object(d.a)([Object(b.b)()],an.prototype,"knowledgeGraph",void 0),Object(d.a)([Object(b.b)()],an.prototype,"inclusionModeDefinition",void 0),Object(d.a)([Object(b.b)()],an.prototype,"entityTypeNames",void 0),Object(d.a)([Object(b.b)()],an.prototype,"relationshipTypeNames",void 0),Object(d.a)([Object(b.b)()],an.prototype,"geographicLookup",void 0),Object(d.a)([Object(b.b)()],an.prototype,"sublayerCaches",void 0),an=Object(d.a)([Object(m.a)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],an);var on=n(112),sn=n(258),un=(n(347),n(432),n(438),n(439),n(437),n(301),n(397),n(350),n(416)),cn=n(467),ln=(n(452),n(710)),dn=n(858),pn=n(449),hn=n(544),fn=Object(hn.a)(),yn=n(330),bn=n(751),vn=n(425),mn=n(302),gn=n(325),jn=n(195),On=n(235),wn=n(486),_n=n(648),xn=n(130),kn=n(364),Tn=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r,a,i,s,c;if(Object(o.a)(this,n),(c=t.call(this,e)).capabilities=Object(pn.a)(!1,!1),c.definitionExpression="",c.displayField="",c.elevationInfo=null,c.geometryType=null,c.geometryFieldName=null,c.graphType=null,c.hasM=!1,c.hasZ=!1,c.labelsVisible=null,c.labelingInfo=null,c.objectIdField=Kt,c.objectType=null,c.parentCompositeLayer=null,c.popupTemplate=null,c.source={openPorts:function(){return c.load().then((function(){var e=new MessageChannel;return new _n.a(e.port1,{channel:e,client:{queryFeatures:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Zt.a.fromJSON(e);return c.queryFeaturesJSON(n,t)}}},(function(){return null})),[e.port2]}))}},c.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)"relationship"===e.graphType?c.geometryType="polyline":c.geometryType="point",c.geometryFieldName=tn;else if(null!==(r=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))&&void 0!==r&&r.geometryType&&"esriGeometryNull"!==(null===(a=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))||void 0===a?void 0:a.geometryType)){var l,d,p,h,f=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);c.geometryFieldName=null!==(l=null===f||void 0===f?void 0:f.name)&&void 0!==l?l:null,c.geometryType=null!==f&&void 0!==f&&f.geometryType?kn.a.fromJSON(f.geometryType):null;var y=null===f||void 0===f?void 0:f.name,b=y?null===(d=e.objectType.properties)||void 0===d?void 0:d[y]:null;b?(c.hasM=null!==(p=b.hasM)&&void 0!==p&&p,c.hasZ=null!==(h=b.hasZ)&&void 0!==h&&h):(c.hasM=!1,c.hasZ=!1)}else c.geometryType=null;return null!==(i=e.objectType.properties)&&void 0!==i&&i.forEach((function(e){var t=e.fieldType;"esriFieldTypeOID"===t&&(t="esriFieldTypeInteger"),c.fields.push(gn.a.fromJSON({name:e.name,type:t,alias:e.alias,defaultValue:null,editable:e.editable,nullable:e.nullable}))})),c.fields.push(gn.a.fromJSON({name:c.objectIdField,type:"esriFieldTypeString",alias:c.objectIdField,editable:!1})),c._set("fields",Object(on.a)(c.fields)),null!==(s=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel)&&void 0!==s&&s.spatialReference&&(c.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?c.renderer=Object(un.a)(Object(pn.d)(kn.a.toJSON("polyline")).renderer):c.renderer=Object(un.a)(Object(pn.d)(kn.a.toJSON("point")).renderer):c.renderer=Object(un.a)(Object(pn.d)(kn.a.toJSON(c.geometryType)).renderer),Object(u.a)(c)}return Object(s.a)(n,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(e){Object(jn.m)(e,this.fieldsIndex),this._set("renderer",e)}},{key:"createPopupTemplate",value:function(e){return Object(wn.a)(this,e)}},{key:"createQuery",value:function(){return new Zt.a({where:"1=1",outFields:["*"]})}},{key:"getField",value:function(e){for(var t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}},{key:"getFieldDomain",value:function(e,t){return null}},{key:"queryFeatures",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,i,o,s,u=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return r=e.sent,i=r.resolvedQuery,o=r.queryEngine,e.t0=On.a,e.next=8,o.executeQuery(i.toJSON(),null===n||void 0===n?void 0:n.signal);case 8:return e.t1=e.sent,s=e.t0.fromJSON.call(e.t0,e.t1),e.abrupt("return",(s.features.forEach((function(e){e.sourceLayer=u})),s));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,i,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return r=e.sent,i=r.resolvedQuery,o=r.queryEngine,e.next=7,o.executeQuery(i.toJSON(),null===n||void 0===n?void 0:n.signal);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,i,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return r=e.sent,i=r.resolvedQuery,o=r.queryEngine,e.abrupt("return",o.executeQueryForCount(i.toJSON(),null===n||void 0===n?void 0:n.signal));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,n,r,i,o,s,u,c,l,d,p,h,f=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=f.length>0&&void 0!==f[0]?f[0]:{},s=f.length>1?f[1]:void 0,u=Object(L.a)(Object(L.a)({},o),{},{returnGeometry:!0}),e.next=5,this._setupQueryObjects(u);case 5:return c=e.sent,l=c.resolvedQuery,d=c.queryEngine,e.next=10,d.executeQueryForExtent(l.toJSON(),null===s||void 0===s?void 0:s.signal);case 10:return p=e.sent,e.abrupt("return",(h=null!=(null===(t=p.extent)||void 0===t?void 0:t.xmin)&&null!=(null===(n=p.extent)||void 0===n?void 0:n.xmax)&&null!=(null===(r=p.extent)||void 0===r?void 0:r.ymin)&&null!=(null===(i=p.extent)||void 0===i?void 0:i.ymax)?new xn.a(p.extent):new xn.a,{count:p.count,extent:h}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,i,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Zt.a.from(t),"link-chart"!==this.parentCompositeLayer.type||!this._cachedQueryEngine){e.next=5;break}i=this._cachedQueryEngine,e.next=9;break;case 5:return e.next=7,this.parentCompositeLayer.dataManager.getData(r,this,n);case 7:o=e.sent,i=this.loadQueryEngine(o);case 9:return e.abrupt("return",i.executeQueryForIds(r.toJSON(),null===n||void 0===n?void 0:n.signal));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadQueryEngine",value:function(e){var t=new ln.a({geometryType:kn.a.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new dn.a({fields:this.fields.map((function(e){return e.toJSON()})),geometryType:kn.a.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return n.featureStore.addMany(e),n}},{key:"refreshCachedQueryEngine",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentCompositeLayer.dataManager.getData(new Zt.a({where:"1=1",outFields:[Kt]}),this);case 2:t=e.sent,this._cachedQueryEngine=this.loadQueryEngine(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setupQueryObjects",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var r,i,o,s,u;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Zt.a.from(t),o=i.geometry,e.t0=o&&!(null!==(r=o.spatialReference)&&void 0!==r&&r.isWGS84),!e.t0){e.next=6;break}return e.next=5,Object(E.initializeProjection)(o.spatialReference,I.b);case 5:i.geometry=Object(E.project)(o instanceof T.a||o instanceof pe.a?o:o.extent,I.b);case 6:if("link-chart"!==this.parentCompositeLayer.type||!this._cachedQueryEngine){e.next=10;break}s=this._cachedQueryEngine,e.next=14;break;case 10:return e.next=12,this.parentCompositeLayer.dataManager.getData(i,this,n);case 12:u=e.sent,s=this.loadQueryEngine(u);case 14:return e.abrupt("return",{resolvedQuery:i,queryEngine:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Object(bn.a)(function(e){var t=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.apply(this,arguments)).fields=[],e.fieldsIndex=null,e}return Object(s.a)(n)}(e);return Object(d.a)([Object(b.b)(fn.fields)],t.prototype,"fields",void 0),Object(d.a)([Object(b.b)(fn.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=Object(d.a)([Object(m.a)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t}(Object(yn.a)(Object(mn.a)(Object(vn.a)(j.a))))));Object(d.a)([Object(b.b)()],Tn.prototype,"capabilities",void 0),Object(d.a)([Object(b.b)({readOnly:!0})],Tn.prototype,"defaultPopupTemplate",null),Object(d.a)([Object(b.b)()],Tn.prototype,"definitionExpression",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"displayField",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"elevationInfo",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"geometryType",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"geometryFieldName",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"graphType",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"hasM",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"hasZ",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"labelsVisible",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"labelingInfo",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"objectIdField",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"objectType",void 0),Object(d.a)([Object(b.b)()],Tn.prototype,"parentCompositeLayer",void 0),Object(d.a)([Object(b.b)({type:sn.a,json:{name:"popupInfo",write:!0}})],Tn.prototype,"popupTemplate",void 0),Object(d.a)([Object(b.b)({types:cn.a,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],Tn.prototype,"renderer",null),Object(d.a)([Object(b.b)()],Tn.prototype,"source",void 0),Object(d.a)([Object(b.b)({json:{read:!1}})],Tn.prototype,"type",void 0);var En,In,Mn,Cn=Tn=Object(d.a)([Object(m.a)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],Tn),Ln=null;function Dn(){return En||(En=Promise.all([n.e(293),n.e(261)]).then(n.bind(null,2242)).then((function(e){return e.l})).then((function(e){return(0,e.default)({locateFile:function(e){return Object(re.a)("esri/libs/linkchartlayout/".concat(e))}})})).then((function(e){!function(e){Ln=e}(e)})),En)}function Sn(e,t,n,r,a,i){var o=n.length,s=a.length,u=Float64Array.BYTES_PER_ELEMENT,c=Uint32Array.BYTES_PER_ELEMENT,l=Uint8Array.BYTES_PER_ELEMENT,d=15+o*(l+2*u)+s*(2*c),p=Ln._malloc(d);try{var h=p+16-p%16,f=h+o*u,y=f+o*u,b=y+s*c,v=b+s*c,m=function(){return[Ln.HEAPF64.subarray(h>>3,(h>>3)+o),Ln.HEAPF64.subarray(f>>3,(f>>3)+o),Ln.HEAPU32.subarray(y>>2,(y>>2)+s),Ln.HEAPU32.subarray(b>>2,(b>>2)+s),Ln.HEAPU8.subarray(v,v+o)]},g=m(),j=Object(_.a)(g,5),O=j[0],w=j[1],x=j[2],k=j[3],T=j[4];O.set(n),w.set(r),x.set(a),k.set(i),T.set(t);var E=e(o,v,h,f,s,y,b),I=m(),M=Object(_.a)(I,5),C=M[0],L=M[1],D=M[2],S=M[3],G=M[4];return n.set(C),r.set(L),a.set(D),i.set(S),t.set(G),E}finally{Ln._free(p)}}(Mn=In||(In={}))[Mn.None=0]="None",Mn[Mn.IsMovable=1]="IsMovable",Mn[Mn.IsGeographic=2]="IsGeographic",Mn[Mn.IsRoot=4]="IsRoot";var Gn,Rn,Nn,Fn,Pn,An,Bn,Yn;!function(e){e.getMinIdealEdgeLength=function(){return Ln.getMinIdealEdgeLength()},e.apply=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Sn((function(e,t,n,r,a,u,c){return Ln.applyForceDirectedLayout(e,t,n,r,a,u,c,i,o,s)}),e,t,n,r,a)}}(Gn||(Gn={})),function(e){e.apply=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Sn((function(e,t,n,r,a,u,c){return Ln.applyCommunityLayout(e,t,n,r,a,u,c,i,o,s)}),e,t,n,r,a)}}(Rn||(Rn={})),function(e){e.apply=function(e,t,n,r,a){return Sn(Ln.applySimpleLayout,e,t,n,r,a)}}(Nn||(Nn={})),function(e){e.apply=function(e,t,n,r,a){return Sn(Ln.applyHierarchicalLayout,e,t,n,r,a)}}(Fn||(Fn={})),function(e){e.apply=function(e,t,n,r,a){return Sn(Ln.applyRadialTreeLayout,e,t,n,r,a)}}(Pn||(Pn={})),function(e){e.apply=function(e,t,n,r,a){return Sn(Ln.applySmartTreeLayout,e,t,n,r,a)}}(An||(An={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Bn||(Bn={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Yn||(Yn={}));var zn=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var r;if(Object(o.a)(this,n),(r=t.call(this,e)).dataPreloadedInLocalCache=!1,r._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},r._graphTypeLookup=new Map,r.layers=new p.a,r.linkChartDiagramLookup=new Map,r.linkChartExtent=new xn.a({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),r.linkChartGeohashLookup=new Map,r.sublayerIdsCache=new Map,r.tables=new p.a,r.type="link-chart",r._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new h.a("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it");return Object(u.a)(r)}return Object(s.a)(n,[{key:"normalizeCtorArgs",value:function(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}},{key:"_initializeLayerProperties",value:function(e){var t,n,r,a,i,o,s,u,c,l,d=this;if(!this.title&&this.url){var p=this.url.split("/");this.title=p[p.length-2]}var y=new Set,b=[],v=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new h.a("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((function(e){e.name&&d._graphTypeLookup.set(e.name,e)})),null!==(n=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==n&&n.forEach((function(e){e.name&&d._graphTypeLookup.set(e.name,e)})),null!==(r=e.inclusionModeDefinition)&&void 0!==r&&r.generateAllSublayers?(b=null!==(a=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==a?a:[],v=null!==(i=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==i?i:[]):null!==(o=e.inclusionModeDefinition)&&void 0!==o&&o.namedTypeDefinitions&&(null===(s=e.inclusionModeDefinition)||void 0===s?void 0:s.namedTypeDefinitions.size)>0?null===(u=e.inclusionModeDefinition)||void 0===u||u.namedTypeDefinitions.forEach((function(t,n){var r,a;if(!d._graphTypeLookup.get(n))return f.a.getLogger(d).warn("A named type, ".concat(n,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(r=e.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.delete(n));d._graphTypeLookup.get(n)instanceof W||"strictOrigin"in d._graphTypeLookup.get(n)?y.has(n)||(y.add(n),v.push(d._graphTypeLookup.get(n))):d._graphTypeLookup.get(n)instanceof H||"properties"in d._graphTypeLookup.get(n)?y.has(n)||(y.add(n),b.push(d._graphTypeLookup.get(n))):(f.a.getLogger(d).warn("A named type, ".concat(n,", was in the inclusion list that wasn't properly modeled and will be removed")),null===(a=e.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.delete(n))})):(b=null!==(c=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==c?c:[],v=null!==(l=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==l?l:[]);var m=new an({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=b,this.memberRelationshipTypes=v,this.dataManager=m}},{key:"load",value:function(e){var t=this;return this.addResolvingPromise(new Promise((function(n){(function(e){return wt.apply(this,arguments)})(t.url).then((function(r){var o,s,u,c;if(t._initializeLayerProperties({knowledgeGraph:r,inclusionModeDefinition:t._originalInclusionList}),null!==(o=t.dataManager.inclusionModeDefinition)&&void 0!==o&&null!==(o=o.namedTypeDefinitions)&&void 0!==o&&o.size||(t.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(s=t.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==s&&s.forEach((function(e){var n;e.name&&(null===(n=t.dataManager.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.set(e.name,{useAllData:!0}))})),null!==(u=t.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==u&&u.forEach((function(e){var n;e.name&&(null===(n=t.dataManager.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.set(e.name,{useAllData:!0}))}))),t.dataPreloadedInLocalCache)t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(c=t.dataManager.inclusionModeDefinition)||void 0===c||c.namedTypeDefinitions.forEach((function(e){var n;e.useAllData=!1,null!==(n=e.members)&&void 0!==n&&n.forEach((function(e){var n;n=e.linkChartLocation instanceof w.a?e.linkChartLocation:e.linkChartLocation?Object(O.d)(e.linkChartLocation):null,t.linkChartDiagramLookup.set(e.id,n),n&&2===n.coords.length&&0===n.lengths.length?t.linkChartGeohashLookup.set(e.id,Object(g.b)(n.coords[1],n.coords[0],nn)):t.linkChartGeohashLookup.set(e.id,"")})),t.addResolvingPromise(t._initializeDiagram().then(Object(i.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.layers.forEach(function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.tables.forEach(function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))))}));else{var l,d="GEOGRAPHIC"===(null===(l=t.defaultLinkChartConfig)||void 0===l?void 0:l.layoutMode);t.addResolvingPromise(t.dataManager.refreshCacheContent(void 0,!1,d,!0).then(Object(i.a)(Object(a.a)().mark((function n(){var r,i;return Object(a.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Object(y.n)(e),r=[],i=[],t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1,t.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((function(e){e.useAllData=!1}))),n.next=6,t._initializeDiagram();case 6:return t.layers.forEach((function(e){i.push(e.refreshCachedQueryEngine()),r.push(new Promise((function(t){e.on("layerview-create",(function(){t(null)}))})))})),t.tables.forEach((function(e){i.push(e.refreshCachedQueryEngine())})),n.next=10,Promise.all(i);case 10:case"end":return n.stop()}}),n)})))))}n(null)}))}))),Promise.resolve(this)}},{key:"addRecords",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._handleNewRecords(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"expand",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,r,i=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.getConnectedRecordIds(t);case 2:return n=e.sent,r=n.filter((function(e){var t;return!(null!==(t=i.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))})),e.next=6,this._handleNewRecords(n);case 6:return e.abrupt("return",{records:r});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadLayerAssumingLocalCache",value:function(){var e,t,n=this;this.memberRelationshipTypes.forEach((function(e){var t=new Cn({objectType:e,parentCompositeLayer:n,graphType:"relationship",title:e.name});t.geometryType?n.layers.push(t):n.tables.push(t),n.dataManager.sublayerCaches.has(e.name)||n.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((function(e){var t=new Cn({objectType:e,parentCompositeLayer:n,graphType:"entity",title:e.name});t.geometryType?n.layers.push(t):n.tables.push(t),n.dataManager.sublayerCaches.has(e.name)||n.dataManager.sublayerCaches.set(e.name,new Map)})),(null===(e=this.dataManager.inclusionModeDefinition)||void 0===e?void 0:e.namedTypeDefinitions)&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.forEach((function(e,t){var r,a=function(e,t,n){return e.has(t)||e.set(t,n()),e.get(t)}(n.sublayerIdsCache,t,(function(){return new Set}));null===(r=e.members)||void 0===r||r.forEach((function(e){if(a.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof w.a)n.linkChartDiagramLookup.set(e.id,e.linkChartLocation),2===e.linkChartLocation.coords.length&&0===e.linkChartLocation.lengths.length?n.linkChartGeohashLookup.set(e.id,Object(g.b)(e.linkChartLocation.coords[1],e.linkChartLocation.coords[0],nn)):n.linkChartGeohashLookup.set(e.id,"");else{var t=Object(O.d)(e.linkChartLocation);n.linkChartDiagramLookup.set(e.id,e.linkChartLocation?t:null),"x"in e.linkChartLocation&&"y"in e.linkChartLocation?n.linkChartGeohashLookup.set(e.id,Object(g.b)(e.linkChartLocation.x,e.linkChartLocation.y,nn)):n.linkChartGeohashLookup.set(e.id,"")}}))})))}},{key:"calculateLinkChartLayout",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,n,r,i,o,s,u,c,l,d,p,y,b,v,m,j,w,_,x,k,T,E,I,M,C,L,D,S=this,G=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=G.length>0&&void 0!==G[0]?G[0]:"RADIAL_TREE",i=G.length>1?G[1]:void 0,o=[],s=[],this.dataManager.sublayerCaches.forEach((function(e,t){S.dataManager.entityTypeNames.has(t)?e.forEach((function(e){o.push({typeName:t,feature:e})})):S.dataManager.relationshipTypeNames.has(t)&&e.forEach((function(e){s.push({typeName:t,feature:e})}))})),this.linkChartDiagramLookup=new Map,u=new Map,c=new Map,l=new Map,d=new Map,p=new Uint8Array(o.length),y=new Float64Array(o.length),b=new Float64Array(o.length),v=new Uint32Array(s.length),m=new Uint32Array(s.length),j=[],"FORCE_DIRECTED",w=null!==(t=null===i||void 0===i?void 0:i.xScaleFactor)&&void 0!==t?t:1,_=null!==(n=null===i||void 0===i?void 0:i.yScaleFactor)&&void 0!==n?n:1,x=new xn.a({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),"FORCE_DIRECTED",T=0,E=0,e.t0="GEOGRAPHIC"===r?"FORCE_DIRECTED":r,e.next="FORCE_DIRECTED"===e.t0?9:"COMMUNITY"===e.t0?11:"HIERARCHICAL"===e.t0?13:"RADIAL_TREE"===e.t0?15:"SMART_TREE"===e.t0?17:19;break;case 9:return k=Gn.apply,e.abrupt("break",20);case 11:return k=Rn.apply,e.abrupt("break",20);case 13:return k=Fn.apply,e.abrupt("break",20);case 15:return k=Pn.apply,e.abrupt("break",20);case 17:return k=An.apply,e.abrupt("break",20);case 19:k=Nn.apply;case 20:return o.forEach((function(e){var t,n,a,o,s,u,c=e.typeName,l=e.feature;if(null!==i&&void 0!==i&&null!==(t=i.lockedNodeLocations)&&void 0!==t&&t.has(l.attributes[Kt])){"GEOGRAPHIC"===r&&S.dataManager.geographicLookup.has(c)?p[T]=In.IsGeographic:p[T]=In.None;var h=i.lockedNodeLocations.get(l.attributes[Kt]);y[T]=h.x,b[T]=h.y}else if("GEOGRAPHIC"===r&&S.dataManager.geographicLookup.has(c)){var f;p[T]=In.IsGeographic;var v=null,m=l.attributes[S.dataManager.geographicLookup.get(c).name];switch(null===(f=S.dataManager.geographicLookup.get(c))||void 0===f?void 0:f.geometryType){case"esriGeometryPoint":y[T]=null===m||void 0===m?void 0:m.x,b[T]=null===m||void 0===m?void 0:m.y;break;case"esriGeometryPolygon":null!=(null===(n=v=null===m||void 0===m?void 0:m.centroid)||void 0===n?void 0:n.x)&&null!=(null===(a=v)||void 0===a?void 0:a.y)?(y[T]=v.x,b[T]=v.y):p[T]=In.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":null!=(null===(s=v=null===m||void 0===m||null===(o=m.extent)||void 0===o?void 0:o.center)||void 0===s?void 0:s.x)&&null!=(null===(u=v)||void 0===u?void 0:u.y)?(y[T]=v.x,b[T]=v.y):p[T]=In.IsMovable;break;default:p[T]=In.IsMovable}(null==y[T]||null==b[T]||Number.isNaN(y[T])||Number.isNaN(b[T]))&&(p[T]=In.IsMovable,y[T]=0,b[T]=0)}else p[T]=In.IsMovable,y[T]=0,b[T]=0;d.set(l.attributes[Kt],T),j[T]={feature:l,typeName:c},T++})),I=!1,s.forEach((function(e){var t=d.get(e.feature.attributes[$t]),n=d.get(e.feature.attributes[en]);void 0!==t&&void 0!==n?(v[E]=t,m[E]=n,E++):(I=!0,S.linkChartDiagramLookup.set(e.feature.attributes[$t],null),S.linkChartGeohashLookup.set(e.feature.attributes[$t],null))})),I&&f.a.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),e.next=26,Dn();case 26:if(k(p,y,b,v,m)){e.next=28;break}throw new h.a("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");case 28:for(M=0;M<j.length;M++)p[M]===In.IsMovable&&(y[M]=y[M]*w,b[M]=b[M]*_),b[M]>84.9999&&(b[M]=84.9999),b[M]<-84.9999&&(b[M]=-84.9999),y[M]>179.9999&&(y[M]=179.9999),y[M]<-179.9999&&(y[M]=-179.9999),j[M].feature.attributes[tn]=new de.a(y[M],b[M]),u.has(j[M].typeName)?null===(C=u.get(j[M].typeName))||void 0===C||C.set(j[M].feature.attributes[Kt],j[M].feature):((L=new Map).set(j[M].feature.attributes[Kt],j[M].feature),u.set(j[M].typeName,L)),l.set(j[M].feature.attributes[Kt],j[M].feature),D=Object(O.d)(j[M].feature.attributes[tn]),this.linkChartDiagramLookup.set(j[M].feature.attributes[Kt],j[M].feature.attributes[tn]?D:null),this.linkChartGeohashLookup.set(j[M].feature.attributes[Kt],Object(g.b)(j[M].feature.attributes[tn].y,j[M].feature.attributes[tn].x,nn)),j[M].feature.attributes[tn].x<x.xmin&&(x.xmin=j[M].feature.attributes[tn].x),j[M].feature.attributes[tn].x>x.xmax&&(x.xmax=j[M].feature.attributes[tn].x),j[M].feature.attributes[tn].y<x.ymin&&(x.ymin=j[M].feature.attributes[tn].y),j[M].feature.attributes[tn].y>x.ymax&&(x.ymax=j[M].feature.attributes[tn].y);return e.abrupt("return",(this.linkChartExtent.xmin=x.xmin,this.linkChartExtent.xmax=x.xmax,this.linkChartExtent.ymin=x.ymin,this.linkChartExtent.ymax=x.ymax,s.forEach((function(e){var t,n,r=null===(t=j[d.get(e.feature.attributes[$t])])||void 0===t?void 0:t.feature.attributes[tn],a=null===(n=j[d.get(e.feature.attributes[en])])||void 0===n?void 0:n.feature.attributes[tn];if(r&&a){var i=new pe.a({paths:[[r.x,r.y],[a.x,a.y]]});if(e.feature.attributes[tn]=i,c.has(e.typeName)){var o=c.get(e.typeName);null===o||void 0===o||o.set(e.feature.attributes[Kt],e.feature)}else{var s=new Map;s.set(e.feature.attributes[Kt],e.feature),c.set(e.typeName,s)}l.set(e.feature.attributes[Kt],e.feature);var u=Object(O.d)(e.feature.attributes[tn]);S.linkChartDiagramLookup.set(e.feature.attributes[Kt],e.feature.attributes[tn]?u:null),S.linkChartGeohashLookup.set(e.feature.attributes[Kt],"")}})),this._currentLinkChartConfig={layoutMode:r,xScaleFactor:w,yScaleFactor:_},{nodes:u,links:c,idMap:l}));case 30:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"applyNewLinkChartLayout",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,n,r,i=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"RADIAL_TREE",n=i.length>1?i[1]:void 0,r=[],e.next=5,this.calculateLinkChartLayout(t,n);case 5:return this.layers.forEach((function(e){r.push(e.refreshCachedQueryEngine())})),e.next=8,Promise.all(r);case 8:this.layers.forEach((function(e){e.emit("refresh",{dataChanged:!0})}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentNodeLocations",value:function(){var e,t=new Map;return null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(e=e.namedTypeDefinitions)&&void 0!==e&&e.forEach((function(e){var n;null===e||void 0===e||null===(n=e.members)||void 0===n||n.forEach((function(e){var n,r=e.linkChartLocation,a=e.id;r&&(n="x"in r?{x:r.x,y:r.y}:{x:r.coords[0],y:r.coords[1]},t.set(a,new de.a({x:n.x,y:n.y})))}))})),t}},{key:"synchronizeInclusionListWithCache",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n;null!==(n=t.dataManager.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.forEach((function(e,n){if(e.useAllData=!1,e.members&&e.members.size>0){if(!t.dataManager.sublayerCaches.get(n))return;var r=Array.from(t.dataManager.sublayerCaches.get(n).keys());Array.from(e.members.keys()).filter((function(e){return!r.includes(e)})).forEach((function(t){var n;null===(n=e.members)||void 0===n||n.delete(t)}))}})),e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshLinkChartCache",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.refreshCacheContent(t);case 2:return n=[],this.layers.forEach((function(e){n.push(e.refreshCachedQueryEngine())})),e.next=6,Promise.all(n);case 6:this.layers.forEach((function(e){e.emit("refresh",{dataChanged:!0})}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleNewRecords",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,i,o,s,u,c,l,d,p,h;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this.dataManager.addToLayerInclusionSet(t),i=Object(r.a)(t);try{for(i.s();!(o=i.n()).done;)s=o.value,this.sublayerIdsCache.has(s.typeName)||(this.sublayerIdsCache.set(s.typeName,new Set),n.push(s.typeName)),this.sublayerIdsCache.get(s.typeName).add(s.id)}catch(a){i.e(a)}finally{i.f()}for(u=0,c=n;u<c.length;u++)l=c[u],this._graphTypeLookup.has(l)&&(d=this._graphTypeLookup.get(l),h=new Cn({objectType:d,parentCompositeLayer:this,graphType:p="endPoints"in d?"relationship":"entity",title:l}),"entity"===p?this.dataManager.entityTypeNames.add(l):this.dataManager.relationshipTypeNames.add(l),h.geometryType?this.layers.push(h):this.tables.push(h),this.dataManager.sublayerCaches.set(l,new Map));return e.next=7,this.dataManager.refreshCacheContent(t.map((function(e){return e.id})));case 7:return e.next=9,this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_initializeDiagram",value:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,n=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defaultLinkChartConfig){e.next=9;break}if(!this.defaultLinkChartConfig.doNotRecalculateLayout){e.next=5;break}null!==(t=this.dataManager.inclusionModeDefinition)&&void 0!==t&&null!==(t=t.namedTypeDefinitions)&&void 0!==t&&t.forEach((function(e){var t;null===e||void 0===e||null===(t=e.members)||void 0===t||t.forEach((function(e){var t,r=e.linkChartLocation,a=e.id;if(r){t="x"in r?{x:r.x,y:r.y}:{x:r.coords[0],y:r.coords[1]};var i=Object(O.d)(t);n.linkChartDiagramLookup.set(a,i),n.linkChartGeohashLookup.set(a,Object(g.b)(t.x,t.y,nn)),n.linkChartExtent.xmin>t.x&&(n.linkChartExtent.xmin=t.x),n.linkChartExtent.xmax<t.x&&(n.linkChartExtent.xmax=t.x),n.linkChartExtent.ymin>t.y&&(n.linkChartExtent.ymin=t.y),n.linkChartExtent.ymax<t.y&&(n.linkChartExtent.ymax=t.y)}}))})),this.memberRelationshipTypes.forEach((function(e){var t;e.name&&(null===(t=n.dataManager.sublayerCaches.get(e.name))||void 0===t||t.forEach((function(e){var t=n.linkChartDiagramLookup.get(e.attributes[$t]),r=n.linkChartDiagramLookup.get(e.attributes[en]);if(t&&r){var a=Object(O.d)(new pe.a({paths:[[t.coords[0],t.coords[1]],[r.coords[0],r.coords[1]]]}));n.linkChartDiagramLookup.set(e.attributes[Kt],a)}else n.linkChartDiagramLookup.set(e.attributes[Kt],null);n.linkChartGeohashLookup.set(e.attributes[Kt],"")})))})),e.next=7;break;case 5:return e.next=7,this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()});case 7:e.next=11;break;case 9:return e.next=11,this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Object(yn.a)(Object(mn.a)(j.a)));Object(d.a)([Object(b.b)()],zn.prototype,"dataPreloadedInLocalCache",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"defaultLinkChartConfig",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"dataManager",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"knowledgeGraph",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"layers",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"linkChartDiagramLookup",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"linkChartExtent",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"linkChartGeohashLookup",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"memberEntityTypes",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"memberRelationshipTypes",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"sublayerIdsCache",void 0),Object(d.a)([Object(b.b)()],zn.prototype,"tables",void 0),Object(d.a)([Object(b.b)({json:{read:!1}})],zn.prototype,"type",void 0);var Qn=zn=Object(d.a)([Object(m.a)("esri.layers.LinkChartLayer")],zn)},217:function(e,t,n){"use strict";n.d(t,"a",(function(){return M})),n.d(t,"b",(function(){return L}));var r=n(4),a=n(99),i=n(12),o=n(92),s=n(187),u=n(101),c=n(102),l=n(164),d=n(192),p=n(242),h=n(132),f=n(233),y=n(1),b=(n(119),n(129)),v=n(122),m=n(221);function g(e,t,n,r){return j.apply(this,arguments)}function j(){return(j=Object(i.a)(Object(r.a)().mark((function e(t,n,a,i){var o,s,u,c,l,d,p,h;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Object(m.c)(t),s=n[0].spatialReference,u=Object(y.a)(Object(y.a)({},i),{},{query:Object(y.a)(Object(y.a)({},o.query),{},{f:"json",sr:JSON.stringify(s),target:JSON.stringify({geometryType:Object(v.c)(n[0]),geometries:n}),cutter:JSON.stringify(a)})}),e.next=5,Object(b.default)(o.path+"/cut",u);case 5:return c=e.sent,l=c.data,d=l.cutIndexes,p=l.geometries,h=void 0===p?[]:p,e.abrupt("return",{cutIndexes:d,geometries:h.map((function(e){var t=Object(v.a)(e);return t.spatialReference=s,t}))});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=n(128),w=n(417);function _(e,t,n){return x.apply(this,arguments)}function x(){return(x=Object(i.a)(Object(r.a)().mark((function e(t,n,a){var i,o,s,u,c,l,d;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="string"==typeof t?Object(O.Q)(t):t,s=n[0].spatialReference,u=Object(v.c)(n[0]),c=Object(y.a)(Object(y.a)({},a),{},{query:Object(y.a)(Object(y.a)({},o.query),{},{f:"json",sr:null!==(i=s.wkid)&&void 0!==i?i:JSON.stringify(s),geometries:JSON.stringify(Object(w.b)(n))})}),e.next=6,Object(b.default)(o.path+"/simplify",c);case 6:return l=e.sent,d=l.data,e.abrupt("return",Object(w.a)(d.geometries,u,s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=c.a.getLogger("esri.geometry.support.normalizeUtils");function T(e,t,n){if(t){var r=function(e,t){if(!(e instanceof d.a||e instanceof l.a)){var n="straightLineDensify: the input geometry is neither polyline nor polygon";throw k.error(n),new u.a(n)}var r,a=Object(p.b)(e),i=[],s=Object(o.a)(a);try{for(s.s();!(r=s.n()).done;){var c=r.value,h=[];i.push(h),h.push([c[0][0],c[0][1]]);for(var f=0;f<c.length-1;f++){var y=c[f][0],b=c[f][1],v=c[f+1][0],m=c[f+1][1],g=Math.sqrt((v-y)*(v-y)+(m-b)*(m-b)),j=(m-b)/g,O=(v-y)/g,w=g/t;if(w>1){for(var _=1;_<=w-1;_++){var x=_*t,T=O*x+y,E=j*x+b;h.push([T,E])}var I=(g+Math.floor(w-1)*t)/2,M=O*I+y,C=j*I+b;h.push([M,C])}h.push([v,m])}}}catch(L){s.e(L)}finally{s.f()}return function(e){return"polygon"===e.type}(e)?new l.a({rings:i,spatialReference:e.spatialReference}):new d.a({paths:i,spatialReference:e.spatialReference})}(e,1e6);e=Object(f.e)(r,!0)}return n&&(e=Object(p.d)(e,n)),e}function E(e,t,n){if(Array.isArray(e)){var r=e[0];if(r>t){var a=Object(p.c)(r,t);e[0]=r+a*(-2*t)}else if(r<n){var i=Object(p.c)(r,n);e[0]=r+i*(-2*n)}}else{var o=e.x;if(o>t){var s=Object(p.c)(o,t);e=e.clone().offset(s*(-2*t),0)}else if(o<n){var u=Object(p.c)(o,n);e=e.clone().offset(u*(-2*n),0)}}return e}function I(e,t){for(var n=-1,r=function(){for(var r=t.cutIndexes[a],i=t.geometries[a],s=Object(p.b)(i),u=function(e){var t=s[e];t.some((function(n){if(n[0]<180)return!0;for(var r=0,a=0;a<t.length;a++){var o=t[a][0];r=o>r?o:r}r=Number(r.toFixed(9));for(var s=-360*Object(p.c)(r,180),u=0;u<t.length;u++){var c=i.getPoint(e,u);i.setPoint(e,u,c.clone().offset(s,0))}return!0}))},c=0;c<s.length;c++)u(c);if(r===n){if(function(e){return"polygon"===e[0].type}(e)){var l,d=Object(o.a)(Object(p.b)(i));try{for(d.s();!(l=d.n()).done;){var h=l.value;e[r]=e[r].addRing(h)}}catch(v){d.e(v)}finally{d.f()}}else if(function(e){return"polyline"===e[0].type}(e)){var f,y=Object(o.a)(Object(p.b)(i));try{for(y.s();!(f=y.n()).done;){var b=f.value;e[r]=e[r].addPath(b)}}catch(v){y.e(v)}finally{y.f()}}}else n=r,e[r]=i},a=0;a<t.cutIndexes.length;a++)r();return e}function M(e,t,n){return C.apply(this,arguments)}function C(){return(C=Object(i.a)(Object(r.a)().mark((function e(t,n,a){var i,u,c,y,b,v,m,j,O,w,x,C,L,D,S,G,R,N,F,P,A,B,Y,z,Q,U,q,X,H,J,W,V,Z,K,$,ee,te,ne,re,ae,ie;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)){e.next=2;break}return e.abrupt("return",M([t],n));case 2:n&&"string"!=typeof n&&k.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead"),u="string"==typeof n?n:null!==(i=null===n||void 0===n?void 0:n.url)&&void 0!==i?i:s.a.geometryServiceUrl,x=0,C=[],L=[],D=Object(o.a)(t);try{for(D.s();!(S=D.n()).done;)null!=(G=S.value)?(c||(c=G.spatialReference,y=Object(h.e)(c),b=c.isWebMercator,j=b?102100:4326,v=p.a[j].maxX,m=p.a[j].minX,O=p.a[j].plus180Line,w=p.a[j].minus180Line),y?"mesh"===G.type?L.push(G):"point"===G.type?L.push(E(G.clone(),v,m)):"multipoint"===G.type?((R=G.clone()).points=R.points.map((function(e){return E(e,v,m)})),L.push(R)):"extent"===G.type?(N=G.clone()._normalize(!1,!1,y),L.push(N.rings?new l.a(N):N)):G.extent?(F=G.extent,P=Object(p.c)(F.xmin,m)*(2*v),A=0===P?G.clone():Object(p.d)(G.clone(),P),F.offset(P,0),F.intersects(O)&&F.xmax!==v?(x=F.xmax>x?F.xmax:x,A=T(A,b),C.push(A),L.push("cut")):F.intersects(w)&&F.xmin!==m?(x=F.xmax*(2*v)>x?F.xmax*(2*v):x,A=T(A,b,360),C.push(A),L.push("cut")):L.push(A)):L.push(G.clone()):L.push(G)):L.push(G)}catch(r){D.e(r)}finally{D.f()}for(B=Object(p.c)(x,v),Y=-90,z=B,Q=new d.a;B>0;)U=360*B-180,Q.addPath([[U,Y],[U,-1*Y]]),Y*=-1,B--;if(!(C.length>0&&z>0)){e.next=29;break}return e.t0=I,e.t1=C,e.next=16,g(u,C,Q,a);case 16:for(e.t2=e.sent,q=(0,e.t0)(e.t1,e.t2),X=[],H=[],J=0;J<L.length;J++)"cut"!==(W=L[J])?H.push(W):(V=q.shift(),null!=(Z=t[J])&&"polygon"===Z.type&&Z.rings&&Z.rings.length>1&&V.rings.length>=Z.rings.length?(X.push(V),H.push("simplify")):H.push(b?Object(f.b)(V):V));if(X.length){e.next=23;break}return e.abrupt("return",H);case 23:return e.next=25,_(u,X,a);case 25:for(K=e.sent,$=[],ee=0;ee<H.length;ee++)"simplify"!==(te=H[ee])?$.push(te):$.push(b?Object(f.b)(K.shift()):K.shift());return e.abrupt("return",$);case 29:for(ne=[],re=0;re<L.length;re++)"cut"!==(ae=L[re])?ne.push(ae):(ie=C.shift(),ne.push(!0===b?Object(f.b)(ie):ie));return e.abrupt("return",ne);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){var n=Object(h.e)(t);if(n){var r=Object(a.a)(n.valid,2),i=r[0],o=r[1],s=o-i;if(e<i)for(;e<i;)e+=s;if(e>o)for(;e>o;)e-=s}return e}},242:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return c}));var r=n(92),a=n(192),i=n(125),o=n(122),s={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new a.a({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator}),minus180Line:new a.a({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new a.a({paths:[[[180,-180],[180,180]]],spatialReference:i.a.WGS84}),minus180Line:new a.a({paths:[[[-180,-180],[-180,180]]],spatialReference:i.a.WGS84})}};function u(e,t){return Math.ceil((e-t)/(2*t))}function c(e,t){var n,a=l(e),i=Object(r.a)(a);try{for(i.s();!(n=i.n()).done;){var o,s=n.value,u=Object(r.a)(s);try{for(u.s();!(o=u.n()).done;){o.value[0]+=t}}catch(c){u.e(c)}finally{u.f()}}}catch(c){i.e(c)}finally{i.f()}return e}function l(e){return Object(o.g)(e)?e.rings:e.paths}},449:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return c}));var r=n(34),a=n(1),i=n(93),o=n(116),s=n(488),u=n(382);function c(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?u.a:"esriGeometryPolyline"===e?u.c:u.b}}}var l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/,d=1;function p(e,t){if(Object(i.a)("esri-csp-restrictions"))return function(){return Object(a.a)(Object(r.a)({},t,null),e)};try{var n="this.".concat(t," = null;");for(var o in e)n+="this".concat(l.test(o)?".".concat(o):'["'.concat(o,'"]')," = ").concat(JSON.stringify(e[o]),";");var s=new Function("\n      return class AttributesClass$".concat(d++," {\n        constructor() {\n          ").concat(n,";\n        }\n      }\n    "))();return function(){return new s}}catch(u){return function(){return Object(a.a)(Object(r.a)({},t,null),e)}}}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:Object(o.a)(e)}}]}function f(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.a,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1}}}},597:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(90),a=n(91),i=n(92),o=n(89),s=n(88),u=n(98),c=n(111),l=n(440),d=n(670),p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,n=arguments.length>1?arguments[1]:void 0;Object(o.a)(this,e),this._compareMinX=b,this._compareMinY=v,this._toBBox=function(e){return e},this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&("function"==typeof n?this._toBBox=n:this._initFormat(n)),this.clear()}return Object(s.a)(e,[{key:"destroy",value:function(){this.clear(),k.prune(),T.prune(),E.prune(),I.prune()}},{key:"all",value:function(e){this._all(this._data,e)}},{key:"search",value:function(e,t){var n=this._data,r=this._toBBox;if(_(e,n))for(k.clear();n;){for(var a=0,i=n.children.length;a<i;a++){var o=n.children[a],s=n.leaf?r(o):o;_(e,s)&&(n.leaf?t(o):w(e,s)?this._all(o,t):k.push(o))}n=k.pop()}}},{key:"collides",value:function(e){var t=this._data,n=this._toBBox;if(!_(e,t))return!1;for(k.clear();t;){for(var r=0,a=t.children.length;r<a;r++){var i=t.children[r],o=t.leaf?n(i):i;if(_(e,o)){if(t.leaf||w(e,o))return!0;k.push(i)}}t=k.pop()}return!1}},{key:"load",value:function(e){if(!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var r=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===r.height)this._splitRoot(this._data,r);else{if(this._data.height<r.height){var a=this._data;this._data=r,r=a}this._insert(r,this._data.height-r.height-1,!0)}else this._data=r;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this._data.height-1),this}},{key:"clear",value:function(){return this._data=new C([]),this}},{key:"remove",value:function(e){if(!e)return this;var t,n=this._data,r=null,a=0,i=!1,o=this._toBBox(e);for(E.clear(),I.clear();n||E.length>0;){var s;if(n||(n=Object(c.d)(E.pop()),r=E.data[E.length-1],a=null!==(s=I.pop())&&void 0!==s?s:0,i=!0),n.leaf&&-1!==(t=Object(u.g)(n.children,e,n.children.length,n.indexHint)))return n.children.splice(t,1),E.push(n),this._condense(E),this;i||n.leaf||!w(n,o)?r?(a++,n=r.children[a],i=!1):n=null:(E.push(n),I.push(a),a=0,r=n,n=n.children[0])}return this}},{key:"toJSON",value:function(){return this._data}},{key:"fromJSON",value:function(e){return this._data=e,this}},{key:"_all",value:function(e,t){var n=e;for(T.clear();n;){var r;if(!0===n.leaf){var a,o=Object(i.a)(n.children);try{for(o.s();!(a=o.n()).done;){t(a.value)}}catch(s){o.e(s)}finally{o.f()}}else T.pushArray(n.children);n=null!==(r=T.pop())&&void 0!==r?r:null}}},{key:"_build",value:function(e,t,n,r){var a=n-t+1,i=this._maxEntries;if(a<=i){var o=new C(e.slice(t,n+1));return h(o,this._toBBox),o}r||(r=Math.ceil(Math.log(a)/Math.log(i)),i=Math.ceil(a/Math.pow(i,r-1)));var s=new L([]);s.height=r;var u=Math.ceil(a/i),c=u*Math.ceil(Math.sqrt(i));x(e,t,n,c,this._compareMinX);for(var l=t;l<=n;l+=c){var d=Math.min(l+c-1,n);x(e,l,d,u,this._compareMinY);for(var p=l;p<=d;p+=u){var f=Math.min(p+u-1,d);s.children.push(this._build(e,p,f,r-1))}}return h(s,this._toBBox),s}},{key:"_chooseSubtree",value:function(e,t,n,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==n;){for(var a=void 0,i=1/0,o=1/0,s=0,u=t.children.length;s<u;s++){var c=t.children[s],l=m(c),d=j(e,c)-l;d<o?(o=d,i=l<i?l:i,a=c):d===o&&l<i&&(i=l,a=c)}t=a||t.children[0]}return t}},{key:"_insert",value:function(e,t,n){var r=this._toBBox,a=n?e:r(e);E.clear();var i=this._chooseSubtree(a,this._data,t,E);for(i.children.push(e),y(i,a);t>=0&&E.data[t].children.length>this._maxEntries;)this._split(E,t),t--;this._adjustParentBBoxes(a,E,t)}},{key:"_split",value:function(e,t){var n=e.data[t],r=n.children.length,a=this._minEntries;this._chooseSplitAxis(n,a,r);var i=this._chooseSplitIndex(n,a,r);if(i){var o=n.children.splice(i,n.children.length-i),s=n.leaf?new C(o):new L(o);s.height=n.height,h(n,this._toBBox),h(s,this._toBBox),t?e.data[t-1].children.push(s):this._splitRoot(n,s)}else console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}},{key:"_splitRoot",value:function(e,t){this._data=new L([e,t]),this._data.height=e.height+1,h(this._data,this._toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,n){var r,a,i;r=a=1/0;for(var o=t;o<=n-t;o++){var s=f(e,0,o,this._toBBox),u=f(e,o,n,this._toBBox),c=O(s,u),l=m(s)+m(u);c<r?(r=c,i=o,a=l<a?l:a):c===r&&l<a&&(a=l,i=o)}return i}},{key:"_chooseSplitAxis",value:function(e,t,n){var r=e.leaf?this._compareMinX:b,a=e.leaf?this._compareMinY:v;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,a)&&e.children.sort(r)}},{key:"_allDistMargin",value:function(e,t,n,r){e.children.sort(r);for(var a=this._toBBox,i=f(e,0,t,a),o=f(e,n-t,n,a),s=g(i)+g(o),u=t;u<n-t;u++){var c=e.children[u];y(i,e.leaf?a(c):c),s+=g(i)}for(var l=n-t-1;l>=t;l--){var d=e.children[l];y(o,e.leaf?a(d):d),s+=g(o)}return s}},{key:"_adjustParentBBoxes",value:function(e,t,n){for(var r=n;r>=0;r--)y(t.data[r],e)}},{key:"_condense",value:function(e){for(var t=e.length-1;t>=0;t--){var n=e.data[t];if(0===n.children.length)if(t>0){var r=e.data[t-1],a=r.children;a.splice(Object(u.g)(a,n,a.length,r.indexHint),1)}else this.clear();else h(n,this._toBBox)}}},{key:"_initFormat",value:function(e){var t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}]),e}();function h(e,t){f(e,0,e.children.length,t,e)}function f(e,t,n,r,a){a||(a=new C([])),a.minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(var i,o=t;o<n;o++)i=e.children[o],y(a,e.leaf?r(i):i);return a}function y(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function b(e,t){return e.minX-t.minX}function v(e,t){return e.minY-t.minY}function m(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function g(e){return e.maxX-e.minX+(e.maxY-e.minY)}function j(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function O(e,t){var n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),a=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,a-n)*Math.max(0,i-r)}function w(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function x(e,t,n,r,a){for(var i=[t,n];i.length;){var o=Object(c.d)(i.pop()),s=Object(c.d)(i.pop());if(!(o-s<=r)){var u=s+Math.ceil((o-s)/r/2)*r;Object(d.a)(e,u,s,o,a),i.push(s,u,u,o)}}}var k=new l.a,T=new l.a,E=new l.a,I=new l.a({deallocator:void 0}),M=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.apply(this,arguments)).height=1,e.indexHint=new u.a,e}return Object(s.a)(n)}(Object(s.a)((function e(){Object(o.a)(this,e),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}))),C=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).children=e,r.leaf=!0,r}return Object(s.a)(n)}(M),L=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).children=e,r.leaf=!1,r}return Object(s.a)(n)}(M)},634:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(92),a=n(89),i=n(88),o=n(93),s=n(597),u=n(139),c={minX:0,minY:0,maxX:0,maxY:0};function l(e,t,n){(function(e){c.minX=e[0],c.minY=e[1],c.maxX=e[2],c.maxY=e[3]})(t),e.search(c,n)}var d=function(){function e(){var t=this;Object(a.a)(this,e),this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new s.a(9,Object(o.a)("esri-csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(t._indexInvalid){var e=new Array(t._idByBounds.size),n=0;t._idByBounds.forEach((function(t,r){e[n++]=r})),t._indexInvalid=!1,t._index.clear(),t._index.load(e)}else t._boundsToLoad.length&&(t._index.load(Array.from(new Set(t._boundsToLoad.filter((function(e){return t._idByBounds.has(e)}))))),t._boundsToLoad.length=0)}}return Object(i.a)(e,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;var e,t=Object(u.i)(),n=Object(r.a)(this._boundsById.values());try{for(n.s();!(e=n.n()).done;){var a=e.value;a&&(t[0]=Math.min(a[0],t[0]),t[1]=Math.min(a[1],t[1]),t[2]=Math.max(a[2],t[2]),t[3]=Math.max(a[3],t[3]))}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"valid",get:function(){return!this._indexInvalid}},{key:"clear",value:function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}},{key:"delete",value:function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}},{key:"forEachInBounds",value:function(e,t){var n=this;this._loadIndex(),l(this._index,e,(function(e){return t(n._idByBounds.get(e))}))}},{key:"get",value:function(e){return this._boundsById.get(e)}},{key:"has",value:function(e){return this._boundsById.has(e)}},{key:"invalidateIndex",value:function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}},{key:"set",value:function(e,t){if(!this._indexInvalid){var n=this._boundsById.get(e);n&&(this._index.remove(n),this._idByBounds.delete(n))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}]),e}()},710:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var r=n(92),a=n(99),i=n(89),o=n(88),s=n(101),u=n(193),c=n(102),l=n(392),d=n(139),p=n(168),h=n(634),f=n(375),y=n(335),b=n(169),v={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new y.a(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return null==e.centroid&&(e.centroid=Object(f.a)(new b.a,e.geometry,t.hasZ,t.hasM)),e.centroid}},m=n(598),g=Object(l.b)(),j=function(){function e(t){Object(i.a)(this,e),this.geometryInfo=t,this._boundsStore=new h.a,this._featuresById=new Map,this._markedIds=new Set,this.events=new u.a,this.featureAdapter=v}return Object(o.a)(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){var e=0;return this._featuresById.forEach((function(t){null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}},{key:"getFullExtent",value:function(e){if(null==this.fullBounds)return null;var t=Object(a.a)(this.fullBounds,4);return{xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:Object(m.b)(e)}}},{key:"add",value:function(e){this._add(e),this._emitChanged()}},{key:"addMany",value:function(e){var t,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;this._add(a)}}catch(i){n.e(i)}finally{n.f()}this._emitChanged()}},{key:"clear",value:function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}},{key:"removeById",value:function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}},{key:"removeManyById",value:function(e){this._boundsStore.invalidateIndex();var t,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=this._featuresById.get(a);i&&this._remove(i)}}catch(o){n.e(o)}finally{n.f()}this._emitChanged()}},{key:"forEachBounds",value:function(e,t){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=this._boundsStore.get(i.objectId);o&&t(Object(l.h)(g,o))}}catch(s){a.e(s)}finally{a.f()}}},{key:"getFeature",value:function(e){return this._featuresById.get(e)}},{key:"has",value:function(e){return this._featuresById.has(e)}},{key:"forEach",value:function(e){this._featuresById.forEach((function(t){return e(t)}))}},{key:"forEachInBounds",value:function(e,t){var n=this;this._boundsStore.forEachInBounds(e,(function(e){t(n._featuresById.get(e))}))}},{key:"startMarkingUsedFeatures",value:function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}},{key:"sweep",value:function(){var e=this,t=!1;this._featuresById.forEach((function(n,r){e._markedIds.has(r)||(t=!0,e._remove(n))})),this._markedIds.clear(),t&&this._emitChanged()}},{key:"_emitChanged",value:function(){this.events.emit("changed",void 0)}},{key:"_add",value:function(e){if(e){var t=e.objectId;if(null!=t){var n,r=this._featuresById.get(t);if(this._markedIds.add(t),r?(e.displayId=r.displayId,n=this._boundsStore.get(t),this._boundsStore.delete(t)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),null==e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);null!=(n=Object(p.r)(null!=n?n:Object(d.h)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM))&&this._boundsStore.set(t,n),this._featuresById.set(t,e)}else c.a.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.a("featurestore:invalid-feature","feature id is missing",{feature:e}))}}},{key:"_remove",value:function(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);var t=e.objectId;return this._markedIds.delete(t),this._boundsStore.delete(t),this._featuresById.delete(t),e}}]),e}()},910:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return p}));var r=new Float64Array(2),a=new Float64Array(2),i="0123456789bcdefghjkmnpqrstuvwxyz";function o(e){return i[e]}function s(e){return(e[0]+e[1])/2}function u(e,t,n){return e[0]=t,e[1]=n,e}function c(e,t){var n=s(e),r=t,a=!t;e[0]=a*e[0]+r*n,e[1]=a*n+r*e[1]}function l(e,t){var n=t>s(e);return c(e,n),n}function d(e,t){for(var n=-90,r=90,a=-180,i=180,o=0;o<t;o++){for(var s=Math.ceil((o+1)/2),u=Math.floor((o+1)/2),c=1-o%2,l=30-(3*s+2*u),d=30-(2*s+3*u),p=3*c+2*(1-c),h=2*c+3*(1-c),f=3*c+7*(1-c)<<d,y=(7*c+3*(1-c)<<l&e.geohashX)>>l,b=(f&e.geohashY)>>d,v=p-1;v>=0;v--){var m=(a+i)/2,g=y&1<<v?1:0;a=(1-g)*a+g*m,i=(1-g)*m+g*i}for(var j=h-1;j>=0;j--){var O=(n+r)/2,w=b&1<<j?1:0;n=(1-w)*n+w*O,r=(1-w)*O+w*r}}return[a,n,i,r]}function p(e,t,n,r){r%2&&(r+=1);for(var a=0,i=0,o=-90,s=90,u=-180,c=180,l=0;l<r/2;l++){for(var d=0;d<5;d++){var p=(u+c)/2,h=n>p?1:0;a|=h<<29-(d+5*l),u=(1-h)*u+h*p,c=(1-h)*p+h*c}for(var f=0;f<5;f++){var y=(o+s)/2,b=t>y?1:0;i|=b<<29-(f+5*l),o=(1-b)*o+b*y,s=(1-b)*y+b*s}}e.geohashX=a,e.geohashY=i}function h(e,t,n,r,a){a%2&&(a+=1);for(var i=0,o=0,s=-90,u=90,c=-180,l=180,d=0;d<a/2;d++){for(var p=0;p<5;p++){var h=(c+l)/2,f=r>h?1:0;i|=f<<29-(p+5*d),c=(1-f)*c+f*h,l=(1-f)*h+f*l}for(var y=0;y<5;y++){var b=(s+u)/2,v=n>b?1:0;o|=v<<29-(y+5*d),s=(1-v)*s+v*b,u=(1-v)*b+v*u}}e[2*t]=i,e[2*t+1]=o}function f(e,t,n){for(var i="",s=u(r,-90,90),c=u(a,-180,180),d=0;d<n;d++){var p=0;d%2?(p|=l(s,e)<<4,p|=l(c,t)<<3,p|=l(s,e)<<2,p|=l(c,t)<<1,p|=l(s,e)<<0):(p|=l(c,t)<<4,p|=l(s,e)<<3,p|=l(c,t)<<2,p|=l(s,e)<<1,p|=l(c,t)<<0),i+=o(p)}return i}}}]);
//# sourceMappingURL=189.85c72309.chunk.js.map