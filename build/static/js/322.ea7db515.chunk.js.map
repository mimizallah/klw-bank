{"version":3,"sources":["../node_modules/@arcgis/core/layers/support/StreamConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/WebSocketConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/GeoEventConnection.js","../node_modules/@arcgis/core/layers/support/ClientSideConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/createConnection.js"],"names":["c","_o$EventedAccessor","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","this","emit","get","errorString","e","r","o","EventedAccessor","s","readOnly","prototype","h","i","t","CONNECTING","OPEN","CLOSING","CLOSED","d","_l","_this","call","_outstandingMessages","geometryType","spatialReference","sourceSpatialReference","_config","_featureZScaler","a","_open","_open2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","_tryCreateWebSocket","t0","destroyed","_handshake","stop","_get","_getPrototypeOf","_websocket","onopen","onclose","onerror","onmessage","close","readyState","send","JSON","stringify","push","_onMessage","customParameters","_tryCreateWebSocket2","_callee2","_this$_config$customP","_t","_n","_args2","_context2","length","undefined","source","path","abrupt","n","_createWebSocket","sent","notifyChange","maxReconnectionAttempts","t1","getLogger","error","destroy","concat","Math","min","maxReconnectionInterval","_this2","parse","data","_this3","Promise","WebSocket","_onClose","_onError","_setWebSocketJSONParseHandler","_handshake2","_callee3","_this$_config","l","_this4","_args3","_context3","filter","outFields","timeout","_r$spatialReference","reject","wkid","format","_step","_iterator","_createForOfIteratorHelper","done","err","f","resolve","promise","onMessage","type","_step2","_iterator2","features","geometry","onFeature","_set","code","maxQueryDepth","maxRecordCountFactor","g","_a","_objectSpread","_buddyServicesQuery","_relatedFeatures","_fetchServiceDefinition","timeInfo","trackIdField","warn","_fetchWebSocketUrl","streamUrls","_queryBuddyServices","_setFilter","_enrich","_fetchServiceDefinition2","query","responseType","_serviceDefinition","_x","urls","token","_inferWebSocketBaseUrl","outSR","includes","_setFilter2","u","_serializeFilter","setTimeout","_x2","_x3","shiftCentralMeridian","where","join","relatedFeatures","joinField","attributes","centroid","_queryBuddyServices2","_callee4","_this$_serviceDefinit","_e","_t3","_r2","_s","_o2","_i","_context4","keepLatestArchive","_queryRelatedFeatures","_queryArchive","_queryRelatedFeatures2","_callee5","_context5","_queryBuddy","featuresUrl","_addRelatedFeatures","_x4","_queryArchive2","_callee6","_context6","_x5","_queryBuddy2","_callee7","_this$_config$outFiel","_this$_config$filter$","_this$_config$filter","_yield$t$load","_context7","default","url","load","capabilities","supportsMaxRecordCountFactor","supportsPagination","supportsCentroid","maxRecordCount","returnGeometry","returnExceededLimitFeatures","outSpatialReference","fromJSON","returnCentroid","num","_queryPages","_x6","_queryPages2","_callee8","_this$_config$maxQuer","_yield$c","_args8","_context8","start","exceededTransferLimit","forEach","_x7","_x8","_step3","Map","_iterator3","set","y","connectionStatus","m","p","startsWith"],"mappings":"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","file":"static/js/322.ea7db515.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Error.js\";import o from\"../../core/Evented.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";let c=class extends o.EventedAccessor{destroy(){this.emit(\"destroy\")}get connectionError(){return this.errorString?new e(\"stream-connection\",this.errorString):null}onFeature(r){this.emit(\"data-received\",r)}onMessage(r){this.emit(\"message-received\",r)}};r([s({readOnly:!0})],c.prototype,\"connectionError\",null),c=r([t(\"esri.layers.support.StreamConnection\")],c);const i=c;export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Error.js\";import o from\"../../../../core/Logger.js\";import{after as s,createResolver as r}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as n}from\"../../../../core/urlUtils.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import{subclass as c}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as a}from\"../../../../geometry/support/zscale.js\";import l from\"../../../support/StreamConnection.js\";var h;!function(e){e[e.CONNECTING=0]=\"CONNECTING\",e[e.OPEN=1]=\"OPEN\",e[e.CLOSING=2]=\"CLOSING\",e[e.CLOSED=3]=\"CLOSED\"}(h||(h={}));let d=class extends l{constructor(e){super(),this._outstandingMessages=[],this.errorString=null;const{geometryType:t,spatialReference:o,sourceSpatialReference:s}=e;this._config=e,this._featureZScaler=a(t,s,o),this._open()}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){super.destroy(),null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(null==this._websocket)return\"disconnected\";switch(this._websocket.readyState){case h.CONNECTING:case h.OPEN:return\"connected\";case h.CLOSING:case h.CLOSED:return\"disconnected\"}}sendMessageToSocket(e){null!=this._websocket?this._websocket.send(JSON.stringify(e)):this._outstandingMessages.push(e)}sendMessageToClient(e){this._onMessage(e)}updateCustomParameters(e){this._config.customParameters=e,null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(e=this._config.source.path,r=1e3,i=0){try{if(this.destroyed)return;const t=n(e,this._config.customParameters??{});this._websocket=await this._createWebSocket(t),this.notifyChange(\"connectionStatus\")}catch(c){const n=r/1e3;return this._config.maxReconnectionAttempts&&i>=this._config.maxReconnectionAttempts?(o.getLogger(this).error(new t(\"websocket-connection\",\"Exceeded maxReconnectionAttempts attempts. No further attempts will be made\")),void this.destroy()):(o.getLogger(this).error(new t(\"websocket-connection\",`Failed to connect. Attempting to reconnect in ${n}s`,c)),await s(r),this._tryCreateWebSocket(e,Math.min(1.5*r,1e3*this._config.maxReconnectionInterval),i+1))}}_setWebSocketJSONParseHandler(e){e.onmessage=e=>{try{const t=JSON.parse(e.data);this._onMessage(t)}catch(s){return void o.getLogger(this).error(new t(\"websocket-connection\",\"Failed to parse message, invalid JSON\",{error:s}))}}}_createWebSocket(e){return new Promise(((t,o)=>{const s=new WebSocket(e);s.onopen=()=>{if(s.onopen=null,this.destroyed)return s.onclose=null,void s.close();s.onclose=e=>this._onClose(e),s.onerror=e=>this._onError(e),this._setWebSocketJSONParseHandler(s),t(s)},s.onclose=e=>{s.onopen=s.onclose=null,o(e)}}))}async _handshake(e=1e4){const s=this._websocket;if(null==s)return;const n=r(),i=s.onmessage,{filter:c,outFields:a,spatialReference:l}=this._config;return n.timeout(e),s.onmessage=e=>{let r=null;try{r=JSON.parse(e.data)}catch(h){}r&&\"object\"==typeof r||(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - malformed message\",e.data)),n.reject(),this.destroy()),r.spatialReference?.wkid!==l?.wkid&&(o.getLogger(this).error(new t(\"websocket-connection\",`Protocol violation. Handshake failed - expected wkid of ${l.wkid}`,e.data)),n.reject(),this.destroy()),\"json\"!==r.format&&(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - format is not set\",e.data)),n.reject(),this.destroy()),c&&r.filter!==c&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set filter, but server doesn't support it\")),a&&r.outFields!==a&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set outFields, but server doesn't support it\")),s.onmessage=i;for(const t of this._outstandingMessages)s.send(JSON.stringify(t));this._outstandingMessages=[],n.resolve()},s.send(JSON.stringify({filter:c,outFields:a,format:\"json\",spatialReference:{wkid:l.wkid}})),n.promise}_onMessage(e){if(this.onMessage(e),\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}}_onError(e){const t=\"Encountered an error over WebSocket connection\";this._set(\"errorString\",t),o.getLogger(this).error(\"websocket-connection\",t)}_onClose(e){this._websocket=null,this.notifyChange(\"connectionStatus\"),1e3!==e.code&&o.getLogger(this).error(\"websocket-connection\",`WebSocket closed unexpectedly with error code ${e.code}`),this.destroyed||this._open()}};e([i()],d.prototype,\"connectionStatus\",null),e([i()],d.prototype,\"errorString\",void 0),d=e([c(\"esri.layers.graphics.sources.connections.WebSocketConnection\")],d);export{d as WebSocketConnection};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import t from\"../../../../request.js\";import r from\"../../../../core/Error.js\";import s from\"../../../../core/Logger.js\";import{createResolver as o}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as i}from\"../../../../core/urlUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{WebSocketConnection as a}from\"./WebSocketConnection.js\";import{executeQuery as c}from\"../../../../rest/query/operations/query.js\";import u from\"../../../../rest/support/Query.js\";import{fromJSON as l}from\"../../../../geometry/support/jsonUtils.js\";import f from\"../../../../geometry/SpatialReference.js\";const h=1e4,d={maxQueryDepth:5,maxRecordCountFactor:3};let g=class extends a{constructor(e){super({...d,...e}),this._buddyServicesQuery=null,this._relatedFeatures=null}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||s.getLogger(this).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:o}=this._config;this.destroyed||this._setFilter(r,o)}_onMessage(e){if(\"attributes\"in e){let o;try{o=this._enrich(e),null!=this._featureZScaler&&this._featureZScaler(o.geometry)}catch(t){return void s.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to parse message\",t))}this.onFeature(o)}else this.onMessage(e)}async _fetchServiceDefinition(e){const r={f:\"json\",...this._config.customParameters},s=t(e.path,{query:r,responseType:\"json\"}),o=(await s).data;return this._serviceDefinition=o,o}_fetchWebSocketUrl(e,t){const r=e[0],{urls:s,token:o}=r,n=this._inferWebSocketBaseUrl(s);return i(`${n}/subscribe`,{outSR:\"\"+t.wkid,token:o})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes(\"wss\"))return t;return s.getLogger(this).error(new r(\"geoevent-connection\",\"Unable to infer WebSocket url\",e)),null}async _setFilter(e,t){const i=this._websocket;if(null==i||null==e&&null==t)return;const n=JSON.stringify({filter:this._serializeFilter(e,t)});let a=!1;const c=o(),u=()=>{a||(this.destroyed||this._websocket!==i||s.getLogger(this).error(new r(\"geoevent-connection\",\"Server timed out when setting filter\")),c.reject())},l=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(s.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to set service filter\",t.error)),this._set(\"errorString\",`Could not set service filter - ${t.error}`),c.reject(t.error)),this._setWebSocketJSONParseHandler(i),a=!0,c.resolve())};return i.onmessage=l,i.send(n),setTimeout(u,h),c.promise}_serializeFilter(e,t){const o={};if(null==e&&null==t)return o;if(null!=e&&e.geometry)try{const t=l(e.geometry);if(\"extent\"!==t.type)throw new r(`Expected extent but found type ${t.type}`);o.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(i){s.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when setting connection geometryDefinition\",i))}return null!=e&&e.where&&\"1 = 1\"!==e.where&&\"1=1\"!==e.where&&(o.where=e.where),null!=t&&(o.outFields=t.join(\",\")),o}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,o=e.attributes[t],i=this._relatedFeatures.get(o);if(!i)return s.getLogger(this).warn(\"geoevent-connection\",\"Feature join failed. Is the join field configured correctly?\",e),e;const{attributes:n,geometry:a}=i;for(const r in n)e.attributes[r]=n[r];return a&&(e.geometry=a),e.geometry||e.centroid||s.getLogger(this).error(new r(\"geoevent-connection\",\"Found malformed feature - no geometry found\",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),s=this._queryArchive(t);await r;const o=await s;if(!o)return;for(const i of o.features)this.onFeature(this._enrich(i))}catch(e){s.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when querying buddy services\",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new((await import(\"../../../FeatureLayer.js\")).default)({url:e}),{capabilities:r}=await t.load(),s=r.query.supportsMaxRecordCountFactor,o=r.query.supportsPagination,i=r.query.supportsCentroid,n=this._config.maxRecordCountFactor,a=t.capabilities.query.maxRecordCount,l=s?a*n:a,h=new u;if(h.outFields=this._config.outFields??[\"*\"],h.where=this._config.filter?.where??\"1=1\",h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=f.fromJSON(this._config.spatialReference),i&&(h.returnCentroid=!0),s&&(h.maxRecordCountFactor=n),o)return h.num=l,t.destroy(),this._queryPages(e,h);const d=await c(e,h,this._config.sourceSpatialReference);return t.destroy(),d.data}async _queryPages(e,t,r=[],s=0){t.start=null!=t.num?s*t.num:null;const{data:o}=await c(e,t,this._config.sourceSpatialReference);return o.exceededTransferLimit&&s<(this._config.maxQueryDepth??0)?(o.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,s+1)):(r.forEach((e=>o.features.push(e))),o)}_addRelatedFeatures(e){const t=new Map,r=e.features,s=this._serviceDefinition.relatedFeatures.joinField;for(const o of r){const e=o.attributes[s];t.set(e,o)}this._relatedFeatures=t}};g=e([n(\"esri.layers.graphics.sources.connections.GeoEventConnection\")],g);const y=g;export{y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as o}from\"../../geometry/support/zscale.js\";import s from\"./StreamConnection.js\";let c=class extends s{constructor(e){super(),this.connectionStatus=\"connected\",this.errorString=null;const{geometryType:r,spatialReference:t,sourceSpatialReference:s}=e;this._featureZScaler=o(r,s,t)}updateCustomParameters(e){}sendMessageToSocket(e){}sendMessageToClient(e){if(\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const r of e.features)null!=this._featureZScaler&&this._featureZScaler(r.geometry),this.onFeature(r)}this.onMessage(e)}};e([r()],c.prototype,\"connectionStatus\",void 0),e([r()],c.prototype,\"errorString\",void 0),c=e([t(\"esri.layers.support.ClientSideConnection\")],c);export{c as ClientSideConnection};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport e from\"./GeoEventConnection.js\";import{WebSocketConnection as t}from\"./WebSocketConnection.js\";import{ClientSideConnection as n}from\"../../../support/ClientSideConnection.js\";function o(o,r,s,i,c,a,m,p){const f={source:o,sourceSpatialReference:r,spatialReference:s,geometryType:i,filter:c,maxReconnectionAttempts:a,maxReconnectionInterval:m,customParameters:p};if(!o)return new n(f);return o.path.startsWith(\"wss://\")||o.path.startsWith(\"ws://\")?new t(f):new e(f)}export{o as createConnection};\n"],"sourceRoot":""}