(this["webpackJsonpklw-bank"]=this["webpackJsonpklw-bank"]||[]).push([[176,178],{1114:function(e,t,r){"use strict";r.d(t,"a",(function(){return k}));var a=r(1),n=r(4),i=r(12),s=r(221),u=r(92),l=r(89),c=r(88),o=r(111),d=r(536),f=r(168);function h(e,t){return t}function p(e,t,r,a){switch(r){case 0:return _(e,t+a,0);case 1:return"lowerLeft"===e.originPosition?_(e,t+a,1):function(e,t,r){var a=e.translate,n=e.scale;return a[r]-t*n[r]}(e,t+a,1)}}function b(e,t,r,a){return 2===r?_(e,t,2):p(e,t,r,a)}function y(e,t,r,a){return 2===r?_(e,t,3):p(e,t,r,a)}function v(e,t,r,a){return 3===r?_(e,t,3):b(e,t,r,a)}function _(e,t,r){var a=e.translate,n=e.scale;return a[r]+t*n[r]}var m=function(){function e(t){Object(l.a)(this,e),this._options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=h,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=function(){return Object(c.a)((function e(){Object(l.a)(this,e)}))}()}return Object(c.a)(e,[{key:"createFeatureResult",value:function(){return{fields:[],features:[]}}},{key:"finishFeatureResult",value:function(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=function(){return Object(c.a)((function e(){Object(l.a)(this,e)}))}(),this._coordinateBuffer=null,this._lengths.length=0,e.hasZ){var t=Object(d.a)(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(null!=t){var r,a=Object(u.a)(e.features);try{for(a.s();!(r=a.n()).done;){t(r.value.geometry)}}catch(n){a.e(n)}finally{a.f()}}}}},{key:"createSpatialReference",value:function(){return{}}},{key:"addField",value:function(e,t){var r=e.fields;Object(o.c)(r),r.push(t);var a=r.map((function(e){return e.name}));this._attributesConstructor=function(){var e,t=Object(u.a)(a);try{for(t.s();!(e=t.n()).done;){this[e.value]=null}}catch(r){t.e(r)}finally{t.f()}}}},{key:"addFeature",value:function(e,t){e.features.push(t)}},{key:"prepareFeatures",value:function(e){var t=this;switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=function(e,r,a){return t.addCoordinatePoint(e,r,a)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"esriGeometryPolygon":this.addCoordinate=function(e,r,a){return t._addCoordinatePolygon(e,r,a)},this.createGeometry=function(e){return t._createPolygonGeometry(e)};break;case"esriGeometryPolyline":this.addCoordinate=function(e,r,a){return t._addCoordinatePolyline(e,r,a)},this.createGeometry=function(e){return t._createPolylineGeometry(e)};break;case"esriGeometryMultipoint":this.addCoordinate=function(e,r,a){return t._addCoordinateMultipoint(e,r,a)},this.createGeometry=function(e){return t._createMultipointGeometry(e)}}}},{key:"createFeature",value:function(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}},{key:"allocateCoordinates",value:function(){}},{key:"addLength",value:function(e,t,r){0===this._lengths.length&&(this._toAddInCurrentPath=t),this._lengths.push(t)}},{key:"addQueryGeometry",value:function(e,t){var r=t.queryGeometry,n=t.queryGeometryType,i=Object(f.z)(r.clone(),r,!1,!1,this._transform),s=Object(f.l)(i,n,!1,!1);e.queryGeometryType=n,e.queryGeometry=Object(a.a)({},s)}},{key:"createPointGeometry",value:function(e){var t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}},{key:"addCoordinatePoint",value:function(e,t,r){var a=Object(o.m)(this._transform,"transform");switch(t=this._applyTransform(a,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}},{key:"_transformPathLikeValue",value:function(e,t){var r=0;t<=1&&(r=this._previousCoordinate[t],this._previousCoordinate[t]+=e);var a=Object(o.m)(this._transform,"transform");return this._applyTransform(a,e,t,r)}},{key:"_addCoordinatePolyline",value:function(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}},{key:"_addCoordinatePolygon",value:function(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}},{key:"_addCoordinateMultipoint",value:function(e,t,r){0===r&&e.points.push([]);var a=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(a)}},{key:"_createPolygonGeometry",value:function(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"_createPolylineGeometry",value:function(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"_createMultipointGeometry",value:function(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"_dehydratedAddPointsCoordinate",value:function(e,t,r){0===r&&0==this._toAddInCurrentPath--&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);var a=this._transformPathLikeValue(t,r),n=e[e.length-1];0===r&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),n.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=a}},{key:"_deriveApplyTransform",value:function(e){var t=e.hasZ,r=e.hasM;return t&&r?v:t?b:r?y:p}}]),e}(),g=r(408),O=(r(235),r(210));function k(e,t,r){return j.apply(this,arguments)}function j(){return(j=Object(i.a)(Object(n.a)().mark((function e(t,r,i){var u,l,c,o,d,f;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=Object(s.c)(t),l=Object(a.a)({},i),c=O.a.from(r),o=!c.quantizationParameters,e.next=6,Object(g.e)(u,c,new m({sourceSpatialReference:c.sourceSpatialReference,applyTransform:o}),l);case 6:return d=e.sent,f=d.data,e.abrupt("return",f);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},1215:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(4),n=r(12),i=r(89),s=r(88),u=function(){function e(){Object(i.a)(this,e),this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return Object(s.a)(e,[{key:"add",value:function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}},{key:"featureSetByName",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){var r=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!(r.length>1&&void 0!==r[1])||r[1],r.length>2&&void 0!==r[2]?r[2]:["*"],e.abrupt("return",void 0===this._layerByName[t]?null:this._layerByName[t]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){var r=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!(r.length>1&&void 0!==r[1])||r[1],r.length>2&&void 0!==r[2]?r[2]:["*"],e.abrupt("return",void 0===this._layerById[t]?null:this._layerById[t]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"castToText",value:function(){return"object, FeatureSetCollection"}}]),e}()},1216:function(e,t,r){"use strict";r.d(t,"a",(function(){return F})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return k})),r.d(t,"d",(function(){return x})),r.d(t,"e",(function(){return w}));var a=r(4),n=r(12),i=r(92),s=r(90),u=r(91),l=r(89),c=r(88),o=r(172),d=r(262),f=r(1017),h=r(366),p=r(441),b=r(450),y=r(358),v=r(532),_=r(111),m=r(436),g=r(125),O=function(){function e(t){Object(l.a)(this,e),this.field=t,this.sqlRewritable=!1}return Object(c.a)(e,[{key:"postInitialization",value:function(e,t){}}]),e}(),k=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var a;return Object(l.a)(this,r),(a=t.call(this,e)).sqlRewritable=!0,a}return Object(c.a)(r,[{key:"extractValue",value:function(e){return e.attributes[this.field.name]}},{key:"rewriteSql",value:function(e){return{rewritten:this.sqlRewritable,where:e}}}]),r}(O),j=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e,a,n){var i;return Object(l.a)(this,r),(i=t.call(this,Object(y.c)(e))).originalField=e,i.sqlRewritable=!0,i.field.name=a,i.field.alias=n,i}return Object(c.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:this.sqlRewritable,where:Object(v.h)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return e.attributes[this.originalField.name]}}]),r}(O),w=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e,a,n){var i;for(var s in Object(l.a)(this,r),(i=t.call(this,e)).codefield=a,i.lkp=n,i.reverseLkp={},n)i.reverseLkp[n[s]]=s;return i.sqlRewritable=!0,i}return Object(c.a)(r,[{key:"rewriteSql",value:function(e,t){var a=this.evaluateNodeToWhereClause(e.parseTree,y.a.Standardised,this.field.name,this.codefield instanceof m.WhereClause?Object(v.j)(this.codefield,y.a.Standardised):this.codefield,e.parameters);return a.includes(r.BADNESS)?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:m.WhereClause.create(a,Object(_.m)(t._parent).getFieldsIndex())}}},{key:"evaluateNodeToWhereClause",value:function(e,t){var a,n,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0;switch(e.type){case"interval":return Object(v.c)(this.evaluateNodeToWhereClause(e.value,t,l,c,o),e.qualifier,e.op);case"case-expression":var f=" CASE ";"simple"===e.format&&(f+=this.evaluateNodeToWhereClause(e.operand,t,l,r.BADNESS,o));for(var p=0;p<e.clauses.length;p++)f+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[p].operand,t,l,r.BADNESS,o)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[p].value,t,l,r.BADNESS,o);return null!==e.else&&(f+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,l,r.BADNESS,o)),f+=" END ";case"parameter":var b=o[e.value.toLowerCase()];if("string"==typeof b)return"'"+b.toString().replaceAll("'","''")+"'";if(b instanceof Date)return Object(v.e)(b,t,null);if(b instanceof d.a)return Object(v.a)(b,t,null);if(b instanceof Array){for(var y=[],_=0;_<b.length;_++)"string"==typeof b[_]?y.push("'"+b[_].toString().replaceAll("'","''")+"'"):b[_]instanceof Date?y.push(Object(v.e)(b[_],t,null)):b[_]instanceof d.a?y.push(Object(v.a)(b[_],t,null)):y.push(b[_].toString());return y}return b.toString();case"expression-list":n=[];var m,g=Object(i.a)(e.value);try{for(g.s();!(m=g.n()).done;){var O=m.value;n.push(this.evaluateNodeToWhereClause(O,t,l,c,o))}}catch(N){g.e(N)}finally{g.f()}return n;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,l,r.BADNESS,o)+" ) ";case"binary-expression":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" AND "+this.evaluateNodeToWhereClause(e.right,t,l,c,o)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" OR "+this.evaluateNodeToWhereClause(e.right,t,l,c,o)+") ";case"IS":if("null"!==e.right.type)throw new h.c(h.d.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new h.c(h.d.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" IS NOT NULL )";case"IN":if(a=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var k,j=[],w=!0,x=Object(i.a)(e.right.value);try{for(x.s();!(k=x.n()).done;){var F=k.value;if("string"!==F.type){w=!1;break}if(void 0===this.lkp[F.value]){w=!1;break}j.push(this.lkp[F.value].toString())}}catch(N){x.e(N)}finally{x.f()}if(w)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" IN ("+j.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,c,o)," ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,c,o))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" IN ("+u+")) ";case"NOT IN":if(a=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var S,I=[],D=!0,C=Object(i.a)(e.right.value);try{for(C.s();!(S=C.n()).done;){var T=S.value;if("string"!==T.type){D=!1;break}if(void 0===this.lkp[T.value]){D=!1;break}I.push(this.lkp[T.value].toString())}}catch(N){C.e(N)}finally{C.f()}if(D)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" NOT IN ("+I.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,c,o)," ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" NOT IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,c,o))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" NOT IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,c,o)+" NOT IN ("+u+")) ";case"BETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)+") ";case"<>":case"=":if("column-reference"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+c+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column-reference"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+c+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,o)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,o)+") "}case"null":return"null";case"boolean":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replaceAll("'","''")+"'";case"timestamp":case"date":return Object(v.e)(e.value,t,null);case"number":return e.value.toString();case"current-time":return Object(v.f)("date"===e.mode,t);case"column-reference":return l&&l.toLowerCase()===e.column.toLowerCase()?"("+c+")":e.column;case"data-type":return e.value;case"function":var R=this.evaluateNodeToWhereClause(e.args,t,l,r.BADNESS,o);return Object(v.l)(e.name,R,t)}throw new h.c(h.d.UnsupportedSyntax,{node:e.type})}},{key:"extractValue",value:function(e){return this.codefield instanceof m.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}]),r}(O);w.BADNESS="_!!!_BAD_LKP_!!!!";var x=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e,a){var n;return Object(l.a)(this,r),(n=t.call(this,e))._sql=a,n}return Object(c.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:!0,where:Object(v.h)(e,this.field.name,Object(v.j)(this._sql,y.a.Standardised),t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return this._sql.calculateValueCompiled(e)}}]),r}(O),F=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var a;return Object(l.a)(this,r),(a=t.call(this,e))._calcFunc=null,a.declaredClass="esri.arcade.featureset.actions.Adapted",a.adaptedFields=[],a._extraFilter=null,a._extraFilter=e.extraFilter,a._parent=e.parentfeatureset,a._maxProcessing=30,a.adaptedFields=e.adaptedFields,a}return Object(c.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new g.a({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=y.o.point,this.typeIdField="",this.types=null),this.fields=[];var e,t=Object(i.a)(this.adaptedFields);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.postInitialization(this,this._parent),this.fields.push(r.field)}}catch(a){t.e(a)}finally{t.f()}}},{key:"_getSet",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){var r,n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=18;break}return e.next=3,this._ensureLoaded();case 3:if(n=null,!this._extraFilter){e.next=10;break}return e.next=7,this._getFilteredSet("",null,null,null,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,null===(r=this._parent)||void 0===r?void 0:r._getSet(t);case 12:e.t0=e.sent;case 13:return n=e.t0,this._checkCancelled(t),Object(_.c)(n),this._wset=new b.a(n._candidates.slice(0),n._known.slice(0),n._ordered,this._clonePageDefinition(n.pagesDefinition)),e.abrupt("return",this._wset);case 18:return e.abrupt("return",this._wset);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){return Object(_.m)(this._parent)._isInFeatureSet(e)}},{key:"_getFeatures",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,s){var u,l,c,d,h,p,y,v,_,m,g,O,k,j,w,x,F;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=[],-1!==r&&void 0===this._featureCache[r]&&l.push(r),c=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,c)){e.next=7;break}return e.next=6,this._expandPagedSet(t,c,0,0,s);case 6:return e.abrupt("return",this._getFeatures(t,r,n,s));case 7:for(d=0,h=t._lastFetchedIndex;h<t._known.length&&(++d<=n&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[h]]&&(t._known[h]!==r&&l.push(t._known[h]),l.length>=c)));h++);if(0!==l.length){e.next=11;break}return e.abrupt("return","success");case 11:return t=new b.a([],l,t._ordered,null),p=Math.min(l.length,n),e.next=15,null===(u=this._parent)||void 0===u?void 0:u._getFeatures(t,-1,p,s);case 15:for(this._checkCancelled(s),y=[],v=0;v<p;v++)void 0!==(m=null===(_=this._parent)||void 0===_?void 0:_._featureFromCache(l[v]))&&y.push({geometry:m.geometry,attributes:m.attributes,id:l[v]});for(g=0,O=y;g<O.length;g++){k=O[g],j=[],w=Object(i.a)(this.adaptedFields);try{for(w.s();!(x=w.n()).done;)F=x.value,j[F.field.name]=F.extractValue(k)}catch(a){w.e(a)}finally{w.f()}this._featureCache[k.id]=new o.a({attributes:j,geometry:Object(f.a)(k.geometry)})}return e.abrupt("return","success");case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_fetchAndRefineFeatures",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.a(h.b.NeverReach);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,s,u){var l,c,o,d,f,h,p,y;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=!1,c=this._reformulateWithoutAdaptions(n),l=c.cannot,n=c.where,o=!1,null===s){e.next=28;break}o=!0,d=[],f=Object(i.a)(this.adaptedFields),e.prev=8,f.s();case 10:if((h=f.n()).done){e.next=19;break}if((p=h.value)instanceof k||!0!==s.scanForField(p.field.name)){e.next=17;break}if(p instanceof j){e.next=16;break}return s=null,o=!1,e.abrupt("break",19);case 16:d.push({field:p.field.name,newfield:p.originalField.name});case 17:e.next=10;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),f.e(e.t0);case 24:return e.prev=24,f.f(),e.finish(24);case 27:s&&d.length>0&&(s=s.replaceFields(d));case 28:return null!==n?null!==this._extraFilter&&(n=Object(v.b)(this._extraFilter,n)):n=this._extraFilter,e.next=31,this._ensureLoaded();case 31:return e.next=33,Object(_.m)(this._parent)._getFilteredSet(t,r,n,s,u);case 33:return y=e.sent,e.abrupt("return",(this._checkCancelled(u),!0===l?new b.a(y._candidates.slice(0).concat(y._known.slice(0)),[],!0===o&&y._ordered,this._clonePageDefinition(y.pagesDefinition)):new b.a(y._candidates.slice(0),y._known.slice(0),!0===o&&y._ordered,this._clonePageDefinition(y.pagesDefinition))));case 35:case"end":return e.stop()}}),e,this,[[8,21,24,27]])})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_reformulateWithoutAdaptions",value:function(e){var t={cannot:!1,where:e};if(null!==e){var r,a=Object(i.a)(this.adaptedFields);try{for(a.s();!(r=a.n()).done;){var n=r.value;if(!0===Object(v.i)(e,n.field.name)){var s=n.rewriteSql(e,this);if(!0!==s.rewritten){t.cannot=!0,t.where=null;break}t.where=s.where}}}catch(u){a.e(u)}finally{a.f()}}return t}},{key:"_stat",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s,u,l){var c,o,d;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=!1,o=this._reformulateWithoutAdaptions(r),c=o.cannot,r=o.where,o=this._reformulateWithoutAdaptions(s),c=c||o.cannot,null!==(s=o.where)?null!==this._extraFilter&&(s=Object(v.b)(this._extraFilter,s)):s=this._extraFilter,!0!==c){e.next=3;break}return e.abrupt("return",null===s&&""===n&&null===i?this._manualStat(t,r,u,l):{calculated:!1});case 3:return e.next=5,Object(_.m)(this._parent)._stat(t,r,n,i,s,u,l);case 5:return d=e.sent,e.abrupt("return",!1===d.calculated?null===s&&""===n&&null===i?this._manualStat(t,r,u,l):{calculated:!1}:d);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,s,u){var l,c,o,d,f,h,p,b,y,_;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}return e.abrupt("return",!1);case 2:l=0;case 3:if(!(l<t.length)){e.next=24;break}c=Object(i.a)(this.adaptedFields),e.prev=5,c.s();case 7:if((o=c.n()).done){e.next=13;break}if(d=o.value,t[l].toLowerCase()!==d.field.name.toLowerCase()||d instanceof k){e.next=11;break}return e.abrupt("return",!1);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),c.e(e.t0);case 18:return e.prev=18,c.f(),e.finish(18);case 21:l++,e.next=3;break;case 24:f=[],h=0;case 26:if(!(h<r.length)){e.next=40;break}if(null===(p=r[h]).workingexpr){e.next=36;break}if(!(b=this._reformulateWithoutAdaptions(p.workingexpr)).cannot){e.next=32;break}return e.abrupt("return",!1);case 32:(y=p.clone()).workingexpr=b.where,f.push(y),e.next=37;break;case 36:f.push(p);case 37:h++,e.next=26;break;case 40:return _=this._reformulateWithoutAdaptions(u),e.abrupt("return",!_.cannot&&(null!==(u=_.where)?null!==this._extraFilter&&(u=Object(v.b)(this._extraFilter,u)):u=this._extraFilter,this._parent._canDoAggregates(t,f,n,s,u)));case 42:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s,u,l){var c,o,d,f,p,b;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new h.a(h.b.NeverReach);case 2:c=[],o=0;case 4:if(!(o<r.length)){e.next=18;break}if(null===(d=r[o]).workingexpr){e.next=14;break}if(!(f=this._reformulateWithoutAdaptions(d.workingexpr)).cannot){e.next=10;break}throw new h.a(h.b.NeverReach);case 10:(p=d.clone()).workingexpr=f.where,c.push(p),e.next=15;break;case 14:c.push(d);case 15:o++,e.next=4;break;case 18:if(!(b=this._reformulateWithoutAdaptions(s)).cannot){e.next=21;break}throw new h.a(h.b.NeverReach);case 21:return e.abrupt("return",(null!==(s=b.where)?null!==this._extraFilter&&(s=Object(v.b)(this._extraFilter,s)):s=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(t,c,n,i,s,u,l)));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()}],[{key:"findField",value:function(e,t){var r,a=Object(i.a)(e);try{for(a.s();!(r=a.n()).done;){var n=r.value;if(n.name.toLowerCase()===t.toString().toLowerCase())return n}}catch(s){a.e(s)}finally{a.f()}return null}}]),r}(p.a)},1217:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var a=r(4),n=r(12),i=r(89),s=r(88),u=r(90),l=r(91),c=r(366),o=r(441),d=r(450),f=r(358),h=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e))._topnum=0,a.declaredClass="esri.arcade.featureset.actions.Top",a._countedin=0,a._maxProcessing=100,a._topnum=e.topnum,a._parent=e.parentfeatureset,a}return Object(s.a)(r,[{key:"_getSet",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){var r;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getSet(t);case 5:return r=e.sent,e.abrupt("return",(this._wset=new d.a(r._candidates.slice(0),r._known.slice(0),!1,this._clonePageDefinition(r.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setKnownLength",value:function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);if(t===f.b.NotInFeatureSet)return t;var r=this._idstates[e];return r===f.b.InFeatureSet||r===f.b.NotInFeatureSet?r:t===f.b.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=f.b.InFeatureSet,this._countedin++,f.b.InFeatureSet):(this._idstates[e]=f.b.NotInFeatureSet,f.b.NotInFeatureSet):f.b.Unknown}},{key:"_expandPagedSet",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s){var u,l;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new c.a(c.b.NotImplemented);case 2:if(r>this._topnum&&(r=this._topnum),!(this._countedin>=this._topnum&&t.pagesDefinition.internal.set.length<=t.pagesDefinition.resultOffset)){e.next=5;break}return u=t._known.length,e.abrupt("return",(u>0&&"GETPAGES"===t._known[u-1]&&(t._known.length=u-1),(u=t._candidates.length)>0&&"GETPAGES"===t._candidates[u-1]&&(t._candidates.length=u-1),"success"));case 5:return e.next=7,this._parent._expandPagedSet(t,r,n,i,s);case 7:return l=e.sent,e.abrupt("return",(this._setKnownLength(t)>this._topnum&&(t._known.length=this._topnum),this._setKnownLength(t)>=this._topnum&&(t._candidates.length=0),l));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i){var s,u,l,c,o,f,h,p;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],u=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,u)){e.next=5;break}return e.next=4,this._expandPagedSet(t,u,0,0,i);case 4:return e.abrupt("return",this._getFeatures(t,r,n,i));case 5:for(-1!==r&&void 0===this._featureCache[r]&&s.push(r),l=0,c=t._lastFetchedIndex;c<t._known.length&&(++l<=n&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[c]]&&(t._known[c]!==r&&s.push(t._known[c]),s.length>u)));c++);if(0!==s.length){e.next=10;break}return e.abrupt("return","success");case 10:return o=new d.a([],s,!1,null),f=Math.min(s.length,n),e.next=13,this._parent._getFeatures(o,-1,f,i);case 13:for(h=0;h<f;h++)void 0!==(p=this._parent._featureFromCache(s[h]))&&(this._featureCache[s[h]]=p);return e.abrupt("return","success");case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s){var u;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this._getSet(s);case 4:return u=e.sent,e.abrupt("return",new d.a(u._candidates.slice(0).concat(u._known.slice(0)),[],!1,this._clonePageDefinition(u.pagesDefinition)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_refineKnowns",value:function(e,t){for(var r=0,a=null,n=[],i=0;i<e._candidates.length;i++){var s=this._isInFeatureSet(e._candidates[i]);if(s===f.b.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===a?a={start:i,end:i}:a.end===i-1?a.end=i:(n.push(a),a={start:i,end:i}),e._known.length>=this._topnum)break}else if(s===f.b.NotInFeatureSet)null===a?a={start:i,end:i}:a.end===i-1?a.end=i:(n.push(a),a={start:i,end:i}),r+=1;else if(s===f.b.Unknown)break;if(r>=t)break}null!==a&&n.push(a);for(var u=n.length-1;u>=0;u--)e._candidates.splice(n[u].start,n[u].end-n[u].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}},{key:"_stat",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){o.a._featuresetFunctions.top=function(e){return new r({parentfeatureset:this,topnum:e})}}}]),r}(o.a)},1218:function(e,t,r){"use strict";r.d(t,"a",(function(){return k}));var a=r(92),n=r(4),i=r(12),s=r(89),u=r(88),l=r(90),c=r(91),o=r(172),d=r(366),f=r(441),h=r(450),p=r(358),b=r(532),y=r(214),v=r(412),_=r(936),m=r(723),g=r(325),O=r(210),k=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a;return Object(s.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",a._removeGeometry=!1,a._overrideFields=null,a._forceIsTable=!1,e.spatialReference&&(a.spatialReference=e.spatialReference),a._transparent=!0,a._maxProcessing=1e3,a._layer=e.layer,a._wset=null,!0===e.isTable&&(a._forceIsTable=!0),void 0!==e.outFields&&(a._overrideFields=e.outFields),void 0!==e.includeGeometry&&(a._removeGeometry=!1===e.includeGeometry),a}return Object(u.a)(r,[{key:"_maxQueryRate",value:function(){return p.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"loadImpl",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._layer.loaded){e.next=4;break}e.t0=(this._initialiseFeatureSet(),this),e.next=8;break;case 4:return e.next=6,this._layer.load();case 6:this._initialiseFeatureSet(),e.t0=this;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return""}},{key:"_initialiseFeatureSet",value:function(){var e,t,r,n;if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var i,s=[],u=[],l=Object(a.a)(this.fields);try{for(l.s();!(i=l.n()).done;){var c=i.value;if("oid"===c.type)s.push(c),u.push(c.name);else{var o,d=Object(a.a)(this._overrideFields);try{for(d.s();!(o=d.n()).done;){if(o.value.toLowerCase()===c.name.toLowerCase()){s.push(c),u.push(c.name);break}}}catch(y){d.e(y)}finally{d.f()}}}}catch(y){l.e(y)}finally{l.f()}this.fields=s,this._overrideFields=u}this.objectIdField=this._layer.objectIdField;var f,h=Object(a.a)(this.fields);try{for(h.s();!(f=h.n()).done;){var b=f.value;"global-id"===b.type&&(this.globalIdField=b.name)}}catch(y){h.e(y)}finally{h.f()}this._databaseType=p.a.Standardised,this.hasZ=!0===(null===(e=this._layer)||void 0===e||null===(e=e.capabilities)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.supportsZ),this.hasM=!0===(null===(t=this._layer)||void 0===t||null===(t=t.capabilities)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.supportsM),this._layer instanceof _.default?(this.typeIdField=null!==(r=this._layer.subtypeField)&&void 0!==r?r:"",this.types=this._layer.subtypes):(this.typeIdField=null!==(n=this._layer.typeIdField)&&void 0!==n?n:"",this.types=this._layer.types)}},{key:"isTable",value:function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}},{key:"_isInFeatureSet",value:function(){return p.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_changeFeature",value:function(e){var t,r={},n=Object(a.a)(this.fields);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){n.e(s)}finally{n.f()}return new o.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l,c,o,d,f=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u="",l=!1,null!==i&&(u=i.constructClause(),l=!0),!this.isTable()||!r||null===t||""===t){e.next=3;break}return e.abrupt("return",new h.a([],[],!0,null));case 3:return(c=new O.a).returnZ=this.hasZ,c.returnM=this.hasM,c.where=null===a?null===r?"1=1":"":Object(b.j)(a,p.a.Standardised),c.spatialRelationship=this._makeRelationshipEnum(t),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==u?u.split(","):null,c.geometry=null===r?null:r,c.returnGeometry=!0,c.relationParameter=this._makeRelationshipParam(t),e.next=7,this._layer.queryFeatures(c);case 7:if(null!==(o=e.sent)){e.next=10;break}return e.abrupt("return",new h.a([],[],l,null));case 10:return this._checkCancelled(s),d=[],o.features.forEach((function(e){var t=e.attributes[f._layer.objectIdField];d.push(t),f._featureCache[t]=f._changeFeature(e)})),e.abrupt("return",new h.a([],d,l,null));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_makeRelationshipEnum",value:function(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}},{key:"_queryAllFeatures",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){var t,r,a,i,s=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._wset){e.next=2;break}return e.abrupt("return",this._wset);case 2:return(t=new O.a).where="1=1",e.next=6,this._ensureLoaded();case 6:if(!this._layer.source||!this._layer.source.items){e.next=9;break}return r=[],e.abrupt("return",(this._layer.source.items.forEach((function(e){var t=e.attributes[s._layer.objectIdField];r.push(t),s._featureCache[t]=s._changeFeature(e)})),this._wset=new h.a([],r,!1,null),this._wset));case 9:return t.returnZ=this.hasZ,t.returnM=this.hasM,e.next=12,this._layer.queryFeatures(t);case 12:return a=e.sent,i=[],e.abrupt("return",(a.features.forEach((function(e){var t=e.attributes[s._layer.objectIdField];i.push(t),s._featureCache[t]=s._changeFeature(e)})),this._wset=new h.a([],i,!1,null),this._wset));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,a){var i,s;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],-1!==r&&void 0===this._featureCache[r]&&i.push(r),s=t._lastFetchedIndex;s<t._known.length&&(t._lastFetchedIndex+=1,!(void 0===this._featureCache[t._known[s]]&&(t._known[s]!==r&&i.push(t._known[s]),i.length>a)));s++);if(0!==i.length){e.next=5;break}return e.abrupt("return","success");case 5:throw new d.a(d.b.MissingFeatures);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_refineSetBlock",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return[]}},{key:"nativeCapabilities",value:function(){var e;return{title:null!==(e=this._layer.title)&&void 0!==e?e:"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}},{key:"queryAttachments",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new O.a).where=this.objectIdField+"="+t.toString(),r.returnZ=this.hasZ,r.returnM=this.hasM,e.next=4,this._layer.queryFeatures(r);case 4:return a=e.sent,e.abrupt("return",1===a.features.length?a.features[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOwningSystemUrl",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getIdentityUser",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"preferredTimeReference",get:function(){var e,t;return null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.preferredTimeReference)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null}},{key:"dateFieldsTimeReference",get:function(){var e,t;return null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.dateFieldsTimeReference)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null}},{key:"datesInUnknownTimezone",get:function(){var e;return null===(e=this._layer)||void 0===e?void 0:e.datesInUnknownTimezone}},{key:"editFieldsInfo",get:function(){var e,t;return null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.editFieldsInfo)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null}},{key:"timeInfo",get:function(){var e,t;return null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.timeInfo)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null}}],[{key:"_cloneAttr",value:function(e){var t={};for(var r in e)t[r]=e[r];return t}},{key:"create",value:function(e,t){var n,i,s,u,l,c=e.layerDefinition.objectIdField,o=null!==(n=e.layerDefinition.typeIdField)&&void 0!==n?n:"",d=[];if(e.layerDefinition.types){var f,h=Object(a.a)(e.layerDefinition.types);try{for(h.s();!(f=h.n()).done;){var p=f.value;d.push(m.a.fromJSON(p))}}catch(Z){h.e(Z)}finally{h.f()}}var b=e.layerDefinition.geometryType;void 0===b&&(b=e.featureSet.geometryType||"");var _=e.featureSet.features,O=t.toJSON();if(!c){var k,j=!1,w=Object(a.a)(e.layerDefinition.fields);try{for(w.s();!(k=w.n()).done;){var x=k.value;if("oid"===x.type||"esriFieldTypeOID"===x.type){c=x.name,j=!0;break}}}catch(Z){w.e(Z)}finally{w.f()}if(!1===j){for(var F="FID",S=!0,I=0;S;){var D,C=!0,T=Object(a.a)(e.layerDefinition.fields);try{for(T.s();!(D=T.n()).done;){if(D.value.name===F){C=!1;break}}}catch(Z){T.e(Z)}finally{T.f()}!0===C?S=!1:F="FID"+(++I).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:F,alias:F});for(var R=[],N=0;N<_.length;N++)R.push({geometry:e.featureSet.features[N].geometry,attributes:e.featureSet.features[N].attributes?this._cloneAttr(e.featureSet.features[N].attributes):{}}),R[N].attributes[F]=N;_=R,c=F}}var A,P=[],E=Object(a.a)(e.layerDefinition.fields);try{for(E.s();!(A=E.n()).done;){var L=A.value;L instanceof g.a?P.push(L):P.push(g.a.fromJSON(L))}}catch(Z){E.e(Z)}finally{E.f()}var G=b;switch(G||(G=""),G){case"esriGeometryPoint":G="point";break;case"esriGeometryPolyline":G="polyline";break;case"esriGeometryPolygon":G="polygon";break;case"esriGeometryEnvelope":G="extent";break;case"esriGeometryMultipoint":G="multipoint";break;case"":case"esriGeometryNull":G="esriGeometryNull"}if("esriGeometryNull"!==G){var q,M=Object(a.a)(_);try{for(M.s();!(q=M.n()).done;){var B=q.value;B.geometry&&B.geometry instanceof y.a==0&&(B.geometry.type=G,void 0===B.geometry.spatialReference&&(B.geometry.spatialReference=O))}}catch(Z){M.e(Z)}finally{M.f()}}else{var U,W=Object(a.a)(_);try{for(W.s();!(U=W.n()).done;){var V=U.value;V.geometry&&(V.geometry=null)}}catch(Z){W.e(Z)}finally{W.f()}}var Q={outFields:["*"],source:_,fields:P,hasZ:!0===(null===e||void 0===e||null===(i=e.layerDefinition)||void 0===i?void 0:i.hasZ)||!0===(null===e||void 0===e||null===(s=e.featureSet)||void 0===s?void 0:s.hasZ),hasM:!0===(null===e||void 0===e||null===(u=e.layerDefinition)||void 0===u?void 0:u.hasM)||!0===(null===e||void 0===e||null===(l=e.featureSet)||void 0===l?void 0:l.hasM),types:d,typeIdField:o,objectIdField:c,spatialReference:t},z="esriGeometryNull"===G||null===G;return z||(Q.geometryType=G),new r({layer:new v.default(Q),spatialReference:t,isTable:z})}}]),r}(f.a)},1544:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return o}));var a=r(4),n=r(1),i=r(12),s=r(277),u=r(129),l=r(197);function c(e,t){return null===e?t:new l.a({url:e.field("url")})}function o(e,t,r){return d.apply(this,arguments)}function d(){return d=Object(i.a)(Object(a.a)().mark((function e(t,r,i){var l,c,o,d;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===s.c||void 0===s.c?void 0:s.c.findCredential(t.restUrl)){e.next=3;break}return e.abrupt("return",null);case 3:if("loaded"!==t.loadStatus||""!==r||!t.user||!t.user.sourceJSON||!1!==i){e.next=5;break}return e.abrupt("return",t.user.sourceJSON);case 5:if(""!==r){e.next=14;break}return e.next=8,Object(u.default)(t.restUrl+"/community/self",{responseType:"json",query:Object(n.a)({f:"json"},!1===i?{}:{returnUserLicenseTypeExtensions:!0})});case 8:if(!(l=e.sent).data){e.next=13;break}if(!(c=l.data)||!c.username){e.next=13;break}return e.abrupt("return",c);case 13:case 20:return e.abrupt("return",null);case 14:return e.next=16,Object(u.default)(t.restUrl+"/community/users/"+r,{responseType:"json",query:{f:"json"}});case 16:if(!(o=e.sent).data){e.next=20;break}return d=o.data,e.abrupt("return",d.error?null:d);case 21:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}},1774:function(e,t,r){"use strict";r.r(t),r.d(t,"constructAssociationMetaDataFeatureSetFromUrl",(function(){return Fe})),r.d(t,"constructFeatureSet",(function(){return me})),r.d(t,"constructFeatureSetFromPortalItem",(function(){return Pe})),r.d(t,"constructFeatureSetFromRelationship",(function(){return Ie})),r.d(t,"constructFeatureSetFromUrl",(function(){return ve})),r.d(t,"convertToFeatureSet",(function(){return Ae})),r.d(t,"createFeatureSetCollectionFromMap",(function(){return Re})),r.d(t,"createFeatureSetCollectionFromService",(function(){return Ne})),r.d(t,"initialiseMetaDataCache",(function(){return pe}));var a=r(92),n=r(4),i=r(1),s=r(89),u=r(88),l=r(90),c=r(91),o=r(12),d=r(129),f=r(1215),h=r(357),p=r(922),b=r(172),y=r(1216),v=r(923),_=r(441),m=r(450),g=r(924),O=r(358),k=r(532),j=r(1081),w=r(366),x=r(436);var F=function(){function e(){Object(s.a)(this,e),this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}return Object(u.a)(e,[{key:"clone",value:function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t}},{key:"toStatisticsName",value:function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}],[{key:"parseStatField",value:function(t,r,a){var n=new e;n.field=t;var i=x.WhereClause.create(r,a),s=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new w.c(w.d.MissingStatisticParameters);var t=x.WhereClause.create(Object(k.k)(e.parseTree.args.value[0],O.a.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(i);if(null===s)throw new w.c(w.d.UnsupportedSqlFunction,{function:""});var u=s.name.toUpperCase().trim();if("MIN"===u){if(n.typeofstat="MIN",n.workingexpr=s.expr,null===i)throw new w.c(w.d.InvalidFunctionParameters,{function:"min"})}else if("MAX"===u){if(n.typeofstat="MAX",n.workingexpr=s.expr,null===i)throw new w.c(w.d.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===u)n.typeofstat="COUNT",n.workingexpr=s.expr;else if("STDEV"===u){if(n.typeofstat="STDDEV",n.workingexpr=s.expr,null===i)throw new w.c(w.d.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===u){if(n.typeofstat="SUM",n.workingexpr=s.expr,null===i)throw new w.c(w.d.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===u){if(n.typeofstat="AVG",n.workingexpr=s.expr,null===i)throw new w.c(w.d.InvalidFunctionParameters,{function:u})}else if("AVG"===u){if(n.typeofstat="AVG",n.workingexpr=s.expr,null===i)throw new w.c(w.d.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==u)throw new w.c(w.d.UnsupportedSqlFunction,{function:u});if(n.typeofstat="VAR",n.workingexpr=s.expr,null===i)throw new w.c(w.d.InvalidFunctionParameters,{function:"var"})}return n}}]),e}(),S=r(786),I=r(125),D=r(325),C=r(227);function T(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var R=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a;return Object(s.a)(this,r),(a=t.call(this,e))._decodedStatsfield=[],a._decodedGroupbyfield=[],a._candosimplegroupby=!0,a.phsyicalgroupbyfields=[],a.objectIdField="ROW__ID",a._internalObjectIdField="ROW__ID",a._adaptedFields=[],a.declaredClass="esri.arcade.featureset.actions.Aggregate",a._uniqueIds=1,a._maxQuery=10,a._maxProcessing=10,a._parent=e.parentfeatureset,a._config=e,a}return Object(u.a)(r,[{key:"isTable",value:function(){return!0}},{key:"_getSet",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=5;break}return e.next=3,this._getFilteredSet("",null,null,null,t);case 3:return r=e.sent,e.abrupt("return",(this._wset=r,this._wset));case 5:return e.abrupt("return",this._wset);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(){return O.b.InFeatureSet}},{key:"_nextUniqueName",value:function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t}},{key:"_convertToEsriFieldType",value:function(e){return e}},{key:"_initialiseFeatureSet",value:function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new C.a([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){for(var i=!1,s=0;s<this._config.groupbyfields.length;s++)if(this._config.groupbyfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(var u=0;u<this._config.statsfields.length;u++)if(this._config.statsfields[u].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}var l,c=Object(a.a)(this._config.statsfields);try{for(c.s();!(l=c.n()).done;){var o=l.value,d=new F;d.field=o.name,d.tofieldname=o.name,d.workingexpr=o.expression instanceof x.WhereClause?o.expression:x.WhereClause.create(o.expression,n),d.typeofstat=T(o.statistic),this._decodedStatsfield.push(d)}}catch(W){c.e(W)}finally{c.f()}this._decodedGroupbyfield=[];var f,h=Object(a.a)(this._config.groupbyfields);try{for(h.s();!(f=h.n()).done;){var p=f.value,b={name:p.name,singlefield:null,tofieldname:p.name,expression:p.expression instanceof x.WhereClause?p.expression:x.WhereClause.create(p.expression,n)};this._decodedGroupbyfield.push(b)}}catch(W){h.e(W)}finally{h.f()}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";var v,_=Object(a.a)(this._parent.fields);try{for(_.s();!(v=_.n()).done;){e[v.value.name.toUpperCase()]=1}}catch(W){_.e(W)}finally{_.f()}this.types=null}else this.geometryType=O.o.point,this.typeIdField="",this.types=null,this.spatialReference=new I.a({wkid:4326});this.fields=[];var m=new F;m.field=this._nextUniqueName(e),m.tofieldname=this.objectIdField,m.workingexpr=x.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),m.typeofstat="MIN",this._decodedStatsfield.push(m);var g,j=Object(a.a)(this._decodedGroupbyfield);try{for(j.s();!(g=j.n()).done;){var S=g.value,R=new D.a;if(S.name=this._nextUniqueName(e),R.name=S.tofieldname,R.alias=R.name,Object(k.d)(S.expression)){var N=this._parent.getField(Object(k.j)(S.expression,O.a.Standardised));if(!N)throw new w.a(w.b.AggregationFieldNotFound);S.name=N.name,S.singlefield=N.name,this.phsyicalgroupbyfields.push(N.name),R.type=N.type}else{R.type=this._convertToEsriFieldType(Object(k.g)(S.expression,this._parent.fields));var A=new D.a;A.name=S.name,A.alias=A.name,this.phsyicalgroupbyfields.push(S.name),this._adaptedFields.push(new y.d(A,S.expression)),this._candosimplegroupby=!1}this.fields.push(R)}}catch(W){j.e(W)}finally{j.f()}if(this._adaptedFields.length>0){var P,E=Object(a.a)(this._parent.fields);try{for(E.s();!(P=E.n()).done;){var L=P.value;this._adaptedFields.push(new y.c(L))}}catch(W){E.e(W)}finally{E.f()}}for(var G=0;G<this._decodedStatsfield.length;G++){var q=new D.a,M=null,B=this._decodedStatsfield[G];B.field=this._nextUniqueName(e),B.tofieldname===this.objectIdField&&(this._internalObjectIdField=B.field),q.name=B.tofieldname,q.alias=q.name;var U=null!==B.workingexpr&&Object(k.d)(B.workingexpr)?Object(k.j)(B.workingexpr,O.a.Standardised):"";switch(this._decodedStatsfield[G].typeofstat){case"SUM":if(""!==U){if(!(M=this._parent.getField(U)))throw new w.a(w.b.AggregationFieldNotFound);q.type=M.type}else q.type="double";break;case"MIN":case"MAX":if(""!==U){if(!(M=this._parent.getField(U)))throw new w.a(w.b.AggregationFieldNotFound);q.type=M.type}else q.type="double";break;case"COUNT":q.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==U&&!(M=this._parent.getField(U)))throw new w.a(w.b.AggregationFieldNotFound);q.type="double"}this.fields.push(q)}}},{key:"_canDoAggregates",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i){var s;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==r&&this._featureCache[r],s=this._maxQuery,!0!==this._checkIfNeedToExpandKnownPage(t,s)){e.next=8;break}return e.next=5,this._expandPagedSet(t,s,0,0,i);case 5:e.t0=this._getFeatures(t,r,a,i),e.next=9;break;case 8:e.t0="success";case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,i,s,u){var l,c,o,d,f,h,b,_,O,j,w,x,F;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=2;break}return e.abrupt("return",new m.a([],[],!0,null));case 2:return l=null,c={ordered:!1,nowhereclause:!1},e.next=6,this._ensureLoaded();case 6:if(null===i){e.next=15;break}o=0;case 8:if(!(o<this._decodedStatsfield.length)){e.next=15;break}if(!0!==Object(k.i)(i,this._decodedStatsfield[o].tofieldname)){e.next=12;break}return c.nowhereclause=!0,i=null,e.abrupt("break",15);case 12:o++,e.next=8;break;case 15:if(null===s){e.next=44;break}c.ordered=!0,d=0;case 18:if(!(d<this._decodedStatsfield.length)){e.next=25;break}if(!0!==s.scanForField(this._decodedStatsfield[d].tofieldname)){e.next=22;break}return s=null,c.ordered=!1,e.abrupt("break",25);case 22:d++,e.next=18;break;case 25:if(null===s){e.next=44;break}f=Object(a.a)(this._decodedGroupbyfield),e.prev=27,f.s();case 29:if((h=f.n()).done){e.next=36;break}if(null!==(b=h.value).singlefield||!0!==s.scanForField(b.tofieldname)){e.next=34;break}return s=null,c.ordered=!1,e.abrupt("break",36);case 34:e.next=29;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(27),f.e(e.t0);case 41:return e.prev=41,f.f(),e.finish(41);case 44:if(e.t1=!1!==this._candosimplegroupby,!e.t1){e.next=49;break}return e.next=48,this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null);case 48:e.t1=e.sent;case 49:if(!e.t1){e.next=58;break}return _=null,i&&(_=this._reformulateWhereClauseWithoutGroupByFields(i)),O=null,s&&(O=this._reformulateOrderClauseWithoutGroupByFields(s)),e.next=56,this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,_,O,this._internalObjectIdField);case 56:return j=e.sent,e.abrupt("return",(this._checkCancelled(u),l=!0===c.nowhereclause?new m.a(j._candidates.slice(0).concat(j._known.slice(0)),[],!0===c.ordered&&j._ordered,this._clonePageDefinition(j.pagesDefinition)):new m.a(j._candidates.slice(0),j._known.slice(0),!0===c.ordered&&j._ordered,this._clonePageDefinition(j.pagesDefinition))));case 58:return w=this._parent,this._adaptedFields.length>0&&(w=new y.a({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===c.nowhereclause?l=new m.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new v.a({parentfeatureset:w,orderbyclause:new g.a(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}}):(x=w,null!==i&&(F=null,i&&(F=this._reformulateWhereClauseWithoutGroupByFields(i)),x=new p.a({parentfeatureset:x,whereclause:F})),l=new m.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new v.a({parentfeatureset:x,orderbyclause:new g.a(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})),e.abrupt("return",l);case 61:case"end":return e.stop()}}),e,this,[[27,38,41,44]])})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_reformulateWhereClauseWithoutStatsFields",value:function(e){var t,r=Object(a.a)(this._decodedStatsfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;e=Object(k.h)(e,n.tofieldname,Object(k.j)(n.workingexpr,O.a.Standardised),this._parent.getFieldsIndex())}}catch(i){r.e(i)}finally{r.f()}return e}},{key:"_reformulateWhereClauseWithoutGroupByFields",value:function(e){var t,r=Object(a.a)(this._decodedGroupbyfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.tofieldname!==n.name&&(e=Object(k.h)(e,n.tofieldname,Object(k.j)(n.expression,O.a.Standardised),this._parent.getFieldsIndex()))}}catch(i){r.e(i)}finally{r.f()}return e}},{key:"_reformulateOrderClauseWithoutGroupByFields",value:function(e){var t,r=[],n=Object(a.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.tofieldname!==i.name&&r.push({field:i.tofieldname,newfield:i.name})}}catch(s){n.e(s)}finally{n.f()}return r.length>0?e.replaceFields(r):e}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}},{key:"_refineSetBlock",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._checkIfNeedToExpandCandidatePage(t,this._maxQuery)){e.next=4;break}return e.next=3,this._expandPagedSet(t,this._maxQuery,0,0,a);case 3:return e.abrupt("return",this._refineSetBlock(t,r,a));case 4:return this._checkCancelled(a),t._candidates.length,this._refineKnowns(t,r),t._candidates.length,e.abrupt("return",(t._candidates.length,t));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,a,n){return this._expandPagedSetFeatureSet(e,t,r,a,n)}},{key:"_getPhysicalPage",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,i){var s,u,l,c,o,d,f,h,p,y,v,_,m;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==t.pagesDefinition.aggregatefeaturesetpagedefinition){e.next=2;break}return e.abrupt("return",this._sequentialGetPhysicalItem(t,t.pagesDefinition.resultRecordCount,i,[]));case 2:return e.next=4,this._getAgregagtePhysicalPage(t,r,i);case 4:s=e.sent,u=Object(a.a)(s);try{for(u.s();!(l=u.n()).done;){for(f in c=l.value,o={geometry:c.geometry,attributes:{}},d={},c.attributes)d[f.toLowerCase()]=c.attributes[f];h=Object(a.a)(this._decodedGroupbyfield);try{for(h.s();!(p=h.n()).done;)y=p.value,o.attributes[y.tofieldname]=d[y.name.toLowerCase()]}catch(n){h.e(n)}finally{h.f()}v=Object(a.a)(this._decodedStatsfield);try{for(v.s();!(_=v.n()).done;)m=_.value,o.attributes[m.tofieldname]=d[m.field.toLowerCase()]}catch(n){v.e(n)}finally{v.f()}this._featureCache[o.attributes[this.objectIdField]]=new b.a(o)}}catch(n){u.e(n)}finally{u.f()}return e.abrupt("return",s.length);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_sequentialGetPhysicalItem",value:function(e,t,r,a){var n=this;return new Promise((function(i,s){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(a.length):n._nextAggregateItem(e,t,r,a,(function(s){null===s?i(a.length):(t-=1,i(n._sequentialGetPhysicalItem(e,t,r,a)))}),s)}))}},{key:"_nextAggregateItem",value:function(e,t,r,a,n,i){var s=this;try{Object(h.a)(e.pagesDefinition.internal.iterator.next()).then((function(u){if(null===u)if(null!==e.pagesDefinition.internal.workingItem){var l=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);a.push(l),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(l.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,n(null)}else e.pagesDefinition.internal.fullyResolved=!0,n(null);else{var c=s._generateAggregateHash(u);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[u],id:c};else{if(c!==e.pagesDefinition.internal.workingItem.id){var o=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return a.push(o),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(o.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[u],id:c},void n(o)}e.pagesDefinition.internal.workingItem.features.push(u)}s._nextAggregateItem(e,t,r,a,n,i)}}),i)}catch(u){i(u)}}},{key:"_calculateFieldStat",value:function(e,t,r){for(var a=[],n=0;n<e.features.length;n++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[n]);null!==i&&a.push(i)}else a.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=Object(j.a)("min",a,-1);break;case"MAX":r.attributes[t.tofieldname]=Object(j.a)("max",a,-1);break;case"SUM":r.attributes[t.tofieldname]=Object(j.a)("sum",a,-1);break;case"COUNT":r.attributes[t.tofieldname]=a.length;break;case"VAR":r.attributes[t.tofieldname]=Object(j.a)("var",a,-1);break;case"STDDEV":r.attributes[t.tofieldname]=Object(j.a)("stddev",a,-1);break;case"AVG":r.attributes[t.tofieldname]=Object(j.a)("avg",a,-1)}return!0}},{key:"_calculateAndAppendAggregateItem",value:function(e){var t,r={attributes:{},geometry:null},n=Object(a.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=i.singlefield?e.features[0].attributes[i.singlefield]:i.expression.calculateValue(e.features[0]);r.attributes[i.tofieldname]=s}}catch(f){n.e(f)}finally{n.f()}var u,l=Object(a.a)(this._decodedStatsfield);try{for(l.s();!(u=l.n()).done;){var c=u.value;this._calculateFieldStat(e,c,r)}}catch(f){l.e(f)}finally{l.f()}for(var o=[],d=0;d<this._decodedStatsfield.length;d++)o.push(this._calculateFieldStat(e,this._decodedStatsfield[d],r));return this._featureCache[r.attributes[this.objectIdField]]=new b.a({attributes:r.attributes,geometry:r.geometry}),r}},{key:"_generateAggregateHash",value:function(e){var t,r="",n=Object(a.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=i.singlefield?e.attributes[i.singlefield]:i.expression.calculateValue(e);r+=null==s?":":":"+s.toString()}}catch(u){n.e(u)}finally{n.f()}return Object(S.a)(r,S.b.String)}},{key:"_stat",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){_.a._featuresetFunctions.groupby=function(e,t){return new r({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}]),r}(_.a),N=r(1546),A=r(1217),P=r(1317),E=r(277),L=r(122),G=r(412),q=r(101),M=r(93),B=r(110),U=r(538),W=r(555),V=r(572),Q=r(1114),z=r(235),Z=r(210);function J(e,t,r,a){return K.apply(this,arguments)}function K(){return(K=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=$,e.t1=r,e.next=4,X(t,r,a,i);case 4:return e.t2=e.sent,e.t3=a,e.t4=i,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,r,a){return H.apply(this,arguments)}function H(){return(H=Object(o.a)(Object(n.a)().mark((function e(t,r,a,s){var u,l,c,o,d,f,h;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=Object(i.a)({},s),c=te(r,a),o=null!=(null===(u=r.outStatistics)||void 0===u?void 0:u[0]),d=Object(M.a)("featurelayer-pbf-statistics"),f=!o||d,"pbf"!==(null===a||void 0===a?void 0:a.format)||!f){e.next=13;break}return e.prev=2,e.next=5,Object(Q.a)(t,c,l);case 5:h=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),"query:parsing-pbf"===e.t0.name){e.next=12;break}throw e.t0;case 12:a.format="json";case 13:if(e.t1="json"!==(null===a||void 0===a?void 0:a.format)&&f,e.t1){e.next=18;break}return e.next=17,Object(V.b)(t,c,l);case 17:h=e.sent;case 18:return Y(null===a||void 0===a?void 0:a.fieldsIndex,h.fields),e.abrupt("return",h);case 20:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Y(e,t){if(null!=e&&null!=t){var r,n=Object(a.a)(t);try{for(n.s();!(r=n.n()).done;){var i=r.value,s=e.get(i.name);s&&Object.assign(i,s.toJSON())}}catch(u){n.e(u)}finally{n.f()}}}function $(e,t,r,a){return ee.apply(this,arguments)}function ee(){return(ee=Object(o.a)(Object(n.a)().mark((function e(t,a,i,s){var u,l,c;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=null===i||void 0===i?void 0:i.infoFor3D,re(t,u)&&null!=u&&a.assetMaps&&a.features&&a.features.length){e.next=3;break}return e.abrupt("return",z.a.fromJSON(a));case 3:return e.next=5,Object(B.r)(Promise.all([r.e(11),r.e(46)]).then(r.bind(null,2254)),s);case 5:return l=e.sent,c=l.meshFeatureSetFromJSON,e.abrupt("return",c(t,u,a));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t){var r,n,i=Z.a.from(e);i.sourceSpatialReference=null!==(r=null!==(n=i.sourceSpatialReference)&&void 0!==n?n:null===t||void 0===t?void 0:t.sourceSpatialReference)&&void 0!==r?r:null,((null===t||void 0===t?void 0:t.gdbVersion)||(null===t||void 0===t?void 0:t.dynamicDataSource))&&((i=i===e?i.clone():i).gdbVersion=e.gdbVersion||t.gdbVersion,i.dynamicDataSource=e.dynamicDataSource?W.a.from(e.dynamicDataSource):t.dynamicDataSource);var s=null===t||void 0===t?void 0:t.infoFor3D;if(null!=s&&re(e,s)){var u,l;(i=i===e?i.clone():i).formatOf3DObjects=null;var c,o=s.supportedFormats,d=s.queryFormats,f=null!==(u=Object(U.d)("model/gltf-binary",o))&&void 0!==u?u:Object(U.b)("glb",o),h=null!==(l=Object(U.d)("model/gltf+json",o))&&void 0!==l?l:Object(U.b)("gtlf",o),p=Object(a.a)(d);try{for(p.s();!(c=p.n()).done;){var b=c.value;if(b===f){i.formatOf3DObjects=b;break}b!==h||i.formatOf3DObjects||(i.formatOf3DObjects=b)}}catch(C){p.e(C)}finally{p.f()}if(!i.formatOf3DObjects)throw new q.a("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==i.outFields||!i.outFields.includes("*")){null==(i=i===e?i.clone():i).outFields&&(i.outFields=[]);var y=s.transformFieldRoles,v=y.originX,_=y.originY,m=y.originZ,g=y.translationX,O=y.translationY,k=y.translationZ,j=y.scaleX,w=y.scaleY,x=y.scaleZ,F=y.rotationX,S=y.rotationY,I=y.rotationZ,D=y.rotationDeg;i.outFields.push(v,_,m,g,O,k,j,w,x,F,S,I,D)}}return i}function re(e,t){return null!=t&&!0===e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}r(187),r(98),r(128),r(649),r(672);var ae=r(819),ne=(r(119),r(217),r(457),r(194),r(132),r(820)),ie=(r(168),r(593)),se=(r(613),r(889)),ue=r(469),le=r(936),ce=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a;return Object(s.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",a._removeGeometry=!1,a._overrideFields=null,a.formulaCredential=null,a._pageJustIds=!1,a._requestStandardised=!1,a._useDefinitionExpression=!0,a._cachedDateMetaData={},e.spatialReference&&(a.spatialReference=e.spatialReference),a._transparent=!0,a._maxProcessing=1e3,a._layer=e.layer,a._wset=null,void 0!==e.outFields&&(a._overrideFields=e.outFields),void 0!==e.includeGeometry&&(a._removeGeometry=!1===e.includeGeometry),a}return Object(u.a)(r,[{key:"_maxQueryRate",value:function(){return O.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(e){this._pageJustIds=e}},{key:"urlQueryPath",get:function(){return this._layer.parsedUrl.path||""}},{key:"convertQueryToLruCacheKey",value:function(e){var t=this.urlQueryPath+","+Object(O.r)(e.toJSON());return Object(S.a)(t,S.b.String)}},{key:"loadImpl",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._layer.loaded){e.next=4;break}e.t0=(this._initialiseFeatureSet(),this),e.next=8;break;case 4:return e.next=6,this._layer.load();case 6:this._initialiseFeatureSet(),e.t0=this;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initialiseFeatureSet",value:function(){var e,t,r,n;if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===(null===(e=this._layer)||void 0===e||null===(e=e.capabilities)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.supportsZ),this.hasM=!0===(null===(t=this._layer)||void 0===t||null===(t=t.capabilities)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.supportsM),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var i,s=[],u=[],l=Object(a.a)(this.fields);try{for(l.s();!(i=l.n()).done;){var c=i.value;if("oid"===c.type)s.push(c),u.push(c.name);else{var o,d=Object(a.a)(this._overrideFields);try{for(d.s();!(o=d.n()).done;){if(o.value.toLowerCase()===c.name.toLowerCase()){s.push(c),u.push(c.name);break}}}catch(y){d.e(y)}finally{d.f()}}}}catch(y){l.e(y)}finally{l.f()}this.fields=s,this._overrideFields=u}if(this._layer.source&&this._layer.source.sourceJSON){var f=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=O.a.StandardisedNoInterval,null!=f&&f>=10.61&&(this._databaseType=O.a.Standardised)):null!=f&&(f>=10.5&&(this._databaseType=O.a.StandardisedNoInterval,this._requestStandardised=!0),f>=10.61&&(this._databaseType=O.a.Standardised))}this.objectIdField=this._layer.objectIdField;var h,p=Object(a.a)(this.fields);try{for(p.s();!(h=p.n()).done;){var b=h.value;"global-id"===b.type&&(this.globalIdField=b.name)}}catch(y){p.e(y)}finally{p.f()}this._layer instanceof le.default?(this.typeIdField=null!==(r=this._layer.subtypeField)&&void 0!==r?r:"",this.types=this._layer.subtypes):(this.typeIdField=null!==(n=this._layer.typeIdField)&&void 0!==n?n:"",this.types=this._layer.types)}},{key:"_isInFeatureSet",value:function(){return O.b.InFeatureSet}},{key:"_refineSetBlock",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_runDatabaseProbe",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return r=new Z.a,this.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r.where=t.replace("OBJECTID",this._layer.objectIdField),e.prev=4,e.next=7,this._layer.queryObjectIds(r);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_canUsePagination",value:function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return this._layer.url}},{key:"pbfSupportedForQuery",value:function(e){var t,r=null===(t=this._layer)||void 0===t||null===(t=t.capabilities)||void 0===t?void 0:t.query;return!e.outStatistics&&!0===(null===r||void 0===r?void 0:r.supportsFormatPBF)&&!0===(null===r||void 0===r?void 0:r.supportsQuantizationEditMode)}},{key:"queryPBF",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.quantizationParameters={mode:"edit"},e.next=3,J(this._layer.parsedUrl,t,{format:"pbf"},{});case 3:return e.abrupt("return",e.sent.unquantize());case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}},{key:"nativeCapabilities",value:function(){var e;return{title:null!==(e=this._layer.title)&&void 0!==e?e:"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}},{key:"executeQuery",value:function(e,t){var r=this;e.returnZ=this.hasZ,e.returnM=this.hasM;var a="execute"===t?V.a:"executeForCount"===t?ae.a:ne.a,n="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==n?a(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,i),i=i.catch((function(e){var t;throw null!==(t=r.recentlyUsedQueries)&&void 0!==t&&t.removeFromCache(s),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===i&&(i=!0!==n?a(this._layer.parsedUrl.path,e):this.queryPBF(e)),i}},{key:"_getFilteredSet",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l,c,o,d;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(u=e.sent,!this.isTable()||!r||null===t||""===t){e.next=5;break}return e.abrupt("return",new m.a([],[],!0,null));case 5:if(!this._canUsePagination()){e.next=7;break}return e.abrupt("return",this._getFilteredSetUsingPaging(t,r,a,i,s));case 7:return l="",c=!1,null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(l=i.constructClause(),c=!0),o=new Z.a,this.datesInUnknownTimezone&&(o.timeReferenceUnknownClient=!0),o.where=null===a?null===r?"1=1":"":Object(k.j)(a,u),this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=this._makeRelationshipEnum(t),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==l?l.split(","):null,o.geometry=null===r?null:r,o.relationParameter=this._makeRelationshipParam(t),e.next=13,this.executeQuery(o,"executeForIds");case 13:return null===(d=e.sent)&&(d=[]),this._checkCancelled(s),e.abrupt("return",new m.a([],d,c,null));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,a,n){return this._expandPagedSetFeatureSet(e,t,r,a,n)}},{key:"_getFilteredSetUsingPaging",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l,c,o,d,f,h,p,b,y,v;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l="",c=!1,null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(l=i.constructClause(),c=!0),e.next=4,this.databaseType();case 4:return o=e.sent,d=null===a?null===r?"1=1":"":Object(k.j)(a,o),this._layer.definitionExpression&&this._useDefinitionExpression&&(d=""!==d?"(("+this._layer.definitionExpression+") AND ("+d+"))":this._layer.definitionExpression),f=this._maxQueryRate(),null!=(h=null===(u=this._layer.capabilities)||void 0===u?void 0:u.query.maxRecordCount)&&h<f&&(f=h),p=null,!0===this._pageJustIds?p=new m.a([],["GETPAGES"],c,{spatialRel:this._makeRelationshipEnum(t),relationParam:this._makeRelationshipParam(t),outFields:this._layer.objectIdField,resultRecordCount:f,resultOffset:0,geometry:null===r?null:r,where:d,orderByFields:l,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}):(y=!0,!0===this._removeGeometry&&(y=!1),v=null!==(b=this._overrideFields)&&void 0!==b?b:this._fieldsIncludingObjectId(["*"]),p=new m.a([],["GETPAGES"],c,{spatialRel:this._makeRelationshipEnum(t),relationParam:this._makeRelationshipParam(t),outFields:v.join(","),resultRecordCount:f,resultOffset:0,geometry:null===r?null:r,where:d,orderByFields:l,returnGeometry:y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})),e.next=14,this._expandPagedSet(p,f,0,1,s);case 14:return e.abrupt("return",p);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a){var i,s,u,l,c,o,d,f;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.pagesDefinition.internal.lastRetrieved,s=i,u=t.pagesDefinition.internal.lastPage,l=new Z.a,this._requestStandardised&&(l.sqlFormat="standard"),this.datesInUnknownTimezone&&(l.timeReferenceUnknownClient=!0),l.spatialRelationship=t.pagesDefinition.spatialRel,l.relationParameter=t.pagesDefinition.relationParam,l.outFields=t.pagesDefinition.outFields.split(","),l.num=t.pagesDefinition.resultRecordCount,l.start=t.pagesDefinition.internal.lastPage,l.geometry=t.pagesDefinition.geometry,l.where=t.pagesDefinition.where,l.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=t.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference,e.next=4,this.executeQuery(l,"execute");case 4:if(c=e.sent,this._checkCancelled(a),t.pagesDefinition.internal.lastPage===u){e.next=7;break}return e.abrupt("return","done");case 7:for(o=this._layer.objectIdField,d=0;d<c.features.length;d++)t.pagesDefinition.internal.set[s+d]=c.features[d].attributes[o];if(!1===this._pageJustIds)for(f=0;f<c.features.length;f++)this._featureCache[c.features[f].attributes[o]]=c.features[f];return e.abrupt("return",((void 0===c.exceededTransferLimit&&c.features.length!==t.pagesDefinition.resultRecordCount||!1===c.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=i+c.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,"done"));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.includes("*"))return t;var r,n=!1,i=Object(a.a)(t);try{for(i.s();!(r=i.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(s){i.e(s)}finally{i.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFeatures",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i){var s,u,l,c,o,d,f,h,p,b,y;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=[],-1!==r&&void 0===this._featureCache[r]&&u.push(r),!0!==this._checkIfNeedToExpandKnownPage(t,this._maxProcessingRate())){e.next=5;break}return e.next=4,this._expandPagedSet(t,this._maxProcessingRate(),0,0,i);case 4:return e.abrupt("return",this._getFeatures(t,r,a,i));case 5:l=0,c=t._lastFetchedIndex;case 7:if(!(c<t._known.length)){e.next=18;break}if(t._lastFetchedIndex+=1,l++,void 0!==this._featureCache[t._known[c]]){e.next=13;break}if(o=!1,null!==this._layer._mode&&void 0!==this._layer._mode&&void 0!==(d=this._layer._mode)._featureMap[t._known[c]]&&null!==(f=d._featureMap[t._known[c]])&&(o=!0,this._featureCache[t._known[c]]=f),!(!1===o&&(t._known[c]!==r&&u.push(t._known[c]),u.length>=this._maxProcessingRate()-1))){e.next=13;break}return e.abrupt("break",18);case 13:if(!(l>=a&&0===u.length)){e.next=15;break}return e.abrupt("break",18);case 15:c++,e.next=7;break;case 18:if(0!==u.length){e.next=20;break}return e.abrupt("return","success");case 20:return h=new Z.a,this._requestStandardised&&(h.sqlFormat="standard"),this.datesInUnknownTimezone&&(h.timeReferenceUnknownClient=!0),h.objectIds=u,h.outFields=null!==(s=this._overrideFields)&&void 0!==s?s:this._fieldsIncludingObjectId(["*"]),h.returnGeometry=!0,!0===this._removeGeometry&&(h.returnGeometry=!1),h.outSpatialReference=this.spatialReference,e.next=24,this.executeQuery(h,"execute");case 24:if(p=e.sent,this._checkCancelled(i),void 0===p.error){e.next=27;break}throw new w.a(w.b.RequestFailed,{reason:p.error});case 27:for(b=this._layer.objectIdField,y=0;y<p.features.length;y++)this._featureCache[p.features[y].attributes[b]]=p.features[y];return e.abrupt("return","success");case 30:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_getDistinctPages",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s,u,l,c,o){var d,f,h,p,b,y,v,_,m,g,O,j,x;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this.databaseType();case 4:h=e.sent,p=a.parseTree.column,b=null!==(d=this._layer.fields)&&void 0!==d?d:[],y=0;case 8:if(!(y<b.length)){e.next=15;break}if(b[y].name.toLowerCase()!==p.toLowerCase()){e.next=12;break}return p=b[y].name,e.abrupt("break",15);case 12:y++,e.next=8;break;case 15:return v=new Z.a,this._requestStandardised&&(v.sqlFormat="standard"),this.datesInUnknownTimezone&&(v.timeReferenceUnknownClient=!0),_=null===u?null===s?"1=1":"":Object(k.j)(u,h),this._layer.definitionExpression&&this._useDefinitionExpression&&(_=""!==_?"(("+this._layer.definitionExpression+") AND ("+_+"))":this._layer.definitionExpression),v.where=_,v.spatialRelationship=this._makeRelationshipEnum(i),v.relationParameter=this._makeRelationshipParam(i),v.geometry=null===s?null:s,v.returnDistinctValues=!0,v.returnGeometry=!1,v.outFields=[p],e.next=21,this.executeQuery(v,"execute");case 21:if(m=e.sent,this._checkCancelled(o),m.hasOwnProperty("features")){e.next=24;break}throw new w.a(w.b.InvalidStatResponse);case 24:g=!1,O=0;case 26:if(!(O<b.length)){e.next=33;break}if(b[O].name!==p){e.next=30;break}return"date"===b[O].type&&(g=!0),e.abrupt("break",33);case 30:O++,e.next=26;break;case 33:j=0;case 34:if(!(j<m.features.length)){e.next=41;break}if(g?null!==(x=m.features[j].attributes[p])?c.push(new Date(x)):c.push(x):c.push(m.features[j].attributes[p]),!(c.length>=l)){e.next=38;break}return e.abrupt("break",41);case 38:j++,e.next=34;break;case 41:if(0!==m.features.length){e.next=43;break}return e.abrupt("return",c);case 43:if(!(m.features.length===(null===(f=this._layer.capabilities)||void 0===f?void 0:f.query.maxRecordCount)&&c.length<l)){e.next=49;break}return e.t0=!0,e.next=47,this._getDistinctPages(t+m.features.length,r,a,i,s,u,l,c,o);case 47:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 49:return e.abrupt("return",c);case 50:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u,l,c){return e.apply(this,arguments)}}()},{key:"_distinctStat",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s,u,l){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=!0,e.next=3,this._getDistinctPages(0,t,r,a,i,s,u,[],l);case 3:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"isTable",value:function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}},{key:"_countstat",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i){var s,u,l;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(s=e.sent,u=new Z.a,this._requestStandardised&&(u.sqlFormat="standard"),!this.isTable()||!a||null===r||""===r){e.next=6;break}return e.abrupt("return",{calculated:!0,result:0});case 6:return l=null===i?null===a?"1=1":"":Object(k.j)(i,s),this._layer.definitionExpression&&this._useDefinitionExpression&&(l=""!==l?"(("+this._layer.definitionExpression+") AND ("+l+"))":this._layer.definitionExpression),u.where=l,this.datesInUnknownTimezone&&(u.timeReferenceUnknownClient=!0),u.where=l,u.spatialRelationship=this._makeRelationshipEnum(r),u.relationParameter=this._makeRelationshipParam(r),u.geometry=null===a?null:a,u.returnGeometry=!1,e.t0=!0,e.next=11,this.executeQuery(u,"executeForCount");case 11:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 13:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_stats",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s,u,l){var c,o,d,f,h,p,b,y,v,_,m,g,O,x;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:if(o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,d=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,f=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct,"count"!==t){e.next=5;break}return e.abrupt("return",f?this._countstat(t,a,i,s):{calculated:!1});case 5:if(!1!==d&&(!1!==Object(k.d)(r)||!1!==o)&&!1!==r.isStandardized){e.next=7;break}return e.abrupt("return",""!==a||null!==s?{calculated:!1}:this._manualStat(t,r,u,l));case 7:if("distinct"!==t){e.next=9;break}return e.abrupt("return",!1===f?""!==a||null!==s?{calculated:!1}:this._manualStat(t,r,u,l):this._distinctStat(t,r,a,i,s,u,l));case 9:return e.next=11,this.databaseType();case 11:if(h=e.sent,!this.isTable()||!i||null===a||""===a){e.next=14;break}return e.abrupt("return",{calculated:!0,result:null});case 14:return p=new Z.a,this._requestStandardised&&(p.sqlFormat="standard"),b=null===s?null===i?"1=1":"":Object(k.j)(s,h),this._layer.definitionExpression&&this._useDefinitionExpression&&(b=""!==b?"(("+this._layer.definitionExpression+") AND ("+b+"))":this._layer.definitionExpression),p.where=b,p.spatialRelationship=this._makeRelationshipEnum(a),p.relationParameter=this._makeRelationshipParam(a),p.geometry=null===i?null:i,this.datesInUnknownTimezone&&(p.timeReferenceUnknownClient=!0),(y=new se.a).statisticType=Object(j.c)(t),y.onStatisticField=Object(k.j)(r,h),y.outStatisticFieldName="ARCADE_STAT_RESULT",p.returnGeometry=!1,v="ARCADE_STAT_RESULT",p.outStatistics=[y],e.next=24,this.executeQuery(p,"execute");case 24:if((_=e.sent).hasOwnProperty("features")&&0!==_.features.length){e.next=27;break}throw new w.a(w.b.InvalidStatResponse);case 27:m=!1,g=null!==(c=_.fields)&&void 0!==c?c:[],O=0;case 30:if(!(O<g.length)){e.next=37;break}if("ARCADE_STAT_RESULT"!==g[O].name.toUpperCase()){e.next=34;break}return v=g[O].name,"date"===g[O].type&&(m=!0),e.abrupt("break",37);case 34:O++,e.next=30;break;case 37:if(!m){e.next=40;break}return x=_.features[0].attributes[v],e.abrupt("return",(null!==x&&(x=new Date(_.features[0].attributes[v])),{calculated:!0,result:x}));case 40:return e.abrupt("return",{calculated:!0,result:_.features[0].attributes[v]});case 41:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_stat",value:function(e,t,r,a,n,i,s){return this._stats(e,t,r,a,n,i,s)}},{key:"_canDoAggregates",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r){var a,i,s,u,l,c;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:if(i=!1,s=null===(a=this._layer.capabilities)||void 0===a?void 0:a.query,u=!0===(null===s||void 0===s?void 0:s.supportsSqlExpression),null!=s&&!0===s.supportsStatistics&&!0===s.supportsOrderBy&&(i=!0),i)for(l=0;l<r.length-1;l++)(!1===(null===(c=r[l].workingexpr)||void 0===c?void 0:c.isStandardized)||!1===Object(k.d)(r[l].workingexpr)&&!1===u)&&(i=!1);return e.abrupt("return",!1!==i);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_makeRelationshipEnum",value:function(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s,u,l){var c,o,d,f,h,p,b,y,v,_,g;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this.databaseType();case 4:for(o=e.sent,d="",f=!1,h=!1,null!==u&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(d=u.constructClause(),h=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(h=!1,f=!0,d=this._layer.objectIdField),p=[],b=0;b<r.length;b++)(y=new se.a).onStatisticField=null!==r[b].workingexpr?Object(k.j)(r[b].workingexpr,o):"",y.outStatisticFieldName=r[b].field,y.statisticType=r[b].toStatisticsName(),p.push(y);return""===d&&(d=t.join(",")),v=this._maxQueryRate(),null!=(_=null===(c=this._layer.capabilities)||void 0===c?void 0:c.query.maxRecordCount)&&_<v&&(v=_),g=null===s?null===i?"1=1":"":Object(k.j)(s,o),this._layer.definitionExpression&&this._useDefinitionExpression&&(g=""!==g?"(("+this._layer.definitionExpression+") AND ("+g+"))":this._layer.definitionExpression),e.abrupt("return",new m.a([],["GETPAGES"],h,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(a),relationParam:this._makeRelationshipParam(a),outFields:["*"],useOIDpagination:f,generatedOid:l,resultRecordCount:v,resultOffset:0,groupByFieldsForStatistics:t,outStatistics:p,geometry:null===i?null:i,where:g,orderByFields:d,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_getAgregagtePhysicalPage",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a){var i,s,u,l,c,o,d,f,h;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.pagesDefinition.where,!0===t.pagesDefinition.useOIDpagination&&(i=""!==i?"("+i+") AND ("+t.pagesDefinition.generatedOid+">"+t.pagesDefinition.internal.lastMaxId.toString()+")":t.pagesDefinition.generatedOid+">"+t.pagesDefinition.internal.lastMaxId.toString()),s=t.pagesDefinition.internal.lastRetrieved,u=s,l=t.pagesDefinition.internal.lastPage,c=new Z.a,this._requestStandardised&&(c.sqlFormat="standard"),c.where=i,c.spatialRelationship=t.pagesDefinition.spatialRel,c.relationParameter=t.pagesDefinition.relationParam,c.outFields=t.pagesDefinition.outFields,c.outStatistics=t.pagesDefinition.outStatistics,c.geometry=t.pagesDefinition.geometry,c.groupByFieldsForStatistics=t.pagesDefinition.groupByFieldsForStatistics,c.num=t.pagesDefinition.resultRecordCount,c.start=t.pagesDefinition.internal.lastPage,c.returnGeometry=t.pagesDefinition.returnGeometry,this.datesInUnknownTimezone&&(c.timeReferenceUnknownClient=!0),c.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,!(this.isTable()&&c.geometry&&c.spatialRelationship)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.executeQuery(c,"execute");case 7:if(o=e.sent,this._checkCancelled(a),o.hasOwnProperty("features")){e.next=10;break}throw new w.a(w.b.InvalidStatResponse);case 10:if(d=[],t.pagesDefinition.internal.lastPage===l){e.next=13;break}return e.abrupt("return",[]);case 13:for(o.features.length>0&&void 0===o.features[0].attributes[t.pagesDefinition.generatedOid]&&(t.pagesDefinition.generatedOid=t.pagesDefinition.generatedOid.toLowerCase()),f=0;f<o.features.length;f++)t.pagesDefinition.internal.set[u+f]=o.features[f].attributes[t.pagesDefinition.generatedOid];for(h=0;h<o.features.length;h++)d.push(new b.a({attributes:o.features[h].attributes,geometry:null}));return e.abrupt("return",(!0===t.pagesDefinition.useOIDpagination?0===o.features.length?t.pagesDefinition.internal.fullyResolved=!0:t.pagesDefinition.internal.lastMaxId=o.features[o.features.length-1].attributes[t.pagesDefinition.generatedOid]:(void 0===o.exceededTransferLimit&&o.features.length!==t.pagesDefinition.resultRecordCount||!1===o.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=s+o.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,d));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}},{key:"serviceUrl",value:function(){return Object(O.i)(this._layer.parsedUrl.path)}},{key:"queryAttachments",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l,c,o,d=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(u=this._layer.capabilities)||void 0===u||!u.data.supportsAttachment||null===u||void 0===u||!u.operations.supportsQueryAttachments){e.next=9;break}return l={objectIds:[t],returnMetadata:s},(r&&r>0||a&&a>0)&&(l.size=[r&&r>0?r:0,a&&a>0?a:r+1]),i&&i.length>0&&(l.attachmentTypes=i),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:l,method:"attachments"}),e.next=6,this._layer.queryAttachments(l);case 6:return c=e.sent,o=[],e.abrupt("return",(c&&c[t]&&c[t].forEach((function(e){var r,a=d._layer.parsedUrl.path+"/"+t.toString()+"/attachments/"+e.id.toString(),n=null;s&&e.exifInfo&&(n=ue.a.convertJsonToArcade(e.exifInfo,"system",!0)),o.push(new P.a(e.id,e.name,e.contentType,e.size,a,n,null!==(r=e.keywords)&&void 0!==r?r:null))})),o));case 9:return e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"queryRelatedFeatures",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r,i,s,u,l,c,o,f,h,p,y,v,_,m,g;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={f:"json",relationshipId:t.relationshipId.toString(),definitionExpression:t.where,outFields:null===(r=t.outFields)||void 0===r?void 0:r.join(","),returnGeometry:t.returnGeometry.toString()},void 0!==t.resultOffset&&null!==t.resultOffset&&(i.resultOffset=t.resultOffset.toString()),void 0!==t.resultRecordCount&&null!==t.resultRecordCount&&(i.resultRecordCount=t.resultRecordCount.toString()),t.orderByFields&&(i.orderByFields=t.orderByFields.join(",")),t.objectIds&&t.objectIds.length>0&&(i.objectIds=t.objectIds.join(",")),t.outSpatialReference&&(i.outSR=JSON.stringify(t.outSpatialReference.toJSON())),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:i,method:"relatedrecords",url:this._layer.parsedUrl.path+"/queryRelatedRecords"}),e.next=4,Object(d.default)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:i});case 4:if(!(s=e.sent).data){e.next=9;break}if(u={},(l=s.data)&&l.relatedRecordGroups){c=l.spatialReference,o=Object(a.a)(l.relatedRecordGroups);try{for(o.s();!(f=o.n()).done;){h=f.value,p=h.objectId,y=[],v=Object(a.a)(h.relatedRecords);try{for(v.s();!(_=v.n()).done;)(m=_.value).geometry&&(m.geometry.spatialReference=c),g=new b.a({geometry:m.geometry?Object(L.a)(m.geometry):null,attributes:m.attributes}),y.push(g)}catch(n){v.e(n)}finally{v.f()}u[p]={features:y,exceededTransferLimit:!0===l.exceededTransferLimit}}}catch(n){o.e(n)}finally{o.f()}}return e.abrupt("return",u);case 9:throw new w.a(w.b.InvalidRequest);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r){var a,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new Z.a).outFields=r,a.returnGeometry=!1,a.outSpatialReference=this.spatialReference,a.where=this.objectIdField+"="+t.toString(),this.datesInUnknownTimezone&&(a.timeReferenceUnknownClient=!0),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:a,method:"execute"}),e.next=4,Object(V.a)(this._layer.parsedUrl.path,a);case 4:return i=e.sent,e.abrupt("return",1===i.features.length?i.features[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getIdentityUser",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return t=null===E.c||void 0===E.c?void 0:E.c.findCredential(this._layer.url),e.abrupt("return",t?t.userId:null);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getOwningSystemUrl",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t,r,a,i,s;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:if(!(t=null===E.c||void 0===E.c?void 0:E.c.findServerInfo(this._layer.url))){e.next=5;break}return e.abrupt("return",t.owningSystemUrl);case 5:if(r=this._layer.url,a=r.toLowerCase().indexOf("/rest/services"),!(r=a>-1?r.substring(0,a):r)){e.next=20;break}return r+="/rest/info",e.prev=9,e.next=12,Object(d.default)(r,{query:{f:"json"}});case 12:return i=e.sent,s="",e.abrupt("return",(i.data&&i.data.owningSystemUrl&&(s=i.data.owningSystemUrl),s));case 17:return e.prev=17,e.t0=e.catch(9),e.abrupt("return","");case 20:return e.abrupt("return","");case 21:case"end":return e.stop()}}),e,this,[[9,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"getDataSourceFeatureSet",value:function(){var e,t,a,n,i=new r({layer:this._layer,spatialReference:null!==(e=this.spatialReference)&&void 0!==e?e:void 0,outFields:null!==(t=this._overrideFields)&&void 0!==t?t:void 0,includeGeometry:!this._removeGeometry,lrucache:null!==(a=this.recentlyUsedQueries)&&void 0!==a?a:void 0,interceptor:null!==(n=this.featureSetQueryInterceptor)&&void 0!==n?n:void 0});return i._useDefinitionExpression=!1,i}},{key:"preferredTimeReference",get:function(){var e,t;return void 0===this._cachedDateMetaData.preferredTimeReference&&(this._cachedDateMetaData.preferredTimeReference=null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.preferredTimeReference)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null),this._cachedDateMetaData.preferredTimeReference}},{key:"dateFieldsTimeReference",get:function(){var e,t;return void 0===this._cachedDateMetaData.dateFieldsTimeReference&&(this._cachedDateMetaData.dateFieldsTimeReference=null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.dateFieldsTimeReference)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null),this._cachedDateMetaData.dateFieldsTimeReference}},{key:"datesInUnknownTimezone",get:function(){return this._layer.datesInUnknownTimezone}},{key:"editFieldsInfo",get:function(){var e,t;return void 0===this._cachedDateMetaData.editFieldsInfo&&(this._cachedDateMetaData.editFieldsInfo=null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.editFieldsInfo)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null),this._cachedDateMetaData.editFieldsInfo}},{key:"timeInfo",get:function(){var e,t;return void 0===this._cachedDateMetaData.timeInfo&&(this._cachedDateMetaData.timeInfo=null!==(e=null===(t=this._layer)||void 0===t||null===(t=t.timeInfo)||void 0===t?void 0:t.toJSON())&&void 0!==e?e:null),this._cachedDateMetaData.timeInfo}}],[{key:"create",value:function(e,t,a,n,i){return new r({layer:new G.default({url:e,outFields:null===t?["*"]:t}),spatialReference:a,lrucache:n,interceptor:i})}}]),r}(_.a),oe=r(1218),de=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a;return Object(s.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",a._findObjectId=-1,a._requestStandardised=!1,a._removeGeometry=!1,a._overrideFields=null,a.featureObjectId=null,e.spatialReference&&(a.spatialReference=e.spatialReference),a._transparent=!0,a._maxProcessing=1e3,a._layer=e.layer,a._wset=null,a._findObjectId=e.objectId,a.featureObjectId=e.objectId,a.relationship=e.relationship,a._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(a._overrideFields=e.outFields),void 0!==e.includeGeometry&&(a._removeGeometry=!1===e.includeGeometry),a}return Object(u.a)(r,[{key:"_maxQueryRate",value:function(){return O.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"loadImpl",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._layer.load(),null===(t=this._relatedLayer)||void 0===t?void 0:t.load()]);case 2:return this._initialiseFeatureSet(),e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nativeCapabilities",value:function(){return this._relatedLayer.nativeCapabilities()}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var e,t=[],r=[],n=Object(a.a)(this.fields);try{for(n.s();!(e=n.n()).done;){var i=e.value;if("oid"===i.type)t.push(i),r.push(i.name);else{var s,u=Object(a.a)(this._overrideFields);try{for(u.s();!(s=u.n()).done;){if(s.value.toLowerCase()===i.name.toLowerCase()){t.push(i),r.push(i.name);break}}}catch(c){u.e(c)}finally{u.f()}}}}catch(c){n.e(c)}finally{n.f()}this.fields=t,this._overrideFields=r}var l=this._layer.nativeCapabilities();l&&(this._databaseType=l.databaseType,this._requestStandardised=l.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types}},{key:"databaseType",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._relatedLayer.databaseType();case 2:return this._databaseType=this._relatedLayer._databaseType,e.abrupt("return",this._databaseType);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isTable",value:function(){return this._relatedLayer.isTable()}},{key:"_isInFeatureSet",value:function(){return O.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_changeFeature",value:function(e){var t,r={},n=Object(a.a)(this.fields);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){n.e(s)}finally{n.f()}return new b.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l,c,o,d,f,h,p,b,y,v,_,g;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(!this.isTable()||!r||null===t||""===t){e.next=4;break}return e.abrupt("return",new m.a([],[],!0,null));case 4:if(!1!==(l=this._layer.nativeCapabilities()).canQueryRelated){e.next=7;break}return e.abrupt("return",new m.a([],[],!0,null));case 7:if(null===(u=l.capabilities)||void 0===u||!u.queryRelated||!l.capabilities.queryRelated.supportsPagination){e.next=9;break}return e.abrupt("return",this._getFilteredSetUsingPaging(t,r,a,i,s));case 9:return c="",o=!1,null!==i&&l.capabilities&&l.capabilities.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(c=i.constructClause(),o=!0),(d=new ie.default).objectIds=[this._findObjectId],f=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._relatedLayer.fields?this._relatedLayer.fields.map((function(e){return e.name})):["*"]),d.outFields=f,d.relationshipId=this.relationship.id,d.where="1=1",h=!0,!0===this._removeGeometry&&(h=!1),d.returnGeometry=h,this._requestStandardised&&(d.sqlFormat="standard"),d.outSpatialReference=this.spatialReference,d.orderByFields=""!==c?c.split(","):null,e.next=19,l.source.queryRelatedFeatures(d);case 19:for(p=e.sent,this._checkCancelled(s),b=p[this._findObjectId]?p[this._findObjectId].features:[],y=[],v=0;v<b.length;v++)this._featureCache[b[v].attributes[this._relatedLayer.objectIdField]]=b[v],y.push(b[v].attributes[this._relatedLayer.objectIdField]);return _=r&&null!==t&&""!==t,g=null!=a,e.abrupt("return",new m.a(_||g?y:[],_||g?[]:y,o,null));case 25:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.includes("*"))return t;var r,n=!1,i=Object(a.a)(t);try{for(i.s();!(r=i.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(s){i.e(s)}finally{i.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFilteredSetUsingPaging",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l,c,o,d,f,h,p,b,y,v,_;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="",o=!1,d=this._layer.nativeCapabilities(),null!==i&&d&&null!==(u=d.capabilities)&&void 0!==u&&u.queryRelated&&!0===d.capabilities.queryRelated.supportsOrderBy&&(c=i.constructClause(),o=!0),e.next=5,this.databaseType();case 5:return"1=1",f=this._maxQueryRate(),null!=(h=null===(l=d.capabilities)||void 0===l?void 0:l.query.maxRecordCount)&&h<f&&(f=h),p=r&&null!==t&&""!==t,b=null!=a,y=null,v=!0,!0===this._removeGeometry&&(v=!1),_=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._relatedLayer.fields?this._relatedLayer.fields.map((function(e){return e.name})):["*"]),y=new m.a(p||b?["GETPAGES"]:[],p||b?[]:["GETPAGES"],o,{outFields:_.join(","),resultRecordCount:f,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:c,returnGeometry:v,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),e.next=16,this._expandPagedSet(y,f,0,0,s);case 16:return e.abrupt("return",y);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,a,n){return this._expandPagedSetFeatureSet(e,t,r,a,n)}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a){var i,s,u,l,c,o,d,f,h,p;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.pagesDefinition.internal.lastRetrieved,s=i,u=t.pagesDefinition.internal.lastPage,l=this._layer.nativeCapabilities(),c=new ie.default,!0===this._requestStandardised&&(c.sqlFormat="standard"),c.relationshipId=this.relationship.id,c.objectIds=t.pagesDefinition.objectIds,c.resultOffset=t.pagesDefinition.internal.lastPage,c.resultRecordCount=t.pagesDefinition.resultRecordCount,c.outFields=t.pagesDefinition.outFields.split(","),c.where=t.pagesDefinition.where,c.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,c.returnGeometry=t.pagesDefinition.returnGeometry,c.outSpatialReference=this.spatialReference,e.next=4,l.source.queryRelatedFeatures(c);case 4:if(o=e.sent,this._checkCancelled(a),t.pagesDefinition.internal.lastPage===u){e.next=7;break}return e.abrupt("return",0);case 7:for(d=o[this._findObjectId]?o[this._findObjectId].features:[],f=0;f<d.length;f++)t.pagesDefinition.internal.set[s+f]=d[f].attributes[this._relatedLayer.objectIdField];for(h=0;h<d.length;h++)this._featureCache[d[h].attributes[this._relatedLayer.objectIdField]]=d[h];return p=!o[this._findObjectId]||!1===o[this._findObjectId].exceededTransferLimit,e.abrupt("return",(d.length!==t.pagesDefinition.resultRecordCount&&p&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=i+d.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,d.length));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i){var s,u,l,c;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],-1!==r&&void 0===this._featureCache[r]&&s.push(r),u=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,u)){e.next=7;break}return e.next=6,this._expandPagedSet(t,u,0,0,i);case 6:return e.abrupt("return",this._getFeatures(t,r,a,i));case 7:for(l=0,c=t._lastFetchedIndex;c<t._known.length&&(++l<=a&&(t._lastFetchedIndex+=1),!("GETPAGES"!==t._known[c]&&void 0===this._featureCache[t._known[c]]&&(t._known[c]!==r&&s.push(t._known[c]),s.length>a)))&&!(l>=a&&0===s.length);c++);if(0!==s.length){e.next=11;break}return e.abrupt("return","success");case 11:throw new w.a(w.b.MissingFeatures);case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_refineSetBlock",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s,u,l){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return this._relatedLayer.gdbVersion}},{key:"_canDoAggregates",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return this._relatedLayer.relationshipMetaData()}},{key:"serviceUrl",value:function(){return this._relatedLayer.serviceUrl()}},{key:"queryAttachments",value:function(e,t,r,a,n){return this._relatedLayer.queryAttachments(e,t,r,a,n)}},{key:"getFeatureByObjectId",value:function(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this._relatedLayer.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this._relatedLayer.getIdentityUser()}},{key:"getDataSourceFeatureSet",value:function(){return this._relatedLayer}},{key:"preferredTimeReference",get:function(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.preferredTimeReference)&&void 0!==e?e:null}},{key:"dateFieldsTimeReference",get:function(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.dateFieldsTimeReference)&&void 0!==e?e:null}},{key:"datesInUnknownTimezone",get:function(){var e;return null===(e=this._relatedLayer)||void 0===e?void 0:e.datesInUnknownTimezone}},{key:"editFieldsInfo",get:function(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.editFieldsInfo)&&void 0!==e?e:null}},{key:"timeInfo",get:function(){var e,t;return null!==(e=null===(t=this._relatedLayer)||void 0===t?void 0:t.timeInfo)&&void 0!==e?e:null}}]),r}(_.a),fe=r(1545),he=r(496);function pe(){null===fe.a.applicationCache&&(fe.a.applicationCache=new fe.a)}function be(e,t){return ye.apply(this,arguments)}function ye(){return(ye=Object(o.a)(Object(n.a)().mark((function e(t,r){var a,i,s,u;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fe.a.applicationCache){e.next=22;break}if(!(a=fe.a.applicationCache.getLayerInfo(t))){e.next=7;break}return e.next=5,a;case 5:return i=e.sent,e.abrupt("return",new G.default({url:t,outFields:r,sourceJSON:i}));case 7:if(s=new G.default({url:t,outFields:r}),u=Object(o.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.load();case 2:return e.abrupt("return",s.sourceJSON);case 3:case"end":return e.stop()}}),e)})))(),!fe.a.applicationCache){e.next=19;break}return fe.a.applicationCache.setLayerInfo(t,u),e.prev=10,e.next=13,u;case 13:case 21:return e.abrupt("return",s);case 16:throw e.prev=16,e.t0=e.catch(10),fe.a.applicationCache.clearLayerInfo(t),e.t0;case 19:return e.next=21,u;case 22:return e.abrupt("return",new G.default({url:t,outFields:r}));case 23:case"end":return e.stop()}}),e,null,[[10,16]])})))).apply(this,arguments)}function ve(e,t,r,a,n){return _e.apply(this,arguments)}function _e(){return _e=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=l.length>5&&void 0!==l[5]?l[5]:null,e.t0=me,e.next=4,be(t,["*"]);case 4:return e.t1=e.sent,e.t2=r,e.t3=a,e.t4=i,e.t5=s,e.t6=u,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4,e.t5,e.t6));case 11:case"end":return e.stop()}}),e)}))),_e.apply(this,arguments)}function me(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(e instanceof G.default||Object(h.A)(e)){var u={layer:e,spatialReference:r,outFields:a,includeGeometry:n,lrucache:i,interceptor:s};return 1==!(e.url||!e.source)?new oe.a(u):new ce(u)}return me(e.parent,r,a,n,i,s).filter(x.WhereClause.create(e.parent.subtypeField+"="+e.subtypeCode.toString(),null===(t=e.parent)||void 0===t?void 0:t.fieldsIndex))}function ge(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(o.a)(Object(n.a)().mark((function e(t){var r,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===fe.a.applicationCache){e.next=4;break}if(null===(r=fe.a.applicationCache.getLayerInfo(t))){e.next=4;break}return e.abrupt("return",r);case 4:if(a=Object(o.a)(Object(n.a)().mark((function e(){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.default)(t,{responseType:"json",query:{f:"json"}});case 2:return r=e.sent,e.abrupt("return",r.data?r.data:null);case 4:case"end":return e.stop()}}),e)})))(),null===fe.a.applicationCache){e.next=16;break}return fe.a.applicationCache.setLayerInfo(t,a),e.prev=7,e.next=10,a;case 10:return e.abrupt("return",e.sent);case 13:throw e.prev=13,e.t0=e.catch(7),fe.a.applicationCache.clearLayerInfo(t),e.t0;case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e,null,[[7,13]])})))).apply(this,arguments)}function ke(e,t){return je.apply(this,arguments)}function je(){return(je=Object(o.a)(Object(n.a)().mark((function e(t,r){var a,i,s;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="QUERYDATAELEMTS:"+r.toString()+":"+t,null===fe.a.applicationCache){e.next=5;break}if(null===(i=fe.a.applicationCache.getLayerInfo(a))){e.next=5;break}return e.abrupt("return",i);case 5:if(s=Object(o.a)(Object(n.a)().mark((function e(){var a,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.default)(t+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([r.toString()]),f:"json"}});case 2:if(!(a=e.sent).data){e.next=7;break}if(!(i=a.data).layerDataElements||!i.layerDataElements[0]){e.next=7;break}return e.abrupt("return",i.layerDataElements[0]);case 7:throw new w.a(w.b.DataElementsNotFound);case 8:case"end":return e.stop()}}),e)})))(),null===fe.a.applicationCache){e.next=17;break}return fe.a.applicationCache.setLayerInfo(a,s),e.prev=8,e.next=11,s;case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(8),fe.a.applicationCache.clearLayerInfo(a),e.t0;case 17:return e.abrupt("return",s);case 18:case"end":return e.stop()}}),e,null,[[8,14]])})))).apply(this,arguments)}function we(e){return xe.apply(this,arguments)}function xe(){return(xe=Object(o.a)(Object(n.a)().mark((function e(t){var r,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===fe.a.applicationCache){e.next=4;break}if(null===(r=fe.a.applicationCache.getLayerInfo(t))){e.next=4;break}return e.abrupt("return",r);case 4:if(a=Object(o.a)(Object(n.a)().mark((function e(){var r,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.default)(t,{responseType:"json",query:{f:"json"}});case 2:if(!(r=e.sent).data){e.next=6;break}return a=r.data,e.abrupt("return",(a.layers||(a.layers=[]),a.tables||(a.tables=[]),a));case 6:return e.abrupt("return",{layers:[],tables:[]});case 7:case"end":return e.stop()}}),e)})))(),null===fe.a.applicationCache){e.next=16;break}return fe.a.applicationCache.setLayerInfo(t,a),e.prev=7,e.next=10,a;case 10:return e.abrupt("return",e.sent);case 13:throw e.prev=13,e.t0=e.catch(7),fe.a.applicationCache.clearLayerInfo(t),e.t0;case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e,null,[[7,13]])})))).apply(this,arguments)}function Fe(e,t){return Se.apply(this,arguments)}function Se(){return(Se=Object(o.a)(Object(n.a)().mark((function e(t,r){var i,s,u,l,c,o,d,f,h,p,b,y,v,_,m,g,O,k,j,w,F,S,I,D,C,T,R,N,A,P,E,L,G,q;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},e.next=3,we(t);case 3:if(s=e.sent,i.metadata=s,!s.controllerDatasetLayers||void 0===s.controllerDatasetLayers.utilityNetworkLayerId||null===s.controllerDatasetLayers.utilityNetworkLayerId){e.next=36;break}if(s.layers){u=Object(a.a)(s.layers);try{for(u.s();!(l=u.n()).done;)c=l.value,i.layerNameLkp[c.id]=c.name}catch(n){u.e(n)}finally{u.f()}}if(s.tables){o=Object(a.a)(s.tables);try{for(o.s();!(d=o.n()).done;)f=d.value,i.layerNameLkp[f.id]=f.name}catch(n){o.e(n)}finally{o.f()}}return h=s.controllerDatasetLayers.utilityNetworkLayerId,i.networkId=h,e.next=11,ke(t,h);case 11:if(!(p=e.sent)){e.next=35;break}i.queryelem=p,i.queryelem&&i.queryelem.dataElement&&void 0!==i.queryelem.dataElement.schemaGeneration&&(i.unVersion=i.queryelem.dataElement.schemaGeneration),i.lkp={},i.queryelem.dataElement.domainNetworks||(i.queryelem.dataElement.domainNetworks=[]),b=Object(a.a)(i.queryelem.dataElement.domainNetworks);try{for(b.s();!(y=b.n()).done;){m=y.value,g=Object(a.a)(null!==(v=m.edgeSources)&&void 0!==v?v:[]);try{for(g.s();!(O=g.n()).done;)j=O.value,(w={layerId:j.layerId,sourceId:j.sourceId,className:null!==(k=i.layerNameLkp[j.layerId])&&void 0!==k?k:null}).className&&(i.lkp[w.className]=w)}catch(n){g.e(n)}finally{g.f()}F=Object(a.a)(null!==(_=m.junctionSources)&&void 0!==_?_:[]);try{for(F.s();!(S=F.n()).done;)D=S.value,(C={layerId:D.layerId,sourceId:D.sourceId,className:null!==(I=i.layerNameLkp[D.layerId])&&void 0!==I?I:null}).className&&(i.lkp[C.className]=C)}catch(n){F.e(n)}finally{F.f()}}}catch(n){b.e(n)}finally{b.f()}if(i.queryelem.dataElement.terminalConfigurations){T=Object(a.a)(i.queryelem.dataElement.terminalConfigurations);try{for(T.s();!(R=T.n()).done;){N=R.value,A=Object(a.a)(N.terminals);try{for(A.s();!(P=A.n()).done;)E=P.value,i.terminals.push({terminalId:E.terminalId,terminalName:E.terminalName})}catch(n){A.e(n)}finally{A.f()}}}catch(n){T.e(n)}finally{T.f()}}return e.next=19,ge(t+"/"+h);case 19:if(!(L=e.sent).systemLayers||void 0===L.systemLayers.associationsTableId||null===L.systemLayers.associationsTableId){e.next=34;break}return G=[],i.unVersion>=4&&(G.push("STATUS"),G.push("PERCENTALONG")),e.next=25,ve(t+"/"+L.systemLayers.associationsTableId.toString(),r,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"].concat(G),!1,null,null);case 25:return q=e.sent,e.next=28,q.load();case 28:if(e.t0=i.unVersion>=4,!e.t0){e.next=33;break}return q=q.filter(x.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",q.getFieldsIndex())),e.next=33,q.load();case 33:return e.abrupt("return",{lkp:i.lkp,associations:q,unVersion:i.unVersion,terminals:i.terminals});case 34:case 35:case 36:return e.abrupt("return",{associations:null,unVersion:i.unVersion,lkp:null,terminals:[]});case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e,t,r){return De.apply(this,arguments)}function De(){return De=Object(o.a)(Object(n.a)().mark((function e(t,r,a){var i,s,u,l,c,o,d,f=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.length>3&&void 0!==f[3]?f[3]:null,s=f.length>4&&void 0!==f[4]?f[4]:null,u=!(f.length>5&&void 0!==f[5])||f[5],l=f.length>6&&void 0!==f[6]?f[6]:null,c=f.length>7&&void 0!==f[7]?f[7]:null,o=t.serviceUrl()){e.next=8;break}return e.abrupt("return",null);case 8:return o="/"===o.charAt(o.length-1)?o+r.relatedTableId.toString():o+"/"+r.relatedTableId.toString(),e.next=11,ve(o,i,s,u,l,c);case 11:return d=e.sent,e.abrupt("return",new de({layer:t,relatedLayer:d,relationship:r,objectId:a,spatialReference:i,outFields:s,includeGeometry:u,lrucache:l,interceptor:c}));case 13:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}p.a.registerAction(),R.registerAction(),v.a.registerAction(),N.a.registerAction(),A.a.registerAction();var Ce=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(s.a)(this,r),(a=t.call(this))._map=e,a._overridespref=n,a._lrucache=i,a._interceptor=u,a._instantLayers=[],a}return Object(u.a)(r,[{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=me(e,this._overridespref,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:a,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),a}},{key:"featureSetByName",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r,a,s,u,l,c,o,d,f,p,b,y,v,_=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(_.length>1&&void 0!==_[1])||_[1],a=_.length>2&&void 0!==_[2]?_[2]:null,void 0===this._map.loaded||void 0===this._map.load||!1!==this._map.loaded){e.next=6;break}return e.next=5,this._map.load();case 5:return e.abrupt("return",this.featureSetByName(t,r,a));case 6:null===a&&(a=["*"]),a=(a=a.slice(0)).sort(),s=JSON.stringify(a),u=0;case 9:if(!(u<this._instantLayers.length)){e.next=16;break}if((l=this._instantLayers[u]).opitem.title!==t||l.includeGeometry!==r||l.outFields!==s){e.next=13;break}return e.abrupt("return",this._instantLayers[u].featureset);case 13:u++,e.next=9;break;case 16:if(c=[],o=this._map.allLayers.find((function(e){if(e instanceof G.default){if(e.title===t)return!0}else if(Object(h.A)(e)){if(e.title===t)return!0;c.push(e)}return!1})),!o){e.next=19;break}return e.abrupt("return",this._makeAndAddFeatureSet(o,r,a));case 19:if(!this._map.tables){e.next=28;break}if(d=this._map.tables.find((function(e){return!!(e.title&&e.title===t||e.title&&e.title===t)})),!d){e.next=28;break}if(!(d instanceof G.default)){e.next=24;break}return e.abrupt("return",this._makeAndAddFeatureSet(d,r,a));case 24:return d._materializedTable||(f=d.outFields?d:Object(i.a)(Object(i.a)({},d),{},{outFields:["*"]}),d._materializedTable=new G.default(f)),e.next=27,d._materializedTable.load();case 27:return e.abrupt("return",this._makeAndAddFeatureSet(d._materializedTable,r,a));case 28:p=0,b=c;case 29:if(!(p<b.length)){e.next=45;break}if("not-loaded"!==(y=b[p]).loadStatus&&"loading"!==y.loadStatus){e.next=39;break}return e.prev=32,e.next=35,y.load();case 35:e.next=39;break;case 37:e.prev=37,e.t0=e.catch(32);case 39:if(v=y.sublayers.find((function(e){return e.title===t})),!v){e.next=42;break}return e.abrupt("return",this._makeAndAddFeatureSet(v,r,a));case 42:p++,e.next=29;break;case 45:return e.abrupt("return",null);case 46:case"end":return e.stop()}}),e,this,[[32,37]])})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r,a,s,u,l,c,o,d,f,p,b,y,v,_=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(_.length>1&&void 0!==_[1])||_[1],a=_.length>2&&void 0!==_[2]?_[2]:["*"],void 0===this._map.loaded||void 0===this._map.load||!1!==this._map.loaded){e.next=6;break}return e.next=5,this._map.load();case 5:return e.abrupt("return",this.featureSetById(t,r,a));case 6:null===a&&(a=["*"]),a=(a=a.slice(0)).sort(),s=JSON.stringify(a),u=0;case 9:if(!(u<this._instantLayers.length)){e.next=16;break}if((l=this._instantLayers[u]).opitem.id!==t||l.includeGeometry!==r||l.outFields!==s){e.next=13;break}return e.abrupt("return",this._instantLayers[u].featureset);case 13:u++,e.next=9;break;case 16:if(c=[],o=this._map.allLayers.find((function(e){if(e instanceof G.default){if(e.id===t)return!0}else if(Object(h.A)(e)){if(e.id===t)return!0;c.push(e)}return!1})),!o){e.next=19;break}return e.abrupt("return",this._makeAndAddFeatureSet(o,r,a));case 19:if(!this._map.tables){e.next=28;break}if(d=this._map.tables.find((function(e){return e.id===t})),!d){e.next=28;break}if(!(d instanceof G.default)){e.next=24;break}return e.abrupt("return",this._makeAndAddFeatureSet(d,r,a));case 24:return d._materializedTable||(f=Object(i.a)(Object(i.a)({},d),{},{outFields:["*"]}),d._materializedTable=new G.default(f)),e.next=27,d._materializedTable.load();case 27:return e.abrupt("return",this._makeAndAddFeatureSet(d._materializedTable,r,a));case 28:p=0,b=c;case 29:if(!(p<b.length)){e.next=45;break}if("not-loaded"!==(y=b[p]).loadStatus&&"loading"!==y.loadStatus){e.next=39;break}return e.prev=32,e.next=35,y.load();case 35:e.next=39;break;case 37:e.prev=37,e.t0=e.catch(32);case 39:if(v=y.sublayers.find((function(e){return e.id===t})),!v){e.next=42;break}return e.abrupt("return",this._makeAndAddFeatureSet(v,r,a));case 42:p++,e.next=29;break;case 45:return e.abrupt("return",null);case 46:case"end":return e.stop()}}),e,this,[[32,37]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(f.a),Te=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(s.a)(this,r),(a=t.call(this))._url=e,a._overridespref=n,a._lrucache=i,a._interceptor=u,a.metadata=null,a._instantLayers=[],a}return Object(u.a)(r,[{key:"url",get:function(){return this._url}},{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=me(e,this._overridespref,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:a,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),a}},{key:"_loadMetaData",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(){var t;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we(this._url);case 2:return t=e.sent,e.abrupt("return",(this.metadata=t,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){return this._loadMetaData()}},{key:"clone",value:function(){return new r(this._url,this._overridespref,this._lrucache,this._interceptor)}},{key:"featureSetByName",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r,i,s,u,l,c,o,d,f,h,p,b,y,v,_,m,g=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=!(g.length>1&&void 0!==g[1])||g[1],null===(s=g.length>2&&void 0!==g[2]?g[2]:null)&&(s=["*"]),s=(s=s.slice(0)).sort(),u=JSON.stringify(s),l=0;case 5:if(!(l<this._instantLayers.length)){e.next=12;break}if((c=this._instantLayers[l]).opitem.title!==t||c.includeGeometry!==i||c.outFields!==u){e.next=9;break}return e.abrupt("return",this._instantLayers[l].featureset);case 9:l++,e.next=5;break;case 12:return e.next=14,this._loadMetaData();case 14:o=e.sent,d=null,f=Object(a.a)(null!==(r=o.layers)&&void 0!==r?r:[]);try{for(f.s();!(h=f.n()).done;)(p=h.value).name===t&&(d=p)}catch(n){f.e(n)}finally{f.f()}if(!d){y=Object(a.a)(null!==(b=o.tables)&&void 0!==b?b:[]);try{for(y.s();!(v=y.n()).done;)(_=v.value).name===t&&(d=_)}catch(n){y.e(n)}finally{y.f()}}if(!d){e.next=24;break}return e.next=22,be(this._url+"/"+d.id,["*"]);case 22:return m=e.sent,e.abrupt("return",this._makeAndAddFeatureSet(m,i,s));case 24:return e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=Object(o.a)(Object(n.a)().mark((function e(t){var r,i,s,u,l,c,o,d,f,h,p,b,y,v,_,m,g=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=!(g.length>1&&void 0!==g[1])||g[1],null===(s=g.length>2&&void 0!==g[2]?g[2]:["*"])&&(s=["*"]),s=(s=s.slice(0)).sort(),u=JSON.stringify(s),t=null!=t?t.toString():"",l=0;case 6:if(!(l<this._instantLayers.length)){e.next=13;break}if((c=this._instantLayers[l]).opitem.id!==t||c.includeGeometry!==i||c.outFields!==u){e.next=10;break}return e.abrupt("return",this._instantLayers[l].featureset);case 10:l++,e.next=6;break;case 13:return e.next=15,this._loadMetaData();case 15:o=e.sent,d=null,f=Object(a.a)(null!==(r=o.layers)&&void 0!==r?r:[]);try{for(f.s();!(h=f.n()).done;)null!==(p=h.value).id&&void 0!==p.id&&p.id.toString()===t&&(d=p)}catch(n){f.e(n)}finally{f.f()}if(!d){y=Object(a.a)(null!==(b=o.tables)&&void 0!==b?b:[]);try{for(y.s();!(v=y.n()).done;)null!==(_=v.value).id&&void 0!==_.id&&_.id.toString()===t&&(d=_)}catch(n){y.e(n)}finally{y.f()}}if(!d){e.next=25;break}return e.next=23,be(this._url+"/"+d.id,["*"]);case 23:return m=e.sent,e.abrupt("return",this._makeAndAddFeatureSet(m,i,s));case 25:return e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(f.a);function Re(e,t){return new Ce(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}function Ne(e,t){return new Te(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}function Ae(e,t,r,a,n){if(null===e)return null;if(e instanceof G.default){switch(t){case"datasource":return me(e,n,e.outFields,!0,r,a).getDataSourceFeatureSet();case"parent":case"root":return me(e,n,e.outFields,!0,r,a)}return null}if(Object(h.A)(e)){switch(t){case"datasource":return me(e,n,e.outFields,!0,r,a).getDataSourceFeatureSet();case"parent":case"root":return me(e,n,e.outFields,!0,r,a)}return null}if(Object(h.B)(e)){switch(t){case"datasource":return me(e.parent,n,e.parent.outFields,!0,r,a).getDataSourceFeatureSet();case"parent":case"root":return me(e,n,e.parent.outFields,!0,r,a)}return null}if(e instanceof _.a)switch(t){case"datasource":return e.getDataSourceFeatureSet();case"parent":return e;case"root":return e.getRootFeatureSet()}return null}function Pe(e,t,r,a,n,i,s){return Ee.apply(this,arguments)}function Ee(){return Ee=Object(o.a)(Object(n.a)().mark((function e(t,r,a,i,s,u,l){var c,o,d,f,h,p,b=arguments;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=b.length>7&&void 0!==b[7]?b[7]:null,!fe.a.applicationCache){e.next=8;break}if(!(o=fe.a.applicationCache.getLayerInfo(t+":"+u.url))){e.next=8;break}return e.next=6,o;case 6:return d=e.sent,e.abrupt("return",me(new G.default({url:Object(O.i)(d.url)+"/"+r,outFields:["*"]}),a,i,s,l,c));case 8:return f=new he.default({id:t,portal:u}).load(),fe.a.applicationCache&&fe.a.applicationCache.setLayerInfo(t+":"+u.url,f),e.prev=10,e.next=13,f;case 13:return p=e.sent,e.abrupt("return",me(new G.default({url:Object(O.i)(null!==(h=p.url)&&void 0!==h?h:"")+"/"+r,outFields:["*"]}),a,i,s,l,c));case 17:throw e.prev=17,e.t0=e.catch(10),fe.a.applicationCache&&fe.a.applicationCache.clearLayerInfo(t+":"+u.url),e.t0;case 20:case"end":return e.stop()}}),e,null,[[10,17]])}))),Ee.apply(this,arguments)}},2220:function(e,t,r){"use strict";r.r(t),r.d(t,"registerFunctions",(function(){return q}));var a=r(4),n=r(92),i=r(12),s=r(262),u=r(1316),l=r(469),c=r(252),o=r(807),d=r(1215),f=r(1774),h=r(806),p=r(357),b=r(1544),y=r(1216),v=r(922),_=r(923),m=r(1217),g=r(1547),O=r(1218),k=r(924),j=r(358),w=r(532),x=r(1315),F=r(110),S=r(436),I=r(412),D=r(325),C=r(197);function T(e,t,r,a){if(1===a.length){if(Object(p.S)(a[0]))return Object(x.a)(e,a[0],-1);if(Object(p.U)(a[0]))return Object(x.a)(e,a[0].toArray(),-1)}return Object(x.a)(e,a,-1)}function R(e,t,r){return N.apply(this,arguments)}function N(){return(N=Object(i.a)(Object(a.a)().mark((function e(t,r,n){var i,s,u,l,c,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=t.getVariables()).length>0)){e.next=17;break}s=[],u=0;case 4:if(!(u<i.length)){e.next=14;break}return l={name:i[u]},e.t0=s,e.next=9,r.evaluateIdentifier(n,l);case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:u++,e.next=4;break;case 14:for(c={},o=0;o<i.length;o++)c[i[o]]=s[o];return e.abrupt("return",(t.parameters=c,t));case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(var a in e)if(a.toLowerCase()===t.toLowerCase())return e[a];return r}function P(e){if(null===e)return null;var t={type:A(e,"type",""),name:A(e,"name","")};if("range"===t.type)t.range=A(e,"range",[]);else{t.codedValues=[];var r,a=Object(n.a)(A(e,"codedValues",[]));try{for(a.s();!(r=a.n()).done;){var i=r.value;t.codedValues.push({name:A(i,"name",""),code:A(i,"code",null)})}}catch(s){a.e(s)}finally{a.f()}}return t}function E(e){if(null===e)return null;var t={},r=A(e,"wkt",null);null!==r&&(t.wkt=r);var a=A(e,"wkid",null);return null!==a&&(t.wkid=a),t}function L(e){if(null===e)return null;var t={hasZ:A(e,"hasz",!1),hasM:A(e,"hasm",!1)},r=A(e,"spatialreference",null);r&&(t.spatialReference=E(r));var a=A(e,"x",null);if(null!==a)return t.x=a,t.y=A(e,"y",null),t;var n=A(e,"rings",null);if(null!==n)return t.rings=n,t;var i=A(e,"paths",null);if(null!==i)return t.paths=i,t;var s=A(e,"points",null);if(null!==s)return t.points=s,t;for(var u=0,l=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];u<l.length;u++){var c=l[u],o=A(e,c,null);null!==o&&(t[c]=o)}return t}function G(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){var r,a=Object(n.a)(t);try{for(a.s();!(r=a.n()).done;)if(r.value===e)return!0}catch(i){a.e(i)}finally{a.f()}return!1}(e.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&!1!==Object(p.S)(e.layerDefinition.fields)&&!1!==Object(p.S)(e.featureSet.features)}function q(e){"async"===e.mode&&(e.functions.timezone=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(n,i,u){var o,d,f;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(u,1,2,t,r),!Object(p.X)(u[0])){e.next=19;break}return e.next=3,u[0].load();case 3:if(1!==u.length&&null!==u[1]){e.next=5;break}return e.abrupt("return",u[0].dateTimeReferenceFieldIndex.layerDateFieldsTimeZone);case 5:if(u[1]instanceof l.a&&!1!==u[1].hasField("type")){e.next=7;break}throw new c.b(t,c.d.InvalidParameter,r);case 7:if(o=u[1].field("type"),!1!==Object(p.I)(o)){e.next=10;break}throw new c.b(t,c.d.InvalidParameter,r);case 10:e.t0=Object(p.P)(o).toLowerCase(),e.next="preferredtimezone"===e.t0?13:"editfieldsinfo"===e.t0?14:"timeinfo"===e.t0?15:"field"===e.t0?16:18;break;case 13:return e.abrupt("return",u[0].dateTimeReferenceFieldIndex.layerPreferredTimeZone);case 14:return e.abrupt("return",u[0].dateTimeReferenceFieldIndex.layerEditFieldsTimeZone);case 15:return e.abrupt("return",u[0].dateTimeReferenceFieldIndex.layerTimeInfoTimeZone);case 16:if(!u[1].hasField("fieldname")||!Object(p.I)(u[1].field("fieldname"))){e.next=18;break}return e.abrupt("return",u[0].dateTimeReferenceFieldIndex.fieldTimeZone(Object(p.P)(u[1].field("fieldname"))));case 18:throw new c.b(t,c.d.InvalidParameter,r);case 19:if(null!==(d=Object(p.R)(u[0],Object(p.h)(t)))){e.next=22;break}return e.abrupt("return",null);case 22:return f=d.timeZone,e.abrupt("return","system"===f?s.a.systemTimeZoneCanonicalName:f);case 24:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}())},e.functions.sqltimestamp=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(n,i,s){var u,l,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(s,1,3,t,r),u=s[0],!Object(p.Q)(u)){e.next=8;break}if(1!==s.length){e.next=5;break}return e.abrupt("return",u.toSQLString());case 5:if(2!==s.length){e.next=7;break}return e.abrupt("return",u.changeTimeZone(Object(p.P)(s[1])).toSQLString());case 7:case 18:throw new c.b(t,c.d.InvalidParameter,r);case 8:if(!Object(p.X)(u)){e.next=18;break}if(3===s.length){e.next=11;break}throw new c.b(t,c.d.InvalidParameter,r);case 11:return e.next=13,u.load();case 13:if(l=Object(p.P)(s[1]),!1!==Object(p.Q)(s[2])){e.next=16;break}throw new c.b(t,c.d.InvalidParameter,r);case 16:return o=u.fieldTimeZone(l),e.abrupt("return",null===o?s[2].toSQLString():s[2].changeTimeZone(o).toSQLString());case 19:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}())},e.signatures.push({name:"sqltimestamp",min:2,max:4}),e.functions.featuresetbyid=function(t,r){return e.standardFunctionAsync(t,r,(function(e,a,n){if(Object(p.d)(n,2,4,t,r),n[0]instanceof d.a){var i=Object(p.P)(n[1]),s=Object(p.e)(n[2],null),u=Object(p.N)(Object(p.e)(n[3],!0));if(null===s&&(s=["*"]),!1===Object(p.S)(s))throw new c.b(t,c.d.InvalidParameter,r);return n[0].featureSetById(i,u,s)}throw new c.b(t,c.d.InvalidParameter,r)}))},e.signatures.push({name:"featuresetbyid",min:2,max:4}),e.functions.getfeatureset=function(t,r){return e.standardFunctionAsync(t,r,(function(e,a,n){if(Object(p.d)(n,1,2,t,r),Object(p.V)(n[0])){var i=Object(p.e)(n[1],"datasource");return null===i&&(i="datasource"),i=Object(p.P)(i).toLowerCase(),Object(f.convertToFeatureSet)(n[0].fullSchema(),i,t.lrucache,t.interceptor,t.spatialReference)}throw new c.b(t,c.d.InvalidParameter,r)}))},e.signatures.push({name:"getfeatureset",min:1,max:2}),e.functions.featuresetbyportalitem=function(t,r){return e.standardFunctionAsync(t,r,(function(e,a,n){var i,s;if(Object(p.d)(n,2,5,t,r),null===n[0])throw new c.b(t,c.d.PortalRequired,r);if(n[0]instanceof u.a){var l=Object(p.P)(n[1]),o=Object(p.P)(n[2]),d=Object(p.e)(n[3],null),h=Object(p.N)(Object(p.e)(n[4],!0));if(null===d&&(d=["*"]),!1===Object(p.S)(d))throw new c.b(t,c.d.InvalidParameter,r);var y=null;return y=t.services&&t.services.portal?t.services.portal:C.a.getDefault(),y=Object(b.a)(n[0],y),Object(f.constructFeatureSetFromPortalItem)(l,o,t.spatialReference,d,h,y,t.lrucache,t.interceptor)}if(!1===Object(p.I)(n[0]))throw new c.b(t,c.d.PortalRequired,r);var v=Object(p.P)(n[0]),_=Object(p.P)(n[1]),m=Object(p.e)(n[2],null),g=Object(p.N)(Object(p.e)(n[3],!0));if(null===m&&(m=["*"]),!1===Object(p.S)(m))throw new c.b(t,c.d.InvalidParameter,r);return Object(f.constructFeatureSetFromPortalItem)(v,_,t.spatialReference,m,g,null!==(i=null===(s=t.services)||void 0===s?void 0:s.portal)&&void 0!==i?i:C.a.getDefault(),t.lrucache,t.interceptor)}))},e.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),e.functions.featuresetbyname=function(t,r){return e.standardFunctionAsync(t,r,(function(e,a,n){if(Object(p.d)(n,2,4,t,r),n[0]instanceof d.a){var i=Object(p.P)(n[1]),s=Object(p.e)(n[2],null),u=Object(p.N)(Object(p.e)(n[3],!0));if(null===s&&(s=["*"]),!1===Object(p.S)(s))throw new c.b(t,c.d.InvalidParameter,r);return n[0].featureSetByName(i,u,s)}throw new c.b(t,c.d.InvalidParameter,r)}))},e.signatures.push({name:"featuresetbyname",min:2,max:4}),e.functions.featureset=function(t,r){return e.standardFunction(t,r,(function(e,a,i){var s,u;Object(p.d)(i,1,1,t,r);var o=i[0],d={layerDefinition:{geometryType:"",objectIdField:"",hasM:!1,hasZ:!1,globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(Object(p.I)(o))void 0!==(o=JSON.parse(o)).layerDefinition?(d.layerDefinition=o.layerDefinition,d.featureSet=o.featureSet,o.layerDefinition.spatialReference&&(d.layerDefinition.spatialReference=o.layerDefinition.spatialReference)):(d.featureSet.features=o.features,d.featureSet.geometryType=o.geometryType,d.layerDefinition.geometryType=d.featureSet.geometryType,d.layerDefinition.objectIdField=null!==(s=o.objectIdFieldName)&&void 0!==s?s:"",d.layerDefinition.typeIdField=o.typeIdFieldName,d.layerDefinition.globalIdField=o.globalIdFieldName,d.layerDefinition.fields=o.fields,o.spatialReference&&(d.layerDefinition.spatialReference=o.spatialReference));else{if(!(i[0]instanceof l.a))throw new c.b(t,c.d.InvalidParameter,r);var f=A(o=JSON.parse(i[0].castToText(!0)),"layerdefinition");if(null!==f){d.layerDefinition.geometryType=A(f,"geometrytype",""),d.featureSet.geometryType=d.layerDefinition.geometryType,d.layerDefinition.globalIdField=A(f,"globalidfield",""),d.layerDefinition.objectIdField=A(f,"objectidfield",""),d.layerDefinition.typeIdField=A(f,"typeidfield",""),d.layerDefinition.hasZ=!0===A(f,"hasz",!1),d.layerDefinition.hasM=!0===A(f,"hasm",!1);var h=A(f,"spatialreference",null);h&&(d.layerDefinition.spatialReference=E(h));var b,y=Object(n.a)(A(f,"fields",[]));try{for(y.s();!(b=y.n()).done;){var v=b.value,_={name:A(v,"name",""),alias:A(v,"alias",""),type:A(v,"type",""),nullable:A(v,"nullable",!0),editable:A(v,"editable",!0),length:A(v,"length",null),domain:P(A(v,"domain"))};d.layerDefinition.fields.push(_)}}catch($){y.e($)}finally{y.f()}var m=A(o,"featureset",null);if(m){var g,k={},j=Object(n.a)(d.layerDefinition.fields);try{for(j.s();!(g=j.n()).done;){var w=g.value;k[w.name.toLowerCase()]=w.name}}catch($){j.e($)}finally{j.f()}var x,F=Object(n.a)(A(m,"features",[]));try{for(F.s();!(x=F.n()).done;){var S=x.value,I={},D=A(S,"attributes",{});for(var C in D)I[k[C.toLowerCase()]]=D[C];d.featureSet.features.push({attributes:I,geometry:L(A(S,"geometry",null))})}}catch($){F.e($)}finally{F.f()}}}else{d.layerDefinition.hasZ=!0===A(o,"hasz",!1),d.layerDefinition.hasM=!0===A(o,"hasm",!1),d.layerDefinition.geometryType=A(o,"geometrytype",""),d.featureSet.geometryType=d.layerDefinition.geometryType,d.layerDefinition.objectIdField=A(o,"objectidfieldname",""),d.layerDefinition.typeIdField=A(o,"typeidfieldname","");var T=A(o,"spatialreference",null);T&&(d.layerDefinition.spatialReference=E(T));var R=A(o,"fields",null);if(Object(p.S)(R)){var N,q=Object(n.a)(R);try{for(q.s();!(N=q.n()).done;){var M=N.value,B={name:A(M,"name",""),alias:A(M,"alias",""),type:A(M,"type",""),nullable:A(M,"nullable",!0),editable:A(M,"editable",!0),length:A(M,"length",null),domain:P(A(M,"domain"))};d.layerDefinition.fields.push(B)}}catch($){q.e($)}finally{q.f()}}else R=null,d.layerDefinition.fields=R;var U,W={},V=Object(n.a)(d.layerDefinition.fields);try{for(V.s();!(U=V.n()).done;){var Q=U.value;W[Q.name.toLowerCase()]=Q.name}}catch($){V.e($)}finally{V.f()}var z=A(o,"features",null);if(Object(p.S)(z)){var Z,J=Object(n.a)(z);try{for(J.s();!(Z=J.n()).done;){var K=Z.value,X={},H=A(K,"attributes",{});for(var Y in H)X[W[Y.toLowerCase()]]=H[Y];d.featureSet.features.push({attributes:X,geometry:L(A(K,"geometry",null))})}}catch($){J.e($)}finally{J.f()}}else z=null,d.featureSet.features=z}}if(!1===G(d))throw new c.b(t,c.d.InvalidParameter,r);return""===((null===d||void 0===d||null===(u=d.layerDefinition)||void 0===u?void 0:u.geometryType)||"")&&(d.layerDefinition.geometryType="esriGeometryNull"),O.a.create(d,t.spatialReference)}))},e.signatures.push({name:"featureset",min:1,max:1}),e.functions.filter=function(t,r){return e.standardFunctionAsync(t,r,function(){var s=Object(i.a)(Object(a.a)().mark((function i(s,u,l){var o,d,f,b,y,_,m,g,O,k,j,w,x,I,D;return Object(a.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(Object(p.d)(l,2,2,t,r),!Object(p.S)(l[0])&&!Object(p.U)(l[0])){a.next=36;break}if(o=[],(d=l[0])instanceof h.a&&(d=d.toArray()),f=null,Object(p.O)(l[1])){a.next=7;break}throw new c.b(t,c.d.InvalidParameter,r);case 7:f=l[1].createFunction(t),b=Object(n.a)(d),a.prev=9,b.s();case 11:if((y=b.n()).done){a.next=27;break}if(_=y.value,m=f(_),!Object(F.j)(m)){a.next=24;break}return a.t0=!0,a.next=18,m;case 18:if(a.t1=a.sent,a.t2=a.t0===a.t1,!a.t2){a.next=22;break}o.push(_);case 22:a.next=25;break;case 24:!0===m&&o.push(_);case 25:a.next=11;break;case 27:a.next=32;break;case 29:a.prev=29,a.t3=a.catch(9),b.e(a.t3);case 32:return a.prev=32,b.f(),a.finish(32);case 35:return a.abrupt("return",o);case 36:if(!Object(p.X)(l[0])){a.next=59;break}return a.next=39,l[0].load();case 39:if(g=a.sent,O=S.WhereClause.create(l[1],g.getFieldsIndex()),!((k=O.getVariables()).length>0)){a.next=58;break}j=[],w=0;case 45:if(!(w<k.length)){a.next=55;break}return x={name:k[w]},a.t4=j,a.next=50,e.evaluateIdentifier(t,x);case 50:a.t5=a.sent,a.t4.push.call(a.t4,a.t5);case 52:w++,a.next=45;break;case 55:for(I={},D=0;D<k.length;D++)I[k[D]]=j[D];return a.abrupt("return",(O.parameters=I,new v.a({parentfeatureset:l[0],whereclause:O})));case 58:return a.abrupt("return",new v.a({parentfeatureset:l[0],whereclause:O}));case 59:throw new c.b(t,c.d.InvalidParameter,r);case 60:case"end":return a.stop()}}),i,null,[[9,29,32,35]])})));return function(e,t,r){return s.apply(this,arguments)}}())},e.signatures.push({name:"filter",min:2,max:2}),e.functions.orderby=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(n,i,s){var u;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(s,2,2,t,r),!Object(p.X)(s[0])){e.next=3;break}return u=new k.a(s[1]),e.abrupt("return",new _.a({parentfeatureset:s[0],orderbyclause:u}));case 3:throw new c.b(t,c.d.InvalidParameter,r);case 4:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}())},e.signatures.push({name:"orderby",min:2,max:2}),e.functions.top=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(n,i,s){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(s,2,2,t,r),!Object(p.X)(s[0])){e.next=2;break}return e.abrupt("return",new m.a({parentfeatureset:s[0],topnum:s[1]}));case 2:if(!Object(p.S)(s[0])){e.next=4;break}return e.abrupt("return",Object(p.M)(s[1])>=s[0].length?s[0].slice(0):s[0].slice(0,Object(p.M)(s[1])));case 4:if(!Object(p.U)(s[0])){e.next=6;break}return e.abrupt("return",Object(p.M)(s[1])>=s[0].length()?s[0].slice(0):s[0].slice(0,Object(p.M)(s[1])));case 6:throw new c.b(t,c.d.InvalidParameter,r);case 7:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}())},e.signatures.push({name:"top",min:2,max:2}),e.functions.first=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(n,i,s){var u,l;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(s,1,1,t,r),!Object(p.X)(s[0])){e.next=8;break}return e.next=3,s[0].first(n.abortSignal);case 3:if(null===(u=e.sent)){e.next=7;break}return l=o.a.createFromGraphicLikeObject(u.geometry,u.attributes,s[0],t.timeReference),e.abrupt("return",(l._underlyingGraphic=u,l));case 7:return e.abrupt("return",u);case 8:return e.abrupt("return",Object(p.S)(s[0])?0===s[0].length?null:s[0][0]:Object(p.U)(s[0])?0===s[0].length()?null:s[0].get(0):null);case 9:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}())},e.signatures.push({name:"first",min:1,max:1}),e.functions.attachments=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(n,i,s){var u,o,d;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(s,1,2,t,r),u={minsize:-1,maxsize:-1,types:null,returnMetadata:!1},!(s.length>1)){e.next=9;break}if(!(s[1]instanceof l.a)){e.next=7;break}s[1].hasField("minsize")&&(u.minsize=Object(p.M)(s[1].field("minsize"))),s[1].hasField("metadata")&&(u.returnMetadata=Object(p.N)(s[1].field("metadata"))),s[1].hasField("maxsize")&&(u.maxsize=Object(p.M)(s[1].field("maxsize"))),s[1].hasField("types")&&(o=Object(p.D)(s[1].field("types"),!1)).length>0&&(u.types=o),e.next=9;break;case 7:if(null===s[1]){e.next=9;break}throw new c.b(t,c.d.InvalidParameter,r);case 9:if(!Object(p.V)(s[0])){e.next=25;break}if((d=s[0]._layer)instanceof I.default&&(d=Object(f.constructFeatureSet)(d,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null!==d){e.next=16;break}e.t0=[],e.next=24;break;case 16:if(!1!==Object(p.X)(d)){e.next=20;break}e.t1=[],e.next=23;break;case 20:return e.next=22,d.load();case 22:e.t1=d.queryAttachments(s[0].field(d.objectIdField),u.minsize,u.maxsize,u.types,u.returnMetadata);case 23:e.t0=e.t1;case 24:return e.abrupt("return",e.t0);case 25:if(null!==s[0]){e.next=27;break}return e.abrupt("return",[]);case 27:throw new c.b(t,c.d.InvalidParameter,r);case 28:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}())},e.signatures.push({name:"attachments",min:1,max:2}),e.functions.featuresetbyrelationshipname=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(n,i,s){var u,l,o,d,h,b,y,v,_,m,O,k;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(s,2,4,t,r),u=s[0],l=Object(p.P)(s[1]),o=Object(p.e)(s[2],null),d=Object(p.N)(Object(p.e)(s[3],!0)),null===o&&(o=["*"]),!1!==Object(p.S)(o)){e.next=6;break}throw new c.b(t,c.d.InvalidParameter,r);case 6:if(null!==s[0]){e.next=8;break}return e.abrupt("return",null);case 8:if(Object(p.V)(s[0])){e.next=10;break}throw new c.b(t,c.d.InvalidParameter,r);case 10:if((h=u._layer)instanceof I.default&&(h=Object(f.constructFeatureSet)(h,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null!==h){e.next=13;break}return e.abrupt("return",null);case 13:if(!1!==Object(p.X)(h)){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,h.load();case 17:if(h=e.sent,b=h.relationshipMetaData().filter((function(e){return e.name===l})),0!==b.length){e.next=21;break}return e.abrupt("return",null);case 21:if(!(void 0!==b[0].relationshipTableId&&null!==b[0].relationshipTableId&&b[0].relationshipTableId>-1)){e.next=23;break}return e.abrupt("return",Object(f.constructFeatureSetFromRelationship)(h,b[0],u.field(h.objectIdField),h.spatialReference,o,d,t.lrucache,t.interceptor));case 23:if(y=h.serviceUrl()){e.next=26;break}return e.abrupt("return",null);case 26:return y="/"===y.charAt(y.length-1)?y+b[0].relatedTableId.toString():y+"/"+b[0].relatedTableId.toString(),e.next=29,Object(f.constructFeatureSetFromUrl)(y,h.spatialReference,o,d,t.lrucache,t.interceptor);case 29:return v=e.sent,e.next=32,v.load();case 32:if(_=(_=v.relationshipMetaData()).filter((function(e){return e.id===b[0].id})),!1!==u.hasField(b[0].keyField)&&null!==u.field(b[0].keyField)){e.next=41;break}return e.next=36,h.getFeatureByObjectId(u.field(h.objectIdField),[b[0].keyField]);case 36:if(!(m=e.sent)){e.next=40;break}return O=S.WhereClause.create(_[0].keyField+"= @id",v.getFieldsIndex()),e.abrupt("return",(O.parameters={id:m.attributes[b[0].keyField]},v.filter(O)));case 40:return e.abrupt("return",new g.a({parentfeatureset:v}));case 41:return k=S.WhereClause.create(_[0].keyField+"= @id",v.getFieldsIndex()),e.abrupt("return",(k.parameters={id:u.field(b[0].keyField)},v.filter(k)));case 43:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}())},e.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),e.functions.featuresetbyassociation=function(t,r){return e.standardFunctionAsync(t,r,function(){var e=Object(i.a)(Object(a.a)().mark((function e(i,s,u){var l,o,d,h,b,v,_,m,g,O,k,w,x,F,C,T,R,N,A,P,E,L,G,q,M,B,U,W,V,Q,z,Z,J,K,X,H,Y,$,ee,te,re;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.d)(u,2,3,t,r),l=u[0],o=Object(p.P)(Object(p.e)(u[1],"")).toLowerCase(),d=Object(p.I)(u[2])?Object(p.P)(u[2]):null,null!==u[0]){e.next=4;break}return e.abrupt("return",null);case 4:if(Object(p.V)(u[0])){e.next=6;break}throw new c.b(t,c.d.InvalidParameter,r);case 6:if((h=l._layer)instanceof I.default&&(h=Object(f.constructFeatureSet)(h,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null!==h){e.next=9;break}return e.abrupt("return",null);case 9:if(!1!==Object(p.X)(h)){e.next=11;break}return e.abrupt("return",null);case 11:return e.next=13,h.load();case 13:return b=h.serviceUrl(),e.next=16,Object(f.constructAssociationMetaDataFeatureSetFromUrl)(b,t.spatialReference);case 16:if(v=e.sent,_=null,m=null,g=!1,null!==d&&""!==d&&void 0!==d){O=Object(n.a)(v.terminals);try{for(O.s();!(k=O.n()).done;)(w=k.value).terminalName===d&&(m=w.terminalId)}catch(a){O.e(a)}finally{O.f()}null===m&&(g=!0)}x=v.associations.getFieldsIndex(),F=x.get("TOGLOBALID").name,C=x.get("FROMGLOBALID").name,T=x.get("TOTERMINALID").name,R=x.get("FROMTERMINALID").name,N=x.get("FROMNETWORKSOURCEID").name,A=x.get("TONETWORKSOURCEID").name,P=x.get("ASSOCIATIONTYPE").name,E=x.get("ISCONTENTVISIBLE").name,L=x.get("OBJECTID").name,G=Object(n.a)(h.fields),e.prev=21,G.s();case 23:if((q=G.n()).done){e.next=30;break}if("global-id"!==(M=q.value).type){e.next=28;break}return _=l.field(M.name),e.abrupt("break",30);case 28:e.next=23;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(21),G.e(e.t0);case 35:return e.prev=35,G.f(),e.finish(35);case 38:for(Z in B=null,U=new y.d(new D.a({name:"percentalong",alias:"percentalong",type:"double"}),S.WhereClause.create("0",v.associations.getFieldsIndex())),W=new y.d(new D.a({name:"side",alias:"side",type:"string"}),S.WhereClause.create("''",v.associations.getFieldsIndex())),V="globalid",Q="globalId",z={},v.lkp)z[Z]=v.lkp[Z].sourceId;J=new y.e(new D.a({name:"classname",alias:"classname",type:"string"}),null,z),K="",e.t1=o,e.next="midspan"===e.t1?46:"junctionedge"===e.t1?50:"connected"===e.t1?54:"container"===e.t1?59:"content"===e.t1?61:"structure"===e.t1?63:"attached"===e.t1?65:67;break;case 46:return K="((".concat(F,"='").concat(_,"') OR ( ").concat(C,"='").concat(_,"')) AND (").concat(P," IN (5))"),J.codefield=S.WhereClause.create("CASE WHEN (".concat(F,"='").concat(_,"') THEN ").concat(N," ELSE ").concat(A," END"),v.associations.getFieldsIndex()),(X=Object(j.c)(y.a.findField(v.associations.fields,C))).name=V,X.alias=V,B=new y.d(X,S.WhereClause.create("CASE WHEN (".concat(C,"='").concat(_,"') THEN ").concat(F," ELSE ").concat(C," END"),v.associations.getFieldsIndex())),U=v.unVersion>=4?new y.c(y.a.findField(v.associations.fields,x.get("PERCENTALONG").name)):new y.d(new D.a({name:"percentalong",alias:"percentalong",type:"double"}),S.WhereClause.create("0",v.associations.getFieldsIndex())),e.abrupt("break",68);case 50:return K="((".concat(F,"='").concat(_,"') OR ( ").concat(C,"='").concat(_,"')) AND (").concat(P," IN (4,6))"),J.codefield=S.WhereClause.create("CASE WHEN (".concat(F,"='").concat(_,"') THEN ").concat(N," ELSE ").concat(A," END"),v.associations.getFieldsIndex()),(H=Object(j.c)(y.a.findField(v.associations.fields,C))).name=V,H.alias=V,B=new y.d(H,S.WhereClause.create("CASE WHEN (".concat(C,"='").concat(_,"') THEN ").concat(F," ELSE ").concat(C," END"),v.associations.getFieldsIndex())),W=new y.d(new D.a({name:"side",alias:"side",type:"string"}),S.WhereClause.create("CASE WHEN (".concat(P,"=4) THEN 'from' ELSE 'to' END"),v.associations.getFieldsIndex())),e.abrupt("break",68);case 54:return ee="".concat(F,"='@T'"),te="".concat(C,"='@T'"),null!==m&&(ee+=" AND ".concat(T,"=@A"),te+=" AND ".concat(R,"=@A")),K="(("+ee+") OR ("+te+"))",K=Object(p.q)(K,"@T",null!==(Y=_)&&void 0!==Y?Y:""),ee=Object(p.q)(ee,"@T",null!==($=_)&&void 0!==$?$:""),null!==m&&(ee=Object(p.q)(ee,"@A",m.toString()),K=Object(p.q)(K,"@A",m.toString())),J.codefield=S.WhereClause.create("CASE WHEN "+ee+" THEN ".concat(N," ELSE ").concat(A," END"),v.associations.getFieldsIndex()),(re=Object(j.c)(y.a.findField(v.associations.fields,C))).name=V,re.alias=V,B=new y.d(re,S.WhereClause.create("CASE WHEN "+ee+" THEN ".concat(C," ELSE ").concat(F," END"),v.associations.getFieldsIndex())),e.abrupt("break",68);case 59:return K="".concat(F,"='").concat(_,"' AND ").concat(P," = 2"),null!==m&&(K+=" AND ".concat(T," = ")+m.toString()),J.codefield=N,K="( "+K+" )",B=new y.b(y.a.findField(v.associations.fields,C),V,V),e.abrupt("break",68);case 61:return K="(".concat(C,"='").concat(_,"' AND ").concat(P," = 2)"),null!==m&&(K+=" AND ".concat(R," = ")+m.toString()),J.codefield=A,K="( "+K+" )",B=new y.b(y.a.findField(v.associations.fields,F),V,V),e.abrupt("break",68);case 63:return K="(".concat(F,"='").concat(_,"' AND ").concat(P," = 3)"),null!==m&&(K+=" AND ".concat(T," = ")+m.toString()),J.codefield=N,K="( "+K+" )",B=new y.b(y.a.findField(v.associations.fields,C),V,Q),e.abrupt("break",68);case 65:return K="(".concat(C,"='").concat(_,"' AND ").concat(P," = 3)"),null!==m&&(K+=" AND ".concat(R," = ")+m.toString()),J.codefield=A,K="( "+K+" )",B=new y.b(y.a.findField(v.associations.fields,F),V,Q),e.abrupt("break",68);case 67:throw new c.b(t,c.d.InvalidParameter,r);case 68:return g&&(K="1 <> 1"),e.abrupt("return",new y.a({parentfeatureset:v.associations,adaptedFields:[new y.c(y.a.findField(v.associations.fields,L)),new y.c(y.a.findField(v.associations.fields,E)),B,W,J,U],extraFilter:K?S.WhereClause.create(K,v.associations.getFieldsIndex()):null}));case 70:case"end":return e.stop()}}),e,null,[[21,32,35,38]])})));return function(t,r,a){return e.apply(this,arguments)}}())},e.signatures.push({name:"featuresetbyassociation",min:2,max:6}),e.functions.groupby=function(t,r){return e.standardFunctionAsync(t,r,function(){var s=Object(i.a)(Object(a.a)().mark((function i(s,u,o){var d,f,h,b,y,v,_,m,g,O,k,j,x,F,I,D,C,T,N,A,P,E,L,G,q,M,B,U,W,V,Q,z,Z,J,K,X,H,Y;return Object(a.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(Object(p.d)(o,3,3,t,r),Object(p.X)(o[0])){a.next=2;break}throw new c.b(t,c.d.InvalidParameter,r);case 2:return a.next=4,o[0].load();case 4:if(d=a.sent,f=[],h=[],b=!1,y=[],!Object(p.I)(o[1])){a.next=12;break}y.push(o[1]),a.next=23;break;case 12:if(!(o[1]instanceof l.a)){a.next=16;break}y.push(o[1]),a.next=23;break;case 16:if(!Object(p.S)(o[1])){a.next=20;break}y=o[1],a.next=23;break;case 20:if(Object(p.U)(o[1])){a.next=22;break}throw new c.b(t,c.d.InvalidParameter,r);case 22:y=o[1].toArray();case 23:v=Object(n.a)(y),a.prev=24,v.s();case 26:if((_=v.n()).done){a.next=41;break}if(m=_.value,!Object(p.I)(m)){a.next=33;break}g=S.WhereClause.create(Object(p.P)(m),d.getFieldsIndex()),O=!0===Object(w.d)(g)?Object(p.P)(m):"%%%%FIELDNAME",f.push({name:O,expression:g}),"%%%%FIELDNAME"===O&&(b=!0),a.next=39;break;case 33:if(m instanceof l.a){a.next=35;break}throw new c.b(t,c.d.InvalidParameter,r);case 35:if(k=m.hasField("name")?m.field("name"):"%%%%FIELDNAME",j=m.hasField("expression")?m.field("expression"):"","%%%%FIELDNAME"===k&&(b=!0),k){a.next=38;break}throw new c.b(t,c.d.InvalidParameter,r);case 38:f.push({name:k,expression:S.WhereClause.create(j||k,d.getFieldsIndex())});case 39:a.next=26;break;case 41:a.next=46;break;case 43:a.prev=43,a.t0=a.catch(24),v.e(a.t0);case 46:return a.prev=46,v.f(),a.finish(46);case 49:if(y=[],!Object(p.I)(o[2])){a.next=53;break}y.push(o[2]),a.next=64;break;case 53:if(!Object(p.S)(o[2])){a.next=57;break}y=o[2],a.next=64;break;case 57:if(!Object(p.U)(o[2])){a.next=61;break}y=o[2].toArray(),a.next=64;break;case 61:if(o[2]instanceof l.a){a.next=63;break}throw new c.b(t,c.d.InvalidParameter,r);case 63:y.push(o[2]);case 64:x=Object(n.a)(y),a.prev=65,x.s();case 67:if((F=x.n()).done){a.next=77;break}if((I=F.value)instanceof l.a){a.next=71;break}throw new c.b(t,c.d.InvalidParameter,r);case 71:if(D=I.hasField("name")?I.field("name"):"",C=I.hasField("statistic")?I.field("statistic"):"",T=I.hasField("expression")?I.field("expression"):"",D&&C&&T){a.next=74;break}throw new c.b(t,c.d.InvalidParameter,r);case 74:h.push({name:D,statistic:C.toLowerCase(),expression:S.WhereClause.create(T,d.getFieldsIndex())});case 75:a.next=67;break;case 77:a.next=82;break;case 79:a.prev=79,a.t1=a.catch(65),x.e(a.t1);case 82:return a.prev=82,x.f(),a.finish(82);case 85:if(b){N={},A=Object(n.a)(d.fields);try{for(A.s();!(P=A.n()).done;)E=P.value,N[E.name.toLowerCase()]=1}catch(i){A.e(i)}finally{A.f()}L=Object(n.a)(f);try{for(L.s();!(G=L.n()).done;)"%%%%FIELDNAME"!==(q=G.value).name&&(N[q.name.toLowerCase()]=1)}catch(i){L.e(i)}finally{L.f()}M=Object(n.a)(h);try{for(M.s();!(B=M.n()).done;)"%%%%FIELDNAME"!==(U=B.value).name&&(N[U.name.toLowerCase()]=1)}catch(i){M.e(i)}finally{M.f()}W=0,V=Object(n.a)(f);try{for(V.s();!(Q=V.n()).done;)if("%%%%FIELDNAME"===(z=Q.value).name){for(;1===N["field_"+W.toString()];)W++;N["field_"+W.toString()]=1,z.name="FIELD_"+W.toString()}}catch(i){V.e(i)}finally{V.f()}}Z=0,J=f;case 87:if(!(Z<J.length)){a.next=94;break}return K=J[Z],a.next=91,R(K.expression,e,t);case 91:Z++,a.next=87;break;case 94:X=0,H=h;case 95:if(!(X<H.length)){a.next=102;break}return Y=H[X],a.next=99,R(Y.expression,e,t);case 99:X++,a.next=95;break;case 102:return a.abrupt("return",o[0].groupby(f,h));case 103:case"end":return a.stop()}}),i,null,[[24,43,46,49],[65,79,82,85]])})));return function(e,t,r){return s.apply(this,arguments)}}())},e.signatures.push({name:"groupby",min:3,max:3}),e.functions.distinct=function(t,r){return e.standardFunctionAsync(t,r,function(){var s=Object(i.a)(Object(a.a)().mark((function i(s,u,o){var d,f,h,b,y,v,_,m,g,O,k,j,x,F,I,D,C,N,A,P,E,L,G,q,M;return Object(a.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!Object(p.X)(o[0])){a.next=59;break}return Object(p.d)(o,2,2,t,r),a.next=4,o[0].load();case 4:if(d=a.sent,f=[],h=[],!Object(p.I)(o[1])){a.next=11;break}h.push(o[1]),a.next=22;break;case 11:if(!(o[1]instanceof l.a)){a.next=15;break}h.push(o[1]),a.next=22;break;case 15:if(!Object(p.S)(o[1])){a.next=19;break}h=o[1],a.next=22;break;case 19:if(Object(p.U)(o[1])){a.next=21;break}throw new c.b(t,c.d.InvalidParameter,r);case 21:h=o[1].toArray();case 22:b=!1,y=Object(n.a)(h),a.prev=24,y.s();case 26:if((v=y.n()).done){a.next=41;break}if(_=v.value,!Object(p.I)(_)){a.next=33;break}m=S.WhereClause.create(Object(p.P)(_),d.getFieldsIndex()),g=!0===Object(w.d)(m)?Object(p.P)(_):"%%%%FIELDNAME",f.push({name:g,expression:m}),"%%%%FIELDNAME"===g&&(b=!0),a.next=39;break;case 33:if(_ instanceof l.a){a.next=35;break}throw new c.b(t,c.d.InvalidParameter,r);case 35:if(O=_.hasField("name")?_.field("name"):"%%%%FIELDNAME",k=_.hasField("expression")?_.field("expression"):"","%%%%FIELDNAME"===O&&(b=!0),O){a.next=38;break}throw new c.b(t,c.d.InvalidParameter,r);case 38:f.push({name:O,expression:S.WhereClause.create(k||O,d.getFieldsIndex())});case 39:a.next=26;break;case 41:a.next=46;break;case 43:a.prev=43,a.t0=a.catch(24),y.e(a.t0);case 46:return a.prev=46,y.f(),a.finish(46);case 49:if(b){j={},x=Object(n.a)(d.fields);try{for(x.s();!(F=x.n()).done;)I=F.value,j[I.name.toLowerCase()]=1}catch(i){x.e(i)}finally{x.f()}D=Object(n.a)(f);try{for(D.s();!(C=D.n()).done;)"%%%%FIELDNAME"!==(N=C.value).name&&(j[N.name.toLowerCase()]=1)}catch(i){D.e(i)}finally{D.f()}A=0,P=Object(n.a)(f);try{for(P.s();!(E=P.n()).done;)if("%%%%FIELDNAME"===(L=E.value).name){for(;1===j["field_"+A.toString()];)A++;j["field_"+A.toString()]=1,L.name="FIELD_"+A.toString()}}catch(i){P.e(i)}finally{P.f()}}G=0,q=f;case 51:if(!(G<q.length)){a.next=58;break}return M=q[G],a.next=55,R(M.expression,e,t);case 55:G++,a.next=51;break;case 58:return a.abrupt("return",o[0].groupby(f,[]));case 59:return a.abrupt("return",T("distinct",0,0,o));case 60:case"end":return a.stop()}}),i,null,[[24,43,46,49]])})));return function(e,t,r){return s.apply(this,arguments)}}())})}},572:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return f}));var a=r(1),n=r(4),i=r(12),s=r(221),u=r(408),l=r(235),c=r(210);function o(e,t,r){return d.apply(this,arguments)}function d(){return d=Object(i.a)(Object(n.a)().mark((function e(t,r,a){var i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,r,a);case 2:return i=e.sent,e.abrupt("return",l.a.fromJSON(i));case 4:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function f(e,t,r){return h.apply(this,arguments)}function h(){return h=Object(i.a)(Object(n.a)().mark((function e(t,r,i){var l,o,d,f,h;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=Object(s.c)(t),o=Object(a.a)({},i),d=c.a.from(r),e.next=5,Object(u.a)(l,d,d.sourceSpatialReference,o);case 5:return f=e.sent,h=f.data,e.abrupt("return",h);case 8:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}},649:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var a,n=r(89),i=r(88),s=r(90),u=r(91),l=r(94),c=r(105),o=r(97),d=r(96),f=(r(98),r(93),r(95));var h={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}},p=a=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).contentType=null,a.exifInfo=null,a.id=null,a.globalId=null,a.keywords=null,a.name=null,a.parentGlobalId=null,a.parentObjectId=null,a.size=null,a.url=null,a}return Object(i.a)(r,[{key:"orientationInfo",get:function(){var e=function(e){var t=e.exifInfo,r=e.exifName,a=e.tagName;if(!t||!r||!a)return null;var n=t.find((function(e){return e.name===r}));return n?function(e){var t=e.tagName,r=e.tags;if(!r||!t)return null;var a=r.find((function(e){return e.name===t}));return a&&a.value||null}({tagName:a,tags:n.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:this.exifInfo});return h[e]||null}},{key:"clone",value:function(){return new a({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}}]),r}(c.a);Object(l.a)([Object(o.b)({type:String})],p.prototype,"contentType",void 0),Object(l.a)([Object(o.b)()],p.prototype,"exifInfo",void 0),Object(l.a)([Object(o.b)({readOnly:!0})],p.prototype,"orientationInfo",null),Object(l.a)([Object(o.b)({type:d.a})],p.prototype,"id",void 0),Object(l.a)([Object(o.b)({type:String})],p.prototype,"globalId",void 0),Object(l.a)([Object(o.b)({type:String})],p.prototype,"keywords",void 0),Object(l.a)([Object(o.b)({type:String})],p.prototype,"name",void 0),Object(l.a)([Object(o.b)({json:{read:!1}})],p.prototype,"parentGlobalId",void 0),Object(l.a)([Object(o.b)({json:{read:!1}})],p.prototype,"parentObjectId",void 0),Object(l.a)([Object(o.b)({type:d.a})],p.prototype,"size",void 0),Object(l.a)([Object(o.b)({json:{read:!1}})],p.prototype,"url",void 0);var b=p=a=Object(l.a)([Object(f.a)("esri.layers.support.AttachmentInfo")],p)},819:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(4),n=r(1),i=r(12),s=r(221),u=r(408),l=r(210);function c(e,t,r){return o.apply(this,arguments)}function o(){return o=Object(i.a)(Object(a.a)().mark((function e(t,r,i){var c;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object(s.c)(t),e.abrupt("return",Object(u.b)(c,l.a.from(r),Object(n.a)({},i)).then((function(e){return e.data.count})));case 2:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}},820:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(4),n=r(1),i=r(12),s=r(221),u=r(408),l=r(210);function c(e,t,r){return o.apply(this,arguments)}function o(){return o=Object(i.a)(Object(a.a)().mark((function e(t,r,i){var c;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object(s.c)(t),e.abrupt("return",Object(u.d)(c,l.a.from(r),Object(n.a)({},i)).then((function(e){return e.data.objectIds})));case 2:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}},922:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var a=r(4),n=r(12),i=r(89),s=r(88),u=r(90),l=r(91),c=r(366),o=r(441),d=r(450),f=r(358),h=r(532),p=r(110),b=r(436),y=r(125),v=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.actions.AttributeFilter",a._maxProcessing=1e3,a._parent=e.parentfeatureset,e.whereclause instanceof b.WhereClause?(a._whereclause=e.whereclause,a._whereClauseFunction=null):(a._whereClauseFunction=e.whereclause,a._whereclause=null),a}return Object(s.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new y.a({wkid:4326}),this.geometryType=f.o.point)}},{key:"_getSet",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){var r;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getFilteredSet("",null,this._whereclause,null,t);case 5:return r=e.sent,e.abrupt("return",(this._checkCancelled(t),null!==this._whereClauseFunction?this._wset=new d.a(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,this._clonePageDefinition(r.pagesDefinition)):this._wset=new d.a(r._candidates.slice(0),r._known.slice(0),r._ordered,this._clonePageDefinition(r.pagesDefinition)),this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){var t,r=null===(t=this._parent)||void 0===t?void 0:t._isInFeatureSet(e);return r===f.b.NotInFeatureSet?r:void 0===(r=this._idstates[e])?f.b.Unknown:r}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,a){return this._parent._getFeatures(e,t,r,a)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeWhereClause",value:function(e){var t,r;return null!==(t=null===(r=this._whereclause)||void 0===r?void 0:r.testFeature(e))&&void 0!==t&&t}},{key:"executeWhereClauseDeferred",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t){var r;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this._whereClauseFunction){e.next=3;break}return r=this._whereClauseFunction(t),e.abrupt("return",(Object(p.j)(r),r));case 3:return e.abrupt("return",this.executeWhereClause(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchAndRefineFeatures",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n){var i,s,u,l,c,o,h,p,b,y,v;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new d.a([],t,!1,null),u=Math.min(r,t.length),e.next=3,null===(i=this._parent)||void 0===i?void 0:i._getFeatures(s,-1,u,n);case 3:if(this._checkCancelled(n),null!=this._whereClauseFunction){e.next=7;break}for(l=0;l<u;l++)o=null===(c=this._parent)||void 0===c?void 0:c._featureFromCache(t[l]),!0===this.executeWhereClause(o)?this._idstates[t[l]]=f.b.InFeatureSet:this._idstates[t[l]]=f.b.NotInFeatureSet;return e.abrupt("return","success");case 7:h=[],p=0;case 9:if(!(p<u)){e.next=19;break}return y=null===(b=this._parent)||void 0===b?void 0:b._featureFromCache(t[p]),e.t0=h,e.next=14,this.executeWhereClauseDeferred(y);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:p++,e.next=9;break;case 19:for(v=0;v<r;v++)!0===h[v]?this._idstates[t[v]]=f.b.InFeatureSet:this._idstates[t[v]]=f.b.NotInFeatureSet;return e.abrupt("return","success");case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s){var u;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==this._whereClauseFunction||(null!==n?null!==this._whereclause&&(n=Object(h.b)(this._whereclause,n)):n=this._whereclause),e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getFilteredSet(t,r,n,i,s);case 5:return u=e.sent,e.abrupt("return",(this._checkCancelled(s),null!==this._whereClauseFunction?new d.a(u._candidates.slice(0).concat(u._known.slice(0)),[],u._ordered,this._clonePageDefinition(u.pagesDefinition)):new d.a(u._candidates.slice(0),u._known.slice(0),u._ordered,this._clonePageDefinition(u.pagesDefinition))));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s,u,l){var c,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this._whereClauseFunction){e.next=2;break}return e.abrupt("return",null===s&&""===n&&null===i?this._manualStat(t,r,u,l):{calculated:!1});case 2:return c=this._whereclause,null!==s&&null!==this._whereclause&&(c=Object(h.b)(this._whereclause,s)),e.next=6,this._parent._stat(t,r,n,i,c,u,l);case 6:return o=e.sent,e.abrupt("return",!1===o.calculated?null===s&&""===n&&null===i?this._manualStat(t,r,u,l):{calculated:!1}:o);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===this._whereClauseFunction&&(null!==s?null!==this._whereclause&&(s=Object(h.b)(this._whereclause,s)):s=this._whereclause,null!==this._parent&&this._parent._canDoAggregates(t,r,n,i,s)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=Object(n.a)(Object(a.a)().mark((function e(t,r,n,i,s,u,l){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new c.a(c.b.NeverReach);case 2:return e.abrupt("return",(null!==s?null!==this._whereclause&&(s=Object(h.b)(this._whereclause,s)):s=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(t,r,n,i,s,u,l)));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){o.a._featuresetFunctions.filter=function(e){if("function"==typeof e)return new r({parentfeatureset:this,whereclause:e});var t=null;return e instanceof b.WhereClause&&(t=e),new r({parentfeatureset:this,whereclause:t})}}}]),r}(o.a)},923:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var a=r(92),n=r(4),i=r(12),s=r(89),u=r(88),l=r(90),c=r(91),o=r(357),d=r(366),f=r(441),h=r(450),p=r(924),b=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a;return Object(s.a)(this,r),(a=t.call(this,e))._orderbyclause=null,a.declaredClass="esri.arcade.featureset.actions.OrderBy",a._maxProcessing=100,a._orderbyclause=e.orderbyclause,a._parent=e.parentfeatureset,a}return Object(u.a)(r,[{key:"_getSet",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,this._orderbyclause,t);case 5:return r=e.sent,e.abrupt("return",(this._checkCancelled(t),this._wset=r,this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"manualOrderSet",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r){var a,i,s,u;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdColumnDictionary(t,[],-1,r);case 2:for(i=e.sent,null===(a=this._orderbyclause)||void 0===a||a.order(i),s=new h.a([],[],!0,null),u=0;u<i.length;u++)s._known.push(i[u].id);return e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getIdColumnDictionary",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,i,s){var u,l,c,d,f,h,p;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<t._known.length-1)){e.next=17;break}if(u=this._maxQueryRate(),"GETPAGES"!==t._known[i+1]){e.next=6;break}return e.next=5,Object(o.a)(this._parent._expandPagedSet(t,u,0,0,s));case 5:return e.abrupt("return",this.getIdColumnDictionary(t,r,i,s));case 6:for(l=i+1,c=[];l<t._known.length&&"GETPAGES"!==t._known[l];)c.push(t._known[l]),l++;return i+=c.length,e.next=12,Object(o.a)(this._parent._getFeatureBatch(c,s));case 12:d=e.sent,this._checkCancelled(s),f=Object(a.a)(d);try{for(f.s();!(h=f.n()).done;)p=h.value,r.push({id:p.attributes[this.objectIdField],feature:p})}catch(n){f.e(n)}finally{f.f()}return e.abrupt("return",this.getIdColumnDictionary(t,r,i,s));case 17:if(!(t._candidates.length>0)){e.next=24;break}return e.next=20,Object(o.a)(this._refineSetBlock(t,this._maxProcessingRate(),s));case 20:this._checkCancelled(s),e.t0=this.getIdColumnDictionary(t,r,i,s),e.next=25;break;case 24:e.t0=r;case 25:return e.abrupt("return",e.t0);case 26:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,a){return this._parent._getFeatures(e,t,r,a)}},{key:"_featureFromCache",value:function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}},{key:"_fetchAndRefineFeatures",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new d.a(d.b.NeverReach);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,a,i,s){var u,l,c,o;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this._parent._getFilteredSet(t,r,a,null===i?this._orderbyclause:i,s);case 4:if(u=e.sent,this._checkCancelled(s),l=new h.a(u._candidates.slice(0),u._known.slice(0),u._ordered,this._clonePageDefinition(u.pagesDefinition)),c=!0,u._candidates.length>0&&(c=!1),!1!==l._ordered){e.next=13;break}return e.next=11,this.manualOrderSet(l,s);case 11:return o=e.sent,e.abrupt("return",(!1===c&&(null===r&&null===a||(o=new h.a(o._candidates.slice(0).concat(o._known.slice(0)),[],o._ordered,this._clonePageDefinition(o.pagesDefinition)))),o));case 13:return e.abrupt("return",l);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){f.a._featuresetFunctions.orderBy=function(e){return""===e?this:new r({parentfeatureset:this,orderbyclause:new p.a(e)})}}}]),r}(f.a)},924:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(92),n=r(89),i=r(88);function s(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}var u=function(){function e(t){Object(n.a)(this,e);var r=t.split(",");this._fields=[],this._directions=[];for(var a=0;a<r.length;a++){var i=r[a].match(/\S+/g);this._fields.push(i[0]),2===i.length?"asc"===i[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return Object(i.a)(e,[{key:"constructClause",value:function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}},{key:"order",value:function(e){var t=this;e.sort((function(e,r){for(var a=0;a<t._fields.length;a++){var n,i=t.featureValue(e.feature,t._fields[a],a),u=t.featureValue(r.feature,t._fields[a],a);if(0!==(n=1===t._directions[a]?s(i,u):-1*s(i,u)))return n}return 0}))}},{key:"scanForField",value:function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}},{key:"replaceFields",value:function(t){for(var r="",n=0;n<this._fields.length;n++){0!==n&&(r+=",");var i,s=this._fields[n],u=Object(a.a)(t);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(s.toLowerCase()===l.field.toLowerCase()){s=l.newfield;break}}}catch(c){u.e(c)}finally{u.f()}r+=s,1===this._directions[n]?r+=" ASC":r+=" DESC"}return new e(r)}},{key:"featureValue",value:function(e,t,r){var a=e.attributes[t];if(void 0!==a)return a;for(var n in e.attributes)if(t.toLowerCase()===n.toLowerCase())return this._fields[r]=n,e.attributes[n];return null}}]),e}()}}]);
//# sourceMappingURL=176.c724dd01.chunk.js.map