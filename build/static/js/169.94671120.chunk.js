(this["webpackJsonpklw-bank"]=this["webpackJsonpklw-bank"]||[]).push([[169,246],{115:function(e,t,r){"use strict";r.d(t,"a",(function(){return M})),r.d(t,"b",(function(){return L})),r.d(t,"c",(function(){return S})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return T})),r.d(t,"g",(function(){return x})),r.d(t,"h",(function(){return p})),r.d(t,"i",(function(){return b})),r.d(t,"j",(function(){return _})),r.d(t,"k",(function(){return d}));var n=r(107),i=r(106),a=r(90),s=r(91),o=r(89),c=r(88),u=r(34),l=r(1),h=r(101),f=r(155),v=r(103);var y=Object.keys(v.e).filter((function(e){return"number"==typeof v.e[e]})).reduce((function(e,t){return Object(l.a)(Object(l.a)({},e),{},Object(u.a)({},t,v.e[t]))}),{});function d(e){return e===v.e.OUTLINE_FILL||e===v.e.OUTLINE_FILL_SIMPLE}function b(e){return function(e){return e===v.e.SIMPLE||e===v.e.OUTLINE_FILL_SIMPLE}(e.symbologyType)}function p(e){return d(e.symbologyType)}function x(e,t){switch(e){case v.d.FILL:return M.from(t);case v.d.LINE:return S.from(t);case v.d.MARKER:return w.from(t);case v.d.TEXT:return T.from(t);case v.d.LABEL:return L.from(t);default:throw new Error("Unable to createMaterialKey for unknown geometryType ".concat(e))}}function _(e){switch(m.load(e).geometryType){case v.d.MARKER:return new w(e);case v.d.FILL:return new M(e);case v.d.LINE:return new S(e);case v.d.TEXT:return new T(e);case v.d.LABEL:return new L(e)}}var m=function(){function e(t){Object(o.a)(this,e),this._data=0,this._data=t}return Object(c.a)(e,[{key:"data",get:function(){return this._data},set:function(e){this._data=null!==e&&void 0!==e?e:0}},{key:"geometryType",get:function(){return this.bits(8,11)},set:function(e){this.setBits(e,8,11)}},{key:"mapAligned",get:function(){return!!this.bit(20)},set:function(e){this.setBit(20,e)}},{key:"sdf",get:function(){return!!this.bit(11)},set:function(e){this.setBit(11,null!==e&&void 0!==e&&e)}},{key:"pattern",get:function(){return!!this.bit(12)},set:function(e){this.setBit(12,e)}},{key:"textureBinding",get:function(){return this.bits(0,8)},set:function(e){this.setBits(e,0,8)}},{key:"symbologyType",get:function(){return this.bits(21,26)},set:function(e){this.setBits(e,21,26)}},{key:"geometryTypeString",get:function(){switch(this.geometryType){case v.d.FILL:return"fill";case v.d.MARKER:return"marker";case v.d.LINE:return"line";case v.d.TEXT:return"text";case v.d.LABEL:return"label";default:throw new h.a("Unable to handle unknown geometryType: ".concat(this.geometryType))}}},{key:"setBit",value:function(e,t){var r=1<<e;t?this._data|=r:this._data&=~r}},{key:"bit",value:function(e){return(this._data&1<<e)>>e}},{key:"setBits",value:function(e,t,r){for(var n=t,i=0;n<r;n++,i++)this.setBit(n,0!=(e&1<<i))}},{key:"bits",value:function(e,t){for(var r=0,n=e,i=0;n<t;n++,i++)r|=this.bit(n)<<i;return r}},{key:"hasVV",value:function(){return!1}},{key:"setVV",value:function(e,t){}},{key:"getVariation",value:function(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:v.e[this.symbologyType],options:y,namespace:"SYMBOLOGY_TYPE"}}}},{key:"getVariationHash",value:function(){return this._data&~(7&this.textureBinding)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}}]),e}();m.shared=new m(0);var g=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvSizeMinMaxValue",get:function(){return 0!==this.bit(16)},set:function(e){this.setBit(16,e)}},{key:"vvSizeScaleStops",get:function(){return 0!==this.bit(17)},set:function(e){this.setBit(17,e)}},{key:"vvSizeFieldStops",get:function(){return 0!==this.bit(18)},set:function(e){this.setBit(18,e)}},{key:"vvSizeUnitValue",get:function(){return 0!==this.bit(19)},set:function(e){this.setBit(19,e)}},{key:"hasSizeVV",value:function(){return this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.hasSizeVV()}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t);var a=function(e,t,r){var n=v.f.SIZE_FIELD_STOPS|v.f.SIZE_MINMAX_VALUE|v.f.SIZE_SCALE_STOPS|v.f.SIZE_UNIT_VALUE,i=(t&(v.g.FIELD_TARGETS_OUTLINE|v.g.MINMAX_TARGETS_OUTLINE|v.g.SCALE_TARGETS_OUTLINE|v.g.UNIT_TARGETS_OUTLINE))>>>4;return e===v.d.LINE&&r.isOutline||e===v.d.FILL&&d(r.symbologyType)?n&i:n&~i}(this.geometryType,e,t)&e;this.vvSizeMinMaxValue=!!(a&v.f.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(a&v.f.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(a&v.f.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(a&v.f.SIZE_SCALE_STOPS)}}]),r}(e)},O=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvRotation",get:function(){return 0!==this.bit(15)},set:function(e){this.setBit(15,e)}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.vvRotation}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t),this.vvRotation=!t.isOutline&&!!(e&v.f.ROTATION)}}]),r}(e)},j=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvColor",get:function(){return 0!==this.bit(13)},set:function(e){this.setBit(13,e)}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.vvColor}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t),this.vvColor=!t.isOutline&&!!(e&v.f.COLOR)}}]),r}(e)},k=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvOpacity",get:function(){return 0!==this.bit(14)},set:function(e){this.setBit(14,e)}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.vvOpacity}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t),this.vvOpacity=!t.isOutline&&!!(e&v.f.OPACITY)}}]),r}(e)},M=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=e.symbologyType,r=e.vvFlags,n=this.load(0);return n.geometryType=v.d.FILL,n.symbologyType=t,t!==v.e.DOT_DENSITY&&n.setVV(r,e),n.data}}]),r}(j(k(g(m))));M.shared=new M(0);var w=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=e.symbologyType,r=e.vvFlags,n=this.load(0);return n.geometryType=v.d.MARKER,n.symbologyType=t,t!==v.e.HEATMAP&&n.setVV(r,e),n.data}}]),r}(j(k(O(g(m)))));w.shared=new w(0);var S=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=v.d.LINE,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}}]),r}(j(k(g(m))));S.shared=new S(0);var T=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=v.d.TEXT,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}}]),r}(j(k(O(g(m)))));T.shared=new T(0);var L=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=v.d.LABEL,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.mapAligned=Object(f.i)(e.placement),t.data}}]),r}(g(m));L.shared=new L(0)},152:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return E})),r.d(t,"e",(function(){return o})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return s})),r.d(t,"h",(function(){return d})),r.d(t,"i",(function(){return T})),r.d(t,"j",(function(){return S})),r.d(t,"k",(function(){return P})),r.d(t,"l",(function(){return C})),r.d(t,"m",(function(){return L})),r.d(t,"n",(function(){return M})),r.d(t,"o",(function(){return w})),r.d(t,"p",(function(){return I})),r.d(t,"q",(function(){return z})),r.d(t,"r",(function(){return O})),r.d(t,"s",(function(){return g})),r.d(t,"t",(function(){return k})),r.d(t,"u",(function(){return _})),r.d(t,"v",(function(){return p})),r.d(t,"w",(function(){return m})),r.d(t,"x",(function(){return x})),r.d(t,"y",(function(){return a})),r.d(t,"z",(function(){return j})),r.d(t,"A",(function(){return V})),r.d(t,"B",(function(){return W})),r.d(t,"C",(function(){return y})),r.d(t,"D",(function(){return b}));var n=r(99),i=r(92);function a(e){return"function"==typeof e}function s(e,t,r,n){return a(e)?e(t,r,n):e}function o(e){return[e.r,e.g,e.b,e.a]}var c=" /-,\n";function u(e){for(var t=e.length;t--;)if(!c.includes(e.charAt(t)))return!1;return!0}function l(e,t){var r=[],n=0,i=-1;do{if((i=e.indexOf("[",n))>=n){if(i>n){var a=e.substr(n,i-n);r.push([a,null,u(a)])}if(n=i+1,(i=e.indexOf("]",n))>=n){if(i>n){var s=t[e.substr(n,i-n)];s&&r.push([null,s,!1])}n=i+1}}}while(-1!==i);if(n<e.length-1){var o=e.substr(n);r.push([o,null,u(o)])}return r}function h(e,t,r){var a,s="",o=null,c=Object(i.a)(t);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=Object(n.a)(u,3),h=l[0],f=l[1],y=l[2];if(h)y?o=h:(o&&(s+=o,o=null),s+=h);else{var d=e.attributes[f];d&&(o&&(s+=o,o=null),s+=d)}}}catch(b){c.e(b)}finally{c.f()}return v(s,r)}function f(e,t,r){var n=l(t,e);return function(e){return h(e,n,r)}}function v(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function y(e,t,r,n,i,a){for(var s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=t/i,c=r/a,u=Math.ceil(o/2),l=Math.ceil(c/2),h=0;h<a;h++)for(var f=0;f<i;f++){for(var v=4*(f+(s?a-h-1:h)*i),y=0,d=0,b=0,p=0,x=0,_=0,m=0,g=(h+.5)*c,O=Math.floor(h*c);O<(h+1)*c;O++)for(var j=Math.abs(g-(O+.5))/l,k=(f+.5)*o,M=j*j,w=Math.floor(f*o);w<(f+1)*o;w++){var S=Math.abs(k-(w+.5))/u,T=Math.sqrt(M+S*S);T>=-1&&T<=1&&((y=2*T*T*T-3*T*T+1)>0&&(m+=y*e[(S=4*(w+O*t))+3],b+=y,e[S+3]<255&&(y=y*e[S+3]/250),p+=y*e[S],x+=y*e[S+1],_+=y*e[S+2],d+=y))}n[v]=p/d,n[v+1]=x/d,n[v+2]=_/d,n[v+3]=m/b}}function d(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function b(e){var t,r;return null!==(t=null===(r=e.data)||void 0===r?void 0:r.symbol)&&void 0!==t?t:null}function p(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function x(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function _(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function m(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}var g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||isNaN(e)?t:e},O=function(e){return e.tintColor?d(e.tintColor):{r:255,g:255,b:255,a:1}},j=function(e){if(!e)return!1;var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){switch(t.value.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}}}catch(n){r.e(n)}finally{r.f()}return!1};function k(){return Promise.all([r.e(7),r.e(229)]).then(r.bind(null,434))}function M(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function w(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function S(e){var t="normal",r="normal";if(e){var n=e.toLowerCase();n.includes("italic")?t="italic":n.includes("oblique")&&(t="oblique"),n.includes("bold")?r="bold":n.includes("light")&&(r="lighter")}return{style:t,weight:r}}function T(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function L(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers){var t,r=Object(i.a)(e.symbolLayers);try{for(r.s();!(t=r.n()).done;){var n=L(t.value);if(null!=n)return n}}catch(a){r.e(a)}finally{r.f()}}break;case"CIMTextSymbol":return L(e.symbol);case"CIMSolidFill":return e.color}}function I(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":var t=e.symbolLayers;if(t){var r,n=Object(i.a)(t);try{for(n.s();!(r=n.n()).done;){var a=I(r.value);if(null!=a)return a}}catch(s){n.e(s)}finally{n.f()}}break;case"CIMTextSymbol":return I(e.symbol);case"CIMSolidStroke":return e.color}}function z(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers){var t,r=Object(i.a)(e.symbolLayers);try{for(r.s();!(t=r.n()).done;){var n=z(t.value);if(void 0!==n)return n}}catch(a){r.e(a)}finally{r.f()}}break;case"CIMTextSymbol":return z(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function P(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function C(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function E(e){return(e?Object.keys(e):[]).map((function(t){return{name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"}}))}var V=function(e){return e.includes("data:image/svg+xml")};function W(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}},1548:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(89),i=r(88),a=r(90),s=r(91),o=r(94),c=r(189),u=r(97),l=(r(96),r(98),r(93),r(95)),h=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"initialize",value:function(){}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(c.a);Object(o.a)([Object(u.b)({readOnly:!0})],h.prototype,"supportsTileUpdates",null),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"remoteClient",void 0),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"service",void 0),Object(o.a)([Object(u.b)()],h.prototype,"spatialReference",null),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"tileInfo",void 0),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"tileStore",void 0);var f=h=Object(o.a)([Object(l.a)("esri.views.2d.layers.features.processors.BaseProcessor")],h)},161:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return o})),r.d(t,"g",(function(){return a}));var n=0,i=100;function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t){return Math.sqrt(e*e+t*t)}function o(e){var t=s(e[0],e[1]);e[0]/=t,e[1]/=t}function c(e,t){return s(e[0]-t[0],e[1]-t[1])}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 1/Math.max(e,1)}function l(e,t){return[!(null===e||void 0===e||!e.minScale)&&t.scaleToZoom(e.minScale)||n,!(null===e||void 0===e||!e.maxScale)&&t.scaleToZoom(e.maxScale)||i]}},202:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));Math.PI;var n=256/360,i=1/Math.LN2;function a(e,t){return(e%=t)>=0?e:e+t}function s(e){return a(e*n,256)}function o(e){return Math.log(e)*i}},204:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(89),i=r(88),a=r(121),s=r(279),o=function(){function e(){Object(n.a)(this,e),this._materialKey=null}return Object(i.a)(e,[{key:"bindFeature",value:function(e,t,r){}},{key:"write",value:function(e,t,r,n){if(this._effects&&this._effects.length>0){var i=a.a.fromFeatureSetReaderCIM(t);if(i){i.invertY();for(var o=s.a.executeEffects(this._effects,i,e.tileKey,n.geometryEngine);i=o.next();)i.invertY(),this._write(e,t,n,i)}}else this._write(e,t,n)}},{key:"_write",value:function(e,t,r,n){}}]),e}()},216:function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return T}));var n=r(4),i=r(12),a=r(276),s=r(92),o=r(89),c=r(88),u=r(103),l=r(115),h={marker:u.d.MARKER,fill:u.d.FILL,line:u.d.LINE,text:u.d.TEXT},f=function(){function e(t,r,n,i){Object(o.a)(this,e);var a={minScale:null===r||void 0===r?void 0:r.minScale,maxScale:null===r||void 0===r?void 0:r.maxScale},c=function(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(a);this.layers=t,this.data=r,this.hash=this._createHash()+c,this.rendererKey=n;var f,v={isOutline:!1,placement:null,symbologyType:u.e.DEFAULT,vvFlags:n},y=Object(s.a)(t);try{for(y.s();!(f=y.n()).done;){var d=f.value,b=h[d.type];v.isOutline="line"===d.type&&d.isOutline,d.materialKey=Object(l.g)(b,v),d.maxVVSize=i,d.scaleInfo=a,d.templateHash+=c}}catch(p){y.e(p)}finally{y.f()}}return Object(c.a)(e,[{key:"type",get:function(){return"expanded-cim"}},{key:"_createHash",value:function(){var e,t="",r=Object(s.a)(this.layers);try{for(r.s();!(e=r.n()).done;){t+=e.value.templateHash}}catch(n){r.e(n)}finally{r.f()}return t}}]),e}();var v=r(238),y=r(101),d=r(110),b=r(128),p=r(197),x=r(215),_=r(293),m=r(303);function g(e,t,r){return O.apply(this,arguments)}function O(){return(O=Object(i.a)(Object(n.a)().mark((function e(t,r,i){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.name){e.next=2;break}throw new y.a("style-symbol-reference-name-missing","Missing name in style symbol reference");case 2:if(!t.styleName||"Esri2DPointSymbolsStyle"!==t.styleName){e.next=4;break}return e.abrupt("return",j(t,i));case 4:return e.prev=4,e.t0=M,e.next=8,Object(_.b)(t,r,i);case 8:return e.t1=e.sent,e.t2=t.name,e.t3=r,e.t4=i,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 15:return e.prev=15,e.t5=e.catch(4),e.abrupt("return",(Object(d.m)(e.t5),null));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})))).apply(this,arguments)}function j(e,t){return k.apply(this,arguments)}function k(){return(k=Object(i.a)(Object(n.a)().mark((function e(t,r){var i,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=_.a.replaceAll(/\{SymbolName\}/gi,t.name),e.prev=1,e.next=4,Object(_.d)(i,r);case 4:return a=e.sent,e.abrupt("return",Object(_.c)(a.data));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(Object(d.m)(e.t0),null));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function M(e,t,r,n){return w.apply(this,arguments)}function w(){return(w=Object(i.a)(Object(n.a)().mark((function e(t,r,i,a){var s,o,c,u;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={portal:i&&null!=i.portal?i.portal:p.a.getDefault(),url:Object(b.Q)(t.baseUrl),origin:"portal-item"},o=Object(m.getStyleItemFromStyle)(r,t.data)){e.next=3;break}throw new y.a("symbolstyleutils:symbol-name-not-found","The symbol name '".concat(r,"' could not be found"),{symbolName:r});case 3:return c=Object(x.d)(Object(_.e)(o,"cimRef"),s),Object(v.b)()&&(c=Object(v.a)(c)),e.prev=5,e.next=8,Object(_.d)(c,a);case 8:return u=e.sent,e.abrupt("return",Object(_.c)(u.data));case 12:return e.prev=12,e.t0=e.catch(5),e.abrupt("return",(Object(d.m)(e.t0),null));case 15:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}var S=function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,i){var s;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new a.a(i,r),e.t0=f,e.next=4,s.analyzeSymbolReference(t.data,!1);case 4:return e.t1=e.sent,e.t2=t.data,e.t3=t.rendererKey,e.t4=t.maxVVSize,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3,e.t4));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();function T(e,t,r,n){return L.apply(this,arguments)}function L(){return(L=Object(i.a)(Object(n.a)().mark((function e(t,r,i,a){var s,o;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if("cim"!==t.type){e.next=4;break}return e.abrupt("return",S(t,r,i));case 4:if("web-style"!==t.type){e.next=21;break}return e.next=7,g(t,null,a);case 7:if(e.t1=s=e.sent,e.t0=null!==e.t1,!e.t0){e.next=11;break}e.t0=void 0!==s;case 11:if(!e.t0){e.next=15;break}e.t2=s,e.next=16;break;case 15:e.t2=void 0;case 16:return e.t3=e.t2,e.t4=t.rendererKey,e.t5=t.maxVVSize,o={type:"cim",data:e.t3,rendererKey:e.t4,maxVVSize:e.t5},e.abrupt("return",S(o,r,i));case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){if(!e)return null;var t=e.avoidSDFRasterization,r=e.type,n=e.cim,i=e.url,a=e.materialHash,s=e.maxVVSize,o={cim:n,type:r,mosaicHash:a,url:i,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:t};switch(r){case"marker":s&&"size"in n&&(n.size=Math.max(s,n.size)),o.size=e.size,o.path=e.path,o.animatedSymbolProperties=e.animatedSymbolProperties;break;case"line":o.dashTemplate=e.dashTemplate;break;case"text":o.text=e.text,o.fontName=e.fontName}return o}},223:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(101);function i(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new n.a(r.name,r.message,r.details)),!1}return!0}},224:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n,i,a,s=r(201),o={exports:{}};n=o,i=function(){function e(e,r,i){i=i||2;var a,s,o,u,l,h,f,v=r&&r.length,y=v?r[0]*i:e.length,d=t(e,0,y,i,!0),b=[];if(!d||d.next===d.prev)return b;if(v&&(d=c(e,r,d,i)),e.length>80*i){a=o=e[0],s=u=e[1];for(var p=i;p<y;p+=i)(l=e[p])<a&&(a=l),(h=e[p+1])<s&&(s=h),l>o&&(o=l),h>u&&(u=h);f=0!==(f=Math.max(o-a,u-s))?1/f:0}return n(d,b,i,a,s,f),b}function t(e,t,r,n,i){var a,s;if(i===T(e,t,r,n)>0)for(a=t;a<r;a+=n)s=M(a,e[a],e[a+1],s);else for(a=r-n;a>=t;a-=n)s=M(a,e[a],e[a+1],s);if(s&&_(s,s.next)){var o=s.next;w(s),s=o}return s}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!_(n,n.next)&&0!==x(n.prev,n,n.next))n=n.next;else{var i=n.prev;if(w(n),(n=t=i)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,c,u,l,h,f){if(e){!f&&h&&v(e,u,l,h);for(var y,d,b=e;e.prev!==e.next;)if(y=e.prev,d=e.next,h?a(e,u,l,h):i(e))t.push(y.i/c),t.push(e.i/c),t.push(d.i/c),w(e),e=d.next,b=d.next;else if((e=d)===b){f?1===f?n(e=s(r(e),t,c),t,c,u,l,h,2):2===f&&o(e,t,c,u,l,h):n(r(e),t,c,u,l,h,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(x(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(b(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&x(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,r,n){var i=e.prev,a=e,s=e.next;if(x(i,a,s)>=0)return!1;for(var o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,c=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,l=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=y(o,c,t,r,n),f=y(u,l,t,r,n),v=e.prevZ,d=e.nextZ;v&&v.z>=h&&d&&d.z<=f;){if(v!==e.prev&&v!==e.next&&b(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&x(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,d!==e.prev&&d!==e.next&&b(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&x(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;v&&v.z>=h;){if(v!==e.prev&&v!==e.next&&b(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&x(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&b(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&x(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function s(e,t,n){var i=e;do{var a=i.prev,s=i.next.next;!_(a,s)&&m(a,i,i.next,s)&&j(a,s)&&j(s,a)&&(t.push(a.i/n),t.push(i.i/n),t.push(s.i/n),w(i),w(i.next),i=e=s),i=i.next}while(i!==e);return r(i)}function o(e,t,i,a,s,o){var c=e;do{for(var u=c.next.next;u!==c.prev;){if(c.i!==u.i&&p(c,u)){var l=k(c,u);return c=r(c,c.next),l=r(l,l.next),n(c,t,i,a,s,o),void n(l,t,i,a,s,o)}u=u.next}c=c.next}while(c!==e)}function c(e,n,i,a){var s,o,c,l=[];for(s=0,o=n.length;s<o;s++)(c=t(e,n[s]*a,s<o-1?n[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),l.push(d(c));for(l.sort(u),s=0;s<l.length;s++)i=r(i=h(l[s],i),i.next);return i}function u(e,t){return e.x-t.x}function l(e){if(e.next.prev===e)return e;for(var t=e;;){var r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function h(e,t){var n=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>s){if(s=o,o===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r;var c,u=r,l=r.x,h=r.y,v=1/0;n=r;do{i>=n.x&&n.x>=l&&i!==n.x&&b(a<h?i:s,a,l,h,a<h?s:i,a,n.x,n.y)&&(c=Math.abs(a-n.y)/(i-n.x),j(n,e)&&(c<v||c===v&&(n.x>r.x||n.x===r.x&&f(r,n)))&&(r=n,v=c)),n=n.next}while(n!==u);return r}(e,t);if(!n)return t;var i=k(n,e),a=r(n,n.next),s=l(i);return r(s,s.next),a=l(a),l(t===n?a:t)}function f(e,t){return x(e.prev,e,t.prev)<0&&x(t.next,e,e.next)<0}function v(e,t,r,n){var i=e;do{null===i.z&&(i.z=y(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,s,o,c,u=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ);t++);for(c=u;o>0||c>0&&n;)0!==o&&(0===c||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(s>1)}(i)}function y(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function b(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&m(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(j(e,t)&&j(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(x(e.prev,e,t.prev)||x(e,t.prev,t))||_(e,t)&&x(e.prev,e,e.next)>0&&x(t.prev,t,t.next)>0)}function x(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function m(e,t,r,n){var i=O(x(e,t,r)),a=O(x(e,t,n)),s=O(x(r,n,e)),o=O(x(r,n,t));return i!==a&&s!==o||!(0!==i||!g(e,r,t))||!(0!==a||!g(e,n,t))||!(0!==s||!g(r,e,n))||!(0!==o||!g(r,t,n))}function g(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function O(e){return e>0?1:e<0?-1:0}function j(e,t){return x(e.prev,e,e.next)<0?x(e,t,e.next)>=0&&x(e,e.prev,t)>=0:x(e,t,e.prev)<0||x(e,e.next,t)<0}function k(e,t){var r=new S(e.i,e.x,e.y),n=new S(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function M(e,t,r,n){var i=new S(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(e,t,r,n){for(var i=0,a=t,s=r-n;a<r;a+=n)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}return e.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,s=Math.abs(T(e,0,a,r));if(i)for(var o=0,c=t.length;o<c;o++){var u=t[o]*r,l=o<c-1?t[o+1]*r:e.length;s-=Math.abs(T(e,u,l,r))}var h=0;for(o=0;o<n.length;o+=3){var f=n[o]*r,v=n[o+1]*r,y=n[o+2]*r;h+=Math.abs((e[f]-e[y])*(e[v+1]-e[f+1])-(e[f]-e[v])*(e[y+1]-e[f+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[i][a][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r},e},void 0!==(a=i())&&(n.exports=a);var c=Object(s.b)(o.exports)},2290:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return I}));var n=r(92),i=r(4),a=r(12),s=r(89),o=r(88),c=r(90),u=r(91),l=r(94),h=r(180),f=(r(101),r(93),r(102),r(111)),v=r(110),y=(r(96),r(98),r(95)),d=r(284),b=r(125),p=r(176),x=r(103),_=r(423),m=r(424),g=r(321),O=r(418),j=r(310),k=r(1548),M=r(1),w=function(){function e(t){Object(s.a)(this,e),this._remoteClient=t,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}return Object(o.a)(e,[{key:"destroy",value:function(){}},{key:"fetchResource",value:function(){var e=Object(a.a)(Object(i.a)().mark((function e(t,r){var n,a,s,o=this;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._resourceMap,!(a=n.get(t))){e.next=3;break}return e.abrupt("return",a);case 3:if(!(s=this._inFlightResourceMap.get(t))){e.next=6;break}return e.abrupt("return",s);case 6:e.prev=6,s=this._remoteClient.invoke("tileRenderer.fetchResource",{url:t},Object(M.a)({},r)),this._inFlightResourceMap.set(t,s),s.then((function(e){return o._inFlightResourceMap.delete(t),n.set(t,e),e})),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(6),e.abrupt("return",Object(v.h)(e.t0)?null:{width:0,height:0});case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getResource",value:function(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}},{key:"loadFont",value:function(e){return Promise.resolve(null)}}]),e}();function S(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function T(e){var t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin,version:t.version},transferList:new Array};for(var n in t.data){var i=n,a=t.data[i];if(r.message.data[i]=null,null!=a){var s=a.stride,o=a.indices.slice(0),c=a.vertices.slice(0),u=a.records.slice(0),l={stride:s,indices:o,vertices:c,records:u,metrics:Object(f.b)(a.metrics,(function(e){return e.slice(0)}))};r.transferList.push(o,c,u),r.message.data[i]=l}}return r}var L=function(e){Object(c.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments)).type="symbol",e._matchers={feature:null,aggregate:null},e._bufferData=new Map,e._bufferIds=new Map,e}return Object(o.a)(r,[{key:"initialize",value:function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new w(this.remoteClient)}},{key:"destroy",value:function(){this._resourceManagerProxy.destroy()}},{key:"supportsTileUpdates",get:function(){return!0}},{key:"forEachBufferId",value:function(e){this._bufferIds.forEach((function(t){t.forEach(e)}))}},{key:"update",value:function(){var e=Object(a.a)(Object(i.a)().mark((function e(t,r){var n,a,s;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("symbol"===(a=r.schema.processors[0]).type){e.next=3;break}return e.abrupt("return");case 3:s=Object(d.a)(this._schema,a),(Object(d.b)(s,"mesh")||Object(d.b)(s,"target"))&&(t.mesh=!0,null!==(n=t.why)&&void 0!==n&&n.mesh.push("Symbology changed"),this._schema=a,this._factory=this._createFactory(a),this._factory.update(a,this.tileStore.tileScheme.tileInfo));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onTileMessage",value:function(e,t,r,n){return Object(v.n)(n),this._onTileData(e,t,r,n)}},{key:"onTileClear",value:function(e,t){var r={clear:!0,end:t};return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:r})}},{key:"onTileError",value:function(e,t,r){var n=r.signal,i={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:n})}},{key:"onTileUpdate",value:function(e){var t,r=this,i=Object(n.a)(e.removed);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._bufferData.has(a.key.id)&&this._bufferData.delete(a.key.id),this._bufferIds.has(a.key.id)&&this._bufferIds.delete(a.key.id)}}catch(u){i.e(u)}finally{i.f()}var s,o=Object(n.a)(e.added);try{var c=function(){var e=s.value;r._bufferData.forEach((function(t){var i,a=Object(n.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.message.tileKey===e.id&&r._updateTileMesh("append",e,T(s),[],!1,!1,null)}}catch(u){a.e(u)}finally{a.f()}}))};for(o.s();!(s=o.n()).done;)c()}catch(u){o.e(u)}finally{o.f()}}},{key:"_addBufferData",value:function(e,t){var r;this._bufferData.has(e)||this._bufferData.set(e,[]),null===(r=this._bufferData.get(e))||void 0===r||r.push(T(t))}},{key:"_createFactory",value:function(e){var t=this,r=this.service,n=r.geometryType,i=r.objectIdField,a={geometryType:n,fields:r.fields,spatialReference:b.a.fromJSON(this.spatialReference)},s=new g.a((function(e,r){return t.remoteClient.invoke("tileRenderer.getMaterialItems",e,r)}),this.tileStore.tileScheme.tileInfo),o=e.mesh,c=o.matcher,u=o.aggregateMatcher;return this._store=s,this._matchers.feature=Object(O.a)(c,s,a,this._resourceManagerProxy),this._matchers.aggregate=Object(f.b)(u,(function(e){return Object(O.a)(e,s,a,t._resourceManagerProxy)})),new m.a(n,i,s)}},{key:"_onTileData",value:function(){var e=Object(a.a)(Object(i.a)().mark((function e(t,r,a,s){var o,c,u,l,h,f,y,d,b,p,x,_,m,g,O,j,k,M,w,S,T,L,I,z,P=this;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(v.n)(s),c=r.type,u=r.addOrUpdate,l=r.remove,h=r.clear,f=r.end,y=!!this._schema.mesh.sortKey,u){e.next=5;break}return d={type:c,addOrUpdate:null,remove:l,clear:h,end:f,sort:y},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:d},s));case 5:return b=this._processFeatures(t,u,a,s,null===(o=r.status)||void 0===o?void 0:o.version),e.prev=6,e.next=9,b;case 9:if(null!=(p=e.sent)){e.next=13;break}return x={type:c,addOrUpdate:null,remove:l,clear:h,end:f,sort:y},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:x},s));case 13:_=[],m=Object(n.a)(p),e.prev=15,m.s();case 17:if((g=m.n()).done){e.next=41;break}if(O=g.value,j=!1,k=O.message.bufferIds,M=t.key.id,w=O.message.tileKey,M===w||null==k){e.next=38;break}if(this.tileStore.get(w)){e.next=25;break}return this._addBufferData(M,O),_.push(O),e.abrupt("continue",39);case 25:(S=this._bufferIds.get(w))||(S=new Set,this._bufferIds.set(w,S)),T=Array.from(k),L=0,I=T;case 29:if(!(L<I.length)){e.next=38;break}if(z=I[L],!S.has(z)){e.next=34;break}return j=!0,e.abrupt("break",38);case 34:S.add(z);case 35:L++,e.next=29;break;case 38:j||(this._addBufferData(M,O),_.push(O));case 39:e.next=17;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(15),m.e(e.t0);case 46:return e.prev=46,m.f(),e.finish(46);case 49:return e.next=51,Promise.all(_.map((function(e){var n=t.key.id===e.message.tileKey,i=n?r.remove:[],a=n&&r.end;return P._updateTileMesh(c,t,e,i,a,!!r.clear,s.signal)})));case 51:e.next=56;break;case 53:e.prev=53,e.t1=e.catch(6),this._handleError(t,e.t1,s);case 56:case"end":return e.stop()}}),e,this,[[6,53],[15,43,46,49]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_updateTileMesh",value:function(){var e=Object(a.a)(Object(i.a)().mark((function e(t,r,n,a,s,o,c){var u,l,h,y,d;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t,l=n.message.tileKey,h=!!this._schema.mesh.sortKey,l!==r.key.id&&(s=!1),y={type:u,addOrUpdate:Object(f.b)(n,(function(e){return e.message})),remove:a,clear:o,end:s,sort:h},d={transferList:Object(f.b)(n,(function(e){return e.transferList}))||[]||[],signal:c},e.abrupt("return",(Object(v.n)(d),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l,data:y},d)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s,o){return e.apply(this,arguments)}}()},{key:"_processFeatures",value:function(){var e=Object(a.a)(Object(i.a)().mark((function e(t,r,n,a,s){var o,c,u,l,h,f;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.hasFeatures){e.next=2;break}return e.abrupt("return",null);case 2:return o={transform:t.transform,hasZ:!1,hasM:!1},c=this._factory,u={viewingMode:"",scale:t.scale},e.next=7,this._matchers.feature;case 7:return l=e.sent,e.next=10,this._matchers.aggregate;case 10:return h=e.sent,Object(v.n)(a),f=this._getLabelInfos(t,r),e.next=15,c.analyze(r.getCursor(),this._resourceManagerProxy,l,h,o,u);case 15:return Object(v.n)(a),e.abrupt("return",this._writeFeatureSet(t,r,o,f,c,n,s));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"_writeFeatureSet",value:function(e,t,r,n,i,a,s){for(var o=t.getSize(),c=this._schema.mesh.matcher.symbologyType,u=new _.a(e.key.id,{features:o,records:o,metrics:0},c,a,c!==x.e.HEATMAP,s),l={viewingMode:"",scale:e.scale},h=t.getCursor();h.next();)try{var f=h.getDisplayId(),v=null!=n?n.get(f):null;i.writeCursor(u,h,r,l,e.level,v,this._resourceManagerProxy)}catch(d){}var y=e.tileInfoView.tileInfo.isWrappable;return u.serialize(y)}},{key:"_handleError",value:function(e,t,r){if(!Object(v.h)(t)){var n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}return Promise.resolve()}},{key:"_getLabelingSchemaForScale",value:function(e){var t=this._schema.mesh.labels;if(null==t)return null;if("subtype"===t.type){var r={type:"subtype",classes:{}},n=!1;for(var i in t.classes){var a=t.classes[i].filter((function(t){return S(t,e.scale)}));n=n||!!a.length,r.classes[i]=a}return n?r:null}var s=t.classes.filter((function(t){return S(t,e.scale)}));return s.length?{type:"simple",classes:s}:null}},{key:"_getLabels",value:function(e,t){if("subtype"===t.type){var r,n=this.service.subtypeField,i=Object(f.m)(n,"Expected to find subtype Field"),a=e.readAttribute(i);return null==a?[]:null!==(r=t.classes[a])&&void 0!==r?r:[]}return t.classes}},{key:"_getLabelInfos",value:function(e,t){var r=this,i=this._getLabelingSchemaForScale(e);if(null==i)return null;for(var a=new Map,s=t.getCursor(),o=function(){var e,t=s.getDisplayId(),o=[],c=Object(p.h)(t),u=c&&1!==s.readAttribute("cluster_count")?"aggregate":"feature",l=r._getLabels(s,i),f=Object(n.a)(l);try{var v=function(){var n=e.value;if(n.target!==u)return 0;var i=s.getStorage(),a=c&&"feature"===u?i.getComputedStringAtIndex(s.readAttribute("referenceId"),n.fieldIndex):i.getComputedStringAtIndex(t,n.fieldIndex);if(!a)return 0;var l=Object(h.a)(a.toString()),f=l[0],v=l[1];r._store.getMosaicItem(n.symbol,Object(j.a)(f)).then((function(e){var t;o[n.index]={glyphs:null!==(t=e.glyphMosaicItems)&&void 0!==t?t:[],rtl:v,index:n.index}}))};for(f.s();!(e=f.n()).done;)v()}catch(y){f.e(y)}finally{f.f()}a.set(t,o)};s.next();)o();return a}}]),r}(k.a),I=L=Object(l.a)([Object(y.a)("esri.views.2d.layers.features.processors.SymbolProcessor")],L)},238:function(e,t,r){"use strict";function n(e){return e=e||globalThis.location.hostname,u.some((function(t){var r;return null!=(null===(r=e)||void 0===r?void 0:r.match(t))}))}function i(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(o)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(s)||null!=t.match(c)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));var a=/^devext.arcgis.com$/,s=/^qaext.arcgis.com$/,o=/^[\w-]*\.mapsdevext.arcgis.com$/,c=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,s,/^jsapps.esri.com$/,o,c]},272:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(112),i=r(89),a=r(88),s=function(){function e(t,r){Object(i.a)(this,e),this._pos=0;var n=r?this._roundToNearest(r,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(n),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}return Object(a.a)(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var r=Math.round(e);return 1===t?r:r+(t-r%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),n=new this._ctor(r);n.set(this._buffer,0),this._array=r,this._buffer=n,this._i16View=new Int16Array(this._array)}}},{key:"ensureSize",value:function(e){this._ensureSize(e)}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"i1616Add",value:function(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"writeManyFrom",value:function(e,t,r){this._ensureSize(r-t);for(var n=t;n!==r;n++)this.writeFixed(e._buffer[n])}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){return Object(n.a)(this._buffer)}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}()},295:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return y}));var n=r(4),i=r(12),a=r(288),s=r(93),o=128e3,c=null,u=null;function l(){return h.apply(this,arguments)}function h(){return(h=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(c||(c=f()),c));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return v.apply(this,arguments)}function v(){return v=Object(i.a)(Object(n.a)().mark((function e(){var t;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(s.a)("esri-csp-restrictions")){e.next=6;break}return e.next=3,Promise.all([r.e(24),r.e(294),r.e(260)]).then(r.bind(null,577)).then((function(e){return e.l}));case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,r.e(232).then(r.bind(null,578)).then((function(e){return e.l}));case 8:e.t0=e.sent;case 9:return t=e.t0,e.next=12,t.load({locateFile:function(e){return Object(a.a)("esri/core/libs/libtess/".concat(e))}});case 12:u=e.sent;case 13:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function y(e,t){var r=Math.max(e.length,o);return u.triangulate(e,t,r)}},303:function(e,t,r){"use strict";r.r(t),r.d(t,"fetchSymbolFromStyle",(function(){return b})),r.d(t,"getStyleItemFromStyle",(function(){return d})),r.d(t,"resolveWebStyleSymbol",(function(){return y}));var n=r(177),i=r(238),a=r(101),s=r(111),o=r(128),c=r(197),u=r(215),l=r(413),h=r(429),f=r(293),v=r(405);function y(e,t,r,n){var i=e.name;return null==i?Promise.reject(new a.a("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,r){var n=f.a.replaceAll(/\{SymbolName\}/gi,e),i=null!=t.portal?t.portal:c.a.getDefault();return Object(f.d)(n,r).then((function(e){var t=Object(f.c)(e.data);return Object(l.a)(t,{portal:i,url:Object(o.Q)(Object(o.L)(n)),origin:"portal-item"})}))}(i,t,n):Object(f.b)(e,t,n).then((function(e){return b(Object(s.m)(e),i,t,r,f.e,n)}))}function d(e,t){return t.items.find((function(t){return t.name===e}))}function b(e,t,r,s,y,b){var p,x,_,m=r&&null!=r.portal?r.portal:c.a.getDefault(),g={portal:m,url:Object(o.Q)(e.baseUrl),origin:"portal-item"},O=d(t,e.data);if(!O){var j="The symbol name '".concat(t,"' could not be found");return Promise.reject(new a.a("symbolstyleutils:symbol-name-not-found",j,{symbolName:t}))}var k=Object(u.d)(y(O,s),g),M=null!==(p=null===(x=O.thumbnail)||void 0===x?void 0:x.href)&&void 0!==p?p:null,w=O.thumbnail&&O.thumbnail.imageData;Object(i.b)()&&(k=null!==(_=Object(i.a)(k))&&void 0!==_?_:"",M=Object(i.a)(M));var S={portal:m,url:Object(o.Q)(Object(o.L)(k)),origin:"portal-item"};return Object(f.d)(k,b).then((function(i){var a="cimRef"===s?Object(f.c)(i.data):i.data,o=Object(l.a)(a,S);if(o&&Object(n.c)(o)){if(M){var c=Object(u.d)(M,g);o.thumbnail=new v.a({url:c})}else w&&(o.thumbnail=new v.a({url:"data:image/png;base64,".concat(w)}));e.styleUrl?o.styleOrigin=new h.a({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(o.styleOrigin=new h.a({portal:r.portal,styleName:e.styleName,name:t}))}return o}))}},310:function(e,t,r){"use strict";function n(e){if(null==e)return[];for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}r.d(t,"a",(function(){return n}))},316:function(e,t,r){"use strict";r.d(t,"a",(function(){return _}));var n=r(99),i=r(89),a=r(88),s=r(90),o=r(91),c=r(180),u=r(108),l=r(114),h=r(155),f=r(133),v=r(104),y=r(118),d=r(115),b=r(161),p=r(317),x=r(204),_=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e,n,a,s,o,c,f,b,p,x,_,m,g,O,j,k,M,w,S,T,L,I,z,P){var C;Object(i.a)(this,r),(C=t.call(this))._xOffset=Object(u.c)(g),C._yOffset=Object(u.c)(O),C._decoration=x||"none",C._backgroundColor=I,C._borderLineColor=z,C._borderLineSize=P,C._color=o,C._haloColor=c,C._haloSize=Math.min(Math.floor(5*Object(u.c)(Object(u.e)(a))),127),C._size=Math.min(Math.round(Object(u.c)(n)),127);var E=Math.min(Math.round(Object(u.c)(s||n)),127);C._referenceSize=Math.round(Math.sqrt(256*E)),C._scale=C._size/v.y,C._angle=m,C._justify=Object(h.d)(f||"center"),C._xAlignD=Object(h.e)(f||"center"),C._yAlignD=Object(h.g)(b||"baseline"),C._baseline="baseline"===(b||"baseline"),C._bitset=(p===l.a.MAP?1:0)|(_?1:0)<<1;var V=d.e.load(e);return V.sdf=!0,C._materialKey=V.data,C._lineWidth=Object(u.c)(j)||512,C._lineHeight=k||1,C._textPlacement=M,C._effects=w,C._isCIM=null!==S&&void 0!==S&&S,C._minMaxZoom=Object(y.a)(Math.round(T*v.F),Math.round(L*v.F)),C}return Object(a.a)(r,null,[{key:"fromText",value:function(e,t){var i,a,s=null===(i=e.font)||void 0===i?void 0:i.size,o=new r(e.materialKey,s,e.haloSize||0,s,e.color&&Object(f.c)(e.color)||0,e.haloColor&&Object(f.c)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,l.a.SCREEN,null===(a=e.font)||void 0===a?void 0:a.decoration,!1,e.angle||0,e.xoffset||0,e.yoffset||0,e.lineWidth||0,e.lineHeight||0,null,null,!1,b.b,b.a,e.backgroundColor&&Object(f.c)(e.backgroundColor),e.borderLineColor&&Object(f.c)(e.borderLineColor),e.borderLineSize),u=Object(c.a)(e.text),h=Object(n.a)(u,2)[1];return o.bindTextInfo(null!==t&&void 0!==t?t:[],h),o._vertexBoundsScale=e.maxVVSize&&s?e.maxVVSize/s:1,o}},{key:"fromCIMText",value:function(e,t,i){var a,s=e.scaleFactor||1,o=e.size*e.sizeRatio*s,u=Object(b.e)(e.scaleInfo,i),l=Object(n.a)(u,2),h=l[0],v=l[1],y=new r(e.materialKey,o,e.outlineSize*e.sizeRatio,e.referenceSize,Object(f.b)(e.color),Object(f.b)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,null!==(a=e.colorLocked)&&void 0!==a&&a,e.angle,e.offsetX*e.sizeRatio*s,e.offsetY*e.sizeRatio*s,512,1,e.markerPlacement,e.effects,!0,h,v,e.backgroundColor?Object(f.b)(e.backgroundColor):void 0,e.borderLineColor?Object(f.b)(e.borderLineColor):void 0,e.borderLineWidth),d=Object(c.a)(e.text),p=Object(n.a)(d,2)[1];return y.bindTextInfo(t,p),y._vertexBoundsScale=e.maxVVSize?e.maxVVSize/o:1,y}}]),r}(Object(p.a)(x.a))},317:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));var n=r(92),i=r(99),a=r(89),s=r(88),o=r(90),c=r(91),u=r(108),l=r(121),h=r(318),f=r(104),v=r(103),y=r(118),d=r(115),b=r(198),p=Object(y.a)(4,4),x=Object(y.a)(16,4),_=Object(y.a)(4,2),m=Object(y.a)(4,6),g=[_,_,m,m],O=[_,m,_,m],j=[m,m,p,p],k=[p,p,m,m],M=[m,p,m,p],w=[p,m,p,m],S=function(e){return function(e){Object(o.a)(r,e);var t=Object(c.a)(r);function r(){var e;Object(a.a)(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i)))._isCIM=!1,e._vertexBoundsScale=1,e.geometryType=v.d.TEXT,e._aux=Object(y.b)(0,0,e._referenceSize,e._bitset),e}return Object(s.a)(r,[{key:"bindTextInfo",value:function(e,t){e&&e.length?this._shapingInfo=Object(b.a)(e,t,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:f.B*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM,hasBackground:!!this._backgroundColor,borderLineSize:this._borderLineSize}):this._shapingInfo=null}},{key:"_write",value:function(e,t,r,n){var i=t.getDisplayId();this._writeGeometry(e,t,i,r,n)}},{key:"_writeGeometry",value:function(e,t,r,n,a){var s=this,o=this._shapingInfo;if(null!=o){if(this._textPlacement)return this._writePlacedText(e,r,o,n,t,a);var c=a?a.asOptimized():"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(null!=c){if(c.isPoint){var u=Object(i.a)(c.coords,2),l=u[0],h=u[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(l<0||l>=512||h<0||h>=512))return;return this._writeGlyphs(e,r,{x:l,y:h},o)}c.forEachVertex((function(t,n){return s._writeGlyphs(e,r,{x:t,y:n},o)}))}}}},{key:"_writePlacedText",value:function(e,t,r,n,i,a){var s=this._textPlacement,o=a||l.a.fromFeatureSetReaderCIM(i);if(o){var c=h.a.getPlacement(o,-1,s,Object(u.c)(1),e.tileKey,n.geometryEngine);if(c)for(var f,v,y,d=r.bounds,b=Math.sqrt(d.height*d.height+d.width*d.width);f=c.next();)if(v=f.tx,y=-f.ty,v+b>=0&&v-b<512&&y+b>=0&&y-b<512){var p=-f.getAngle();r.setRotation(p),this._writeGlyphs(e,t,{x:v,y:y},r),r.setRotation(-p)}}}},{key:"_writeGlyphs",value:function(e,t,r,i){var a=d.e.load(this._materialKey),s=Object(y.a)(Math.round(8*r.x),Math.round(8*r.y)),o=this._vertexBoundsScale,c=i.bounds,u=i.background,l=i.glyphs;l.length>0&&(this._borderLineColor||this._backgroundColor)&&(a.textureBinding=l[0].textureBinding,e.recordStart(t,a.data,this.geometryType,!0),this._writeBackgroundGeometry(e,t,r,c,u),e.recordEnd());var h,f=2*Math.max(c.width,c.height),v=Object(n.a)(i.glyphs);try{for(v.s();!(h=v.n()).done;){var b=h.value;a.textureBinding=b.textureBinding,e.recordStart(t,a.data,this.geometryType,!0),e.vertexBounds(r.x+c.x+this._xOffset,r.y+c.y-this._yOffset,f*o,f*o),this._writeVertices(e,t,s,b),e.recordEnd()}}catch(p){v.e(p)}finally{v.f()}}},{key:"_writeGlyph",value:function(e,t,r,n,i){var a=d.e.load(this._materialKey),s=Object(y.a)(Math.round(8*r),Math.round(8*n));a.textureBinding=i.textureBinding,e.recordStart(t,a.data,this.geometryType,!0);var o=i.bounds,c=this._vertexBoundsScale;e.vertexBounds(r+o.x*c,n+o.y*c,o.width*c,o.height*c),this._writeVertices(e,t,s,i),e.recordEnd()}},{key:"_writeVertices",value:function(e,t,r,n){var i=e.vertexCount();this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.upperLeft),e.vertexWrite(n.texcoords.upperLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.upperRight),e.vertexWrite(n.texcoords.upperRight),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.lowerLeft),e.vertexWrite(n.texcoords.lowerLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.lowerRight),e.vertexWrite(n.texcoords.lowerRight),e.vertexEnd(),e.indexWrite(i+0),e.indexWrite(i+1),e.indexWrite(i+2),e.indexWrite(i+1),e.indexWrite(i+3),e.indexWrite(i+2)}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(y.b)(0,0,this._referenceSize,this._bitset),o=Object(y.b)(0,0,this._size,this._haloSize);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(i),e.vertexWrite(a),e.vertexWrite(o),e.vertexWrite(s),e.vertexWrite(this._minMaxZoom)}},{key:"_writeBackgroundVertex",value:function(e,t,r,n,i,a){var s=Object(y.b)(0,1,this._referenceSize,this._bitset),o=Object(y.b)(0,0,this._size,this._haloSize),c=Object(y.b)(0,0,0,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(c),e.vertexWrite(o),e.vertexWrite(s),e.vertexWrite(this._minMaxZoom),e.vertexWrite(i),e.vertexWrite(a),e.vertexEnd()}},{key:"_writeBackgroundQuad",value:function(e,t,r,n,i,a){var s=e.vertexCount();this._writeBackgroundVertex(e,t,r,n,i.upperLeft,a[0]),this._writeBackgroundVertex(e,t,r,n,i.upperRight,a[1]),this._writeBackgroundVertex(e,t,r,n,i.lowerLeft,a[2]),this._writeBackgroundVertex(e,t,r,n,i.lowerRight,a[3]),e.indexWrite(s+0),e.indexWrite(s+1),e.indexWrite(s+2),e.indexWrite(s+1),e.indexWrite(s+3),e.indexWrite(s+2)}},{key:"_writeBackgroundGeometry",value:function(e,t,r,n,a){var s=Object(y.a)(Math.round(8*r.x),Math.round(8*r.y)),o=n.x,c=n.y,u=n.width,l=n.height,h=2*Math.max(u,l);if(e.vertexBounds(r.x+o+this._xOffset,r.y+c-this._yOffset,h*this._vertexBoundsScale,h*this._vertexBoundsScale),this._backgroundColor){var f=[x,x,x,x];this._writeBackgroundQuad(e,t,s,this._backgroundColor,a.main,f)}if(this._borderLineColor||this._backgroundColor){var v=!!this._borderLineColor&&!!this._borderLineSize&&this._borderLineSize>0?[g,g,O,O,this._borderLineColor]:[j,k,M,w,this._backgroundColor],d=Object(i.a)(v,5),b=d[0],p=d[1],_=d[2],m=d[3],S=d[4];this._writeBackgroundQuad(e,t,s,S,a.top,b),this._writeBackgroundQuad(e,t,s,S,a.bot,p),this._writeBackgroundQuad(e,t,s,S,a.left,_),this._writeBackgroundQuad(e,t,s,S,a.right,m)}}}]),r}(e)}},318:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(89),i=r(88),a=r(231),s=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,null,[{key:"getPlacement",value:function(e,t,r,n,i,s){var o=Object(a.b)(r);return o?(-1===t&&e.invertY(),o.execute(e,r,n,i,s)):null}}]),e}()},319:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(99),i=r(89),a=r(88),s=r(90),o=r(91),c=r(108),u=r(182),l=r(156),h=r(114),f=r(133),v=r(104),y=r(103),d=r(118),b=r(115),p=r(161),x=r(320),_=r(204),m=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e,n,a,s,o,c,f,p,x,_,m,g,O,j,k,M,w,S,T,L,I,z,P,C){var E;Object(i.a)(this,r),(E=t.call(this)).angle=s,E.height=f,E.width=c,E.xOffset=n*T,E.yOffset=a*T,E._markerPlacement=L||void 0,E._effects=I||void 0,E._anchorX=M,E._anchorY=w,E._minMaxZoom=Object(d.a)(Math.round(z*v.F),Math.round(P*v.F));var V=(j===h.a.MAP?v.n:v.o)|(m?v.l:0)|(O?v.p:0)|(g?v.q:0),W=k&&k.sdf,A=b.d.load(e);A.sdf=W,A.pattern=!0,A.textureBinding=k.textureBinding,E._materialKey=A.data,E._fillColor=o,E._outlineColor=x,E._sizeOutlineWidth=Object(d.b)(Math.round(Math.min(Math.sqrt(128*c),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*_),255)),Math.round(Math.min(Math.sqrt(128*p),255))),A.symbologyType===y.e.PIE_CHART?(c*=S*T,f*=S*T,E._computedWidth=c,E._computedHeight=f,E._texUpperLeft=Object(d.a)(0,1),E._texUpperRight=Object(d.a)(1,1),E._texBottomLeft=Object(d.a)(0,0),E._texBottomRight=Object(d.a)(1,0)):E._computeSize(c,f,S,_,T,k,A.hasSizeVV(),C);var R=Math.round(64*S);E._bitestAndDistRatio=Object(d.a)(V,R);var F=Object(l.c)(),B=Object(u.a)();return E._applyTransformation(B,F),E}return Object(a.a)(r,null,[{key:"fromCIMMarker",value:function(e,t,i){var a,s=t&&t.width||1,o=t&&t.height||1,u=e.size,l=s/o*e.scaleX,v=e.scaleSymbolsProportionally&&e.frameHeight?u/e.frameHeight:1,y=Object(f.b)(e.color),d=Object(f.b)(e.outlineColor),b=Object(c.c)(u),x=b*l,_=Object(c.c)(e.offsetX||0),m=Object(c.c)(e.offsetY||0),g=Object(c.c)(e.outlineWidth||0)*v,O=e.alignment||h.a.SCREEN,j=Object(c.c)(e.referenceSize),k=Object(p.e)(e.scaleInfo,i),M=Object(n.a)(k,2),w=M[0],S=M[1],T=e.rotation||0;e.rotateClockwise||(T=-T);var L=0,I=0,z=e.anchorPoint;z&&(e.isAbsoluteAnchorPoint?u&&(L=z.x/(u*l),I=z.y/u):(L=z.x,I=z.y));var P=new r(e.materialKey,_,m,T,y,x,b,j,d,g,e.colorLocked,e.scaleSymbolsProportionally,!1,O,t,L,I,e.sizeRatio,null!==(a=e.scaleFactor)&&void 0!==a?a:1,e.markerPlacement,e.effects,w,S,!0);return P._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/x:1,P._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/b:1,P}},{key:"fromPictureMarker",value:function(e,t){var n=Math.round(Object(c.c)(e.width)),i=Math.round(Object(c.c)(e.height)),a=v.J,s=Math.round(Object(c.c)(e.xoffset||0)),o=Math.round(Object(c.c)(e.yoffset||0)),u=new r(e.materialKey,s,o,e.angle,a,n,i,i,0,0,!1,!1,!1,h.a.SCREEN,t,0,0,1,1,null,null,p.b,p.a,!1);return u._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,u._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,u}},{key:"fromSimpleMarker",value:function(e,t){var n,i=e.style,a=Object(f.c)(e.color),s=Math.round(Object(c.c)(e.size)),o=s;"esriSMSTriangle"===i&&(o*=t.height/t.width);var u=Math.round(Object(c.c)(e.xoffset||0)),l=Math.round(Object(c.c)(e.yoffset||0)),v=e.outline,y=0|((null===v||void 0===v?void 0:v.color)&&Object(f.c)(v.color)),d=0|((null===v||void 0===v?void 0:v.width)&&Math.round(Object(c.c)(v.width))),b=new r(e.materialKey,u,l,null!==(n=e.angle)&&void 0!==n?n:0,a,s,o,o,y,d,!1,!1,"esriSMSCross"===i||"esriSMSX"===i,h.a.SCREEN,t,0,0,2,1,null,null,p.b,p.a,!1);return b.boundsType="esriSMSCircle"===i?"circle":"square",b._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,b._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,b}},{key:"fromLineSymbolMarker",value:function(e,t){var n,i=Object(f.c)(e.color),a=Math.round(Object(c.c)(6*e.lineWidth)),s=a,o="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":n=h.f.Both;break;case"begin":n=h.f.JustBegin;break;case"end":n=h.f.JustEnd;break;default:n=h.f.None}var u={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:n,offsetAlongLine:0},l=new r(e.materialKey,0,0,0,i,a,s,s/6,i,o?Math.round(Object(c.c)(e.lineWidth)):0,!1,!1,o,h.a.MAP,t,0,0,2,1,u,null,p.b,p.a,!1);return l.boundsType="circle"===e.style?"circle":"square",l}}]),r}(Object(x.a)(_.a))},320:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(99),i=r(89),a=r(88),s=r(90),o=r(91),c=r(108),u=r(219),l=r(182),h=r(171),f=r(156),v=r(121),y=r(318),d=r(104),b=r(103),p=r(118),x=r(115),_=3.14159265359/180,m=function(e){return function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).angle=0,e.xOffset=0,e.yOffset=0,e.width=0,e.height=0,e.boundsType="square",e._anchorX=0,e._anchorY=0,e._computedWidth=0,e._computedHeight=0,e._allowBorrowing=!0,e._vertexBoundsScaleX=1,e._vertexBoundsScaleY=1,e.geometryType=b.d.MARKER,e}return Object(a.a)(r,[{key:"_write",value:function(e,t,r,n){var i=t.getDisplayId();e.recordStart(i,this._materialKey,this.geometryType,!0),this._writeGeometry(e,t,i,r,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i,a){var s=this;if(null!=this._markerPlacement)return this._writePlacedMarkers(e,t,i,a);if(this._allowBorrowing=!0,!a&&"esriGeometryPoint"===t.geometryType){var o=t.getX(),c=t.getY();if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(o<0||o>=513||c<0||c>=513))return;return this._writeVertices(e,r,this._getPos(o,c),o,c)}var u=a?a.asOptimized():"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(null!=u){if(u.isPoint){var l=Object(n.a)(u.coords,2),h=l[0],f=l[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(h<0||h>=512||f<0||f>=512))return;return this._writeVertices(e,r,this._getPos(h,f),h,f)}u.forEachVertex((function(t,n){var i=2*d.fb;t<-i||t>=i||n<-i||n>=i||s._writeVertices(e,r,s._getPos(t,n),t,n)}))}}},{key:"_writePlacedMarkers",value:function(e,t,r,n){var i=n||v.a.fromFeatureSetReaderCIM(t);if(i){var a=y.a.getPlacement(i,-1,this._markerPlacement,Object(c.c)(1),e.tileKey,r.geometryEngine);if(a){this._allowBorrowing="esriGeometryPolygon"!==t.geometryType;for(var s=t.getDisplayId(),o=Object(f.c)(),u=Object(l.a)(),h=a.next();null!=h;){var d=h.tx,b=-h.ty;d>=-128&&d<=640&&b>=-128&&b<=640&&(this._applyTransformation(u,o,-h.getAngle()/_),this._writeVertices(e,s,this._getPos(d,b),d,b)),h=a.next()}}}}},{key:"_writeVertices",value:function(e,t,r,n,i){var a=x.d.load(this._materialKey);return a.symbologyType===b.e.HEATMAP?this._writeHeatmapVertices(e,t,r):this._writeMarkerVertices(e,t,a,r,n,i)}},{key:"_writeMarkerVertices",value:function(e,t,r,n,i,a){var s=r.vvRotation,o=e.vertexCount(),c=this._computedWidth*this._vertexBoundsScaleX,u=this._computedHeight*this._vertexBoundsScaleY;if(this.angle){var l=Math.max(c,u);c=l,u=l}if(s){var h=Math.max(this.xOffset,this.yOffset);c+=h,u+=h}this._allowBorrowing&&e.vertexBounds(i+this.xOffset,a-this.yOffset,c,u),e.vertexWrite(n),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(this._texUpperLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(n),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(this._texUpperRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(n),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(this._texBottomLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(n),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(this._texBottomRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),this._writeIndices(e,o)}},{key:"_writeHeatmapVertices",value:function(e,t,r){var n=e.vertexCount();e.vertexWrite(r),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(t),e.vertexEnd(),this._writeIndices(e,n)}},{key:"_writeIndices",value:function(e,t){e.indexWrite(t+0),e.indexWrite(t+1),e.indexWrite(t+2),e.indexWrite(t+1),e.indexWrite(t+3),e.indexWrite(t+2)}},{key:"_applyTransformation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r?Object(u.b)(e,_*r):Object(u.c)(e),Object(u.j)(e,e,Object(f.d)(this.xOffset,-this.yOffset)),this.angle&&Object(u.h)(e,e,_*this.angle);var n=this._computedWidth,i=this._computedHeight,a=-(.5+this._anchorX)*n,s=-(.5-this._anchorY)*i;Object(h.p)(t,a,s),Object(h.q)(t,t,e),this._offsetUpperLeft=Object(p.a)(16*t[0],16*t[1]),Object(h.p)(t,a+n,s),Object(h.q)(t,t,e),this._offsetUpperRight=Object(p.a)(16*t[0],16*t[1]),Object(h.p)(t,a,s+i),Object(h.q)(t,t,e),this._offsetBottomLeft=Object(p.a)(16*t[0],16*t[1]),Object(h.p)(t,a+n,s+i),Object(h.q)(t,t,e),this._offsetBottomRight=Object(p.a)(16*t[0],16*t[1])}},{key:"_computeSize",value:function(e,t,r,n,i,a,s,o){var c=e*r,u=t*r;if(a.sdf&&!s){var l=o&&e>t?c:e,h=t,f=n+2;e=Math.min(l+f,c),t=Math.min(h+f,u)}else e=c,t=u;var v=d.L/Math.max(c,u),y=.5*(c-e)*v,b=.5*(u-t)*v,x=a.rect.x+d.M+y,_=a.rect.y+d.M+b,m=x+a.width-2*y,g=_+a.height-2*b,O=Math.floor(x),j=Math.floor(_),k=Math.ceil(m),M=Math.ceil(g);e*=(k-O)/(m-x),t*=(M-j)/(g-_),this._texUpperLeft=Object(p.a)(O,j),this._texUpperRight=Object(p.a)(k,j),this._texBottomLeft=Object(p.a)(O,M),this._texBottomRight=Object(p.a)(k,M),this._anchorX*=c/e,this._anchorY*=u/t,e*=i,t*=i,this._computedWidth=e,this._computedHeight=t}},{key:"_getPos",value:function(e,t){return Object(p.a)(Math.round(8*e),Math.round(8*t))}}]),r}(e)}},321:function(e,t,r){"use strict";r.d(t,"a",(function(){return Ye})),r.d(t,"b",(function(){return He}));var n=r(4),i=r(12),a=r(92),s=r(89),o=r(88),c=r(1),u=r(101),l=r(102),h=r(110),f=r(382),v=r(103),y=r(115),d=r(99),b=r(367),p=r(90),x=r(91),_=r(108),m=r(152),g=r(133),O=r(104),j=r(202),k=r(118),M=r(161),w=r(117),S=(r(224),r(295)),T=r(239),L=r(169);function I(e,t,r,n,i,a,s){ee=0;var o,c,u,l,h,f=(n-r)*a,v=i&&i.length,y=v?(i[0]-r)*a:f,d=z(t,r,n,0,y,a,!0);if(d&&d.next!==d.prev){if(v&&(d=function(e,t,r,n,i,a){for(var s=new Array,o=0,c=n.length;o<c;o++){var u=z(e,t,r,n[o]*a,o<c-1?n[o+1]*a:r*a,a,!1);u===u.next&&(u.steiner=!0),s.push(R(u))}s.sort(X);for(var l=0,h=s;l<h.length;l++){i=F(h[l],i)}return i}(t,r,n,i,d,a)),f>80*a){o=u=t[0+r*a],c=l=t[1+r*a];for(var b=a;b<y;b+=a){var p=t[b+r*a],x=t[b+1+r*a];o=Math.min(o,p),c=Math.min(c,x),u=Math.max(u,p),l=Math.max(l,x)}h=0!==(h=Math.max(u-o,l-c))?1/h:0}C(d,e,a,o,c,h,s,0)}}function z(e,t,r,n,i,a,s){var o;if(s===function(e,t,r,n,i,a){for(var s=0,o=n,c=i-a;o<i;o+=a)s+=(e[c+t*a]-e[o+t*a])*(e[o+1+t*a]+e[c+1+t*a]),c=o;return s}(e,t,0,n,i,a)>0)for(var c=n;c<i;c+=a)o=W(c+t*a,e[c+t*a],e[c+1+t*a],o);else for(var u=i-a;u>=n;u-=a)o=W(u+t*a,e[u+t*a],e[u+1+t*a],o);return o&&U(o,o.next)&&(A(o),o=o.next),o}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var r,n=e;do{if(r=!1,n.steiner||!U(n,n.next)&&0!==D(n.prev,n,n.next))n=n.next;else{if(A(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function C(e,t,r,n,i,a,s,o){if(e){!o&&a&&(e=B(e,n,i,a));for(var c=e;e.prev!==e.next;){var u=e.prev,l=e.next;if(a?V(e,n,i,a):E(e))t.push(u.index/r+s),t.push(e.index/r+s),t.push(l.index/r+s),A(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?C(e=q(e,t,r,s),t,r,n,i,a,s,2):2===o&&H(e,t,r,n,i,a,s):C(P(e),t,r,n,i,a,s,1);break}}}}function E(e){var t=e.prev,r=e,n=e.next;if(D(t,r,n)>=0)return!1;for(var i=e.next.next,a=i,s=0;i!==e.prev&&(0===s||i!==a);){if(s++,N(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&D(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function V(e,t,r,n){var i=e.prev,a=e,s=e.next;if(D(i,a,s)>=0)return!1;for(var o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,c=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,l=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=G(o,c,t,r,n),f=G(u,l,t,r,n),v=e.prevZ,y=e.nextZ;v&&v.z>=h&&y&&y.z<=f;){if(v!==e.prev&&v!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&D(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,y!==e.prev&&y!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,y.x,y.y)&&D(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;v&&v.z>=h;){if(v!==e.prev&&v!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&D(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=f;){if(y!==e.prev&&y!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,y.x,y.y)&&D(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function W(e,t,r,n){var i=J.create(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function F(e,t){var r=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>s){if(s=o,o===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var c,u=r,l=r.x,h=r.y,f=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=l&&i!==n.x&&N(a<h?i:s,a,l,h,a<h?s:i,a,n.x,n.y)&&((c=Math.abs(a-n.y)/(i-n.x))<f||c===f&&n.x>r.x)&&K(n,e)&&(r=n,f=c),n=n.next;return r}(e,t);if(!r)return t;var n=Q(r,e);return P(n,n.next),P(r,r.next)}function B(e,t,r,n){for(var i;i!==e;i=i.next){if(null===(i=i||e).z&&(i.z=G(i.x,i.y,t,r,n)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,B(e,t,r,n);i.prevZ=i.prev,i.nextZ=i.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var n=void 0,i=e;e=null,t=null;for(var a=0;i;){a++,n=i;for(var s=0;s<r&&n;s++)n=n.nextZ;for(var o=r;s>0||o>0&&n;){var c=void 0;0===s?(c=n,n=n.nextZ,o--):0!==o&&n?i.z<=n.z?(c=i,i=i.nextZ,s--):(c=n,n=n.nextZ,o--):(c=i,i=i.nextZ,s--),t?t.nextZ=c:e=c,c.prevZ=t,t=c}i=n}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function D(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Z(e,t,r,n){return!!(U(e,t)&&U(r,n)||U(e,n)&&U(r,t))||D(e,t,r)>0!=D(e,t,n)>0&&D(r,n,e)>0!=D(r,n,t)>0}function N(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function K(e,t){return D(e.prev,e,e.next)<0?D(e,t,e.next)>=0&&D(e,e.prev,t)>=0:D(e,t,e.prev)<0||D(e,e.next,t)<0}function G(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function U(e,t){return e.x===t.x&&e.y===t.y}function X(e,t){return e.x-t.x}function q(e,t,r,n){var i=e;do{var a=i.prev,s=i.next.next;!U(a,s)&&Z(a,i,i.next,s)&&K(a,s)&&K(s,a)&&(t.push(a.index/r+n),t.push(i.index/r+n),t.push(s.index/r+n),A(i),A(i.next),i=e=s),i=i.next}while(i!==e);return i}function H(e,t,r,n,i,a,s){var o=e;do{for(var c=o.next.next;c!==o.prev;){if(o.index!==c.index&&Y(o,c)){var u=Q(o,c);return o=P(o,o.next),u=P(u,u.next),C(o,t,r,n,i,a,s,0),void C(u,t,r,n,i,a,s,0)}c=c.next}o=o.next}while(o!==e)}function Y(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&Z(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&K(e,t)&&K(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function Q(e,t){var r=J.create(e.index,e.x,e.y),n=J.create(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}for(var J=function(){function e(){Object(s.a)(this,e),this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return Object(o.a)(e,null,[{key:"create",value:function(t,r,n){var i=ee<$.length?$[ee++]:new e;return i.index=t,i.x=r,i.y=n,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}]),e}(),$=new Array,ee=0,te=0;te<8096;te++)$.push(new J);var re=new T.d(0,0,0,1,0),ne=new T.d(0,0,0,1,0);function ie(e,t,r){for(var n=0,i=1;i<r;i++){var a=e[2*(t+i-1)],s=e[2*(t+i-1)+1];n+=(e[2*(t+i)]-a)*(e[2*(t+i)+1]+s)}return n}function ae(e,t,r,n,i){for(var a=0,s=r;s<n;s+=3){var o=2*(e[s]-i),c=2*(e[s+1]-i),u=2*(e[s+2]-i);a+=Math.abs((t[o]-t[u])*(t[c+1]-t[o+1])-(t[o]-t[c])*(t[u+1]-t[o+1]))}return a}re.setExtent(O.fb),ne.setExtent(O.fb);var se=r(114),oe=r(121),ce=r(399),ue=16,le=function(e){return function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(s.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).tessellationProperties={},e._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},e.geometryType=v.d.LINE,e}return Object(o.a)(r,[{key:"writeGeometry",value:function(e,t,r,n){this._writeGeometry(e,t,r,n)}},{key:"_initializeTessellator",value:function(e){var t=y.c.load(this._materialKey),r=y.a.load(this._materialKey),n=this._tessellationOptions,i=t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue,a=this.tessellationProperties._halfWidth<O.eb&&!e&&!i;this.tessellationProperties.minMaxZoom=this._minMaxZoom,n.wrapDistance=65535,n.textured=this._isDashed||this._hasPattern,n.offset=this.tessellationProperties.offset,n.halfWidth=this.tessellationProperties._halfWidth;var s=a?0:1,o=Object(y.h)(r)?fe:he;this._lineTessellator=new ce.a(o(this.tessellationProperties,s,s),ve(this.tessellationProperties),a)}},{key:"_write",value:function(e,t,r,n){var i="esriGeometryPoint"===t.geometryType;e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,i),this._writeGeometry(e,t,n,i),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n){var i=r||oe.a.fromFeatureSetReaderCIM(t);if(i){var a=this._getLines(i,n);null!=a&&this._writeVertices(e,t,a)}}},{key:"_getLines",value:function(e,t){return function(e,t){ne.setPixelMargin(t);var r=ne,n=-t,i=O.fb+t,s=[],o=!1;if(!e.nextPath())return null;for(var c=!0;c;){e.seekPathStart();var u=[];if(!e.numPoints)return null;r.reset(T.a.LineString),e.nextPoint();var l=e.x,h=e.y;if(o)r.moveTo(l,h);else{if(l<n||l>i||h<n||h>i){o=!0;continue}u.push({x:l,y:h})}for(var f=!1;e.nextPoint();)if(l=e.x,h=e.y,o)r.lineTo(l,h);else{if(l<n||l>i||h<n||h>i){f=!0;break}u.push({x:l,y:h})}if(f)o=!0;else{if(o){var v=r.resultWithStarts();if(v){var y,d=Object(a.a)(v);try{for(d.s();!(y=d.n()).done;){var b=y.value;s.push(b)}}catch(p){d.e(p)}finally{d.f()}}}else s.push({line:u,start:0});c=e.nextPath(),o=!1}}return s=s.filter((function(e){return e.line.length>1})),0===s.length?null:s}(e,t?256:16)}},{key:"_writeVertices",value:function(e,t,r){var n=t.getDisplayId(),i=e.vertexCount(),s=this.tessellationProperties,o=this._tessellationOptions;s.out=e,s.id=n,s.indexCount=0,s.vertexCount=0,s.offset=i,o.capType=this._capType,o.joinType=this._joinType;var c=y.a.load(this._materialKey);this.tessellationProperties.key=Object(y.h)(c)?c:y.c.load(this._materialKey);var u,l=Object(a.a)(r);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=h.line,v=h.start;o.initialDistance=v%65535,this._lineTessellator.tessellate(f,o)}}catch(d){l.e(d)}finally{l.f()}}}]),r}(e)},he=function(e,t,r){return function(n,i,a,s,o,c,u,l,h,f,v){var y=Object(k.a)(v,Math.ceil(ue*e._halfWidth)),d=Object(k.b)(Math.round(ue*u),Math.round(ue*l),Math.round(ue*h),Math.round(ue*f)),b=Object(k.b)(ue*o,ue*c,0,e._bitset),p=e.out;return p.vertexBounds(n,i,t,r),p.vertexWrite(Object(k.a)(8*n,8*i)),p.vertexWrite(e.id),p.vertexWrite(e._fillColor),p.vertexWrite(d),p.vertexWrite(y),p.vertexWrite(e._tl),p.vertexWrite(e._br),p.vertexWrite(b),p.vertexWrite(Object(k.a)(Math.ceil(ue*e._halfReferenceWidth),0)),p.vertexWrite(e.minMaxZoom),p.vertexEnd(),e.offset+e.vertexCount++}},fe=function(e,t,r){return function(n,i,a,s,o,c,u,l,h,f,v){var d=Object(k.a)(ue*e._halfWidth,ue*e._halfReferenceWidth),b=Object(k.b)(ue*u+128,ue*l+128,ue*h+128,ue*f+128),p=e.out,x=e._bitset<<24|e.id;p.vertexBounds(n,i,t,r),p.vertexWrite(Object(k.a)(8*n,8*i)),p.vertexWrite(x),p.vertexWrite(e._fillColor);var _=Object(y.i)(e.key);return _||(p.vertexWrite(0),p.vertexWrite(0)),p.vertexWrite(0),p.vertexWrite(d),p.vertexWrite(b),_||p.vertexWrite(e.minMaxZoom),p.vertexEnd(),e.offset+e.vertexCount++}},ve=function(e){return function(t,r,n){var i=e.out;i.indexWrite(t),i.indexWrite(r),i.indexWrite(n),e.indexCount+=3}},ye=r(204),de=function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(e,n,i,a,o,c,u,l,h,f,v,d,b,p,x,_,m,g,j,w){var S;Object(s.a)(this,r),S=t.call(this);var T=y.c.load(e);n&&(T.sdf=n.sdf,T.pattern=!0,T.textureBinding=n.textureBinding),S._capType=a,S._joinType=o,S._miterLimitCosine=Object(M.d)(c),S.tessellationProperties._fillColor=u,S.tessellationProperties._tl=l,S.tessellationProperties._br=h,S._hasPattern=f,S._isDashed=v,S._zOrder=m,S._effects=g||null,S._minMaxZoom=Object(k.a)(Math.round(j*O.F),Math.round(w*O.F)),S._materialKey=T.data;var L=(b?O.l:0)|(p?O.r:0)|(d?O.m:0)|(x?O.k:0);return S.tessellationProperties._bitset=L,S.tessellationProperties._halfWidth=.5*i,S.tessellationProperties._halfReferenceWidth=.5*_,S.tessellationProperties.offset=0,S._initializeTessellator(!1),S}return Object(o.a)(r,null,[{key:"fromCIMLine",value:function(e,t,n){var i,a,s,o,c=e.color,u=e.scaleFactor||1,l=!!e.dashTemplate,h=e.cap;l&&h===se.e.ROUND&&(h=se.e.SQUARE);var f=e.join,v=Object(_.c)(e.width)*u,y=Object(_.c)(e.referenceWidth),b=Object(_.c)(e.miterLimit),p=c&&Object(g.b)(c)||0,x=Object(M.e)(e.scaleInfo,n),m=Object(d.a)(x,2),j=m[0],w=m[1];if(!t)return new r(e.materialKey,t,v,h,f,b,p,0,0,!1,l,null!==(i=e.scaleDash)&&void 0!==i&&i,null!==(a=e.colorLocked)&&void 0!==a&&a,!1,e.sampleAlphaOnly,y,e.zOrder,e.effects,j,w);var S=t.rect,T=t.width,L=t.height,I=S.x+O.M,z=S.y+O.M,P=I+T,C=z+L,E=Object(k.a)(I,z),V=Object(k.a)(P,C);return new r(e.materialKey,t,v,h,f,b,p,E,V,!0,l,null!==(s=e.scaleDash)&&void 0!==s&&s,null!==(o=e.colorLocked)&&void 0!==o&&o,!1,e.sampleAlphaOnly,y,e.zOrder,e.effects,j,w)}},{key:"fromFillOutline",value:function(e){var t,n=y.a.load(e.materialKey);return Object(y.h)(n)&&e.outline&&"esriSLSSolid"===(null===(t=e.outline)||void 0===t?void 0:t.style)?r.fromSimpleLine(Object(c.a)({hash:"",materialKey:e.materialKey},e.outline),null,!0):null}},{key:"fromSimpleLine",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.color,a="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,s=Object(w.i)(e.cap||"round"),o=Object(w.j)(e.join||"round"),c=i&&"esriSLSNull"!==e.style&&Object(g.c)(i)||0;"esriSLSNull"===e.style&&(c=0);var u=Object(_.c)(e.width),l=e.miterLimit;if(!t)return new r(e.materialKey,t,u,s,o,l,c,0,0,!1,a,!0,!1,n,!1,u,0,null,M.b,M.a);var h=t.rect,f=t.width,v=t.height,y=h.x+O.M,d=h.y+O.M,b=y+f,p=d+v,x=Object(k.a)(y,d),m=Object(k.a)(b,p);return new r(e.materialKey,t,u,s,o,l,c,x,m,!0,a,!0,!1,n,!1,u,0,null,M.b,M.a)}},{key:"fromPictureLineSymbol",value:function(e,t,r,n){return l.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!"),null}}]),r}(le(ye.a)),be=function(e){return function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(s.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).forceLibtess=!1,e._bitset=0,e._lineTemplate=null,e.geometryType=v.d.FILL,e}return Object(o.a)(r,[{key:"_maybeAddLineTemplate",value:function(e){this._lineTemplate=de.fromFillOutline(e)}},{key:"_write",value:function(e,t,r,n){var i="esriGeometryPoint"===t.geometryType,a=y.a.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,i),this._writeGeometry(e,t,a,n,i),Object(y.h)(a)&&null!=this._lineTemplate&&this._lineTemplate.writeGeometry(e,t,n,i),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n,i){var a=this._getGeometry(t,n,i);if(null!=a){var s=[];if(a.maxLength>100||this.forceLibtess||!function(e,t){var r=t.coords,n=t.lengths,i=e;if(t.hasIndeterminateRingOrder)return!1;for(var a=0,s=0;s<n.length;){for(var o=s,c=n[s],u=ie(r,a,c),l=[];++o<n.length;){var h=n[o],f=ie(r,a+c,h);if(!(f>0))break;u+=f,l.push(a+c),c+=h}var v=i.length;I(i,r,a,a+c,l,2,0);var y=ae(i,r,v,i.length,0),d=Math.abs(u);if(Math.abs((y-d)/Math.max(1e-7,d))>1e-5)return i.length=0,!1;s=o,a+=c}return!0}(s,a)){var o=function(e){var t=e.coords,r=e.lengths;return Object(S.b)(t,r).buffer}(a);this._writeVertices(e,t,o,[o.length/2],r)}else s.length&&this._writeVertices(e,t,a.coords,a.lengths,r,s)}}},{key:"_writeVertex",value:function(e,t,r,n,i,a){var s=Object(k.a)(1*n,1*i);if(e.vertexBounds(n,i,0,0),e.vertexWrite(s),e.vertexWrite(t),r.symbologyType===v.e.DOT_DENSITY)e.vertexWriteF32(1/Math.abs(a.readGeometryArea()));else{e.vertexWrite(this.fillColor);var o=Object(y.i)(r);o||(e.vertexWrite(this.tl),e.vertexWrite(this.br)),e.vertexWrite(this.aux21),e.vertexWrite(this.aux22),e.vertexWrite(this.aux3),o||e.vertexWrite(this._minMaxZoom)}}},{key:"_writeVertices",value:function(e,t,r,n,i,s){var o=t.getDisplayId(),c=this._bitset<<24|o,u=n.reduce((function(e,t){return e+t})),l=Object(w.n)(i.geometryType,i.symbologyType).geometry/4,h=e.vertexCount();e.vertexEnsureSize(l*u);var f=0;if(s){var v,y=Object(a.a)(s);try{for(y.s();!(v=y.n()).done;){var d=v.value,b=r[2*d],p=r[2*d+1];this._writeVertex(e,c,i,b,p,t),f++}}catch(O){y.e(O)}finally{y.f()}}else for(var x=0;x<r.length;x+=2){var _=Math.round(r[x]),m=Math.round(r[x+1]);this._writeVertex(e,c,i,_,m,t),f++}e.indexEnsureSize(f);for(var g=0;g<f;g++)e.indexWrite(g+h)}},{key:"_getGeometry",value:function(e,t,r){var n=(null===t||void 0===t?void 0:t.asOptimized())||e.readGeometryForDisplay();return n?function(e,t){if(null==e)return null;if(!function(e,t,r){for(var n=0,i=0;i<e.lengths.length;i++){for(var a=e.lengths[i],s=0;s<a;s++){var o=e.coords[2*(s+n)],c=e.coords[2*(s+n)+1];if(o<t||o>r||c<t||c>r)return!0}n+=a}return!1}(e,-128,O.fb+128))return e;re.setPixelMargin(t),re.reset(T.a.Polygon);for(var r=0,n=0;n<e.lengths.length;n++){var i=e.lengths[n],s=e.coords[2*(0+r)],o=e.coords[2*(0+r)+1];re.moveTo(s,o);for(var c=1;c<i;c++)s=e.coords[2*(c+r)],o=e.coords[2*(c+r)+1],re.lineTo(s,o);re.close(),r+=i}var u=re.result(!1);if(!u)return null;var l,h=[],f=[],v=Object(a.a)(u);try{for(v.s();!(l=v.n()).done;){var y,d=l.value,b=0,p=Object(a.a)(d);try{for(p.s();!(y=p.n()).done;){var x=y.value;f.push(x.x),f.push(x.y),b++}}catch(_){p.e(_)}finally{p.f()}h.push(b)}}catch(_){v.e(_)}finally{v.f()}return new L.a(h,f)}(n,r?256:8):null}}]),r}(e)},pe=r(276),xe=l.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),_e=function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this))._ongoingMaterialRequestMap=new Map,n._materialCache=new Map,n._dynamicPropertyMap=new Map,n._cimLayer=e,n}return Object(o.a)(r,[{key:"analyze",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,i,a,s){var o,c,u,l,h,f,v,y,d,b,p,x,_,g,O=this;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s||0!==s.length){e.next=2;break}return e.abrupt("return",null);case 2:if(o=s&&s.length>0,c=r.readLegacyFeature(),u=r.getObjectId(),l=this._materialCache,h=this._cimLayer.materialHash){e.next=5;break}return e.abrupt("return",(xe.error("A Dynamic mesh template must have a material hash value or function!"),null));case 5:if(f="function"==typeof h?h(c,i,a,u):h,null==(v=l.get(f))){e.next=8;break}return e.abrupt("return",v);case 8:if(!(y=this._ongoingMaterialRequestMap.get(f))){e.next=11;break}return e.abrupt("return",y);case 11:d=this._cimLayer,(b=Object(pe.b)(d.cim,this._cimLayer.materialOverrides)).mosaicHash=f,p=d.type,x=d.url,_={cim:b,type:p,mosaicHash:f,url:x,size:null,dashTemplate:null,text:null,fontName:null,objectId:u,animatedSymbolProperties:null},e.t0=p,e.next="marker"===e.t0?17:"line"===e.t0?19:"text"===e.t0?21:22;break;case 17:return _.size=Object(m.g)(d.size,c,i,a),_.animatedSymbolProperties=Object(m.g)(d.animatedSymbolProperties,c,i,a),e.abrupt("break",22);case 19:return _.dashTemplate=d.dashTemplate,e.abrupt("break",22);case 21:_.text=Object(m.g)(d.text,c,i,a),_.fontName=Object(m.g)(d.fontName,c,i,a);case 22:return g=t.getMosaicItem(_,s).then((function(e){return o||(O._ongoingMaterialRequestMap.delete(f),l.set(f,e)),e})).catch((function(e){return O._ongoingMaterialRequestMap.delete(f),xe.error(".analyze()",e.message),null})),e.abrupt("return",(o||this._ongoingMaterialRequestMap.set(f,g),g));case 24:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()}]),r}(ye.a),me=r(223),ge=function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(e,n,i){var a,o;if(Object(s.a)(this,r),(o=t.call(this,e))._minMaxZoom=Object(k.a)(Math.round(n*O.F),Math.round(i*O.F)),Object(m.y)(e.color)){o._dynamicPropertyMap.set("fillColor",(function(t,r,n){var i=e.color(t,r,n);return i&&Object(g.b)(i)||0}))}else{var c=e.color;o.fillColor=c&&Object(g.b)(c)||0}var u="CIMMarkerPlacementInsidePolygon"===(null===(a=e.cim.placement)||void 0===a?void 0:a.type)&&e.cim.placement.shiftOddRows?2:1,l=e.height;if(Object(m.y)(l)){o._dynamicPropertyMap.set("_height",(function(e,t,r){return l(e,t,r)*u}))}else o._height=(l||0)*u;var h=e.offsetX;if(Object(m.y)(h)){o._dynamicPropertyMap.set("_offsetX",(function(e,t,r){return Object(_.c)(h(e,t,r))}))}else o._offsetX=Object(_.c)(h||0);var f=e.offsetY;if(Object(m.y)(f)){o._dynamicPropertyMap.set("_offsetY",(function(e,t,r){return Object(_.c)(-f(e,t,r))}))}else o._offsetY=Object(_.c)(-f||0);var v=e.scaleX;Object(m.y)(v)?o._dynamicPropertyMap.set("_scaleX",v):o._scaleX=v||1;var y=e.angle;if(Object(m.y)(y)){o._dynamicPropertyMap.set("_angle",(function(e,t,r){return Object(j.a)(y(e,t,r))}))}else o._angle=Object(j.a)(y)||0;if(null!=e.effects){var d=e.effects;Object(m.y)(d)?o._dynamicPropertyMap.set("_effects",d):o._effects=d}return o._cimFillLayer=e,o._bitset=(e.colorLocked?O.l:0)|(e.applyRandomOffset?O.j:0)|(e.sampleAlphaOnly?O.k:0)|(e.hasUnresolvedReplacementColor?O.i:0),o._fillMaterialKey=e.materialKey,Object(b.a)(o)}return Object(o.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var a=y.a.load(this._fillMaterialKey),s=this._materialCache,o=(0,this._cimFillLayer.materialHash)(i,t,r),c=s.get(o),u=null;if(c&&Object(me.a)(c.spriteMosaicItem)&&(u=c.spriteMosaicItem),u){var l=u,h=l.rect,f=l.width,v=l.height,d=h.x+O.M,b=h.y+O.M,p=d+f,x=b+v,m=Object(_.c)(this._height);m<=0&&(m=x-b),m<O.E&&(m*=O.t,this._bitset|=O.g),m=Math.round(m);var g=Object(_.c)(this._height/v*f);g<=0&&(g=p-d),g<O.E&&(g*=O.t,this._bitset|=O.h),g=Math.round(g);var j=this._scaleX;this.tl=Object(k.a)(d,b),this.br=Object(k.a)(p,x),this.aux21=Object(k.a)(g,m),this.aux22=Object(k.a)(this._offsetX,this._offsetY),this.aux3=Object(k.b)(j*O.t,1*O.t,this._angle,0),a.sdf=u.sdf,a.pattern=!0,a.textureBinding=u.textureBinding}else this.tl=0,this.br=0,this.aux21=0,this.aux22=0,this.aux3=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data}}],[{key:"fromCIMFill",value:function(e,t){var n=Object(M.e)(e.scaleInfo,t),i=Object(d.a)(n,2);return new r(e,i[0],i[1])}}]),r}(be(_e)),Oe=function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(e,n,i){var a;Object(s.a)(this,r),(a=t.call(this,e))._minMaxZoom=Object(k.a)(Math.round(n*O.F),Math.round(i*O.F)),a._cimLineLayer=e;var o=0;Object(m.y)(e.width)||(o=.5*Object(_.c)(e.width));a._dynamicPropertyMap.set("_halfWidth",(function(t,r,n){return Object(m.y)(e.width)?.5*Object(_.c)(e.width(t,r,n)):o})),Object(m.y)(e.cap)?a._dynamicPropertyMap.set("_capType",e.cap):a._capType=e.cap,Object(m.y)(e.join)?a._dynamicPropertyMap.set("_joinType",e.join):a._joinType=e.join;var c=e.color;if(Object(m.y)(c)){a._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return Object(g.b)(c(e,t,r))}))}else a._fillColor=c&&Object(g.b)(c)||0;var u=e.miterLimit;if(Object(m.y)(u)){a._dynamicPropertyMap.set("_miterLimitCosine",(function(e,t,r){return Object(M.d)(u(e,t,r))}))}else a._miterLimitCosine=Object(M.d)(u);if(null!=e.effects){var l=e.effects;Object(m.y)(l)?a._dynamicPropertyMap.set("_effects",l):a._effects=l}a._scaleFactor=e.scaleFactor||1,a._isDashed=null!=e.dashTemplate;var h=e.colorLocked?O.l:0,f=e.scaleDash?O.m:0,v=e.sampleAlphaOnly?O.k:0;return a.tessellationProperties._bitset=h|f|v,a._materialKey=e.materialKey,a._initializeTessellator(!0),a}return Object(o.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)})),this._halfWidth*=this._scaleFactor;var a=this._materialCache,s=(0,this._cimLineLayer.materialHash)(i,t,r),o=a.get(s),c=null;if(o&&Object(me.a)(o.spriteMosaicItem)&&(c=o.spriteMosaicItem),c){this._hasPattern=!0;var u=c,l=u.rect,h=u.width,f=u.height,v=l.x+O.M,d=l.y+O.M,b=v+h,p=d+f;this.tessellationProperties._tl=Object(k.a)(v,d),this.tessellationProperties._br=Object(k.a)(b,p)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var x=y.c.load(this._materialKey);c&&(x.sdf=c.sdf,x.pattern=!0,x.textureBinding=c.textureBinding),this._materialKey=x.data}}],[{key:"fromCIMLine",value:function(e,t){var n=Object(M.e)(e.scaleInfo,t),i=Object(d.a)(n,2);return new r(e,i[0],i[1])}}]),r}(le(_e)),je=r(182),ke=r(156),Me=r(320),we=Object(ke.c)(),Se=Object(je.a)(),Te=function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(e,n,i){var a,o;Object(s.a)(this,r),(o=t.call(this,e))._cimMarkerLayer=e,o._minMaxZoom=Object(k.a)(Math.round(n*O.F),Math.round(i*O.F));var c=e.color;if(Object(m.y)(c)){o._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return Object(g.b)(c(e,t,r))}))}else o._fillColor=Object(g.b)(c);var u=e.outlineColor;if(Object(m.y)(u)){o._dynamicPropertyMap.set("_outlineColor",(function(e,t,r){return Object(g.b)(u(e,t,r))}))}else o._outlineColor=Object(g.b)(u);var l=e.size;if(Object(m.y)(l)){o._dynamicPropertyMap.set("_size",(function(e,t,r){return Object(_.c)(l(e,t,r))}))}else o._size=Object(_.c)(l)||0;var h=e.scaleX;Object(m.y)(h)?o._dynamicPropertyMap.set("_scaleX",h):o._scaleX=h;var f=e.offsetX;if(Object(m.y)(f)){o._dynamicPropertyMap.set("xOffset",(function(e,t,r){return Object(_.c)(f(e,t,r))}))}else o.xOffset=Object(_.c)(f)||0;var v=e.offsetY;if(Object(m.y)(v)){o._dynamicPropertyMap.set("yOffset",(function(e,t,r){return Object(_.c)(v(e,t,r))}))}else o.yOffset=Object(_.c)(v)||0;var y=e.outlineWidth;if(Object(m.y)(y)){o._dynamicPropertyMap.set("_outlineWidth",(function(e,t,r){return Object(_.c)(y(e,t,r))}))}else o._outlineWidth=Object(_.c)(y)||0;var d=e.rotation;if(Object(m.y)(d)?o._dynamicPropertyMap.set("_angle",d):o._angle=d||0,null!=e.effects){var b=e.effects;Object(m.y)(b)?o._dynamicPropertyMap.set("_effects",b):o._effects=b}if(null!=e.markerPlacement){var p=e.markerPlacement;Object(m.y)(p)?o._dynamicPropertyMap.set("_markerPlacement",p):o._markerPlacement=p}return o._scaleFactor=null!==(a=e.scaleFactor)&&void 0!==a?a:1,o._bitSet=(e.alignment===se.a.MAP?O.n:O.o)|(e.colorLocked?O.l:0)|(e.scaleSymbolsProportionally?O.q:0),o._materialKey=e.materialKey,o}return Object(o.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature(),a=e.getObjectId();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var s=this._cimMarkerLayer.materialHash,o="function"==typeof s?s(i,t,r,a):s,c=this._materialCache.get(o);if(c&&Object(me.a)(c.spriteMosaicItem)&&c.spriteMosaicItem){var h=c.spriteMosaicItem,f=this._cimMarkerLayer.sizeRatio,v=h.width/h.height*this._scaleX,d=y.d.load(this._materialKey);d.sdf=h.sdf,d.pattern=!0,d.textureBinding=h.textureBinding,this._materialKey=d.data;var b=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,p=this._size,x=p*v,m=this.xOffset,g=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var O=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(_.c)(this._cimMarkerLayer.frameHeight):1,j=this._outlineWidth*O,M=Object(_.c)(this._cimMarkerLayer.referenceSize),w=0,S=0,T=this._cimMarkerLayer.anchorPoint;T&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(w=Object(_.c)(T.x)/(this._size*v),S=Object(_.c)(T.y)/this._size):(w=T.x,S=T.y)),this._anchorX=w,this._anchorY=S,this._sizeOutlineWidth=Object(k.b)(Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*j),255)),Math.round(Math.min(Math.sqrt(128*M),255))),this.angle=b;var L=Math.round(64*f);this._bitestAndDistRatio=Object(k.a)(this._bitSet,L),this._computeSize(x,p,f,j,this._scaleFactor,h,d.hasSizeVV(),!0),this._applyTransformation(Se,we),this.xOffset=m,this.yOffset=g}else l.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new u.a("mapview-cim","Encountered an error when binding feature"))}}],[{key:"fromCIMMarker",value:function(e,t){var n=Object(M.e)(e.scaleInfo,t),i=Object(d.a)(n,2);return new r(e,i[0],i[1])}}]),r}(Object(Me.a)(_e)),Le=r(107),Ie=r(106),ze=r(155),Pe=r(317),Ce=r(310);function Ee(e,t,r,n){var i;return"string"==typeof e.text?e.text:"function"==typeof e.text&&null!==(i=e.text(t,r,n))&&void 0!==i?i:""}var Ve=function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(e,n,i){var a;Object(s.a)(this,r),(a=t.call(this,e))._horizontalAlignment="center",a._verticalAlignment="middle",a._textToGlyphs=new Map,a._minMaxZoom=Object(k.a)(Math.round(n*O.F),Math.round(i*O.F));var o=e.scaleFactor||1;a._cimTextLayer=e;var c=e.color;if(Object(m.y)(c)){a._dynamicPropertyMap.set("_color",(function(e,t,r){return Object(g.b)(c(e,t,r))}))}else a._color=Object(g.b)(c);var u,l=e.outlineColor;if(Object(m.y)(l)){a._dynamicPropertyMap.set("_haloColor",(function(e,t,r){return Object(g.b)(l(e,t,r))}))}else a._haloColor=Object(g.b)(l);Object(m.y)(e.size)||(u=Math.min(Math.round(Object(_.c)(e.size*e.sizeRatio)),127));var h;if(a._dynamicPropertyMap.set("_size",(function(t,r,n){return Object(m.y)(e.size)?Math.min(Math.round(Object(_.c)(e.size(t,r,n)*e.sizeRatio)),127):u})),Object(m.y)(e.outlineSize)){a._dynamicPropertyMap.set("_haloSize",(function(t,r,n){return Math.min(Math.floor(5*Object(_.c)(e.outlineSize(t,r,n)*e.sizeRatio)),127)}))}else a._haloSize=Math.min(Math.floor(5*Object(_.c)(e.outlineSize*e.sizeRatio)),127);Object(m.y)(e.offsetX)||(h=Math.round(Object(_.c)(e.offsetX*e.sizeRatio)));var f;a._dynamicPropertyMap.set("_xOffset",(function(t,r,n){return Object(m.y)(e.offsetX)?Math.round(Object(_.c)(e.offsetX(t,r,n)*e.sizeRatio)):h})),Object(m.y)(e.offsetY)||(f=Math.round(Object(_.c)(e.offsetY*e.sizeRatio)));if(a._dynamicPropertyMap.set("_yOffset",(function(t,r,n){return Object(m.y)(e.offsetY)?Math.round(Object(_.c)(e.offsetY(t,r,n)*e.sizeRatio)):f})),Object(m.y)(e.angle)?a._dynamicPropertyMap.set("_angle",e.angle):a._angle=e.angle,Object(m.y)(e.horizontalAlignment)?a._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):a._horizontalAlignment=e.horizontalAlignment,Object(m.y)(e.verticalAlignment)?a._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):a._verticalAlignment=e.verticalAlignment,null!=e.effects){var v=e.effects;Object(m.y)(v)?a._dynamicPropertyMap.set("_effects",v):a._effects=v}if(null!=e.markerPlacement){var d=e.markerPlacement;Object(m.y)(d)?a._dynamicPropertyMap.set("_markerPlacement",d):a._textPlacement=d}Object(m.y)(e.text)?a._dynamicPropertyMap.set("_text",e.text):a._text=e.text,a._backgroundColor=e.backgroundColor&&Object(g.b)(e.backgroundColor),a._borderLineColor=e.borderLineColor&&Object(g.b)(e.borderLineColor),a._borderLineSize=e.borderLineWidth,a._scaleFactor=o;var b=Math.min(Math.round(Object(_.c)(e.referenceSize*e.sizeRatio)),127);a._referenceSize=Math.round(Math.sqrt(256*b)),a._materialKey=e.materialKey;var p=y.f.load(a._materialKey);return p.sdf=!0,a._bitset=(e.alignment===se.a.MAP?1:0)|(e.colorLocked?1:0)<<1,a._materialKey=p.data,a._decoration="none",a._lineHeight=1,a._lineWidth=512,a._isCIM=!0,a}return Object(o.a)(r,[{key:"analyze",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,i,a,s){var o,c,u;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.readLegacyFeature(),c=Ee(this._cimTextLayer,o,a,s),e.next=4,Object(Le.a)(Object(Ie.a)(r.prototype),"analyze",this).call(this,t,i,a,s,Object(Ce.a)(c));case 4:return u=e.sent,e.abrupt("return",(u&&u.glyphMosaicItems&&this._textToGlyphs.set(c,u.glyphMosaicItems),u));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"bindFeature",value:function(e,t,r){var n,i,a,s=this,o=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((function(e,n){s[n]=e(o,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/O.y,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Object(ze.e)(null!==(n=this._horizontalAlignment)&&void 0!==n?n:"center"),this._yAlignD=Object(ze.g)(null!==(i=this._verticalAlignment)&&void 0!==i?i:"baseline");var c=null!==(a=this._textToGlyphs.get(this._text))&&void 0!==a?a:[];this.bindTextInfo(c,!1)}else this._shapingInfo=null}}],[{key:"fromCIMText",value:function(e,t){var n=Object(M.e)(e.scaleInfo,t),i=Object(d.a)(n,2);return new r(e,i[0],i[1])}}]),r}(Object(Pe.a)(_e)),We=function(e){Object(p.a)(r,e);var t=Object(x.a)(r);function r(e,n,i,a,o,c,u,l,h,f,v,d,b,p,x,_){var m;Object(s.a)(this,r),(m=t.call(this))._effects=p||void 0;var g=y.a.load(e);return n&&(g.sdf=n.sdf,g.pattern=!0,g.textureBinding=n.textureBinding),m.fillColor=i,m.tl=a,m.br=o,m.aux21=Object(k.a)(c,u),m.aux22=Object(k.a)(l,h),m.aux3=Object(k.b)(f,v,d,0),m._bitset=b,m._minMaxZoom=Object(k.a)(Math.round(x*O.F),Math.round(_*O.F)),m._materialKey=g.data,m}return Object(o.a)(r,null,[{key:"fromCIMFill",value:function(e,t,n){var i=e.color,a=i&&Object(g.b)(i)||0,s=e.materialKey,o=Object(M.e)(e.scaleInfo,n),c=Object(d.a)(o,2),u=c[0],l=c[1],h=(e.colorLocked?O.l:0)|(e.applyRandomOffset?O.j:0)|(e.sampleAlphaOnly?O.k:0)|(e.hasUnresolvedReplacementColor?O.i:0);if(!t)return new r(s,null,a,0,0,0,0,0,0,0,0,0,h,e.effects,u,l);var f=t.rect,v=t.width,y=t.height,b=e.scaleX||1,p=f.x+O.M,x=f.y+O.M,m=p+v,w=x+y,S=Object(_.c)(e.height),T=b*S;"CIMHatchFill"===e.cim.type&&(T*=v/y);var L=S;L<=0&&(L=w-x),L<O.E&&(L*=O.t,h|=O.g),L=Math.round(L);var I=T;I<=0&&(I=m-p),I<O.E&&(I*=O.t,h|=O.h),I=Math.round(I);var z=Object(_.c)(e.offsetX||0),P=Object(_.c)(-e.offsetY||0);return new r(s,t,a,Object(k.a)(p,x),Object(k.a)(m,w),I,L,z,P,O.t,O.t,Object(j.a)(e.angle),h,e.effects,u,l)}},{key:"fromSimpleFill",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.color,s=a&&"esriSFSNull"!==e.style&&Object(g.c)(a)||0,o=i?O.l:0,c=e.materialKey;if(t){var u=t.rect,l=t.width,h=t.height,f=t.pixelRatio,v=u.x+O.M,y=u.y+O.M,d=v+l,b=y+h,p=Object(k.a)(v,y),x=Object(k.a)(d,b),_=l/f;_<O.E&&(_*=O.t,o|=O.h),_=Math.round(_);var m=h/f;m<O.E&&(m*=O.t,o|=O.g),n=new r(c,t,s,p,x,_,m=Math.round(m),0,0,O.t,O.t,0,o,null,M.b,M.a)}else n=new r(c,null,s,0,0,0,0,0,0,0,0,0,o,null,M.b,M.a);return n._maybeAddLineTemplate(e),n}},{key:"fromPictureFill",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=O.J,a=t.rect,s=t.width,o=t.height,c=a.x+O.M,u=a.y+O.M,l=c+s,h=u+o,f=Object(k.a)(c,u),v=Object(k.a)(l,h),y=n?O.l:0,d=Object(_.c)(e.width);d<O.E&&(d*=O.t,y|=O.h),d=Math.round(d);var b=Object(_.c)(e.height);b<O.E&&(b*=O.t,y|=O.g),b=Math.round(b);var p=Object(_.c)(e.xoffset),x=Object(_.c)(-e.yoffset),m=new r(e.materialKey,t,i,f,v,d,b,p,x,O.t*e.xscale,O.t*e.yscale,0,y,null,M.b,M.a);return m._maybeAddLineTemplate(e),m}}]),r}(be(ye.a)),Ae=r(319),Re=r(316),Fe=function(){function e(){Object(s.a)(this,e),this._resolver=null}return Object(o.a)(e,[{key:"isHeld",value:function(){return!!this._resolver}},{key:"acquire",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._resolver){e.next=7;break}return e.next=3,this._resolver.promise;case 3:return e.next=5,this.acquire();case 5:e.next=8;break;case 7:this._resolver=Object(h.c)();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"release",value:function(){var e=this._resolver;this._resolver=null,null===e||void 0===e||e.resolve()}}]),e}();function Be(){return(Be=Object(i.a)(Object(n.a)().mark((function e(t,r,i){return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.acquire();case 3:return e.next=5,r(i);case 5:t.release(),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),t.release(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}var De=r(216),Ze=l.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Ne={sortKey:null,templates:new Array},Ke={isOutline:!1,placement:null,symbologyType:v.e.DEFAULT,vvFlags:0},Ge=Object(c.a)(Object(c.a)({},f.e),{},{hash:JSON.stringify(f.e),materialKey:Object(y.g)(v.d.MARKER,Ke)}),Ue=Object(c.a)(Object(c.a)({},f.g),{},{hash:JSON.stringify(f.g),materialKey:Object(y.g)(v.d.LINE,Ke)}),Xe=Object(c.a)(Object(c.a)({},f.f),{},{hash:JSON.stringify(f.f),materialKey:Object(y.g)(v.d.FILL,Ke)});function qe(e,t){var r=e.length;return e.push(null),t.then((function(t){return e[r]=t})),e}function He(e){return null!=e&&!!(1&e)}var Ye=function(){function e(t,r){Object(s.a)(this,e),this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new Fe,this._fetchResource=t,this._tileInfo=r}return Object(o.a)(e,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},{key:"_textError",get:function(){return this._errorTemplates.line[0]}},{key:"createTemplateGroup",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._initErrorTemplates();var n=e.hash,i=this._symbolToTemplate.get(n);if(null!=i)return i;var a=new Array,s={sortKey:r,templates:a};t&&this._createMeshTemplates(a,t,!0),this._createMeshTemplates(a,e,!1);var o=this._createGroupId("expanded-cim"===e.type&&Qe(e));return this._idToTemplateGroup.set(o,s),this._symbolToTemplate.set(n,o),o}},{key:"getTemplateGroup",value:function(e){var t;return null!==(t=this._idToTemplateGroup.get(e))&&void 0!==t?t:Ne}},{key:"getDynamicTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?(He(e)||Ze.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):Ne}},{key:"getMosaicItem",value:function(e,t){var r=this,n=this._createTemplateId(),i=new Promise((function(e){return r._idToResolver.set(n,e)}));return this._fetchQueue.push({symbol:e,id:n,glyphIds:t}),i}},{key:"finalize",value:function(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,r){return Be.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}},{key:"_initErrorTemplates",value:function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Xe,!1),marker:this._createMeshTemplates([],Ge,!1),line:this._createMeshTemplates([],Ue,!1)})}},{key:"_fetchAllQueuedResources",value:function(e){var t=this;if(!this._fetchQueue.length)return Promise.resolve();var r=this._fetchQueue,n=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(n).then((function(){return t._fetchResource(r,e).then((function(e){var r,n=Object(a.a)(e);try{for(n.s();!(r=n.n()).done;){var i=r.value,s=i.id,o=i.mosaicItem;t._idToResolver.get(s)(o),t._idToResolver.delete(s)}}catch(c){n.e(c)}finally{n.f()}}))})).catch((function(e){Object(h.h)(e)?t._fetchQueue=t._fetchQueue.concat(r):"worker:port-closed"===e.name||Ze.error(new u.a("mapview-template-store","Unable to fetch requested texture resources",e))}))}},{key:"_createGroupId",value:function(e){return this._idCounter++<<1|(e?1:0)}},{key:"_createTemplateId",value:function(){return this._templateIdCounter++}},{key:"_createSMS",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",Object(me.a)(i,Ze)?Ae.a.fromSimpleMarker(t,i):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPMS",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",Object(me.a)(i,Ze)?Ae.a.fromPictureMarker(t,i):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createSFS",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r){var i,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return i=e.sent,a=i.spriteMosaicItem,e.abrupt("return",Object(me.a)(a,Ze)?We.fromSimpleFill(t,a,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createPFS",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r){var i,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return i=e.sent,a=i.spriteMosaicItem,e.abrupt("return",Object(me.a)(a,Ze)?We.fromPictureFill(t,a,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createSLS",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r){var i,a;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return i=e.sent,a=i.spriteMosaicItem,e.abrupt("return",Object(me.a)(a,Ze)?de.fromSimpleLine(t,a):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createLMS",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",Object(me.a)(i,Ze)?Ae.a.fromLineSymbolMarker(t,i):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTS",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,i=r.glyphMosaicItems,e.abrupt("return",Re.a.fromText(t,null!==i&&void 0!==i?i:[]));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMText",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(De.a)(t),Object(Ce.a)(t.text));case 2:return r=e.sent,i=r.glyphMosaicItems,e.abrupt("return",Object(me.a)(i,Ze)?Re.a.fromCIMText(t,i,this._tileInfo):this._textError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMFill",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(De.a)(t));case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",Object(me.a)(i,Ze)?We.fromCIMFill(t,i,this._tileInfo):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMLine",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(De.a)(t));case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",Object(me.a)(i,Ze)?de.fromCIMLine(t,i,this._tileInfo):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMMarker",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(De.a)(t));case 2:return r=e.sent,i=r.spriteMosaicItem,e.abrupt("return",Object(me.a)(i,Ze)?Ae.a.fromCIMMarker(t,i,this._tileInfo):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIM",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,null==(i=this._cimTemplateCache.get(r))){e.next=4;break}return e.abrupt("return",i);case 4:e.t0=t.type,e.next="marker"===e.t0?7:"line"===e.t0?11:"fill"===e.t0?15:"text"===e.t0?19:22;break;case 7:return e.next=9,this._createCIMMarker(t);case 9:return i=e.sent,e.abrupt("break",22);case 11:return e.next=13,this._createCIMLine(t);case 13:return i=e.sent,e.abrupt("break",22);case 15:return e.next=17,this._createCIMFill(t);case 17:return i=e.sent,e.abrupt("break",22);case 19:return e.next=21,this._createCIMText(t);case 21:i=e.sent;case 22:return e.abrupt("return",(this._cimTemplateCache.set(r,i),i));case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createDynamicCIM",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t){var r,i;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,null==(i=this._cimTemplateCache.get(r))){e.next=4;break}return e.abrupt("return",i);case 4:e.t0=t.type,e.next="marker"===e.t0?7:"line"===e.t0?9:"fill"===e.t0?11:"text"===e.t0?13:14;break;case 7:return i=Te.fromCIMMarker(t,this._tileInfo),e.abrupt("break",14);case 9:return i=Oe.fromCIMLine(t,this._tileInfo),e.abrupt("break",14);case 11:return i=ge.fromCIMFill(t,this._tileInfo),e.abrupt("break",14);case 13:i=Ve.fromCIMText(t,this._tileInfo);case 14:return e.abrupt("return",(this._cimTemplateCache.set(r,i),i));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPrimitiveMeshTemplates",value:function(e,t,r){switch(t.type){case"esriSMS":return qe(e,this._createSMS(t));case"esriPMS":return qe(e,this._createPMS(t));case"esriSFS":return qe(e,this._createSFS(t,r));case"line-marker":return qe(e,this._createLMS(t));case"esriPFS":return qe(e,this._createPFS(t,r));case"esriSLS":return qe(e,this._createSLS(t,!1));case"esriTS":return qe(e,this._createTS(t));default:return Ze.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}},{key:"_createMeshTemplates",value:function(e,t,r){if(t.type.includes("3d"))return Ze.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){var n,i=Object(a.a)(t.layers);try{for(i.s();!(n=i.n()).done;){var s=n.value;"function"==typeof s.materialHash?qe(e,this._createDynamicCIM(s)):qe(e,this._createCIM(s))}}catch(l){i.e(l)}finally{i.f()}return e}if("composite-symbol"===t.type){var o,c=Object(a.a)(t.layers);try{for(c.s();!(o=c.n()).done;){var u=o.value;this._createPrimitiveMeshTemplates(e,u,r)}}catch(l){c.e(l)}finally{c.f()}return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}]),e}(),Qe=function(e){if(!e.layers)return!1;var t,r=Object(a.a)(e.layers);try{for(r.s();!(t=r.n()).done;){if("function"==typeof t.value.materialHash)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}},398:function(e,t,r){"use strict";function n(e,t,r,n){var i=e.clone(),a=1<<i.level,s=i.col+t,o=i.row+r;return n&&s<0?(i.col=s+a,i.world-=1):s>=a?(i.col=s-a,i.world+=1):i.col=s,i.row=o,i}r.d(t,"a",(function(){return n}))},399:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(89),i=r(88),a=r(114),s=r(104);function o(e,t){return e.x===t.x&&e.y===t.y}function c(e,t){return e.x=t.y,e.y=-t.x,e}function u(e,t){return e.x=-t.y,e.y=t.x,e}function l(e,t){return e.x=t.x,e.y=t.y,e}function h(e,t){return e.x=-t.x,e.y=-t.y,e}function f(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function v(e,t){return e.x*t.x+e.y*t.y}function y(e,t,r,n){return e.x=t.x*r+t.y*n,e.y=t.x*n-t.y*r,e}var d=function(){function e(t,r,i){Object(n.a)(this,e),this._writeVertex=t,this._writeTriangle=r,this._canUseThinTessellation=i,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}return Object(i.a)(e,[{key:"tessellate",value:function(e,t){(function(e){if(e){var t=e.length;if(!(t<=1)){for(var r=0,n=1;n<t;n++)o(e[n],e[r])||++r===n||(e[r]=e[n]);e.length=r+1}}})(e),this._canUseThinTessellation&&t.halfWidth<s.eb&&!t.offset?this._tessellateThin(e,t):this._tessellate(e,t)}},{key:"_tessellateThin",value:function(e,t){if(!(e.length<2))for(var r=t.wrapDistance||65535,n=t.initialDistance||0,i=!1,a=e[0].x,s=e[0].y,o=e.length,c=1;c<o;++c){i&&(i=!1,n=0);var u=e[c].x,l=e[c].y,h=u-a,f=l-s,v=Math.sqrt(h*h+f*f);if(h/=v,f/=v,n+v>r){i=!0;var y=(r-n)/v;v=r-n,u=(1-y)*a+y*u,l=(1-y)*s+y*l,--c}var d=this._writeVertex(a,s,0,0,h,f,f,-h,0,-1,n),b=this._writeVertex(a,s,0,0,h,f,-f,h,0,1,n);n+=v;var p=this._writeVertex(u,l,0,0,h,f,f,-h,0,-1,n),x=this._writeVertex(u,l,0,0,h,f,-f,h,0,1,n);this._writeTriangle(d,b,p),this._writeTriangle(b,p,x),a=u,s=l}}},{key:"_tessellate",value:function(e,t){var r=e[0],n=e[e.length-1],i=o(r,n),s=i?3:2;if(!(e.length<s)){var d,b,p,x,_,m=t.pixelCoordRatio,g=null!=t.capType?t.capType:a.e.BUTT,O=null!=t.joinType?t.joinType:a.p.MITER,j=null!=t.miterLimit?Math.min(t.miterLimit,4):2,k=null!=t.roundLimit?Math.min(t.roundLimit,1.05):1.05,M=null!=t.halfWidth?t.halfWidth:2,w=!!t.textured,S=null,T=this._prevNormal,L=this._nextNormal,I=-1,z=-1,P=this._joinNormal,C=this._textureNormalLeft,E=this._textureNormalRight,V=this._textureNormal,W=-1,A=-1,R=t.wrapDistance||65535,F=t.initialDistance||0,B=this._writeVertex,D=this._writeTriangle,Z=function(e,t,r,n,i,a){var s=B(b,p,x,_,r,n,e,t,i,a,F);return W>=0&&A>=0&&s>=0&&D(W,A,s),W=A,A=s,s};i&&(d=e[e.length-2],L.x=n.x-d.x,L.y=n.y-d.y,z=f(L),L.x/=z,L.y/=z);for(var N,K,G=!1,U=0;U<e.length;++U){if(G&&(G=!1,F=0),d&&(T.x=-L.x,T.y=-L.y,F+(I=z)>R&&(G=!0)),G){var X=(R-F)/I;I=R-F,d={x:(1-X)*d.x+X*e[U].x,y:(1-X)*d.y+X*e[U].y},--U}else d=e[U];b=d.x,p=d.y;var q=U<=0&&!G,H=U===e.length-1;if(q||(F+=I),(S=H?i?e[1]:null:e[U+1])?(L.x=S.x-b,L.y=S.y-p,z=f(L),L.x/=z,L.y/=z):(L.x=void 0,L.y=void 0),!i){if(q){u(P,L),x=P.x,_=P.y,g===a.e.SQUARE&&(Z(-L.y-L.x,L.x-L.y,L.x,L.y,0,-1),Z(L.y-L.x,-L.x-L.y,L.x,L.y,0,1)),g===a.e.ROUND&&(Z(-L.y-L.x,L.x-L.y,L.x,L.y,-1,-1),Z(L.y-L.x,-L.x-L.y,L.x,L.y,-1,1)),g!==a.e.ROUND&&g!==a.e.BUTT||(Z(-L.y,L.x,L.x,L.y,0,-1),Z(L.y,-L.x,L.x,L.y,0,1));continue}if(H){c(P,T),x=P.x,_=P.y,g!==a.e.ROUND&&g!==a.e.BUTT||(Z(T.y,-T.x,-T.x,-T.y,0,-1),Z(-T.y,T.x,-T.x,-T.y,0,1)),g===a.e.SQUARE&&(Z(T.y-T.x,-T.x-T.y,-T.x,-T.y,0,-1),Z(-T.y-T.x,T.x-T.y,-T.x,-T.y,0,1)),g===a.e.ROUND&&(Z(T.y-T.x,-T.x-T.y,-T.x,-T.y,1,-1),Z(-T.y-T.x,T.x-T.y,-T.x,-T.y,1,1));continue}}var Y=void 0,Q=void 0,J=(K=L,-((N=T).x*K.y-N.y*K.x));if(Math.abs(J)<.01)v(T,L)>0?(P.x=T.x,P.y=T.y,J=1,Y=Number.MAX_VALUE,Q=!0):(u(P,L),J=1,Y=1,Q=!1);else{P.x=(T.x+L.x)/J,P.y=(T.y+L.y)/J;var $=((Y=f(P))-1)*M*m;Q=Y>4||$>I&&$>z}x=P.x,_=P.y;var ee=O;switch(O){case a.p.BEVEL:Y<1.05&&(ee=a.p.MITER);break;case a.p.ROUND:Y<k&&(ee=a.p.MITER);break;case a.p.MITER:Y>j&&(ee=a.p.BEVEL)}switch(ee){case a.p.MITER:if(Z(P.x,P.y,-T.x,-T.y,0,-1),Z(-P.x,-P.y,-T.x,-T.y,0,1),H)break;if(w){var te=G?0:F;W=this._writeVertex(b,p,x,_,L.x,L.y,P.x,P.y,0,-1,te),A=this._writeVertex(b,p,x,_,L.x,L.y,-P.x,-P.y,0,1,te)}break;case a.p.BEVEL:var re=J<0,ne=void 0,ie=void 0,ae=void 0,se=void 0;if(re){var oe=W;W=A,A=oe,ne=C,ie=E}else ne=E,ie=C;if(Q)ae=re?u(this._innerPrev,T):c(this._innerPrev,T),se=re?c(this._innerNext,L):u(this._innerNext,L);else{var ce=re?h(this._inner,P):l(this._inner,P);ae=ce,se=ce}var ue=re?c(this._bevelStart,T):u(this._bevelStart,T);Z(ae.x,ae.y,-T.x,-T.y,ne.x,ne.y);var le=Z(ue.x,ue.y,-T.x,-T.y,ie.x,ie.y);if(H)break;var he=re?u(this._bevelEnd,L):c(this._bevelEnd,L);if(Q){var fe=this._writeVertex(b,p,x,_,-T.x,-T.y,0,0,0,0,F);W=this._writeVertex(b,p,x,_,L.x,L.y,se.x,se.y,ne.x,ne.y,F),A=this._writeVertex(b,p,x,_,L.x,L.y,he.x,he.y,ie.x,ie.y,F),this._writeTriangle(le,fe,A)}else{if(w){var ve=this._bevelMiddle;ve.x=(ue.x+he.x)/2,ve.y=(ue.y+he.y)/2,y(V,ve,-T.x,-T.y),Z(ve.x,ve.y,-T.x,-T.y,V.x,V.y),y(V,ve,L.x,L.y),W=this._writeVertex(b,p,x,_,L.x,L.y,ve.x,ve.y,V.x,V.y,F),A=this._writeVertex(b,p,x,_,L.x,L.y,se.x,se.y,ne.x,ne.y,F)}else{var ye=W;W=A,A=ye}Z(he.x,he.y,L.x,L.y,ie.x,ie.y)}if(re){var de=W;W=A,A=de}break;case a.p.ROUND:var be=J<0,pe=void 0,xe=void 0;if(be){var _e=W;W=A,A=_e,pe=C,xe=E}else pe=E,xe=C;var me=be?h(this._inner,P):l(this._inner,P),ge=void 0,Oe=void 0;Q?(ge=be?u(this._innerPrev,T):c(this._innerPrev,T),Oe=be?c(this._innerNext,L):u(this._innerNext,L)):(ge=me,Oe=me);var je=be?c(this._roundStart,T):u(this._roundStart,T),ke=be?u(this._roundEnd,L):c(this._roundEnd,L),Me=Z(ge.x,ge.y,-T.x,-T.y,pe.x,pe.y),we=Z(je.x,je.y,-T.x,-T.y,xe.x,xe.y);if(H)break;var Se=this._writeVertex(b,p,x,_,-T.x,-T.y,0,0,0,0,F);Q||this._writeTriangle(W,A,Se);var Te=h(this._outer,me),Le=this._writeVertex(b,p,x,_,L.x,L.y,ke.x,ke.y,xe.x,xe.y,F),Ie=void 0,ze=void 0,Pe=Y>2;if(Pe){var Ce=void 0;Y!==Number.MAX_VALUE?(Te.x/=Y,Te.y/=Y,Ce=(Y*((Ce=v(T,Te))*Ce-1)+1)/Ce):Ce=-1,(Ie=be?c(this._startBreak,T):u(this._startBreak,T)).x+=T.x*Ce,Ie.y+=T.y*Ce,(ze=be?u(this._endBreak,L):c(this._endBreak,L)).x+=L.x*Ce,ze.y+=L.y*Ce}y(V,Te,-T.x,-T.y);var Ee=this._writeVertex(b,p,x,_,-T.x,-T.y,Te.x,Te.y,V.x,V.y,F);y(V,Te,L.x,L.y);var Ve=w?this._writeVertex(b,p,x,_,L.x,L.y,Te.x,Te.y,V.x,V.y,F):Ee,We=Se,Ae=w?this._writeVertex(b,p,x,_,L.x,L.y,0,0,0,0,F):Se,Re=-1,Fe=-1;if(Pe&&(y(V,Ie,-T.x,-T.y),Re=this._writeVertex(b,p,x,_,-T.x,-T.y,Ie.x,Ie.y,V.x,V.y,F),y(V,ze,L.x,L.y),Fe=this._writeVertex(b,p,x,_,L.x,L.y,ze.x,ze.y,V.x,V.y,F)),w?Pe?(this._writeTriangle(We,we,Re),this._writeTriangle(We,Re,Ee),this._writeTriangle(Ae,Ve,Fe),this._writeTriangle(Ae,Fe,Le)):(this._writeTriangle(We,we,Ee),this._writeTriangle(Ae,Ve,Le)):Pe?(this._writeTriangle(Se,we,Re),this._writeTriangle(Se,Re,Fe),this._writeTriangle(Se,Fe,Le)):(this._writeTriangle(Se,we,Ee),this._writeTriangle(Se,Ve,Le)),Q?(W=this._writeVertex(b,p,x,_,L.x,L.y,Oe.x,Oe.y,pe.x,pe.y,F),A=Le):(W=w?this._writeVertex(b,p,x,_,L.x,L.y,Oe.x,Oe.y,pe.x,pe.y,F):Me,this._writeTriangle(W,Ae,Le),A=Le),be){var Be=W;W=A,A=Be}}}}}}]),e}()},418:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var n=r(99),i=r(1),a=r(92),s=r(107),o=r(106),c=r(90),u=r(91),l=r(4),h=r(89),f=r(88),v=r(12),y=r(98),d=r(101),b=r(102),p=r(381),x=r(207),_=r(230),m=r(216),g=b.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");function O(e,t,r,n){return j.apply(this,arguments)}function j(){return(j=Object(v.a)(Object(l.a)().mark((function e(t,r,n,i){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="simple"===e.t0||"heatmap"===e.t0?3:"map"===e.t0?4:"interval"===e.t0?5:"dictionary"===e.t0?6:"pie-chart"===e.t0?7:"subtype"===e.t0?8:9;break;case 3:return e.abrupt("return",M.fromBasicRenderer(t,r,n,i));case 4:return e.abrupt("return",T.fromUVRenderer(t,r,n,i));case 5:return e.abrupt("return",S.fromCBRenderer(t,r,n,i));case 6:return e.abrupt("return",C.fromDictionaryRenderer(t,r,n,i));case 7:return e.abrupt("return",w.fromPieChartRenderer(t,r,n,i));case 8:return e.abrupt("return",w.fromSubtypes(t,r,n,i));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k,M=function(){function e(){Object(h.a)(this,e),this.type="feature",this._defaultResult=null}return Object(f.a)(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"match",value:function(e,t,r,n,i){return this.getDefault()}},{key:"analyze",value:function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,r,n,i,a,s){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()}],[{key:"fromBasicRenderer",value:function(){var t=Object(v.a)(Object(l.a)().mark((function t(r,n,i,a){var s,o,c;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.symbol){t.next=7;break}return t.next=4,Object(m.b)(r.symbol,i,a);case 4:o=t.sent,c=n.createTemplateGroup(o,null),s.setDefault(c);case 7:return t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(e,r,n,i){return t.apply(this,arguments)}}()},{key:"fromPieChartRenderer",value:function(){var t=Object(v.a)(Object(l.a)().mark((function t(r,n,i,a){var s,o,c,u;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.markerSymbol){t.next=12;break}return t.next=4,Object(m.b)(r.markerSymbol,i,a);case 4:if(o=t.sent,t.t0=r.fillSymbol,!t.t0){t.next=10;break}return t.next=9,Object(m.b)(r.fillSymbol,i,a);case 9:c=t.sent;case 10:u=n.createTemplateGroup(o,c),s.setDefault(u);case 12:return t.abrupt("return",s);case 13:case"end":return t.stop()}}),t)})));return function(e,r,n,i){return t.apply(this,arguments)}}()}]),e}(),w=function(e){Object(c.a)(r,e);var t=Object(u.a)(r);function r(e,n){var i;return Object(h.a)(this,r),(i=t.call(this))._subMatchers=e,i._subtypeField=n,i}return Object(f.a)(r,[{key:"match",value:function(e,t,r,n,i){var a=t.readAttribute(this._subtypeField),s=this._subMatchers.get(a);return s?s.match(e,t,r,n,i):null}}],[{key:"fromSubtypes",value:function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,n,i,a){var s,o,c,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=new Map,o=[],c=Object(l.a)().mark((function e(){var r,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=parseInt(u,10),c=O(t.renderers[u],n,i,a).then((function(e){return s.set(r,e)})),o.push(c);case 2:case"end":return e.stop()}}),e)})),e.t0=Object(l.a)().keys(t.renderers);case 3:if((e.t1=e.t0()).done){e.next=8;break}return u=e.t1.value,e.delegateYield(c(),"t2",6);case 6:e.next=3;break;case 8:return e.next=10,Promise.all(o);case 10:return e.abrupt("return",new r(s,t.subtypeField));case 11:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),r}(M),S=function(e){Object(c.a)(r,e);var t=Object(u.a)(r);function r(e,n,i,a){var s;return Object(h.a)(this,r),(s=t.call(this)).type="interval",s._intervals=[],s._isMaxInclusive=n,s._fieldIndex=a,s._field=e,s._normalizationInfo=i,s}return Object(f.a)(r,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return Object(s.a)(Object(o.a)(r.prototype),"size",this).call(this)+this._intervals.length}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(null==a||isNaN(a)||a===1/0||a===-1/0)return this.getDefault();for(var s=0;s<this._intervals.length;s++){var o=this._intervals[s],c=o.interval,u=o.result,l=a>=c.min,h=this._isMaxInclusive?a<=c.max:a<c.max;if(l&&h)return u}return this.getDefault()}},{key:"_needsNormalization",value:function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}},{key:"_getValueFromField",value:function(e){var t,r=e.readAttribute(this._field);if(!this._needsNormalization()||null==r)return r;var n=this._normalizationInfo,i=n.normalizationField,a=n.normalizationTotal,s=n.normalizationType,o=null!==(t=e.readAttribute(i))&&void 0!==t?t:1;if(s)switch(s){case"esriNormalizeByField":return o?r/o:void 0;case"esriNormalizeByLog":return Math.log(r)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return r/a*100;default:return void g.error("Found unknown normalization type: ".concat(s))}else g.error("Normalization is required, but no type was set!")}}],[{key:"fromCBRenderer",value:function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,n,i,a){var s,o,c,u,h,f,y,d,b;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.isMaxInclusive,o=t.normalizationField,c=t.normalizationTotal,u=t.normalizationType,h=t.field,f=new r(h,s,{normalizationField:o,normalizationTotal:c,normalizationType:u},t.fieldIndex),e.next=8,Object(m.b)(t.backgroundFillSymbol,i,a);case 8:return y=e.sent,e.next=11,Promise.all(t.intervals.map(function(){var e=Object(v.a)(Object(l.a)().mark((function e(t){var r,s,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.b)(t.symbol,i,a);case 2:return r=e.sent,e.next=5,n.createTemplateGroup(r,y);case 5:s=e.sent,o={min:t.min,max:t.max},f.add(o,s);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.next=13,Object(m.b)(t.defaultSymbol,i,a);case 13:if(!(d=e.sent)){e.next=19;break}return e.next=17,n.createTemplateGroup(d,y);case 17:b=e.sent,f.setDefault(b);case 19:return e.abrupt("return",f);case 20:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),r}(M),T=function(e){Object(c.a)(r,e);var t=Object(u.a)(r);function r(e,n,i){var a;return Object(h.a)(this,r),(a=t.call(this)).type="map",a._nullResult=null,a._resultsMap=new Map,a._fields=[],a._fieldsIndex=i,a._fields=e,a._seperator=n||"",a}return Object(f.a)(r,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"add",value:function(e,t){this._resultsMap.set(e.toString(),t)}},{key:"size",value:function(){return Object(s.a)(Object(o.a)(r.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(null==a)return this.getDefault();var s=a.toString();return this._resultsMap.has(s)?this._resultsMap.get(s):this.getDefault()}},{key:"_getValueFromFields",value:function(e){var t,r=[],n=Object(a.a)(this._fields);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=e.readAttribute(i);null==s||""===s?r.push("<Null>"):r.push(s)}}catch(o){n.e(o)}finally{n.f()}return r.join(this._seperator)}}],[{key:"fromUVRenderer",value:function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,n,i,a){var s,o,c,u,h,f,y;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.fieldDelimiter,o=[t.field],t.field2&&o.push(t.field2),t.field3&&o.push(t.field3),e.next=4,Object(m.b)(t.backgroundFillSymbol,i,a);case 4:return c=e.sent,u=new r(o,s,t.fieldIndex),e.next=8,Promise.all(t.map.map(function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,r){var s,o,h;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.b)(t.symbol,i,a);case 2:return s=e.sent,o=r+1,e.next=6,n.createTemplateGroup(s,c,o);case 6:h=e.sent,"<Null>"===t.value?u.setNullResult(h):u.add(t.value,h);case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 8:return e.next=10,Object(m.b)(t.defaultSymbol,i,a);case 10:if(!(h=e.sent)){e.next=17;break}return f=Number.MAX_SAFE_INTEGER,e.next=15,n.createTemplateGroup(h,c,f);case 15:y=e.sent,u.setDefault(y);case 17:return e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),r}(M);function L(e,t){return I.apply(this,arguments)}function I(){return(I=Object(v.a)(Object(l.a)().mark((function e(t,r){var n,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof(n=t||1)){e.next=3;break}return e.abrupt("return",(function(e,t,r){return n}));case 3:return e.next=5,Object(x.d)(n,r.spatialReference,r.fields);case 5:return i=e.sent,e.abrupt("return",(function(e,t,n){return Object(_.a)(i,e,{$view:n},r.geometryType,t)||1}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){return P.apply(this,arguments)}function P(){return(P=Object(v.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(k||(k=r.e(330).then(r.bind(null,208))),k));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e,r,n,i,a,o){var c;return Object(h.a)(this,s),(c=t.call(this)).type="dictionary",c._groupIdCache=new p.a(100),c._loader=e,c._fieldMap=e.fieldMap,c._symbolFields=e.getSymbolFields(),c._templates=r,c._info=n,c._scaleFn=i,c._schemaUtilsModule=a,c._symbolOptions=o,c}return Object(f.a)(s,[{key:"_analyzeFeature",value:function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,r,n,s,o){var c,u,h,f,v,y,b,p,x=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.readLegacyFeature(),u=this._scaleFn(c,n,s),h=this._attributeHash(c)+"-"+u,!(f=this._groupIdCache.get(h))){e.next=3;break}return e.abrupt("return",f);case 3:return v=Object(i.a)(Object(i.a)({},s),{},{spatialReference:this._info.spatialReference,abortOptions:o,fields:this._info.fields}),e.next=6,this._loader.getSymbolAsync(c,v);case 6:return y=e.sent,b=this._schemaUtilsModule.createSymbolSchema(y,this._symbolOptions),p=Object(m.b)(b,this._info,r,o).then((function(e){if("expanded-cim"!==(null===e||void 0===e?void 0:e.type))return g.error(new d.a("mapview-bad-type","Found unexpected type ".concat(null===e||void 0===e?void 0:e.type," in dictionary response"))),null;e.hash+="-"+u;var t,r=Object(a.a)(e.layers);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.scaleFactor=u,n.templateHash+="-"+u}}catch(i){r.e(i)}finally{r.f()}return x._templates.createTemplateGroup(e,null)})),e.abrupt("return",(this._groupIdCache.put(h,p,1),p));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"analyze",value:function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,r,n,i,a,s){var o,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r.getCursor(),c=[];o.next();)c.push(this._analyzeFeature(o,n,i,a,s));return e.abrupt("return",Promise.all(c).then((function(e){return e.filter(y.i)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t,r,n,i){return null}},{key:"_attributeHash",value:function(e){var t,r="",n=Object(a.a)(this._symbolFields);try{for(n.s();!(t=n.n()).done;){var i,s=t.value,o=null===(i=this._fieldMap)||void 0===i?void 0:i[s];o&&(r+=e.attributes[o]+"-")}}catch(c){n.e(c)}finally{n.f()}return r}}],[{key:"fromDictionaryRenderer",value:function(){var e=Object(v.a)(Object(l.a)().mark((function e(t,i,a,o){var c,u,h,f,v,y;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Promise.resolve().then(r.bind(null,522)),z()]);case 2:return c=e.sent,u=Object(n.a)(c,2),h=u[0].DictionaryLoader,f=u[1],v=new h(t.url,t.config,t.fieldMap),e.next=9,v.fetchResources({spatialReference:a.spatialReference,fields:a.fields});case 9:return e.next=11,L(t.scaleExpression,a);case 11:return y=e.sent,e.abrupt("return",new s(v,i,a,y,f,t.symbolOptions));case 13:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),s}(M)},423:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var n=r(34),i=r(89),a=r(88),s=(r(482),r(388),r(220)),o=(r(446),r(463),r(104)),c=r(176),u=r(103),l=r(117),h=new Map;h.set(u.d.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),h.set(u.d.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),h.set(u.d.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),h.set(u.d.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),h.set(u.d.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var f=r(272),v=function(){function e(t,r,n){Object(i.a)(this,e),this._start={index:0,vertex:0};var a=function(e,t,r){var n=h.get(e),i=n.indicesPerRecord,a=n.multiplier,s=n.verticesPerRecord;return{recordBytes:r*o.u*Uint32Array.BYTES_PER_ELEMENT,indexBytes:a*i*r*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:a*s*r*t}}(t,r,n),s=r/4;this.geometryType=t,this._records=new f.a(Int32Array,a.recordBytes),this._indices=new f.a(Uint32Array,a.indexBytes),this._vertices=new f.a(Uint32Array,a.vertexBytes),this._metrics=new f.a(Float32Array,0),this._strideInt=s}return Object(a.a)(e,[{key:"serialize",value:function(e){var t=this._records.buffer(),r=this._indices.buffer(),n=this._vertices.buffer(),i=this._metrics.length?this._metrics.buffer():null,a=4*this._strideInt;return e.push(t,r,n),{stride:a,records:t,indices:r,vertices:n,metrics:i}}},{key:"strideInt",get:function(){return this._strideInt}},{key:"recordCount",get:function(){return this._records.length/o.u}},{key:"vertexCount",get:function(){return this._vertices.length/this._strideInt}},{key:"indexCount",get:function(){return this._indices.length}},{key:"indexWriter",get:function(){return this._indices}},{key:"vertexWriter",get:function(){return this._vertices}},{key:"metricWriter",get:function(){return this._metrics}},{key:"vertexEnsureSize",value:function(e){this._vertices.ensureSize(e)}},{key:"indexEnsureSize",value:function(e){this._indices.ensureSize(e)}},{key:"recordStart",value:function(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}},{key:"recordEnd",value:function(e,t,r,n,i,a,s,o){this._records.push(e),this._records.push(null!==t&&void 0!==t?t:0),this._records.push(r),this._records.push(n),this._records.push(i),this._records.push(a),this._records.push(s),this._records.writeF32(o)}},{key:"writeIndex",value:function(e){this._indices.push(e)}},{key:"writeVertex",value:function(e){this._vertices.push(e)}},{key:"writeVertexF32",value:function(e){this._vertices.writeF32(e)}},{key:"copyLastFrom",value:function(e,t,r){for(var n=e._records.length-o.u,i=e._records.getValue(n),a=e._records.getValue(n+1),s=e._records.getValue(n+2),c=e._records.getValue(n+4),u=e._records.getValue(n+6),l=e._records.getValue(n+7),h=this._vertices.length,f=(e._start.vertex-this._vertices.length)/this._strideInt,v=this._indices.length,y=this.vertexCount,d=e._start.index;d!==e._indices.length;d++){var b=e._indices.getValue(d);this._indices.push(b-f)}for(var p=e._start.vertex;p!==e._vertices.length;p++){var x=e._vertices.getValue(p);this._vertices.push(x)}for(var _=h;_<=this._vertices.length;_+=this._strideInt)this._vertices.i1616Add(_,t,r);this._records.push(i),this._records.push(a),this._records.push(s),this._records.push(v),this._records.push(c),this._records.push(y),this._records.push(u),this._records.push(l)}}]),e}(),y=r(398),d=128;function b(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case d:return 1}}function p(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case d:return 1}}var x=function(){function e(t,r,n,a,s){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(i.a)(this,e),this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._version=0,this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=r,this.tileKey=t,this._hasAggregate=a,this._pixelBufferEnabled=s,this._version=o,this._symbologyType=n}return Object(a.a)(e,[{key:"hasAggregates",get:function(){return this._hasAggregate}},{key:"hasPixelBufferEnabled",get:function(){return this._pixelBufferEnabled}},{key:"serialize",value:function(e){var t=this,r=[];return r.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((function(n,i){var a=1<<i,o=b(a),c=p(a),u=Object(y.a)(new s.a(t.tileKey),o,c,e),l=t._serializeTileVertexData(t.tileKey,u.id,n.vertexData);l.message.bufferIds=n.displayIds,r.push(l)})),r}},{key:"_serializeTileVertexData",value:function(e,t,r){var i,a,s,o,c,l,h=new Array;return{message:{tileKeyOrigin:e,tileKey:t,data:(l={},Object(n.a)(l,u.d.MARKER,null===(i=r.get(u.d.MARKER))||void 0===i?void 0:i.serialize(h)),Object(n.a)(l,u.d.FILL,null===(a=r.get(u.d.FILL))||void 0===a?void 0:a.serialize(h)),Object(n.a)(l,u.d.LINE,null===(s=r.get(u.d.LINE))||void 0===s?void 0:s.serialize(h)),Object(n.a)(l,u.d.TEXT,null===(o=r.get(u.d.TEXT))||void 0===o?void 0:o.serialize(h)),Object(n.a)(l,u.d.LABEL,null===(c=r.get(u.d.LABEL))||void 0===c?void 0:c.serialize(h)),l),version:this._version},transferList:h}}},{key:"featureStart",value:function(e,t){this._current.insertAfter=e,this._current.sortKey=t}},{key:"featureEnd",value:function(){}},{key:"recordStart",value:function(e,t,r,n){this._current.writer=this._getVertexWriter(r),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=n,this._current.id=e,this._current.materialKey=t,this._current.geometryType=r,this._current.isDotDensity=!1,this._current.writer.recordStart()}},{key:"recordCount",value:function(){return this._current.writer.recordCount}},{key:"vertexCount",value:function(){return this._current.writer.vertexCount}},{key:"indexCount",value:function(){return this._current.writer.indexCount}},{key:"vertexEnsureSize",value:function(e){this._current.writer.vertexEnsureSize(e)}},{key:"indexEnsureSize",value:function(e){this._current.writer.indexEnsureSize(e)}},{key:"vertexBounds",value:function(e,t,r,n){this._current.bufferingEnabled&&this._addOverlap(e,t,r,n)}},{key:"vertexWrite",value:function(e){this._current.writer.writeVertex(e)}},{key:"vertexWriteF32",value:function(e){this._current.writer.writeVertexF32(e)}},{key:"vertexEnd",value:function(){}},{key:"vertexWriter",value:function(){return this._current.writer.vertexWriter}},{key:"indexWrite",value:function(e){this._current.writer.writeIndex(e)}},{key:"indexWriter",value:function(){return this._current.writer.indexWriter}},{key:"metricWriter",value:function(){return this._current.writer.metricWriter}},{key:"metricStart",value:function(e,t,r,n,i,a,s,o){this._current.writer=this._getVertexWriter(u.d.LABEL);var l=this._current.writer.metricWriter;l.push(Object(c.f)(e)),l.push(t),l.push(r),l.push(n),l.push(i),l.push(a),l.push(s),l.push(o),l.push(255),this._current.metricBoxLenPointer=l.push(0)}},{key:"metricEnd",value:function(){var e=this._current.writer.metricWriter;0===e.getValue(this._current.metricBoxLenPointer)&&e.seek(e.length-10)}},{key:"metricBoxWrite",value:function(e,t,r,n){var i=this._current.writer.metricWriter;i.incr(this._current.metricBoxLenPointer),i.push(0),i.push(0),i.push(e),i.push(t),i.push(r),i.push(n)}},{key:"recordEnd",value:function(){var e=this._current.vertStart,t=this._current.writer.vertexCount-e;if(!t)return!1;this.hasRecords=!0;var r=this._current.indexStart,n=this._current.writer.indexCount-r;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,r,n,e,t,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===u.d.LABEL)return!0;for(var i=this._current.writer,a=0;a<8;a++){var s=1<<a;if(this._current.overlaps&s){this._data.neighbors[a]||(this._data.neighbors[a]={vertexData:new Map,displayIds:new Set});var c=this._data.neighbors[a],h=this._current.geometryType;if(!c.vertexData.has(h)){var f=Object(l.n)(h,this._symbologyType).geometry,y=new v(h,f,o.H);c.vertexData.set(h,y)}var d=c.vertexData.get(this._current.geometryType),x=512*-b(s)*8,_=512*-p(s)*8;null!==d&&void 0!==d&&d.copyLastFrom(i,x,_),c.displayIds.add(this._current.id)}}return!0}},{key:"_addOverlap",value:function(e,t,r,n){var i=255^((e<0+r?148:e>=o.fb-r?41:189)|(t<0+n?224:t>=o.fb-n?7:231));this._current.overlaps|=i}},{key:"_getVertexWriter",value:function(e){if(!this._data.self.has(e)){var t=this._data.self,r=Object(l.n)(e,this._symbologyType).geometry;t.set(e,new v(e,r,this.hint.records))}return this._data.self.get(e)}}]),e}()},424:function(e,t,r){"use strict";r.d(t,"a",(function(){return N}));var n=r(4),i=r(12),a=r(92),s=r(89),o=r(88),c=(r(93),r(110)),u=r(295),l=r(176),h=r(99),f=r(90),v=r(91),y=r(101),d=r(102),b=r(141),p=r(108),x=r(219),_=r(182),m=r(114),g=r(155),O=r(133),j=r(104),k=r(103),M=r(118),w=r(115),S=r(161);function T(e){return e.length-1}function L(e){for(var t=0,r=0;r<T(e);r++)t+=I(e,r);return t}function I(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=function(e,t){return e[t+1]}(e,t),i=Object(h.a)(n,2),a=i[0],s=i[1];return Math.sqrt(a*a+s*s)*r}var z=function(){function e(t,r,n,i,a){Object(s.a)(this,e),this._segments=t,this._index=r,this._distance=n,this._xStart=i,this._yStart=a,this._done=!1}return Object(o.a)(e,[{key:"clone",value:function(){return new e(this._segments,this._index,this._distance,this.xStart,this.yStart)}},{key:"equals",value:function(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}},{key:"leq",value:function(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}},{key:"geq",value:function(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}},{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){var e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},{key:"done",get:function(){return this._done}},{key:"hasPrev",value:function(){return this._index-1>=0}},{key:"hasNext",value:function(){return this._index+1<T(this._segments)}},{key:"next",value:function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}},{key:"prev",value:function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}},{key:"_seekBackwards",value:function(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var n=this.backwardLength;this.prev();){if(n+this.length>e)return this._seekBackwards(e-n);n+=this.length}return this._distance=0,t?this:null}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}],[{key:"create",value:function(t){return new e(t,0,0,t[0][0],t[0][1])}}]),e}();function P(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=L(e),a=z.create(e),s=i/2;if(!n)return a.seek(s),void r(a.clone(),0,s+0*t,i);var o=Math.max((i-t)/2,0),c=Math.floor(o/t),u=s-c*t;a.seek(u);for(var l=-c;l<=c;l++)a.x<512&&a.x>=0&&a.y<512&&a.y>=0&&r(a.clone(),l,s+l*t,i),a.seek(t)}function C(e,t){var r=1e-6;if(!(t<=0)){var n=e.length;if(!(n<3)){var i=[],a=0;i.push(0);for(var s=1;s<n;s++)a+=Object(S.c)(e[s],e[s-1]),i.push(a);t=Math.min(t,.2*a);var o=[];o.push(e[0][0]),o.push(e[0][1]);var c=e[n-1][0],u=e[n-1][1],l=Object(S.g)([0,0],e[0],e[1]);Object(S.f)(l),e[0][0]+=t*l[0],e[0][1]+=t*l[1],Object(S.g)(l,e[n-1],e[n-2]),Object(S.f)(l),e[n-1][0]+=t*l[0],e[n-1][1]+=t*l[1];for(var h=1;h<n;h++)i[h]+=t;i[n-1]+=t;for(var f=.5*t,v=1;v<n-1;v++){for(var y=0,d=0,b=0,p=v-1;p>=0&&!(i[p+1]<i[v]-f);p--){var x=f+i[p+1]-i[v],_=i[p+1]-i[p],m=i[v]-i[p]<f?1:x/_;if(Math.abs(m)<r)break;var g=m*m,O=m*x-.5*g*_,j=m*_/t,k=e[p+1],M=e[p][0]-k[0],w=e[p][1]-k[1];y+=j/O*(k[0]*m*x+.5*g*(x*M-_*k[0])-g*m*_*M/3),d+=j/O*(k[1]*m*x+.5*g*(x*w-_*k[1])-g*m*_*w/3),b+=j}for(var T=v+1;T<n&&!(i[T-1]>i[v]+f);T++){var L=f-i[T-1]+i[v],I=i[T]-i[T-1],z=i[T]-i[v]<f?1:L/I;if(Math.abs(z)<r)break;var P=z*z,C=z*L-.5*P*I,E=z*I/t,V=e[T-1],W=e[T][0]-V[0],A=e[T][1]-V[1];y+=E/C*(V[0]*z*L+.5*P*(L*W-I*V[0])-P*z*I*W/3),d+=E/C*(V[1]*z*L+.5*P*(L*A-I*V[1])-P*z*I*A/3),b+=E}o.push(y/b),o.push(d/b)}o.push(c),o.push(u);for(var R=0,F=0;R<n;R++)e[R][0]=o[F++],e[R][1]=o[F++]}}}var E=r(316),V=d.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");var W=function(e){var t=new Map;return function(r){return t.has(r)||t.set(r,e(r)),t.get(r)}}((function(e){var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t})),A=function(e){return Math.floor(127*e+127)},R=function(e){return Math.floor(10*e)},F=function(e){return Math.round(e*(254/360))},B=function(e){Object(f.a)(r,e);var t=Object(v.a)(r);function r(e,n,i,a){var o,c,u,l,f,v,y;Object(s.a)(this,r),(y=t.call(this,e,null===(o=i.font)||void 0===o?void 0:o.size,i.haloSize||0,null===(c=i.font)||void 0===c?void 0:c.size,i.color&&Object(O.c)(i.color)||0,i.haloColor&&Object(O.c)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,Object(g.i)(n.labelPlacement)?m.a.MAP:m.a.SCREEN,null===(u=i.font)||void 0===u?void 0:u.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null,!1,null,null,i.backgroundColor&&Object(O.c)(i.backgroundColor),i.borderLineColor&&Object(O.c)(i.borderLineColor),i.borderLineSize))._outLineLabelAngle=0,y._refPlacementPadding=0,y._refPlacementDirX=0,y._refPlacementDirY=0,y._refOffsetX=0,y._refOffsetY=0,y._zoomLevel=0,y.geometryType=k.d.LABEL,y._allowOverrun=null!==(l=n.allowOverrun)&&void 0!==l&&l,y._repeatLabel=null===(f=n.repeatLabel)||void 0===f||f,y._labelPosition=null!==(v=n.labelPosition)&&void 0!==v?v:"curved";var d=function(e,t){var r=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return Object(b.e)(r,0,25.5)}(n,a),x=function(e,t){var r=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return Object(b.e)(r,0,25.5)}(n,a),_=n.labelPlacement,M=Object(g.c)(_),S=Object(h.a)(M,2),T=S[0],L=S[1];y._xAlignD=T,y._yAlignD=L,y._minZoom=d,y._maxZoom=x,y._minBackgroundZoom=d,y._maxBackgroundZoom=x,y._refPlacementPadding=Object(p.c)(i.haloSize)+j.db,y._repeatLabelDistance=n.repeatLabelDistance?Object(p.c)(n.repeatLabelDistance):128;var I=w.b.load(e);return I.sdf=!0,y._materialKey=I.data,y}return Object(o.a)(r,[{key:"_shapedBox",get:function(){return this._shapingInfo.bounds}},{key:"setZoomLevel",value:function(e){this._zoomLevel=e}},{key:"bindReferenceTemplate",value:function(e){var t=Object(g.f)(this._xAlignD),r=Object(g.h)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,null!=e){if("circle"===e.boundsType&&(t||r)){var n=Math.sqrt(t*t+r*r);t/=n,r/=n}var i=Math.max(e.height,e.width),a=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(M.b)(a,i,A(t),A(r)),this._referenceSize=i,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}else this._refSymbolAndPlacementOffset=Object(M.b)(0,0,A(t),A(r))}},{key:"_write",value:function(e,t){if(null!=this._shapingInfo){var r=this._shapingInfo,n=t.getDisplayId(),i="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(i)switch(this._current={out:e,inId:n,inShaping:r,zoomLevel:this._zoomLevel},"esriGeometryPolyline"===t.geometryType&&"curved"===this._labelPosition&&(this._borderLineColor||this._backgroundColor)&&V.warnOnce("TextSymbol properties 'borderLineColor', 'borderLineSize', and 'backgroundColor' are not supported in curved labels"),t.geometryType){case"esriGeometryPolyline":this._placeLineLabels(i);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(i);break;default:!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mapview-labeling";V.error(new y.a(t,e))}("Geometry of type ".concat(t.geometryType," is not supported"))}}}},{key:"_isVisible",value:function(e,t){var r=R(this._current.zoomLevel);return R(e)<=r&&r<=R(t)}},{key:"_placePointLabels",value:function(e){var t=this._current,r=t.out,n=t.inId,i=t.inShaping;this._writeGlyphs(r,n,e,i)}},{key:"_placeLineLabels",value:function(e){var t,r=function(e,t){for(var r=t,n=0;n<e.length;n++){var i=e[n];C(i,r);var a=[];a.push(i[0]);for(var s=1;s<i.length;s++){var o=Object(h.a)(i[s-1],2),c=o[0],u=o[1],l=Object(h.a)(i[s],2),f=l[0],v=l[1],y=Math.round(f-c),d=Math.round(v-u);a.push([y,d])}e[n]=a,i=a}return e}(e.paths,this._current.inShaping.bounds.width),n=this._placeSubdivGlyphs.bind(this),i=(this._shapedBox.width+this._repeatLabelDistance)/2,s=Object(a.a)(r);try{for(s.s();!(t=s.n()).done;){P(t.value,i,n,this._repeatLabel)}}catch(o){s.e(o)}finally{s.f()}}},{key:"_placeSubdivGlyphs",value:function(e,t,r,n){var i=W(t),a=this._shapedBox.width/2,s=Math.sqrt(this._repeatLabelDistance)/2,o=Math.min(r,n-r),c=this._current.inShaping.isMultiline?25:Math.log2(o/(s+a/2)),u=0===t?c:Math.min(i,c),l=Math.max(this._minZoom,this._current.zoomLevel+1-u),h=this._current.zoomLevel-l,f=this._shapedBox.width/2*Math.pow(2,h);this._current.inShaping.isMultiline?0===t&&this._placeStraight(e,l):this._allowOverrun&&h<0?this._placeStraightAlong(e,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(e,l):"curved"===this._labelPosition&&this._placeCurved(e,l,f)}},{key:"_placeStraight",value:function(e,t){var r=this._current,n=r.out,i=r.inId,a=r.inShaping,s=Math.ceil(e.angle*(180/Math.PI)%360),o=Math.ceil((e.angle*(180/Math.PI)+180)%360);this._outLineLabelAngle=F(s),this._writeGlyphs(n,i,e,a,t),this._outLineLabelAngle=F(o),this._writeGlyphs(n,i,e,a,t)}},{key:"_placeCurved",value:function(e,t,r){var n=this._current,i=n.out,a=n.inId;i.metricStart(a,t,e.x,e.y,0,0,0,0);var s=e.clone(),o=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=F(o),this._placeFirst(s,t,1),this._placeBack(e,s,t,r,1),this._placeForward(e,s,t,r,1),this._outLineLabelAngle=F(c),this._placeFirst(s,t,0),this._placeBack(e,s,t,r,0),this._placeForward(e,s,t,r,0),i.metricEnd()}},{key:"_placeStraightAlong",value:function(e,t){var r=this._current,n=r.out,i=r.inId,a=r.inShaping;n.metricStart(i,t,e.x,e.y,0,0,0,0);var s=e.clone(),o=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360,u=a.glyphs.length>0&&(this._borderLineColor||this._backgroundColor);if(this._maxBackgroundZoom=25,this._minBackgroundZoom=Math.max(t,0),u){var l=w.b.load(this._materialKey);l.textureBinding=a.glyphs[0].textureBinding;var f=Object(x.b)(Object(_.a)(),-e.angle),v=a.shapeBackground(f),y=Object(h.a)(v,2),d=y[0],b=y[1];this._outLineLabelAngle=F(o),n.recordStart(i,l.data,this.geometryType,!0),this._writeBackgroundGeometry(n,i,e,d,b),n.recordEnd(),this._outLineLabelAngle=F(c),n.recordStart(i,l.data,this.geometryType,!0),this._writeBackgroundGeometry(n,i,e,d,b),n.recordEnd()}this._outLineLabelAngle=F(o),this._placeFirst(s,t,1,!0),this._outLineLabelAngle=F(c),this._placeFirst(s,t,0,!0),n.metricEnd()}},{key:"_placeBack",value:function(e,t,r,n,i){for(var a=e.clone(),s=e.backwardLength+0;a.prev()&&!(s>=n);)this._placeOnSegment(a,t,s,r,-1,i),s+=a.length+0}},{key:"_placeForward",value:function(e,t,r,n,i){for(var a=e.clone(),s=e.remainingLength+0;a.next()&&!(s>=n);)this._placeOnSegment(a,t,s,r,1,i),s+=a.length+0}},{key:"_placeFirst",value:function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=e,o=this._current.inShaping,c=o.glyphs,u=this._current.zoomLevel,l=this._current,h=l.out,f=l.inId,v=Object(a.a)(c);try{for(v.s();!(n=v.n()).done;){var y=n.value,d=y.x>o.bounds.x?r:1-r,b=d*e.remainingLength+(1-d)*e.backwardLength,p=Math.abs(y.x+y.width/2-o.bounds.x),x=Math.max(0,u+Math.log2(p/(b+0))),_=Math.max(t,i?0:x);if(y.maxZoom=25,y.angle=e.angle+(1-r)*Math.PI,y.minZoom=_,this._writeGlyph(h,f,s.x,s.y,y),r&&this._isVisible(y.minZoom,y.maxZoom)){var m=y.bounds;h.metricBoxWrite(m.center[0],m.center[1],m.width,m.height)}}}catch(g){v.e(g)}finally{v.f()}}},{key:"_placeOnSegment",value:function(e,t,r,n,i,s){var o,c=this._current.inShaping.glyphs,u=this._current,l=u.out,h=u.inId,f=this._current.inShaping,v=this._current.zoomLevel,y=e.dx/e.length,d=e.dy/e.length,b={x:e.x+r*-i*y,y:e.y+r*-i*d},p=Object(a.a)(c);try{for(p.s();!(o=p.n()).done;){var x=o.value,_=x.x>f.bounds.x?s:1-s;if(_&&1===i||!_&&-1===i){var m=Math.abs(x.x+x.width/2-f.bounds.x),g=Math.max(0,v+Math.log2(m/r)-.1),O=Math.max(n,v+Math.log2(m/(r+e.length+0)));if(0!==g&&(x.angle=e.angle+(1-s)*Math.PI,x.minZoom=O,x.maxZoom=g,this._writeGlyph(l,h,b.x,b.y,x),s&&this._isVisible(x.minZoom,x.maxZoom))){var j=x.bounds,k=e.x-t.x,M=e.y-t.y;l.metricBoxWrite(j.center[0]+k,j.center[1]+M,j.width,j.height)}}}}catch(w){p.e(w)}finally{p.f()}}},{key:"_writeGlyphs",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._minZoom;if(!(r.x<0||r.x>=512||r.y<0||r.y>=512)){if(n.glyphs.length>0&&(this._borderLineColor||this._backgroundColor)){var s=w.b.load(this._materialKey);s.textureBinding=n.glyphs[0].textureBinding,e.recordStart(t,s.data,this.geometryType,!0),this._writeBackgroundGeometry(e,t,r,n.bounds,n.background),e.recordEnd()}var o,c=r.x+this._refOffsetX,u=r.y-this._refOffsetY,l=Object(a.a)(n.glyphs);try{for(l.s();!(o=l.n()).done;){var h=o.value;h.minZoom=i,h.maxZoom=this._maxZoom,this._writeGlyph(e,t,c,u,h)}}catch(d){l.e(d)}finally{l.f()}var f=this._refPlacementDirX,v=this._refPlacementDirY,y=n.boundsT;e.metricStart(t,i,c,u,f,v,this._referenceSize,this._materialKey),e.metricBoxWrite(y.center[0],y.center[1],y.width,y.height),e.metricEnd()}}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(M.b)(0,0,this._size,this._haloSize),o=Math.max(n.minZoom,this._minZoom),c=Math.min(n.maxZoom,this._maxZoom),u=Object(M.b)(R(o),R(c),this._outLineLabelAngle,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(i),e.vertexWrite(a),e.vertexWrite(s),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(u)}},{key:"_writeBackgroundVertex",value:function(e,t,r,n,i,a){var s=Object(M.b)(0,0,this._size,this._haloSize),o=Object(M.b)(0,0,0,0),c=Object(M.b)(R(this._minBackgroundZoom),R(this._maxBackgroundZoom),this._outLineLabelAngle,1);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(o),e.vertexWrite(s),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(c),e.vertexWrite(i),e.vertexWrite(a),e.vertexEnd()}}],[{key:"fromLabelClass",value:function(e,t){if("esriServerLinePlacementCenterAlong"===e.labelPlacement){var n=e.symbol;n.xoffset=0,n.yoffset=0,n.angle=0,n.font.decoration="none"}return new r(e.materialKey,e,e.symbol,t)}}]),r}(E.a),D=r(319),Z=r(321),N=function(){function e(t,r,n){Object(s.a)(this,e),this._loadPromise=Object(u.a)(),this._geometryType=t,this._idField=r,this._templateStore=n}return Object(o.a)(e,[{key:"update",value:function(e,t){null!=e.mesh.labels&&(this._labelTemplates=this._createLabelTemplates(e.mesh.labels,t)),this._schema=e}},{key:"_createLabelTemplates",value:function(e,t){var r=new Map;if("simple"===e.type){var n,i=Object(a.a)(e.classes);try{for(i.s();!(n=i.n()).done;){var s=n.value,o=B.fromLabelClass(s,t);r.set(s.index,o)}}catch(y){i.e(y)}finally{i.f()}return r}for(var c in e.classes){var u,l=e.classes[c],h=Object(a.a)(l);try{for(h.s();!(u=h.n()).done;){var f=u.value,v=B.fromLabelClass(f,t);r.set(f.index,v)}}catch(y){h.e(y)}finally{h.f()}}return r}},{key:"templates",get:function(){return this._templateStore}},{key:"analyze",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,i,s,o,u,h){var f,v,y,d,b,p,x;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(c.i)(h)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="dictionary"===(null===i||void 0===i?void 0:i.type),!e.t0){e.next=7;break}return e.next=6,i.analyze(this._idField,t.copy(),r,o,u,h);case 6:f=e.sent;case 7:for(v=0;t.next();)if(null,y=f?f[v++]:null!=s&&Object(l.h)(t.getDisplayId())&&1!==t.readAttribute("cluster_count")?s.match(this._idField,t,this._geometryType,o,u):i.match(this._idField,t,this._geometryType,o,u),t.setGroupId(y),Object(Z.b)(y)){d=this._templateStore.getDynamicTemplateGroup(y).templates,b=Object(a.a)(d);try{for(b.s();!(p=b.n()).done;)(x=p.value)&&x.analyze&&x.analyze(this._templateStore,t,o,u)}catch(n){b.e(n)}finally{b.f()}}return e.next=11,this._loadPromise;case 11:return e.abrupt("return",this._templateStore.finalize(h));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s,o){return e.apply(this,arguments)}}()},{key:"analyzeGraphics",value:function(){var e=Object(i.a)(Object(n.a)().mark((function e(t,r,i,s,o,u){var l,h,f,v,y,d;return Object(n.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(c.i)(u)){e.next=2;break}return e.abrupt("return");case 2:if(l=t.getCursor(),e.t0=i,!e.t0){e.next=7;break}return e.next=7,i.analyze(this._idField,l.copy(),r,s,o,u);case 7:if(!l.next()){e.next=13;break}if(null!=(h=l.getGroupId())&&-1!==h||(h=null===i||void 0===i?void 0:i.match(this._idField,l,l.geometryType,s,o),l.setGroupId(h)),Object(Z.b)(h)){f=this._templateStore.getDynamicTemplateGroup(h).templates,v=Object(a.a)(f);try{for(v.s();!(y=v.n()).done;)(d=y.value)&&d.analyze&&d.analyze(this._templateStore,l,s,o)}catch(n){v.e(n)}finally{v.f()}}l.setGroupId(h);case 11:e.next=7;break;case 13:return e.next=15,this._loadPromise;case 15:return e.abrupt("return",this._templateStore.finalize(u));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()},{key:"writeGraphic",value:function(e,t,r,n){var i=t.getGroupId(),s=t.getDisplayId(),o=this._templateStore.getTemplateGroup(i);if(e.featureStart(t.insertAfter,0),null!=s){if(Object(Z.b)(i)){var c,u=Object(a.a)(o.templates);try{for(u.s();!(c=u.n()).done;){var l=c.value;l&&l.bindFeature(t,null,null)}}catch(y){u.e(y)}finally{u.f()}}if(o){var h,f=Object(a.a)(o.templates);try{for(f.s();!(h=f.n()).done;){var v=h.value;v&&v.write(e,t,r,n)}}catch(y){f.e(y)}finally{f.f()}e.featureEnd()}}}},{key:"writeCursor",value:function(e,t,r,n,i,s,o){var c=t.getGroupId(),u=t.getDisplayId(),l=this._templateStore.getTemplateGroup(c),h=l.templates,f=this._getSortKeyValue(t,l);if(e.featureStart(0,f),null!=u&&h){if(Object(Z.b)(c)){var v,y=Object(a.a)(h);try{for(y.s();!(v=y.n()).done;){v.value.bindFeature(t,r,n)}}catch(x){y.e(x)}finally{y.f()}}var d,b=Object(a.a)(h);try{for(b.s();!(d=b.n()).done;){d.value.write(e,t,i,o)}}catch(x){b.e(x)}finally{b.f()}if(null!=s&&e.hasRecords){var p=s&&this._findLabelRef(h);this._writeLabels(e,t,s,p,i,o)}e.featureEnd()}}},{key:"_getSortKeyValue",value:function(e,t){var r=this._schema.mesh.sortKey;if(null==r)return 0;var n=0;return n=!0===r.byRenderer&&null!=t.sortKey?t.sortKey:null!=r.fieldIndex?e.getComputedNumericAtIndex(r.fieldIndex):null!=r.field?e.readAttribute(r.field):e.readAttribute(this._idField),null==(n*="asc"===r.order?1:-1)||isNaN(n)?0:n}},{key:"_findLabelRef",value:function(e){var t,r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n instanceof D.a)return n}}catch(i){r.e(i)}finally{r.f()}return null}},{key:"_writeLabels",value:function(e,t,r,n,i,s){var o,c=Object(a.a)(r);try{for(c.s();!(o=c.n()).done;){var u=o.value;if(null!=u&&u){var l=u.glyphs,h=u.rtl,f=u.index,v=this._labelTemplates.get(f);if(!v)continue;v.setZoomLevel(i),v.bindReferenceTemplate(n),v.bindTextInfo(l,h),v.write(e,t,null,s)}}}catch(y){c.e(y)}finally{c.f()}}}]),e}()}}]);
//# sourceMappingURL=169.94671120.chunk.js.map