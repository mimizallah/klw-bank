(this["webpackJsonpklw-bank"]=this["webpackJsonpklw-bank"]||[]).push([[29],{2265:function(e,t,n){"use strict";n.r(t),n.d(t,"ElevationQuery",(function(){return M})),n.d(t,"GeometryDescriptor",(function(){return z})),n.d(t,"getFinestLodIndex",(function(){return P}));var a=n(90),r=n(91),i=n(92),l=n(4),o=n(1),s=n(12),c=n(89),u=n(88),f=n(339),p=n(101),h=n(111),v=n(110),m=n(194),y=n(363),d=n(135),b=n(192),x=n(206),O=n(139),j=(n(119),n(93),n(102)),k=n(233),w=j.a.getLogger("esri.layers.support.ElevationSampler"),T=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"queryElevation",value:function(e){return function(e,t){var n=R(e,t.spatialReference);if(!n)return null;switch(e.type){case"point":!function(e,t,n){e.z=n.elevationAt(t.x,t.y)}(e,n,t);break;case"polyline":!function(e,t,n){E.spatialReference=t.spatialReference;for(var a=e.hasM&&!e.hasZ,r=0;r<e.paths.length;r++)for(var i=e.paths[r],l=t.paths[r],o=0;o<i.length;o++){var s=i[o],c=l[o];E.x=c[0],E.y=c[1],a&&(s[3]=s[2]),s[2]=n.elevationAt(E.x,E.y)}e.hasZ=!0}(e,n,t);break;case"multipoint":!function(e,t,n){E.spatialReference=t.spatialReference;for(var a=e.hasM&&!e.hasZ,r=0;r<e.points.length;r++){var i=e.points[r],l=t.points[r];E.x=l[0],E.y=l[1],a&&(i[3]=i[2]),i[2]=n.elevationAt(E.x,E.y)}e.hasZ=!0}(e,n,t)}return e}(e.clone(),this)}},{key:"on",value:function(){return A}},{key:"projectIfRequired",value:function(e,t){return R(e,t)}}]),e}(),g=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e,a,r){var i;Object(c.a)(this,n),(i=t.call(this)).tile=e,i.noDataValue=r;var l=e.tile.extent;i.extent=Object(O.s)(l,a.spatialReference),i.extent.zmin=e.zmin,i.extent.zmax=e.zmax,i._aaExtent=l;var o=Object(m.e)(a.spatialReference),s=a.lodAt(e.tile.level).resolution*o;return i.demResolution={min:s,max:s},i}return Object(u.a)(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"contains",value:function(e){var t=this.projectIfRequired(e,this.spatialReference);return null!=t&&this.containsAt(t.x,t.y)}},{key:"containsAt",value:function(e,t){return Object(O.f)(this._aaExtent,e,t)}},{key:"elevationAt",value:function(e,t){var n;if(!this.containsAt(e,t)){var a=this.extent,r="".concat(a.xmin,", ").concat(a.ymin,", ").concat(a.xmax,", ").concat(a.ymax);return w.warn("#elevationAt()","Point used to sample elevation (".concat(e,", ").concat(t,") is outside of the sampler extent (").concat(r,")")),this.noDataValue}return null!==(n=this.tile.sample(e,t))&&void 0!==n?n:this.noDataValue}}]),n}(T),_=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e,a,r){var i,l;Object(c.a)(this,n),i=t.call(this),"number"==typeof a?(i.noDataValue=a,l=null):(l=a,i.noDataValue=r),i.samplers=l?e.map((function(e){return new g(e,l,i.noDataValue)})):e;var o=i.samplers[0];if(o){i.extent=o.extent.clone();var s=o.demResolution,u=s.min,f=s.max;i.demResolution={min:u,max:f};for(var p=1;p<i.samplers.length;p++){var h=i.samplers[p];i.extent.union(h.extent),i.demResolution.min=Math.min(i.demResolution.min,h.demResolution.min),i.demResolution.max=Math.max(i.demResolution.max,h.demResolution.max)}}else i.extent=Object(O.s)(Object(O.h)(),l.spatialReference),i.demResolution={min:0,max:0};return i}return Object(u.a)(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"elevationAt",value:function(e,t){var n,a=Object(i.a)(this.samplers);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(r.containsAt(e,t))return r.elevationAt(e,t)}}catch(l){a.e(l)}finally{a.f()}return w.warn("#elevationAt()","Point used to sample elevation (".concat(e,", ").concat(t,") is outside of the sampler")),this.noDataValue}}]),n}(T);function R(e,t){if(null==e)return null;var n=e.spatialReference;if(n.equals(t))return e;var a=Object(k.d)(e,t);return a||w.error("Cannot project geometry spatial reference (wkid:".concat(n.wkid,") to elevation sampler spatial reference (wkid:").concat(t.wkid,")")),a}var E=new d.a,A={remove:function(){}},q=Object(u.a)((function e(t,n){Object(c.a)(this,e),this.data=t,this.safeWidth=.99999999*(t.width-1),this.dx=(t.width-1)/(n[2]-n[0]),this.dy=(t.width-1)/(n[3]-n[1]),this.x0=n[0],this.y1=n[3]})),D=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(Object(c.a)(this,e),this.tile=t,null!=n&&null!=t){var a=t.extent;this._samplerData=new q(n,a)}}return Object(u.a)(e,[{key:"zmin",get:function(){return null!=this._samplerData?this._samplerData.data.minValue:0}},{key:"zmax",get:function(){return null!=this._samplerData?this._samplerData.data.maxValue:0}},{key:"sample",value:function(e,t){if(null!=this._samplerData){var n=this._samplerData,a=n.safeWidth,r=n.data,i=n.dx,l=n.dy,o=n.y1,s=n.x0,c=r.width,u=r.values,f=r.noDataValue,p=I(l*(o-t),0,a),h=I(i*(e-s),0,a),v=Math.floor(p),m=Math.floor(h),y=v*c+m,d=y+c,b=u[y],x=u[d],O=u[y+1],j=u[d+1];if(b!==f&&x!==f&&O!==f&&j!==f){var k=h-m,w=b+(O-b)*k;return w+(x+(j-x)*k-w)*(p-v)}}}}]),e}();function I(e,t,n){return e<t?t:e>n?n:e}var C=n(630),M=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"queryAll",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a){var r,i,s,c,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=a&&a.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:return r=z.fromGeometry(n),i=!1,a&&a.returnSampleInfo||(i=!0),s=Object(o.a)(Object(o.a)(Object(o.a)({},Z),a),{},{returnSampleInfo:!0}),e.next=8,this.query(t[t.length-1],r,s);case 8:return c=e.sent,e.next=11,this._queryAllContinue(t,c,s);case 11:return u=e.sent,e.abrupt("return",(u.geometry=u.geometry.export(),i&&delete u.sampleInfo,u));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a){var r,i,s;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&(n instanceof z||"point"===n.type||"multipoint"===n.type||"polyline"===n.type)){e.next=4;break}throw new p.a("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");case 4:return r=Object(o.a)(Object(o.a)({},Z),a),i=new V(t,n.spatialReference,r),s=r.signal,e.next=7,t.load({signal:s});case 7:return e.next=9,this._createGeometryDescriptor(i,n,s);case 9:return e.next=11,this._selectTiles(i,s);case 11:return e.next=13,this._populateElevationTiles(i,s);case 13:return this._sampleGeometryWithElevation(i),e.abrupt("return",this._createQueryResult(i,s));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"createSampler",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new p.a("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return r=Object(o.a)(Object(o.a)({},Z),a),e.abrupt("return",this._createSampler(t,n,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"createSamplerAll",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a){var r,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=a&&a.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new p.a("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return r=Object(o.a)(Object(o.a)(Object(o.a)({},Z),a),{},{returnSampleInfo:!0}),e.next=7,this._createSampler(t[t.length-1],n,r);case 7:return i=e.sent,e.abrupt("return",this._createSamplerAllContinue(t,n,i,r));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_createSampler",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a,r){var i,o,s,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.signal,e.next=3,t.load({signal:i});case 3:if(o=n.spatialReference,s=t.tileInfo.spatialReference,e.t0=o.equals(s),e.t0){e.next=9;break}return e.next=8,Object(x.initializeProjection)([{source:o,dest:s}],{signal:i});case 8:n=Object(x.project)(n,s);case 9:return c=new L(t,n,a,r),e.next=12,this._selectTiles(c,i);case 12:return e.next=14,this._populateElevationTiles(c,i);case 14:return e.abrupt("return",new _(c.elevationTiles,c.layer.tileInfo,c.options.noDataValue));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"_createSamplerAllContinue",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a,r){var i,o,s,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pop(),t.length){e.next=2;break}return e.abrupt("return",a);case 2:return i=a.samplers.map((function(e){return Object(O.n)(e.extent)})),e.next=5,this._createSampler(t[t.length-1],n,r,i);case 5:if(0!==(o=e.sent).samplers.length){e.next=8;break}return e.abrupt("return",a);case 8:return s=a.samplers.concat(o.samplers),c=new _(s,r.noDataValue),e.abrupt("return",this._createSamplerAllContinue(t,n,c,r));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"_queryAllContinue",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a){var r,i,o,s,c,u,f,p,v,m;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.pop(),i=n.geometry.coordinates,o=n.sampleInfo,Object(h.c)(o),s=[],c=[],u=0;u<i.length;u++)(f=o[u]).demResolution>=0?f.source||(f.source=r):t.length&&(s.push(i[u]),c.push(u));if(t.length&&0!==s.length){e.next=6;break}return e.abrupt("return",n);case 6:return p=n.geometry.clone(s),e.next=9,this.query(t[t.length-1],p,a);case 9:if(v=e.sent,m=v.sampleInfo){e.next=13;break}throw new Error("no sampleInfo");case 13:return e.abrupt("return",(c.forEach((function(e,t){i[e].z=v.geometry.coordinates[t].z,o[e].demResolution=m[t].demResolution})),this._queryAllContinue(t,n,a)));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_createQueryResult",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n){var a,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.geometry.project(t.outSpatialReference,n);case 2:return a=e.sent,Object(h.c)(a),r={geometry:a.export(),noDataValue:t.options.noDataValue},e.abrupt("return",(t.options.returnSampleInfo&&(r.sampleInfo=this._extractSampleInfo(t)),t.geometry.coordinates.forEach((function(e){e.tile=null,e.elevationTile=null})),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_createGeometryDescriptor",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a){var r,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.layer.tileInfo.spatialReference,!(n instanceof z)){e.next=7;break}return e.next=4,n.project(i,a);case 4:r=e.sent,e.next=10;break;case 7:return e.next=9,Object(x.initializeProjection)([{source:n.spatialReference,dest:i}],{signal:a});case 9:r=Object(x.project)(n,i);case 10:if(r){e.next=12;break}throw new p.a("elevation-query:spatial-reference-mismatch","Cannot query elevation in '".concat(n.spatialReference.wkid,"' on an elevation service in '").concat(i.wkid,"'"));case 12:t.geometry=z.fromGeometry(r);case 13:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_selectTiles",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n){var a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("geometry"===t.type&&this._preselectOutsideLayerExtent(t),"number"!=typeof(a=t.options.demResolution)){e.next=6;break}this._selectTilesClosestResolution(t,a),e.next=15;break;case 6:if("finest-contiguous"!==a){e.next=11;break}return e.next=9,this._selectTilesFinestContiguous(t,n);case 9:e.next=15;break;case 11:if("auto"===a){e.next=13;break}throw new p.a("elevation-query:invalid-dem-resolution","Invalid dem resolution value '".concat(a,'\', expected a number, "finest-contiguous" or "auto"'));case 13:return e.next=15,this._selectTilesAuto(t,n);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_preselectOutsideLayerExtent",value:function(e){if(null!=e.layer.fullExtent){var t=new D(null);t.sample=function(){return e.options.noDataValue},e.outsideExtentTile=t;var n=e.layer.fullExtent;e.geometry.coordinates.forEach((function(e){var a=e.x,r=e.y;(a<n.xmin||a>n.xmax||r<n.ymin||r>n.ymax)&&(e.elevationTile=t)}))}}},{key:"_selectTilesClosestResolution",value:function(e,t){var n=this._findNearestDemResolutionLODIndex(e,t);e.selectTilesAtLOD(n)}},{key:"_findNearestDemResolutionLODIndex",value:function(e,t){for(var n=e.layer,a=n.tileInfo,r=n.tilemapCache,i=t/Object(m.e)(a.spatialReference),l=G(a,r),o=l[0],s=0,c=1;c<l.length;c++){var u=l[c];Math.abs(u.resolution-i)<Math.abs(o.resolution-i)&&(o=u,s=c)}return s}},{key:"_selectTilesFinestContiguous",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n){var a,r,i,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.layer,r=a.tileInfo,i=a.tilemapCache,o=P(r,i,t.options.minDemResolution),e.next=3,this._selectTilesFinestContiguousAt(t,o,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_selectTilesFinestContiguousAt",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n,a){var r,i,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.layer,t.selectTilesAtLOD(n),!(n<0)){e.next=3;break}return e.abrupt("return");case 3:if(i=r.tilemapCache,o=t.getTilesToFetch(),e.prev=4,!i||N(i)){e.next=10;break}return e.next=8,Object(v.r)(Promise.all(o.map((function(e){return i.fetchAvailability(e.level,e.row,e.col,{signal:a})}))),a);case 8:e.next=14;break;case 10:return e.next=12,this._populateElevationTiles(t,a);case 12:if(t.allElevationTilesFetched()){e.next=14;break}throw t.clearElevationTiles(),new p.a("elevation-query:has-unavailable-tiles");case 14:e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(4),Object(v.m)(e.t0),e.next=21,this._selectTilesFinestContiguousAt(t,n-1,a);case 21:case"end":return e.stop()}}),e,this,[[4,16]])})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_populateElevationTiles",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n){var a,r,i,o,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.getTilesToFetch(),r={},i=t.options.cache,o=t.options.noDataValue,c=a.map(function(){var e=Object(s.a)(Object(l.a)().mark((function e(a){var s,c,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a.id){e.next=2;break}return e.abrupt("return");case 2:if(s="".concat(t.layer.uid,":").concat(a.id,":").concat(o),null==(c=null!=i?i.get(s):null)){e.next=8;break}e.t0=c,e.next=11;break;case 8:return e.next=10,t.layer.fetchTile(a.level,a.row,a.col,{noDataValue:o,signal:n});case 10:e.t0=e.sent;case 11:u=e.t0,null!=i&&i.put(s,u),r[a.id]=new D(a,u);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Object(v.r)(Object(v.e)(c),n);case 3:t.populateElevationTiles(r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_selectTilesAuto",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n){var a,r,i,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._selectTilesAutoFinest(t),this._reduceTilesForMaximumRequests(t),(a=t.layer.tilemapCache)&&!N(a)){e.next=4;break}return e.abrupt("return",this._selectTilesAutoPrefetchUpsample(t,n));case 4:return r=t.getTilesToFetch(),i={},o=r.map(function(){var e=Object(s.a)(Object(l.a)().mark((function e(t){var r,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new C.a(null,0,0,0,Object(O.h)()),e.next=3,Object(f.d)(a.fetchAvailabilityUpsample(t.level,t.row,t.col,r,{signal:n}));case 3:!1!==(o=e.sent).ok?null!=t.id&&(i[t.id]=r):Object(v.m)(o.error);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,Object(v.r)(Promise.all(o),n);case 7:t.remapTiles(i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_reduceTilesForMaximumRequests",value:function(e){var t=e.layer.tileInfo,n=0,a={},r=function(e){null!=e.id&&(e.id in a?a[e.id]++:(a[e.id]=1,n++))},i=function(e){if(null!=e.id){var t=a[e.id];1===t?(delete a[e.id],n--):a[e.id]=t-1}};e.forEachTileToFetch(r,i);for(var l=!0;l&&(l=!1,e.forEachTileToFetch((function(a){n<=e.options.maximumAutoTileRequests||(i(a),t.upsampleTile(a)&&(l=!0),r(a))}),i),l););}},{key:"_selectTilesAutoFinest",value:function(e){var t=e.layer,n=P(t.tileInfo,t.tilemapCache,e.options.minDemResolution);e.selectTilesAtLOD(n,e.options.maximumAutoTileRequests)}},{key:"_selectTilesAutoPrefetchUpsample",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n){var a,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.layer.tileInfo,e.next=3,this._populateElevationTiles(t,n);case 3:if(r=!1,t.forEachTileToFetch((function(e,t){a.upsampleTile(e)?r=!0:t()})),e.t0=r,!e.t0){e.next=9;break}return e.next=9,this._selectTilesAutoPrefetchUpsample(t,n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_sampleGeometryWithElevation",value:function(e){e.geometry.coordinates.forEach((function(t){var n=t.elevationTile,a=e.options.noDataValue;if(n){var r=n.sample(t.x,t.y);null!=r?a=r:t.elevationTile=null}t.z=a}))}},{key:"_extractSampleInfo",value:function(e){var t=e.layer.tileInfo,n=Object(m.e)(t.spatialReference);return e.geometry.coordinates.map((function(a){var r=-1;return a.elevationTile&&a.elevationTile!==e.outsideExtentTile&&(r=t.lodAt(a.elevationTile.tile.level).resolution*n),{demResolution:r}}))}}]),e}(),z=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"export",value:function(){return this._exporter(this.coordinates,this.spatialReference)}},{key:"clone",value:function(t){var n=new e;return n.geometry=this.geometry,n.spatialReference=this.spatialReference,n.coordinates=t||this.coordinates.map((function(e){return e.clone()})),n._exporter=this._exporter,n}},{key:"project",value:function(){var e=Object(s.a)(Object(l.a)().mark((function e(t,n){var a,r,i,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.spatialReference.equals(t)){e.next=2;break}return e.abrupt("return",this.clone());case 2:return e.next=4,Object(x.initializeProjection)([{source:this.spatialReference,dest:t}],{signal:n});case 4:if(a=new y.a({spatialReference:this.spatialReference,points:this.coordinates.map((function(e){return[e.x,e.y]}))}),r=Object(x.project)(a,t)){e.next=7;break}return e.abrupt("return",null);case 7:return i=this.coordinates.map((function(e,t){var n=e.clone(),a=r.points[t];return n.x=a[0],n.y=a[1],n})),o=this.clone(i),e.abrupt("return",(o.spatialReference=t,o));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"fromGeometry",value:function(t){var n=new e;if(n.geometry=t,n.spatialReference=t.spatialReference,t instanceof e)n.coordinates=t.coordinates.map((function(e){return e.clone()})),n._exporter=function(e,n){var a=t.clone(e);return a.spatialReference=n,a};else switch(t.type){case"point":var a=t,r=a.hasZ,l=a.hasM;n.coordinates=r&&l?[new F(a.x,a.y,a.z,a.m)]:r?[new F(a.x,a.y,a.z)]:l?[new F(a.x,a.y,null,a.m)]:[new F(a.x,a.y)],n._exporter=function(e,n){return t.hasM?new d.a(e[0].x,e[0].y,e[0].z,e[0].m,n):new d.a(e[0].x,e[0].y,e[0].z,n)};break;case"multipoint":var o=t,s=o.hasZ,c=o.hasM;n.coordinates=s&&c?o.points.map((function(e){return new F(e[0],e[1],e[2],e[3])})):s?o.points.map((function(e){return new F(e[0],e[1],e[2])})):c?o.points.map((function(e){return new F(e[0],e[1],null,e[2])})):o.points.map((function(e){return new F(e[0],e[1])})),n._exporter=function(e,n){return t.hasM?new y.a({points:e.map((function(e){return[e.x,e.y,e.z,e.m]})),hasZ:!0,hasM:!0,spatiaReference:n}):new y.a(e.map((function(e){return[e.x,e.y,e.z]})),n)};break;case"polyline":var u,f=t,p=[],h=[],v=t.hasZ,m=t.hasM,x=0,O=Object(i.a)(f.paths);try{for(O.s();!(u=O.n()).done;){var j=u.value;if(h.push([x,x+j.length]),x+=j.length,v&&m){var k,w=Object(i.a)(j);try{for(w.s();!(k=w.n()).done;){var T=k.value;p.push(new F(T[0],T[1],T[2],T[3]))}}catch(M){w.e(M)}finally{w.f()}}else if(v){var g,_=Object(i.a)(j);try{for(_.s();!(g=_.n()).done;){var R=g.value;p.push(new F(R[0],R[1],R[2]))}}catch(M){_.e(M)}finally{_.f()}}else if(m){var E,A=Object(i.a)(j);try{for(A.s();!(E=A.n()).done;){var q=E.value;p.push(new F(q[0],q[1],null,q[2]))}}catch(M){A.e(M)}finally{A.f()}}else{var D,I=Object(i.a)(j);try{for(I.s();!(D=I.n()).done;){var C=D.value;p.push(new F(C[0],C[1]))}}catch(M){I.e(M)}finally{I.f()}}}}catch(M){O.e(M)}finally{O.f()}n.coordinates=p,n._exporter=function(e,n){var a=t.hasM?e.map((function(e){return[e.x,e.y,e.z,e.m]})):e.map((function(e){return[e.x,e.y,e.z]})),r=h.map((function(e){return a.slice(e[0],e[1])}));return new b.a({paths:r,hasM:t.hasM,hasZ:!0,spatialReference:n})}}return n}}]),e}(),F=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;Object(c.a)(this,e),this.x=t,this.y=n,this.z=a,this.m=r,this.tile=i,this.elevationTile=l}return Object(u.a)(e,[{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.m)}}]),e}(),S=Object(u.a)((function e(t,n){Object(c.a)(this,e),this.layer=t,this.options=n})),V=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e,a,r){var i;return Object(c.a)(this,n),(i=t.call(this,e,r)).outSpatialReference=a,i.type="geometry",i}return Object(u.a)(n,[{key:"selectTilesAtLOD",value:function(e){if(e<0)this.geometry.coordinates.forEach((function(e){return e.tile=null}));else{var t=this.layer,n=t.tileInfo,a=t.tilemapCache,r=G(n,a)[e].level;this.geometry.coordinates.forEach((function(e){return e.tile=n.tileAt(r,e.x,e.y)}))}}},{key:"allElevationTilesFetched",value:function(){return!this.geometry.coordinates.some((function(e){return!e.elevationTile}))}},{key:"clearElevationTiles",value:function(){var e,t=Object(i.a)(this.geometry.coordinates);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.elevationTile!==this.outsideExtentTile&&(n.elevationTile=null)}}catch(a){t.e(a)}finally{t.f()}}},{key:"populateElevationTiles",value:function(e){var t,n=Object(i.a)(this.geometry.coordinates);try{for(n.s();!(t=n.n()).done;){var a,r=t.value;!r.elevationTile&&(null===(a=r.tile)||void 0===a?void 0:a.id)&&(r.elevationTile=e[r.tile.id])}}catch(l){n.e(l)}finally{n.f()}}},{key:"remapTiles",value:function(e){var t,n=Object(i.a)(this.geometry.coordinates);try{for(n.s();!(t=n.n()).done;){var a,r=t.value,l=null===(a=r.tile)||void 0===a?void 0:a.id;r.tile=l?e[l]:null}}catch(o){n.e(o)}finally{n.f()}}},{key:"getTilesToFetch",value:function(){var e,t={},n=[],a=Object(i.a)(this.geometry.coordinates);try{for(a.s();!(e=a.n()).done;){var r,l=e.value,o=l.tile;if(o){var s=null===(r=l.tile)||void 0===r?void 0:r.id;l.elevationTile||!s||t[s]||(t[s]=o,n.push(o))}}}catch(c){a.e(c)}finally{a.f()}return n}},{key:"forEachTileToFetch",value:function(e){var t,n=Object(i.a)(this.geometry.coordinates);try{var a=function(){var n=t.value;n.tile&&!n.elevationTile&&e(n.tile,(function(){n.tile=null}))};for(n.s();!(t=n.n()).done;)a()}catch(r){n.e(r)}finally{n.f()}}}]),n}(S),L=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e,a,r,i){var l;return Object(c.a)(this,n),(l=t.call(this,e,r)).type="extent",l.elevationTiles=[],l._candidateTiles=[],l._fetchedCandidates=new Set,l.extent=a.intersection(e.fullExtent),l.maskExtents=i,l}return Object(u.a)(n,[{key:"selectTilesAtLOD",value:function(e,t){var n=this._maximumLodForRequests(t),a=Math.min(n,e);a<0?this._candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(a)}},{key:"_maximumLodForRequests",value:function(e){var t=this.layer,n=t.tileInfo,a=G(n,t.tilemapCache);if(!e)return a.length-1;var r=this.extent;if(null==r)return-1;for(var i=a.length-1;i>=0;i--){var l=a[i],o=l.resolution*n.size[0],s=l.resolution*n.size[1];if(Math.ceil(r.width/o)*Math.ceil(r.height/s)<=e)return i}return-1}},{key:"allElevationTilesFetched",value:function(){return this._candidateTiles.length===this.elevationTiles.length}},{key:"clearElevationTiles",value:function(){this.elevationTiles.length=0,this._fetchedCandidates.clear()}},{key:"populateElevationTiles",value:function(e){var t,n=Object(i.a)(this._candidateTiles);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=a.id&&e[a.id];r&&(this._fetchedCandidates.add(a),this.elevationTiles.push(r))}}catch(l){n.e(l)}finally{n.f()}}},{key:"remapTiles",value:function(e){this._candidateTiles=this._uniqueNonOverlappingTiles(this._candidateTiles.map((function(t){return e[t.id]})))}},{key:"getTilesToFetch",value:function(){return this._candidateTiles}},{key:"forEachTileToFetch",value:function(e,t){var n=this,a=this._candidateTiles;this._candidateTiles=[],a.forEach((function(a){if(n._fetchedCandidates.has(a))t&&t(a);else{var r=!1;e(a,(function(){return r=!0})),r?t&&t(a):n._candidateTiles.push(a)}})),this._candidateTiles=this._uniqueNonOverlappingTiles(this._candidateTiles,t)}},{key:"_uniqueNonOverlappingTiles",value:function(e,t){var n,a={},r=[],l=Object(i.a)(e);try{for(l.s();!(n=l.n()).done;){var o=n.value,s=o.id;s&&!a[s]?(a[s]=o,r.push(o)):t&&t(o)}}catch(u){l.e(u)}finally{l.f()}var c=r.sort((function(e,t){return e.level-t.level}));return c.filter((function(e,n){for(var a=0;a<n;a++){var r=c[a].extent;if(r&&e.extent&&Object(O.d)(r,e.extent))return t&&t(e),!1}return!0}))}},{key:"_selectCandidateTilesCoveringExtentAt",value:function(e){this._candidateTiles.length=0;var t=this.extent;if(null!=t){var n=this.layer,a=n.tileInfo,r=G(a,n.tilemapCache)[e],i=a.tileAt(r.level,t.xmin,t.ymin),l=i.extent;if(null!=l)for(var o=r.resolution*a.size[0],s=r.resolution*a.size[1],c=Math.ceil((t.xmax-l[0])/o),u=Math.ceil((t.ymax-l[1])/s),f=0;f<u;f++)for(var p=0;p<c;p++){var h=new C.a(null,i.level,i.row-f,i.col+p);a.updateTileInfo(h),this._tileIsMasked(h)||this._candidateTiles.push(h)}}}},{key:"_tileIsMasked",value:function(e){return!!this.maskExtents&&this.maskExtents.some((function(t){return e.extent&&Object(O.d)(t,e.extent)}))}}]),n}(S);function P(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=G(e,t),r=a.length-1;if(n>0){var i=n/Object(m.e)(e.spatialReference),l=a.findIndex((function(e){return e.resolution<i}));0===l?r=0:l>0&&(r=l-1)}return r}var Z={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0};function G(e,t){var n=e.lods;if(N(t)){var a=t.effectiveMinLOD,r=t.effectiveMaxLOD;return n.filter((function(e){return e.level>=a&&e.level<=r}))}return n}function N(e){return null!=(null===e||void 0===e?void 0:e.tileInfo)}}}]);
//# sourceMappingURL=29.4f41b88e.chunk.js.map