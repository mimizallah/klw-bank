{"version":3,"sources":["../node_modules/@arcgis/core/layers/support/ExportImageParameters.js","../node_modules/@arcgis/core/layers/MapImageLayer.js","../node_modules/@arcgis/core/layers/support/floorFilterUtils.js"],"names":["y","visible","definitionExpression","labelingInfo","labelsVisible","opacity","minScale","maxScale","renderer","source","m","_s","_inherits","_super","_createSuper","e","_this","_classCallCheck","call","floors","scale","_createClass","key","value","this","layer","get","_this2","hasDynamicLayers","visibleSublayers","map","r","l","toExportImageJSON","length","JSON","stringify","n","serviceSublayers","gdbVersion","set","_this3","_get","_set","handles","remove","add","allSublayers","on","notifyChange","propertyName","id","join","_this$floors","_this4","filter","floorInfo","reduce","s","i","t","commitProperty","_this5","sublayers","forEach","o","a","unshift","some","dpi","format","imageFormat","transparent","imageTransparency","dynamicLayers","_objectSpread","layers","layerDefs","readOnly","prototype","type","Number","q","_S","_len","arguments","Array","_key","apply","concat","dateFieldsTimeReference","datesInUnknownTimezone","imageMaxHeight","imageMaxWidth","isReference","operationalLayerType","preferredTimeReference","sourceJSON","url","signal","addResolvingPromise","loadFromPortal","supportedTypes","catch","p","then","_fetchService","Promise","resolve","supportedImageFormatTypes","includes","_this$capabilities$ex","loaded","slice","reverse","flatten","_ref","toArray","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","d","origin","h","PORTAL_ITEM","createSublayersForOrigin","A","SERVICE","writeSublayerStructure","write","push","originOf","Object","keys","visibleLayers","pixelRatio","version","clone","shiftCentralMeridian","R","g","extent","width","toJSON","destroy","rotation","spatialReference","wkid","timeExtent","_i$timeExtent$toJSON","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","_fetchImage2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$this$_fetchIma","wrap","_context","prev","next","_fetchImage","sent","data","abrupt","stop","_x","_x2","_x3","_x4","_fetchImageBitmap","_callee2","_yield$this$_fetchIma2","_context2","U","_x5","_x6","_x7","_x8","_fetchRecomputedExtents","_callee3","_yield$r","_args3","_context3","undefined","query","returnUpdates","f","customParameters","token","apiKey","fullExtent","fromJSON","F","_fetchImage3","_callee4","_a$signal","_p$query","_this$capabilities","_yield$r2","_e5","_context4","responseType","parsedUrl","createExportImageParameters","refreshParameters","path","t0","error","_x9","_x10","_x11","_x12","_x13","_fetchService2","_callee5","_yield$r3","_context5","read","ssl","replace","_x14","S","M","E","L","v","x","I","O","T","j","w","b","J","Boolean","c","json","origins","service","enabled","overridePolicy","ignoreOrigin","N","P","k","u","_n$floorInfo","floorField","view","_n$floorInfo2"],"mappings":"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","file":"static/js/237.a446f5cf.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{sqlAnd as t}from\"../../core/sql.js\";import{property as i}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{getLayerFloorFilterClause as l}from\"./floorFilterUtils.js\";import{isExportDynamic as n}from\"./sublayerUtils.js\";const y={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let m=class extends(s(r)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=l(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&n(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(y[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=!!this.floors?.length,r=this.visibleSublayers.filter((r=>null!=r.definitionExpression||e&&null!=r.floorInfo));return r.length?JSON.stringify(r.reduce(((e,r)=>{const s=l(this.floors,r),i=t(s,r.definitionExpression);return null!=i&&(e[r.id]=i),e}),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,o=0===r.minScale||t<=r.minScale,a=0===r.maxScale||t>=r.maxScale;r.visible&&(i||o&&a)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([i({readOnly:!0})],m.prototype,\"dynamicLayers\",null),e([i()],m.prototype,\"floors\",void 0),e([i({readOnly:!0})],m.prototype,\"hasDynamicLayers\",null),e([i()],m.prototype,\"layer\",null),e([i({readOnly:!0})],m.prototype,\"layers\",null),e([i({readOnly:!0})],m.prototype,\"layerDefs\",null),e([i({type:Number})],m.prototype,\"scale\",void 0),e([i(a)],m.prototype,\"timeExtent\",void 0),e([i({readOnly:!0})],m.prototype,\"version\",null),e([i({readOnly:!0})],m.prototype,\"visibleSublayers\",null),m=e([o(\"esri.layers.mixins.ExportImageParameters\")],m);export{m as ExportImageParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../TimeExtent.js\";import i from\"../core/Error.js\";import{HandleOwnerMixin as o}from\"../core/HandleOwner.js\";import{loadAll as s}from\"../core/loadAll.js\";import{MultiOriginJSONMixin as a}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as p,isAbortError as n}from\"../core/promiseUtils.js\";import{property as m}from\"../core/accessorSupport/decorators/property.js\";import{Integer as l}from\"../core/accessorSupport/ensureType.js\";import\"../core/arrayUtils.js\";import\"../core/has.js\";import{reader as c}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as u}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as y}from\"../core/accessorSupport/decorators/writer.js\";import{nameToId as d,OriginId as h}from\"../core/accessorSupport/PropertyOrigin.js\";import f from\"../geometry/Extent.js\";import{getScale as g}from\"../geometry/support/scaleUtils.js\";import b from\"./Layer.js\";import{APIKeyMixin as j}from\"./mixins/APIKeyMixin.js\";import{ArcGISMapService as v}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as x}from\"./mixins/ArcGISService.js\";import{BlendLayer as S}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as w}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as I}from\"./mixins/OperationalLayer.js\";import{PortalLayer as O}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as T}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as E}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as L}from\"./mixins/SublayersOwner.js\";import{TemporalLayer as M}from\"./mixins/TemporalLayer.js\";import{url as P}from\"./support/commonProperties.js\";import{ExportImageParameters as R}from\"./support/ExportImageParameters.js\";import{createBitmap as U}from\"./support/imageBitmapUtils.js\";import N from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as A}from\"./support/sublayerUtils.js\";import{serviceSupportsSpatialReference as F}from\"./support/versionUtils.js\";import J from\"../time/TimeReference.js\";let q=class extends(S(M(E(L(v(x(I(O(a(T(j(w(o(b)))))))))))))){constructor(...e){super(...e),this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.preferredTimeReference=null,this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(p).then((()=>this._fetchService(r)))),Promise.resolve(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.includes(\"PNG32\")?\"png32\":\"png24\"}writeSublayers(e,r,t,i){if(!this.loaded||!e)return;const o=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let s=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap?.supportsDynamicLayers){const e=d(i.origin);if(e===h.PORTAL_ITEM){const e=this.createSublayersForOrigin(\"service\").sublayers;s=A(o,e,h.SERVICE)}else if(e>h.PORTAL_ITEM){const e=this.createSublayersForOrigin(\"portal-item\");s=A(o,e.sublayers,d(e.origin))}}const a=[],p={writeSublayerStructure:s,...i};let n=s;o.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=o.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,i){const o=i&&i.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const s=new R({layer:this,floors:i?.floors,scale:g({extent:e,width:r})*o}),a=s.toJSON();s.destroy();const p=!i||!i.rotation||this.version<10.3?{}:{rotation:-i.rotation},n=e&&e.spatialReference,m=n.wkid||JSON.stringify(n.toJSON());a.dpi*=o;const l={};if(i?.timeExtent){const{start:e,end:r}=i.timeExtent.toJSON();l.time=e&&r&&e===r?\"\"+e:`${e??\"null\"},${r??\"null\"}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(l.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:m,imageSR:m,size:r+\",\"+t,...a,...p,...l}}async fetchImage(e,r,t,i){const{data:o}=await this._fetchImage(\"image\",e,r,t,i);return o}async fetchImageBitmap(e,r,t,i){const{data:o,url:s}=await this._fetchImage(\"blob\",e,r,t,i);return U(o,s,i?.signal)}async fetchRecomputedExtents(e={}){const i={...e,query:{returnUpdates:!0,f:\"json\",...this.customParameters,token:this.apiKey}},{data:o}=await r(this.url,i),{extent:s,fullExtent:a,timeExtent:p}=o,n=s||a;return{fullExtent:n&&f.fromJSON(n),timeExtent:p&&t.fromJSON({start:p[0],end:p[1]})}}loadAll(){return s(this,(e=>{e(this.allSublayers)}))}serviceSupportsSpatialReference(e){return F(this,e)}async _fetchImage(e,t,o,s,a){const p={responseType:e,signal:a?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(t,o,s,a),f:\"image\",...this.refreshParameters,...this.customParameters,token:this.apiKey}},m=this.parsedUrl.path+\"/export\";if(null!=p.query?.dynamicLayers&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new i(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:p.query});try{const{data:e}=await r(m,p);return{data:e,url:m}}catch(l){if(n(l))throw l;throw new i(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${m}`,{error:l})}}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:t,ssl:i}=await r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});i&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=t,this.read(t,{origin:\"service\",url:this.parsedUrl})}};e([m({type:J})],q.prototype,\"dateFieldsTimeReference\",void 0),e([m({type:Boolean})],q.prototype,\"datesInUnknownTimezone\",void 0),e([m()],q.prototype,\"dpi\",void 0),e([m()],q.prototype,\"gdbVersion\",void 0),e([m()],q.prototype,\"imageFormat\",void 0),e([c(\"imageFormat\",[\"supportedImageFormatTypes\"])],q.prototype,\"readImageFormat\",null),e([m({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],q.prototype,\"imageMaxHeight\",void 0),e([m({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],q.prototype,\"imageMaxWidth\",void 0),e([m()],q.prototype,\"imageTransparency\",void 0),e([m({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],q.prototype,\"isReference\",void 0),e([m({json:{read:!1,write:!1}})],q.prototype,\"labelsVisible\",void 0),e([m({type:[\"ArcGISMapServiceLayer\"]})],q.prototype,\"operationalLayerType\",void 0),e([m({json:{read:!1,write:!1}})],q.prototype,\"popupEnabled\",void 0),e([m({type:J})],q.prototype,\"preferredTimeReference\",void 0),e([m()],q.prototype,\"sourceJSON\",void 0),e([m({json:{write:{ignoreOrigin:!0}}})],q.prototype,\"sublayers\",void 0),e([y(\"sublayers\",{layers:{type:[N]},visibleLayers:{type:[l]}})],q.prototype,\"writeSublayers\",null),e([m({type:[\"show\",\"hide\",\"hide-children\"]})],q.prototype,\"listMode\",void 0),e([m({json:{read:!1},readOnly:!0,value:\"map-image\"})],q.prototype,\"type\",void 0),e([m(P)],q.prototype,\"url\",void 0),q=e([u(\"esri.layers.MapImageLayer\")],q);const k=q;export{k as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nfunction o(o){const n=o.layer;if(\"floorInfo\"in n&&n.floorInfo?.floorField&&\"floors\"in o.view){return l(o.view.floors,n.floorInfo.floorField)}return null}function n(o,n){return\"floorInfo\"in n&&n.floorInfo?.floorField?l(o,n.floorInfo.floorField):null}function l(o,n){if(!o?.length)return null;const l=o.filter((o=>\"\"!==o)).map((o=>`'${o}'`));return l.push(\"''\"),`${n} IN (${l.join(\",\")}) OR ${n} IS NULL`}export{o as getFloorFilterClause,n as getLayerFloorFilterClause};\n"],"sourceRoot":""}